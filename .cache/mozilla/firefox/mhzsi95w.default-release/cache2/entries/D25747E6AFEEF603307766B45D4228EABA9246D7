/**
 * Fichier JavaScript global
 */

// Global variables
var refreshObj = new Object();
var timerObj = new Object();
var translationsAreLoaded = false;
var switch_package = false;

var isAppleCNA = (navigator.userAgent.match(/iPhone|iPad|iPod/i)
	&& navigator.userAgent.match(/mozilla\//i)
	&& navigator.userAgent.match(/applewebkit\//i)
	&& navigator.userAgent.match(/mobile\//i)
	&& ! navigator.userAgent.match(/safari/i));

var isAppleCNA_fakeclick = false;

$(document).ready(function() {
	// Patch to avoid intempestive informative widget apparition before its display management
	// at the end of the function displayStep cf #15143 and #15121.
	// Report from default portal even if we can't edit standard portal yet.
	if (typeof informativeWidget_configure == 'function') {
		$('#widget_informative').hide();
	}
	// Initialize portal
	$.portal_api('init', initPortal);
});


function handle_force_disconnect()
{
	if ($.settings.user != undefined && $.settings.user.force_feedback_disconnect != undefined && $.settings.user.force_feedback_disconnect) {
		displayWaitingIcon(true);
		feedbackFormDisconnect();
		return true;
	}
	return false;
}


function handle_autoconnect()
{
	if ( $.settings.subscribe != undefined && $.settings.subscribe.autoconnect != undefined && $.settings.step=="LOGON") {
		$('form[name="logonForm"] input[name="login"]').val($.settings.subscribe.autoconnect.login);
		$('form[name="logonForm"] input[name="password"]').val($.settings.subscribe.autoconnect.password);
		// Since autoConnect, set by default the policy to true
		$('form[name="logonForm"] input[name="logonForm_logon_policy_accept"]').attr("checked", true);

		var policy_accepted = $('form[name="logonForm"] input[name="logonForm_logon_policy_accept"]').is(':checked');
		if ( $.settings.logon != undefined && $.settings.logon.policy != undefined && $.settings.logon.policy.display == true && ! policy_accepted ) {
			// Policy is displayed and not accepted. User has to accept it before login.
			return false;
		}
		else {
			$.portal_api('setInAutoConnect', true);
			logonFormConnect();
			// avoid to display portal
			if ( $.settings.subscribe.autoconnect.follow_cloud_redirect == true ) {
				return true;
			}
		}

	}

	return false;
}

function displayWaitingIcon( state )
{
	var display = false;
	if ( (state == true) || (state == false) ) {
		display = state;
	}

	if( display == true)
	{
		$("#waiting_icon_block").show();
		$("#reserved_block").show();
	}
	else
	{
		$("#waiting_icon_block").hide();
	}
}


/* Called just after the portal was loaded in order to get all translations and configure all sub-modules */
function initPortal( data ){

    if ( $.settings != undefined && $.settings.redirect != undefined ) {
        window.location = $.settings.redirect;
    }


    /* Gather translation file then translate */
    var portal_format = null;
    var path_tokens = window.location.pathname.split('/');
    for ( var i = 0; i < path_tokens.length; i++ ) {
        if ( path_tokens[i].toUpperCase().indexOf('PORTAL') === 0 ) {
            portal_format = path_tokens[i];
        }
    }
    if ( portal_format == null ) {
        portal_format = 'portal';
    }
    $.portal_api('getTranslations', portal_format, function (){
        // Translate informative widget first
        if ( typeof informativeWidget_configure == 'function' ) {
            informativeWidget_configure();
        }
        translate($.settings.user.lang);
        translationsAreLoaded = true;
    });

    /* Configure Portal */
    lang_block_configure();
    replaceAllFreeURLs();
	configureDOM($.settings.user.lang, "policy");
	configureDOM($.settings.user.lang, "private_policy");

    if ( handle_force_disconnect() ) {
        return;
    }

    if ( handle_autoconnect() ) {
        return;
    }


    /* Configure reserved_block */
    if ( $.settings != undefined && $.settings.auth_modes != undefined ) {
        // Order is important
        securePwdForm_configure();
        autoLogonForm_configure();
        logonForm_configure();
        forceModifyPwdForm_configure();
        feedbackForm_configure();
        modifyPwdForm_configure();
        getPurchaseSummaryForm_configure();
        upgradeAccountForm_configure();
        manageAccountForm_configure();

        smsSubscriptionForm_configure();
        mailSubscriptionForm_configure();
        oneSubscriptionForm_configure();
        directSubscriptionForm_configure();
        printSubscriptionForm_configure();
        paypalSubscriptionForm_configure();
        ogoneSubscriptionForm_configure();
        ppsSubscriptionForm_configure();

        paypalPaymentForm_configure();
        ogonePaymentForm_configure();
        pmsPaymentForm_configure();

        pwdRecoveryForm_configure();
        pwdRecoverySetForm_configure();

        accountRefillForm_configure();

        shibAuthenticated();

	pre_portal_configure();

        // Analize step
        displayStep();
    }
}

/* Display the portal accordingly to its step or configuration */
function displayStep(){

    if ( !handleCentralPortalRedirection() ) {
        return;
    }

    /* Display right block */
    securePwdForm_display();
    autoLogonForm_display();
    logonForm_display();
    forceModifyPwdForm_display();
    feedbackForm_display();
    modifyPwdForm_display();
    getPurchaseSummaryForm_display();
    upgradeAccountForm_display();
    manageAccountForm_display();

    smsSubscriptionForm_display();
    mailSubscriptionForm_display();
    oneSubscriptionForm_display();
    directSubscriptionForm_display();
    printSubscriptionForm_display();
    paypalSubscriptionForm_display();
    ogoneSubscriptionForm_display();
    ppsSubscriptionForm_display();

    paypalPaymentForm_display();
    ogonePaymentForm_display();
    pmsPaymentForm_display();

    pwdRecoveryForm_display();
    pwdRecoverySetForm_display();

    logonFormSubscribeChoice_display(false);

	pre_portal_display();

    // Widgets
    if ( typeof informativeWidget_display == 'function' ) {
        informativeWidget_display();
    }
    else {
        // Display reserved_block slowly
        $('#reserved_block').fadeIn('slow');
    }
}

/** Handles central portal redirection to post credentials on the local
 * controller
 */
function handleCentralPortalRedirection(){

    if ( $.settings.user.login_URL_params != undefined && ($.settings.user.isConnected == undefined || $.settings.user.isConnected != true) ) {
        displayWaitingIcon(true);
        return buildRedirectionURL($.settings.user.login_URL_params);

    }

    return true;

}

function buildRedirectionURL( url_params ){

    /* When we are a central controller, we need to redirect the client to his
     * local controller (AKA remote controller)
     * This creates a temporary form populated with the client's credentials
     * The form is submitted to the URL given by the remote controller
     * According to
     * http://stackoverflow.com/questions/3770324/jquerys-form-submit-not-working-in-ie/6694054#6694054
     * it only works this way on IE 9
     */
    if ( url_params != undefined ) {

        var target_URL;
        var port = '443';
        var protocol = 'https';
        var host = '';
        var uri = '';

        if ( url_params.url != undefined ) {
            target_URL = url_params.url;
        }
        else {

            if ( url_params.host != undefined ) {
                host = url_params.host;
            }
            if ( url_params.port != undefined ) {
                port = url_params.port;
            }
            if ( url_params.protocol != undefined ) {
                protocol = url_params.protocol;
            }
            if ( url_params.uri != undefined ) {
                uri = url_params.uri;
            }

            target_URL = protocol + '://' + host + ':' + port + '/' + uri;

        }

	var parameters = url_params.parameters;
	var send_cna_id = $.portal_api('isInAutoConnect');
	var cna_id = $.portal_api('getCnaId');
	if (send_cna_id == true && cna_id != null) {
		if (parameters === undefined) {
			parameters = new Object();
		}
		parameters.cna_id = cna_id;
	}
	if ($('form[name="logonForm"] input[name="wispr_mode"]').is(':checked')) {
		parameters.wispr_mode = 'true';
	}

        if ( url_params.type != undefined && url_params.type == "POST" ) {
            var form = document.createElement("form");
            $(form).attr("action", target_URL);
            $(form).attr("method", "POST");
            if ( parameters != undefined ) {
                $.each(parameters, function ( index, value ){
                    $(form).append('<input name="' + index + '" value="' + value + '">');
                });
            }
            document.body.appendChild(form);
            $(form).submit();
            document.removeChild(form);
            return false;

        }
        else { /* GET */
            if ( parameters != undefined ) {
                var get_params = (target_URL.indexOf('?') == -1) ? '?' : '&';
                $.each(parameters, function ( index, value ){
                    get_params += index + '=' + value + '&';
                });

                get_params = get_params.substr(0, get_params.length - 1);

                target_URL += get_params;

            }

            window.location = target_URL;
            return false;
        }
    }
}

/* Display and translate all the error or information message on top of the reserved_block */
function displayErrorInfo( displayLang ){
    if ( displayLang == undefined ) {
        if ( $.settings != undefined && $.settings.user != undefined ) {
            displayLang = $.settings.user.lang;
        }
    }

    if ( $.settings != undefined ) {
        var lang = $.translations;

        if ( $.settings.error != undefined ) {
            // This exception indicate that user maybe attempt to bypass controller portal zone redirection
            if ( $.settings.error.code == "error_redirect-to-index" && $.settings.redirect != undefined ) {
                window.location = $.settings.redirect;
            }

            $('#error_info_value').text($.settings.error.code).removeClass("info").addClass("error");
            // Use a better query or xpath
            $(lang).find('error').each(function (){
                var error = $(this);
                $(this).find('msgid').each(function (){
                    var id = $(this).text();
                    if ( id == $.settings.error.code ) {
                        var trans = error.find(displayLang).text();
                        if ( trans == "" ) {
                            trans = error.find($.settings.lang.defaultLang).text();
                        }
                        if ( trans != "" ) {
                            // For custom fields name in the error message
                            var subscription_modes = new Array("direct", "mail", "sms", "paypal", "ogone", "one", "print"); // Differents subscription mode where custom fields are available
                            var custom_field_error = false;

                            var creationMode = undefined;
                            if ( $.settings.error.code.indexOf("error_personal-settings") > -1 ) {
                                var creationModeRegExp = new RegExp("^portal-([a-zA-Z]+)$");
                                var creationModeMatches = creationModeRegExp.exec($.settings.user.creationMode.value);
                                if ( creationModeMatches != undefined ) {
                                    creationMode = creationModeMatches[1];
                                }
                            }

                            for ( key in subscription_modes ) {
                                var subscription_mode = subscription_modes[key];
                                if ( ($.settings.error.code == "error_" + subscription_mode + "-subscribe_no-custom-field")
                                    || (creationMode != undefined && $.settings.error.code.indexOf("no-custom-field") > -1 && subscription_mode == creationMode)
									|| ($.settings.error.code == 'error_subscribe_no-custom-field' && $.settings.subscribe[subscription_mode] != undefined)) {

                                    custom_field_error = true;
                                    if ( $.settings.subscribe[subscription_mode][$.settings.error.value].labels[displayLang] != undefined ) {
                                        $('#error_info_value').text($.sprintf(trans, $.settings.subscribe[subscription_mode][$.settings.error.value].labels[displayLang]));
                                    }
                                    else if ( $.settings.subscribe[subscription_mode][$.settings.error.value].labels[$.settings.lang.defaultLang] != undefined ) {
                                        $('#error_info_value').text($.sprintf(trans, $.settings.subscribe[subscription_mode][$.settings.error.value].labels[$.settings.lang.defaultLang]));
                                    }
                                    else {
                                        $('#error_info_value').text($.sprintf(trans, $.settings.subscribe[subscription_mode][$.settings.error.value].labels[$.settings.lang.customFieldsDefaultLang]));
                                    }
                                }
                                else if ( ($.settings.error.code == "error_" + subscription_mode + "-subscribe_invalid-custom-field")
                                    || (creationMode != undefined && $.settings.error.code.indexOf("invalid-custom-field") > -1 && subscription_mode == creationMode)
									|| ($.settings.error.code == 'error_subscribe_invalid-custom-field' && $.settings.subscribe[subscription_mode] != undefined)) {

                                    custom_field_error = true;
                                    if ( $.settings.subscribe[subscription_mode][$.settings.error.value[0]].labels[displayLang] != undefined ) {
                                        $('#error_info_value').text($.sprintf(trans, $.settings.subscribe[subscription_mode][$.settings.error.value[0]].labels[displayLang], $.settings.error.value[1]));
                                    }
                                    else if ( $.settings.subscribe[subscription_mode][$.settings.error.value[0]].labels[$.settings.lang.defaultLang] != undefined ) {
                                        $('#error_info_value').text($.sprintf(trans, $.settings.subscribe[subscription_mode][$.settings.error.value[0]].labels[$.settings.lang.defaultLang], $.settings.error.value[1]));
                                    }
                                    else {
                                        $('#error_info_value').text($.sprintf(trans, $.settings.subscribe[subscription_mode][$.settings.error.value[0]].labels[$.settings.lang.customFieldsDefaultLang], $.settings.error.value[1]));
                                    }
									break;
                                }
                            }

                            var error_block;
                            for ( key in subscription_modes ) {
                                var subscription_mode = subscription_modes[key];
                                if ( $.settings.error.code == 'error_' + subscription_mode + '-subscribe_invalid-password' ) {
                                    error_block = $('#SubscriptionErrorBlock').clone();
                                    $('#SubscriptionErrorBlock_text', error_block).text($.sprintf(trans, ""));
                                }
                            }
                            if ( error_block != undefined || $.settings.error.code.indexOf('error_modify-pwd_invalid-password') > -1
                                || $.settings.error.code.indexOf('error_force-modify-pwd_invalid-password') > -1 ) {
                                if ( $.settings.error.code.indexOf('error_force-modify-pwd_invalid-password') > -1 ) {
                                    error_block = $('#forceModifyPwdErrorBlock').clone();
                                    $("#forceModifyPwdErrorBlock_text", error_block).text($.sprintf(trans, ""));
                                }
                                else if ( $.settings.error.code.indexOf('error_modify-pwd_invalid-password') > -1 ) {
                                    var error_block = $('#modifyPwdErrorBlock').clone();
                                    $("#modifyPwdErrorBlock_text", error_block).text($.sprintf(trans, ""));
                                }
                                $.each($.settings.error.value, function ( index, value ){
                                    var translation = getErrorTranslation($.settings.error.code + '-' + value.cause, displayLang);
                                    if ( translation == "" ) {
                                        translation = getErrorTranslation($.settings.error.code + '-' + value.cause, $.settings.lang.defaultLang);
                                    }
                                    switch ( value.cause ) {
                                        case "small":
                                            var error_line = $('li:first', error_block).clone();
                                            error_line.show();
                                            error_line.text($.sprintf(translation, value.minimum));
                                            $('ul:first', error_block).append(error_line);
                                            break;
                                        case "big":
                                            var error_line = $('li:first', error_block).clone();
                                            error_line.show();
                                            error_line.text($.sprintf(translation, value.maximum));
                                            $('ul:first', error_block).append(error_line);
                                            break;
                                        case "missing-occurance":
                                            $.each(value.classes, function ( index, char_class ){
                                                if ( char_class.quota > 0 ) {
                                                    var error_line = $('li:first', error_block).clone();
                                                    error_line.show();
                                                    error_line.text($.sprintf(translation, char_class.quota, char_class.set.join("")));
                                                    $('ul:first', error_block).append(error_line);
                                                }
                                            });
                                            break;
                                    }
                                });
                                error_block.show();
                                $('#error_info_value').html(error_block);
                            }
                            else if ($.settings.error.code == 'error_logon_volume-quota-reached-detail') {
                                // it's only next renew timestamp in which we have an interest
                                if ($.settings.error.value.renewTimeStamp != undefined && $.settings.error.value.zoneOffset != undefined) {
                                    var data_renew = explodeDate(new Date((parseInt($.settings.error.value.renewTimeStamp) + parseInt($.settings.error.value.zoneOffset)) * 1000)); // Must give date in milliseconds
                                    var date_renew = $.sprintf(
                                            getGenericTranslation('full-date-display', displayLang),
                                            data_renew.year,
                                            data_renew.monthNumber,
                                            getGenericTranslation(data_renew.month, displayLang),
                                            data_renew.dayNumber,
                                            getGenericTranslation(data_renew.day, displayLang),
                                            data_renew.hours[24],
                                            data_renew.minutes,
                                            data_renew.hours[12],
                                            data_renew.hours['ext']
                                    );
                                    if ($.settings.error.value.isControllerTimezone === false && $.settings.error.value.zoneTimezone != undefined) {
                                        date_renew += ' (' + $.settings.error.value.zoneTimezone + ')';
                                    }
                                    var error_text = $.sprintf(trans, date_renew);
                                    $('#error_info_value').text(error_text);
                                }
                                else {
                                    // rollback error message without renew timestamp if we have an error
                                    $.settings.error.code = 'error_logon_volume-quota-reached';
                                }
                            }
                            else {
                                if ( custom_field_error == false ) {
                                    $('#error_info_value').text($.sprintf(trans, $.settings.error.value));
                                }
                            }
                        }
                    }
                });
            });
			setTimeout(resetErrorInfo, 10000); // Show the error message for 10 seconds before hidding it
        }
        else if ( $.settings.info != undefined ) {
            $('#error_info_value').text($.settings.info.code).removeClass("error").addClass("info");
            // Use a better query or xpath
            $(lang).find('info').each(function (){
                var info = $(this);
                $(this).find('msgid').each(function (){
                    var id = $(this).text();
                    if ( id == $.settings.info.code ) {
                        var trans = info.find(displayLang).text();
                        if ( trans == "" ) {
                            trans = info.find($.settings.lang.defaultLang).text();
                        }
                        if ( trans != "" ) {
                            $('#error_info_value').text($.sprintf(trans, $.settings.info.value));
                        }
                    }
                });
            });
			setTimeout(resetErrorInfo, 30000); // Show the error message for 30 seconds before hidding it
        }
        else {
            $('#error_info_value').html('&nbsp;').removeClass("error info");
        }
    }
    else {
        $('#error_info_value').html('&nbsp;').removeClass("error info");
    }
}

function resetErrorInfo() {
	$('#error_info_value').html('&nbsp;').removeClass("error info");
}


/*****************************************************************************/
/***** Communication Functions                                           *****/
/***** ***** ***** ***** ***** ***** ***** ***** ***** ***** ***** ***** *****/


/** Authenticate an user on the controller
 * @param callbacks - Callback functions                            [REQUIRED]
 * @param params - The params used to connect a user                [REQUIRED]
 * - login : The user's account login                               [REQUIRED]
 * - password : The user's account password                         [REQUIRED]
 * - securePwd : The portal securization password                   [OPTIONAL, we'll be required if option enabled on portal configuration]
 * - policyAccept : Proove that user agreed the policy (boolean)    [OPTIONAL, we'll be required if option enabled on portal configuration]
 */
function authenticate( callbacks, params ){

    var request = new Object();
    request.action = "authenticate";

    if ( params == undefined ) {
        return false;
    }

    // Check package change
    if ( (params.switchPackage != undefined) && (params.switchPackage == true) ) {
        request.switch_package = params.switchPackage;
        if ( $.settings.user.timeCredit != undefined ) {
            delete $.settings.user.timeCredit;
        }
    }

    if ( ($.settings.step != undefined && $.settings.step == "PAYMENT") && ($.settings.type != undefined && $.settings.type == "PMS") ) {
        // Check only login
        if ( params.login == undefined ) {
            return false;
        } else {
            request.login = params.login;
        }
    } else {
        // Check required parameters
        if ( (params.login == undefined) || (params.password == undefined) ) {
            return false;
        }
        else {
            request.login = params.login;
            request.password = params.password;
        }
    }

    // Get optional parameters
    request.secure_pwd = params.securePwd;
    request.policy_accept = params.policyAccept;
    request.private_policy_accept = params.privatePolicyAccept;

    // Let the portal know the request came from AJAX
    request.from_ajax = true;

    // For package change
    if ( params.lastProfile != undefined )
        request.last_profile = params.lastProfile;

	// send cna id
	if (params.cna_id != undefined) {
		request.cna_id = params.cna_id;
	}
	// send wispr mode
	if (params.wispr_mode != undefined) {
		request.wispr_mode = params.wispr_mode;
	}

	// send option mode
	if (params.option != undefined) {
		request.option = params.option;
	}

    $.portal_api('action', request, callbacks);
}

/** Authenticate an user on the controller for automatic connection
 * @param callbacks - Callback functions                            [REQUIRED]
 * @param params - The params used to connect a user                [OPTIONAL]
 * - securePwd : The portal securization password                   [OPTIONAL, we'll be required if option enabled on portal configuration]
 * - policyAccept : Proove that user agreed the policy              [OPTIONAL, we'll be required if option enabled on portal configuration]
 */
function autoAuthenticate( callbacks, params ){

    var request = new Object();
    request.action = "automatic_authenticate";

    // Get optional parameters
    request.secure_pwd = params.securePwd;
    request.policy_accept = params.policyAccept;

    $.portal_api('action', request, callbacks);
}

/** Authenticate an user on the controller for automatic connection
 * @param callbacks - Callback functions                            [REQUIRED]
 * @param params - The params used to connect a user                [NOT USED]
 */
function informativeWidgetAuthenticate( callbacks, params ){

    var request = new Object();
    request.action = "informativeWidget_authenticate";

    $.portal_api('action', request, callbacks);
}

/** Authenticate an user on with social network credential
 *  Only used to check policy accept
 * @param callbacks - Callback functions                            [REQUIRED]
 * @param params - The params used to connect a user                [REQUIRED]
 * - securePwd : The portal securization password                   [OPTIONAL, we'll be required if option enabled on portal configuration]
 * - policyAccept : Proove that user agreed the policy (boolean)    [OPTIONAL, we'll be required if option enabled on portal configuration]
 */
function socialNetworkAuthenticate( callbacks, params ){

    var request = new Object();
    request.action = "social_network_authenticate";

    if ( params == undefined ) {
        return false;
    }

    // Get optional parameters
    request.secure_pwd = params.securePwd;
    request.policy_accept = params.policyAccept;
	if ( params.privatePolicyAccept != undefined ) {
		request.private_policy_accept = params.privatePolicyAccept;
	}
    request.type = params.type;
    if (request.type == 'twitter') {
        request.user_follow = params.userFollow;
    }
	if (request.type == 'facebook') {
		request.user_like = params.userLike;
	}
    $.portal_api('action', request, callbacks);
}

/** Disconnect an user on the controller
 * @param callbacks - Callback functions                            [REQUIRED]
 * @param params - The params used to disconnect a user             [REQUIRED]
 * - login : The user's account login                               [REQUIRED]
 * - securePwd : The portal securization password                   [OPTIONAL, we'll be required if option enabled on portal configuration]
 */
function disconnect( callbacks, params ){

    var request = new Object();
    request.action = "disconnect";

    if ( params == undefined ) {
        return false;
    }

    // Check required parameters
    if ( params.login == undefined ) {
        return false;
    }
    else {
        request.login = params.login;
    }

    // Get optional parameters
    request.secure_pwd = params.securePwd;

    $.portal_api('action', request, callbacks);
}

/** Refresh the connection of an user on the controller
 * @param callbacks - Callback functions                            [REQUIRED]
 * @param params - The params used to refresh a user                [REQUIRED]
 * - login : The user's account login                               [REQUIRED]
 * - securePwd : The portal securization password                   [OPTIONAL, we'll be required if option enabled on portal configuration]
 */
function refresh( callbacks, params ){
    var request = new Object();
    request.action = "refresh";

    if ( params == undefined ) {
        return false;
    }

    // Check required parameters
    if ( params.login == undefined ) {
        return false;
    }
    else {
        request.login = params.login;
        var currentDate = new Date();
        request.time = currentDate.getTime();
    }

    // Get optional parameters
    request.secure_pwd = params.securePwd;

    if ( ( ($.settings.type == "CONNECT") || ($.settings.type == "REFRESH") ) && ($.settings.user.autoDisconnect != undefined && $.settings.user.autoDisconnect.value != true) ) {
        $.portal_api('action', request, callbacks);
    }
}

/** Request a check of the secure password to know if the user can go further
 * @param callbacks - Callback functions                            [REQUIRED]
 * @param params - The params used to access the portal             [REQUIRED]
 * - securePassword : The portal securization password              [REQUIRED]
 */
function securePwd( callbacks, params ){

    var request = new Object();
    request.action = "secure_pwd";

    if ( params == undefined ) {
        return false;
    }

    // Check required parameters
    if ( params.securePwd == undefined ) {
        return false;
    }
    else {
        request.secure_pwd = params.securePwd;
    }

    $.portal_api('action', request, callbacks);
}

/** Modify the user's account password on the controller (after been connected)
 * @param callbacks - Callback functions                            [REQUIRED]
 * @param params - The params used to modify the user's password    [REQUIRED]
 * - login : The user's account login                               [REQUIRED]
 * - password : The current user's account password                 [REQUIRED]
 * - newPassword : The new account password                         [REQUIRED]
 * - newPasswordConfirm : The new account password confirmation     [REQUIRED]
 * - securePwd : The portal securization password                   [OPTIONAL, we'll be required if option enabled on portal configuration]
 */
function modifyPwd( callbacks, params ){

    var request = new Object();
    request.action = "modify_pwd";

    if ( params == undefined ) {
        return false;
    }

    // Check required parameters
    if ( (params.login == undefined) || (params.password == undefined) || (params.newPassword == undefined) || (params.newPasswordConfirm == undefined) ) {
        return false;
    }
    else {
        request.login = params.login;
        request.password = params.password;
        request.new_password = params.newPassword;
        request.new_password_confirm = params.newPasswordConfirm;
    }

    // Get optional parameters
    request.secure_pwd = params.securePwd;

    $.portal_api('action', request, callbacks);
}

/** Modify the user's account password on the controller (before been connected)
 * @param callbacks - Callback functions                            [REQUIRED]
 * @param params - The params used to modify the user's password    [REQUIRED]
 * - login : The user's account login                               [REQUIRED]
 * - password : The current user's account password                 [REQUIRED]
 * - newPassword : The new account password                         [REQUIRED]
 * - newPasswordConfirm : The new account password confirmation     [REQUIRED]
 * - securePwd : The portal securization password                   [OPTIONAL, we'll be required if option enabled on portal configuration]
 */
function forceModifyPwd( callbacks, params ){

    var request = new Object();
    request.action = "force_modify_pwd";

    if ( params == undefined ) {
        return false;
    }

    // Check required parameters
    if ( (params.login == undefined) || (params.password == undefined) || (params.newPassword == undefined) || (params.newPasswordConfirm == undefined) ) {
        return false;
    }
    else {
        request.login = params.login;
        request.password = params.password;
        request.new_password = params.newPassword;
        request.new_password_confirm = params.newPasswordConfirm;
    }

    // Get optional parameters
    request.secure_pwd = params.securePwd;

    $.portal_api('action', request, callbacks);
}

/** Cancel the current action then go back
 * @param callbacks - Callback functions                            [REQUIRED]
 */
function backAction( callbacks ){

    var request = new Object();
    request.action = "back_action";

    $.portal_api('action', request, callbacks);
}

/** Send the parameters on an user subscribing on the controller
 * @param callbacks - Callback functions                            [REQUIRED]
 * @param params - The params used to create a user account         [REQUIRED]
 * - type : The subcription type                                    [REQUIRED]
 * - securePwd : The portal securization password                   [OPTIONAL, we'll be required if option enabled on portal configuration]
 * + SMS Type
 *   - prefix : The prefix (country code) of the user phone number  [REQUIRED]
 (33 for France, 49 for Germany)
 *   - phone : The user phone number                                [REQUIRED]
 *   - lastName : The user last name                                [REQUIRED]
 *   - firstName : The user first name                              [REQUIRED]
 *   - emailAddress : The user email address                        [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - organizationUnitName : The user company name                 [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - postalAddress : The user postal address                      [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - postalCode : The user address postal code                    [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - postalLocalityName : The user address locality name          [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - postalPostofficeBox : The user address postoffice box        [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - postalStateOrProvinceName : The user address st. or pr. name [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - postalCountryName : The user address country name            [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - personalField_1 : First additional field                     [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - personalField_2 : Second additional field                    [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - personalField_3 : Third additional field                     [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - sponsor_email : The sponsor email                            [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - policyAccept : Proove that user agreed the policy            [OPTIONAL, we'll be required if option enabled on portal configuration]
 * + Mail Type
 *   - emailAddress : The user email address                        [REQUIRED]
 *   - prefix : The prefix (country code) of the user phone number  [OPTIONAL, we'll be required if option enabled on portal configuration]
 (33 for France, 49 for Germany)
 *   - phone : The user phone number                                [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - lastName : The user last name                                [REQUIRED]
 *   - firstName : The user first name                              [REQUIRED]
 *   - organizationUnitName : The user company name                 [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - postalAddress : The user postal address                      [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - postalCode : The user address postal code                    [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - postalLocalityName : The user address locality name          [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - postalPostofficeBox : The user address postoffice box        [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - postalStateOrProvinceName : The user address st. or pr. name [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - postalCountryName : The user address country name            [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - personalField_1 : First additional field                     [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - personalField_2 : Second additional field                    [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - personalField_3 : Third additional field                     [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - sponsor_email : The sponsor email                            [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - policyAccept : Proove that user agreed the policy            [OPTIONAL, we'll be required if option enabled on portal configuration]
 * + One type
 * + Direct Type
 * + Print Type
 * + Paypal Type
 * + Ogone Type
 *   - lastName : The user last name                                [REQUIRED]
 *   - firstName : The user first name                              [REQUIRED]
 *   - login : The user's account login                             [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - password : The new account password                          [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - passwordConfirm : The new account password confirmation      [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - prefix : The prefix (country code) of the user phone number  [OPTIONAL, we'll be required if option enabled on portal configuration]
 ( 33 for France, 49 for Germany)
 *   - phone : The user phone number                                [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - emailAddress : The user email address                        [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - organizationUnitName : The user company name                 [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - postalAddress : The user postal address                      [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - postalCode : The user address postal code                    [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - postalLocalityName : The user address locality name          [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - postalPostofficeBox : The user address postoffice box        [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - postalStateOrProvinceName : The user address st. or pr. name [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - postalCountryName : The user address country name            [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - personalField_1 : First additional field                     [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - personalField_2 : Second additional field                    [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - personalField_3 : Third additional field                     [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - sponsor_email : The sponsor email                            [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - policyAccept : Proove that user agreed the policy            [OPTIONAL, we'll be required if option enabled on portal configuration]
 * + PPS Type
 *   - scratchCode : Scratch code from prepay card                  [REQUIRED]
 *   - captchaCode : Code from portal display to validate logon     [REQUIRED]
 *   - policyAccept : Proove that user agreed the policy            [OPTIONAL, we'll be required if option enabled on portal configuration]
 */
function subscribe( callbacks, params ){

    var request = new Object();
    request.action = "subscribe";

    if ( params == undefined ) {
        return false;
    }

    // Check required parameter
    if ( params.type == undefined ) {
        return false;
    }
    else {
        request.type = params.type;
    }

    switch ( params.type ) {
        case "sms":
        case "mail":
            // Get parameters for subscription
            request.last_name = params.lastName;
            request.first_name = params.firstName;
            request.email_address = params.emailAddress;
            request.prefix = params.prefix;
            request.phone = params.phone;
            request.private_policy_accept = params.privatePolicyAccept;
            request.organizational_unit_name = params.organizationalUnitName;
            // Postal address
            request.postal_address = params.postalAddress;
            request.postal_code = params.postalCode;
            request.postal_locality_name = params.postalLocalityName;
            request.postal_postoffice_box = params.postalPostofficeBox;
            request.postal_state_or_province_name = params.postalStateOrProvinceName;
            request.postal_country_name = params.postalCountryName;

            request.personal_field_1 = params.personalField_1;
            request.personal_field_2 = params.personalField_2;
            request.personal_field_3 = params.personalField_3;

            request.sponsor_email = params.sponsorEmail;
            request.gender = params.gender;
            request.birth_date = params.birthDate;
            request.user_language = params.userLanguage;
            request.interests = params.interests;
            break;

        case "one":
            request.connect_policy_accept = params.connectPolicyAccept;
        case "direct":
        case "print":
        case "paypal":
        case "ogone":
            // Get parameters for subscription
            request.user_login = params.login;
            request.user_password = params.password;
            request.user_password_confirm = params.passwordConfirm;
            request.last_name = params.lastName;
            request.first_name = params.firstName;
            request.email_address = params.emailAddress;
            request.prefix = params.prefix;
            request.phone = params.phone;
            request.private_policy_accept = params.privatePolicyAccept;
            request.organizational_unit_name = params.organizationalUnitName;
            // Postal address
            request.postal_address = params.postalAddress;
            request.postal_code = params.postalCode;
            request.postal_locality_name = params.postalLocalityName;
            request.postal_postoffice_box = params.postalPostofficeBox;
            request.postal_state_or_province_name = params.postalStateOrProvinceName;
            request.postal_country_name = params.postalCountryName;

            request.personal_field_1 = params.personalField_1;
            request.personal_field_2 = params.personalField_2;
            request.personal_field_3 = params.personalField_3;

            request.sponsor_email = params.sponsorEmail;
            request.gender = params.gender;
            request.birth_date = params.birthDate;
            request.user_language = params.userLanguage;
            request.interests = params.interests;
            break;

        case "pps":
            // Get parameters for pps subscription
            request.scratch_code = params.scratchCode;
            request.captcha_code = params.captchaCode;
            request.policy_accept = params.policyAccept;
            //TODO: Check if optin is to be seen here
            break;

        default:
            return false;
            break;
    }

    // Get optional parameters
    request.secure_pwd = params.securePwd;

    $.portal_api('action', request, callbacks);
}

/** Select PMS package for user
 * @param callbacks - Callback functions                            [REQUIRED]
 * @param params - The params used to select a PMS package          [REQUIRED]
 * - login : The user's account login                               [REQUIRED]
 * - package : The package choosen by user                          [REQUIRED]
 * - securePwd : The portal securization password                   [OPTIONAL, we'll be required if option enabled on portal configuration]
 * - policyAccept : Proove that user agreed the policy              [OPTIONAL, we'll be required if option enabled on portal configuration]
 */
function selectPmsPackage( callbacks, params ){

    var request = new Object();
    request.action = "select_pms_package";

    if ( params == undefined ) {
        return false;
    }

    if ( $.settings.payment == undefined ) {
        return false;
    }

	request.login = $.settings.payment.login;

	if ( params.password != undefined ) {
		request.password = params.password;
	}

    request.secure_pwd = $.settings.payment.securePwd;
	request.policy_accept = $.settings.payment.policyAccept;
	request.private_policy_accept = $.settings.payment.privatePolicyAccept;

    request.package = params.package;

    // Get optional parameters
    request.secure_pwd = params.securePwd;

    $.portal_api('action', request, callbacks);
}

/** Select Paypal package for user
 * @param callbacks - Callback functions                            [REQUIRED]
 * @param params - The params used to select a Paypal package       [REQUIRED]
 * - login : The user's account login                               [REQUIRED]
 * - password : The current user's account password                 [REQUIRED]
 * - package : The package choosen by user                          [REQUIRED]
 * - securePwd : The portal securization password                   [OPTIONAL, we'll be required if option enabled on portal configuration]
 * - policyAccept : Proove that user agreed the policy              [OPTIONAL, we'll be required if option enabled on portal configuration]
 */
function selectPaypalPackage( callbacks, params ){

    var request = new Object();
    request.action = "select_paypal_package";

    if ( params == undefined ) {
        return false;
    }

    if ($.settings.payment == undefined) {
        return false;
    }
    request.login = $.settings.payment.login;
    request.process = $.settings.payment.process;
    request.secure_pwd = $.settings.payment.securePwd;
    request.policy_accept = $.settings.payment.policyAccept;
    request.package = params.package;

    // Get optional parameters
    request.secure_pwd = params.securePwd;

    $.portal_api('action', request, callbacks);
}

/** Select Ogone package for user
 * @param callbacks - Callback functions                            [REQUIRED]
 * @param params - The params used to select an Ogone package       [REQUIRED]
 * - login : The user's account login                               [REQUIRED]
 * - password : The current user's account password                 [REQUIRED]
 * - package : The package choosen by user                          [REQUIRED]
 * - securePwd : The portal securization password                   [OPTIONAL, we'll be required if option enabled on portal configuration]
 * - policyAccept : Proove that user agreed the policy              [OPTIONAL, we'll be required if option enabled on portal configuration]
 */
function selectOgonePackage( callbacks, params ){

    var request = new Object();
    request.action = "select_ogone_package";

    if ( params == undefined ) {
        return false;
    }

    if ($.settings.payment == undefined) {
        return false;
    }
    request.login = $.settings.payment.login;
    request.process = $.settings.payment.process;
    request.secure_pwd = $.settings.payment.securePwd;
    request.policy_accept = $.settings.payment.policyAccept;
    request.package = params.package;

    // Get optional parameters
    request.secure_pwd = params.securePwd;

    $.portal_api('action', request, callbacks);
}

/** Send Paypal subscription credential to user email or sms
 * @param callbacks - Callback functions                                     [REQUIRED]
 * @param params - The params used to send Paypal credentials by Mail or Sms [REQUIRED]
 * - action : The mode used to send credentials                              [REQUIRED]
 (paypal_send_sms for sms, paypal_send_mail for mail)
 * - login : The user's account login                                        [REQUIRED]
 * - password : The current user's account password                          [REQUIRED]
 * - email : The user email address                                          [REQUIRED, for mail action]
 * - prefix : The prefix (country code) of the user phone number             [REQUIRED, for sms action]
 (33 for France, 49 for Germany)
 * - phone : The user phone number                                           [REQUIRED, for sms action]
 * - securePwd : The portal securization password                    [OPTIONAL, we'll be required if option enabled on portal configuration]
 */
function subscriptionSendCredential( callbacks , params ) {

	var request = new Object();

	if (params == undefined) {
		return false;
	}

	request.action = params.action;
	request.login = params.login;
	request.password = params.password;
	request.prefix = params.prefix;
	request.phone = params.phone;
	request.email = params.email;

	// Get optional parameters
	request.secure_pwd = params.securePwd;
	$.portal_api('action', request, callbacks);
}

/** Send Paypal subscription SMS to user phone
 * @param callbacks - Callback functions                             [REQUIRED]
 * @param params - The params used to send Paypal credentials by SMS [REQUIRED]
 * - login : The user's account login                                [REQUIRED]
 * - password : The current user's account password                  [REQUIRED]
 * - prefix : The prefix (country code) of the user phone number     [REQUIRED]
 (33 for France, 49 for Germany)
 * - phone : The user phone number                                   [REQUIRED]
 * - securePwd : The portal securization password                    [OPTIONAL, we'll be required if option enabled on portal configuration]
 */
function paypalSendSms( callbacks, params ){

    var request = new Object();
    request.action = "paypal_send_sms";

    if ( params == undefined ) {
        return false;
    }

    request.login = params.login;
    request.password = params.password;
    request.prefix = params.prefix;
    request.phone = params.phone;

    // Get optional parameters
    request.secure_pwd = params.securePwd;

    $.portal_api('action', request, callbacks);
}

/** Send Ogone subscription SMS to user phone
 * @param callbacks - Callback functions                            [REQUIRED]
 * @param params - The params used to send Ogone credentials by SMS [REQUIRED]
 * - login : The user's account login                               [REQUIRED]
 * - password : The current user's account password                 [REQUIRED]
 * - prefix : The prefix (country code) of the user phone number    [REQUIRED]
 (33 for France, 49 for Germany)
 * - phone : The user phone number                                  [REQUIRED]
 * - securePwd : The portal securization password                   [OPTIONAL, we'll be required if option enabled on portal configuration]
 */
function ogoneSendSms( callbacks, params ){

    var request = new Object();
    request.action = "ogone_send_sms";

    if ( params == undefined ) {
        return false;
    }

    request.login = params.login;
    request.password = params.password;
    request.prefix = params.prefix;
    request.phone = params.phone;

    // Get optional parameters
    request.secure_pwd = params.securePwd;

    $.portal_api('action', request, callbacks);
}

/** Request portal API after return from  Ogone/Paypal payment page
 * @param callbacks - Callback functions                            [REQUIRED]
 * @param params - The params used to confirm payment type  [REQUIRED]
 * - login : The user's account login                               [REQUIRED]
 * - password : The user's account login                               [REQUIRED]
 * - type : payment type                    [REQUIRED]
 */
function verifyPayment( callbacks, params ){

    var request = new Object();

    if ( params == undefined ) {
        return false;
    }

    request.action = "verify_payment";
    request.login = params.login;
    request.process = $.settings.payment.process;
    request.type = $.settings.payment.type;
    $.portal_api('action', request, callbacks);
}


/** Request portal API after pay button pushed for Ogone portal
 * @param callbacks - Callback functions                            [REQUIRED]
 * @param params - The params used to confirm Ogone package choice  [REQUIRED]
 * - login : The user's account login                               [REQUIRED]
 * - orderid : ...
 */
function ogoneSubmitPayment( callbacks, params ){

    var request = new Object();
    request.action = "ogone_submit_payment";

    if (params == undefined) {
        return false;
    }
    request.login = params.login;
    request.orderid = params.orderid;
    request.password = params.password;
    request.package = $.settings.payment.package;
    request.process = $.settings.payment.process;
    $.portal_api('action', request, callbacks);
}

/** Request portal API after pay button pushed for Ogone portal
 * @param callbacks - Callback functions                            [REQUIRED]
 * @param params - The params used to confirm Ogone package choice  [REQUIRED]
 * - login : The user's account login                               [REQUIRED]
 * - orderid : ...
 */
function paypalSubmitPayment( callbacks , params ) {

    var request = new Object();
    request.action = "paypal_submit_payment";

    if (params == undefined) {
        return false;
    }
    request.login = params.login;
    request.password = params.password;
    request.package = $.settings.payment.package;
    request.process = $.settings.payment.process;
    $.portal_api('action', request, callbacks);
}

/** Request portal API on feedback to have a purchase summary
 * @param callbacks - Callback functions                            [REQUIRED]
 * @param params - The params used to get a purchase summary        [REQUIRED]
 * - login : The user's account login                               [REQUIRED]
 * - securePwd : The portal securization password                   [OPTIONAL, we'll be required if option enabled on portal configuration]
 */
function getPurchaseSummary( callbacks, params ){

    var request = new Object();
    request.action = "get_purchase_summary";

    if ( params == undefined ) {
        return false;
    }
    request.login = params.login;

    // Get optional parameters
    request.secure_pwd = params.securePwd;

    $.portal_api('action', request, callbacks);
}

/** Request portal API on feedback to have the current package settings
 * This functionnality isn't in portal config anymore since 6.x version
 * but it kept for backward portal compatibility in 5.x versions
 * @param callbacks - Callback functions                            [REQUIRED]
 * @param params - The params used to get the current user package  [REQUIRED]
 * - login : The user's account login                               [REQUIRED]
 * - securePwd : The portal securization password                   [OPTIONAL, we'll be required if option enabled on portal configuration]
 */
function getCurrentPackage( callbacks, params ){

    var request = new Object();
    request.action = "get_current_package";

    if ( params == undefined ) {
        return false;
    }
    request.login = params.login;

    // Get optional parameters
    request.secure_pwd = params.securePwd;

    $.portal_api('action', request, callbacks);
}

/** Request portal API on feedback to create a new upgrade order (allowing new multidevice sessions)
 * This functionnality isn't in portal config anymore since 6.x version
 * but it kept for backward portal compatibility in 5.x versions
 * @param callbacks - Callback functions                            [REQUIRED]
 * @param params - The params used to create a new upgrade order    [REQUIRED]
 * - login : The user's account login                               [REQUIRED]
 * - multidevice : The number of simultaneous sessions wanted       [REQUIRED]
 * - securePwd : The portal securization password                   [OPTIONAL, we'll be required if option enabled on portal configuration]
 */
function getUpgradeOrder( callbacks, params ){

    var request = new Object();
    request.action = "get_upgrade_order";

    if ( params == undefined ) {
        return false;
    }
    request.login = params.login;
    request.multidevice = params.multidevice;

    // Get optional parameters
    request.secure_pwd = params.securePwd;

    $.portal_api('action', request, callbacks);
}

/** Request portal API on feedback to update status of an existing order
 * This functionnality isn't in portal config anymore since 6.x version
 * but it kept for backward portal compatibility in 5.x versions
 * @param callbacks - Callback functions                               [REQUIRED]
 * @param params - The params used to update an existing upgrade order [REQUIRED]
 * - login : The user's account login                                  [REQUIRED]
 * - orderId : The order ID                                            [REQUIRED]
 * - securePwd : The portal securization password                      [OPTIONAL, we'll be required if option enabled on portal configuration]
 */
function updateUpgradeOrder( callbacks, params ){

    var request = new Object();
    request.action = "update_upgrade_order";

    if ( params == undefined ) {
        return false;
    }
    request.login = params.login;
    request.order_id = params.orderId;

    // Get optional parameters
    request.secure_pwd = params.securePwd;

    $.portal_api('action', request, callbacks);
}

/** Request portal API on feedback to check an existing order triggering modification account or not
 * This functionnality isn't in portal config anymore since 6.x version
 * but it kept for backward portal compatibility in 5.x versions
 * @param callbacks - Callback functions                              [REQUIRED]
 * @param params - The params used to check an existing upgrade order [REQUIRED]
 * - login : The user's account login                                 [REQUIRED]
 * - securePwd : The portal securization password                     [OPTIONAL, we'll be required if option enabled on portal configuration]
 */
function checkUpgradeOrder( callbacks, params ){

    var request = new Object();
    request.action = "check_upgrade_order";

    if ( params == undefined ) {
        return false;
    }
    request.login = params.login;

    // Get optional parameters
    request.secure_pwd = params.securePwd;

    $.portal_api('action', request, callbacks);
}

/** Switch display from current language to choosen one
 * @param callbacks - Callback functions                            [REQUIRED]
 * @param params - The params used to change the display language   [REQUIRED]
 * - language : The required display language                       [REQUIRED]
 */
function switchLanguage( callbacks, params ){

    var request = new Object();
    request.action = "switch_language";
    request.isAppleCNA_fakeclick = isAppleCNA ? isAppleCNA_fakeclick : false;

    isAppleCNA_fakeclick = false;
    if ( params == undefined ) {
        return false;
    }

    request.lang = params.language;

    $.portal_api('action', request, callbacks);
}

/** Push new personal information regarding the user account
 * @param callbacks - Callback functions                            [REQUIRED]
 * @param params - The params used to update user personal settings [OPTIONAL]
 *   - lastName : The user last name                                [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - firstName : The user first name                              [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - prefix : The prefix (country code) of the user phone number  [OPTIONAL, we'll be required if option enabled on portal configuration]
 ( 33 for France, 49 for Germany)
 *   - phone : The user phone number                                [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - emailAddress : The user email address                        [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - organizationUnitName : The user company name                 [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - postalAddress : The user postal address                      [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - postalCode : The user address postal code                    [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - postalLocalityName : The user address locality name          [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - postalPostofficeBox : The user address postoffice box        [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - postalStateOrProvinceName : The user address st. or pr. name [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - postalCountryName : The user address country name            [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - personalField_1 : First additional field                     [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - personalField_2 : Second additional field                    [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - personalField_3 : Third additional field                     [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - sponsor_email : The sponsor email                            [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - securePwd : The portal securization password                 [OPTIONAL, we'll be required if option enabled on portal configuration]
 */
function updatePersonalSettings( callbacks, params ){

    var request = new Object();
    request.action = "personal_settings_update";

    if ( params == undefined ) {
        return false;
    }

    request.last_name = params.lastName;
    request.first_name = params.firstName;
    request.email_address = params.emailAddress;
    request.prefix = params.prefix;
    request.phone = params.phone;
    request.organizational_unit_name = params.organizationalUnitName;
    // Postal address
    request.postal_address = params.postalAddress;
    request.postal_code = params.postalCode;
    request.postal_locality_name = params.postalLocalityName;
    request.postal_postoffice_box = params.postalPostofficeBox;
    request.postal_state_or_province_name = params.postalStateOrProvinceName;
    request.postal_country_name = params.postalCountryName;

    request.personal_field_1 = params.personalField_1;
    request.personal_field_2 = params.personalField_2;
    request.personal_field_3 = params.personalField_3;

    request.sponsor_email = params.sponsorEmail;
    // Get optional parameters
    request.secure_pwd = params.securePwd;
    if ( $.settings.user.privatePolicy !== undefined && params.privatePolicyAccept != $.settings.user.privatePolicy.value ) {
        // Send the OptOut only if value different from Optin
        request.private_policy_accept = params.privatePolicyAccept;
    }

    $.portal_api('action', request, callbacks);
}

/** Push new comments regarding the user account linked devices
 * @param callbacks - Callback functions                            [REQUIRED]
 * @param params - The params used to manage user devices           [REQUIRED]
 */
function updateDevicesSettings( callbacks, params ){

    var request = params; //new Object();
    request.action = "devices_settings_update";

    $.portal_api('action', request, callbacks);
}

/** Push new answers/questions regarding the password recovery feature
 * @param callbacks - Callback functions                            [REQUIRED]
 * @param params - The params used by the password recovery feature [REQUIRED]
 */
function updatePwdRecoverySecretQuestions( callbacks, params ){

    var request = params; //new Object();
    request.secure_pwd = params.securePwd;
    request.action = "pwd_recovery_secret_questions_update";

    $.portal_api('action', request, callbacks);
}

/** Get user account and password recovery options according to the given settings
 * @param callbacks - Callback functions                                [REQUIRED]
 * @param params - The params used to retreive an existing user account [REQUIRED]
 *   - login : The user's account login                                 [OPTIONAL]
 *   - prefix : The prefix (country code) of the user phone number      [OPTIONAL]
 ( 33 for France, 49 for Germany)
 *   - phone : The user phone number                                    [OPTIONAL]
 *   - emailAddress : The user email address                            [OPTIONAL]
 *   - securePwd : The portal securization password                     [OPTIONAL, we'll be required if option enabled on portal configuration]
 */
function getPwdRecoveryOptionsFromUser( callbacks, params ){

    var request = new Object();
    request.action = "get_pwd_recovery_options_from_user";

    if ( params == undefined ) {
        return false;
    }

    request.login = params.login;
    request.email_address = params.emailAddress;
    request.prefix = params.prefix;
    request.phone = params.phone;

    // Get optional parameters
    request.secure_pwd = params.securePwd;

    $.portal_api('action', request, callbacks);
}

/** Send a new user's password by SMS
 * @param callbacks - Callback functions                            [REQUIRED]
 * @param params - The params used to send a new user's password    [REQUIRED]
 *   - securePwd : The portal securization password                 [OPTIONAL, we'll be required if option enabled on portal configuration]
 */
function regenPwdWithSmsResend( callbacks, params ){

    var request = new Object();
    request.action = "regen_pwd_with_sms_resend";

    if ( params == undefined ) {
        return false;
    }

    // Get optional parameters
    request.secure_pwd = params.securePwd;

    $.portal_api('action', request, callbacks);
}

/** Send a new user's password by email
 * @param callbacks - Callback functions                            [REQUIRED]
 * @param params - The params used to send a new user's password    [REQUIRED]
 *   - securePwd : The portal securization password                 [OPTIONAL, we'll be required if option enabled on portal configuration]
 */
function regenPwdWithEmailResend( callbacks, params ){

    var request = new Object();
    request.action = "regen_pwd_with_email_resend";

    if ( params == undefined ) {
        return false;
    }

    // Get optional parameters
    request.secure_pwd = params.securePwd;

    $.portal_api('action', request, callbacks);
}

/** Return a new user's password on the portal
 * @param callbacks - Callback functions                            [REQUIRED]
 * @param params - The params used to send a new user's password    [REQUIRED]
 *   - securePwd : The portal securization password                 [OPTIONAL, we'll be required if option enabled on portal configuration]
 */
function regenPwdWithSecretQuestions( callbacks, params ){

    var request = params; //new Object();
    request.action = "regen_pwd_with_secret_questions";

    if ( params == undefined ) {
        return false;
    }

    // Get optional parameters
    request.secure_pwd = params.securePwd;

    $.portal_api('action', request, callbacks);
}

/** Replace href attribute if URL is a free access URL
 */
function replaceAllFreeURLs(){

    if ( $.settings != undefined && $.settings.freeUrls != undefined ) {
        $('a').each(function (){
            for ( freeUrlKey in $.settings.freeUrls ) {
                if ( freeUrlKey == $(this).attr('href') ) {
                    $(this).attr('href', $.settings.freeUrls[freeUrlKey]);
                }
            }
        });
    }
}

function shibAuthenticated(){
    if ( !$.settings.user.isAuthenticatedThroughShibboleth ) {
        return;
    }
    $.settings.user.isAuthenticatedThroughShibboleth = false;
    var params = new Object();
    params.login = "shibuser";
    params.password = "shibpwd";
    params.policyAccept = true;
    if ( ($.settings.user != undefined) && ($.settings.user.securePwd != undefined) ) {
        params.securePwd = $.settings.user.securePwd.value;
    }

    var callbacks = new Object();
    callbacks.beforeSend = function() {logonFormWaiting(true);};
    callbacks.success    = function() {logonFormConnectCallback();};
    callbacks.complete   = function() {logonFormWaiting(false);};

    authenticate(callbacks, params);
}

function refillAccountPaymentSubscribe( callbacks , params ) {

    var request = new Object();
    request.action = "refill_payment_subscribe";

    if (params == undefined) {
        return false;
    }

    request.login    = params.login;
    request.type     = params.type;
    request.password = params.password;
    request.package  = params.package;

    $.portal_api('action', request, callbacks);
}

/** Request portal API to check voucher and change account options
 * @param callbacks - Callback functions                                [REQUIRED]
 * @param params - The params used to check an existing upgrade order   [REQUIRED]
 * - login : The user's account login                                   [REQUIRED]
 * - refillCode : The voucher to use                                    [REQUIRED]
 */
function refillAccount( callbacks, params ){

    var request = new Object();
    request.action = "refill_account";

    if (params == undefined) {
        return false;
    }

    request.login      = params.login;
    request.refillCode = params.refillCode;
    request.password   = params.password;

    if (params.process != undefined) {
        request.process = params.process;
    }

    if (params.type != undefined) {
        request.type = params.type;
    }

    $.portal_api('action', request, callbacks);
}

/** Request portal API to generate free voucher and change account options
 * @param callbacks - Callback functions                              [REQUIRED]
 * @param params - The params used to check an existing upgrade order [REQUIRED]
 * - login : The user's account login                                 [REQUIRED]
 * - password : user password                                         [REQUIRED]
 * - package : The option used to generate code                       [REQUIRED]
 */
function getFreeRefillCode( callbacks , params ) {

    var request = new Object();
    request.action = "get_free_refill_code";

    if (params == undefined) {
        return false;
    }

    request.login    = params.login;
    request.password = params.password;
    request.package  = params.package;

    if (params.process != undefined) {
        request.process = params.process;
    }

    $.portal_api('action', request, callbacks);
}

/*****************************************************************************/

/** Find all known translations into XML file and replace them in display according to choosen language
 * @param displayLang : Language in which to translate              [OPTIONAL]
 */
function translate(displayLang) {
    if (displayLang == undefined) {
        if ($.settings != undefined && $.settings.user != undefined && $.settings.user.lang != null) {
            displayLang = $.settings.user.lang;
        }
        else {
            displayLang = $.settings.lang.defaultLang;
        }
    }

    var lang = $.translations;

    /* From translations file */
    // Translate title
    $(lang).find('title:eq(0)').each(function() {
        var trans = $(this).find(displayLang).text();
        if (trans == "") {
            trans = $(this).find($.settings.lang.defaultLang).text();
            if (trans == "") {
                trans = $(this).find("en").text();
            }
        }
        document.title = trans;
    });
    // Translate texts
    $(lang).find('text').each(function() {
        var trans = $(this).find(displayLang).text();
        if (trans == "") {
            trans = $(this).find($.settings.lang.defaultLang).text();
            if (trans == "") {
                trans = $(this).find("en").text();
            }
        }
        $(this).find('msgid').each(function() {
            var id = $(this).text();
            $('#' + id).text(trans);
        });
    });
    // Translate buttons
    $(lang).find('button').each(function() {
        var trans = $(this).find(displayLang).text();
        if (trans == "") {
            trans = $(this).find($.settings.lang.defaultLang).text();
            if (trans == "") {
                trans = $(this).find("en").text();
            }
        }
        $(this).find('msgid').each(function() {
            var id = $(this).text();
            var needTranslate = false;
            $('#' + id).contents().filter(function() {
                if(this.nodeType === 3) {//Node.TEXT_NODE
                needTranslate = true;
                }
            });
            if(needTranslate) {
                $('#' + id).text(trans); // old code
            }
        });
    });
    // Translate attribute
    $(lang).find('attribute').each(function() {
        var attribute = $(this);
        $(attribute).find('msgid').each(function() {
            var id = $(this).text();
            $(attribute).find('title').each(function() {
                var trans = $(this).find(displayLang).text();
                if (trans == "") {
                    trans = $(this).find($.settings.lang.defaultLang).text();
                    if (trans == "") {
                        trans = $(this).find("en").text();
                    }
                }
                $('#' + id).attr("title", trans);
            });
        });
    });

    /* From configuration */
    // Translate phone help
    subscriptionForm_phoneHelpBlock_configure(displayLang);
    paypalSubscriptionResultForm_phoneHelpBlock_configure(displayLang);
    ogoneSubscriptionResultForm_phoneHelpBlock_configure(displayLang);
    pwdRecoveryForm_phoneHelpBlock_configure(displayLang);
    manageAccountForm_personal_settings_phoneHelpBlock_configure(displayLang);

    // Translate policies
    configureDOM(displayLang, "policy");
    configureDOM(displayLang, "private_policy");
    logonForm_policy_configure(displayLang);
    autoLogonForm_policy_configure(displayLang);
    subscriptionForm_policy_configure(displayLang, 'one');
    oneSubscriptionForm_connect_policy_configure(displayLang);
    subscriptionForm_policy_configure(displayLang, 'direct');
    subscriptionForm_policy_configure(displayLang, 'print');
    subscriptionForm_policy_configure(displayLang, 'mail');
    subscriptionForm_policy_configure(displayLang, 'sms');
    subscriptionForm_policy_configure(displayLang, 'paypal');
    subscriptionForm_policy_configure(displayLang, 'ogone');
    subscriptionForm_policy_configure(displayLang, 'pps');


    logonForm_privatePolicy_configure(displayLang, 'facebook');
    logonForm_privatePolicy_configure(displayLang, 'twitter');
    logonForm_privatePolicy_configure(displayLang, 'linkedin');
    logonForm_privatePolicy_configure(displayLang, 'google');

    // Translate custom fields
    subscriptionForm_customFields_configure(displayLang, 'direct');
    subscriptionForm_customFields_configure(displayLang, 'one');
    subscriptionForm_customFields_configure(displayLang, 'print');
    subscriptionForm_customFields_configure(displayLang, 'paypal');
    subscriptionForm_customFields_configure(displayLang, 'ogone');
    subscriptionForm_customFields_configure(displayLang, 'mail');
    subscriptionForm_customFields_configure(displayLang, 'sms');
    manageAccountForm_personal_settings_customFields_configure(displayLang);

    // Translate packages
    pmsPaymentForm_packages_configure(displayLang);
    paypalPaymentForm_packages_configure(displayLang);
    paypalPaymentForm_packages_describe(displayLang);
    ogonePaymentForm_packages_configure(displayLang);
    ogonePaymentForm_packages_describe(displayLang);
    accountRefillForm_options_configure(displayLang);
    accountRefillForm_options_describe(displayLang);
    pmsPaymentForm_packages_describe(displayLang);
    upgradeAccountForm_fillIn(displayLang);

    // Translate feedback
    feedbackForm_fillIn(displayLang);
    pwdRecoverySetForm_questionsTranslate(displayLang);
    pwdRecoveryResendForm_questionsTranslate(displayLang);

    //Translate password helpblock
    forceModifyPwdForm_HelpBlock_configure(displayLang);
    modifyPwdForm_HelpBlock_configure(displayLang);
    subscriptionForm_passwordHelpBlock_configure(displayLang, 'print');
    subscriptionForm_passwordHelpBlock_configure(displayLang, 'direct');
    subscriptionForm_passwordHelpBlock_configure(displayLang, 'one');
    subscriptionForm_passwordHelpBlock_configure(displayLang, 'ogone');
    subscriptionForm_passwordHelpBlock_configure(displayLang, 'paypal');

	// Translate Logon feedback
	logonForm_feedback_configure(displayLang);

    /* From custom adds (editor or export) */
    // Translate custom blocks
    // Custom blocks from editor have the lang attribute defined
    $('#body div[lang][id]').each(function() {
        $(this).hide();
    });
    $('#body div[lang="' + displayLang + '"][id]').each(function() {
        $(this).show();
    });

    // Translate error/info message
    displayErrorInfo(displayLang);

    // Switching text direction
    if (displayLang == 'ar') {
        $('body').attr('dir', "rtl");
    }
    else {
        $('body').attr('dir', "ltr");
    }
}

/** Find and return a generic label translation stored into XML file according to choosen language
 * @param label : The label to search translation                   [REQUIRED]
 * @param displayLang : Language in which to translate              [OPTIONAL]
 * @param plural : Return plural label translation                  [OPTIONAL]
 */
function getGenericTranslation( label, displayLang, plural ){

    var trans = "";

    if ( displayLang == undefined || displayLang == null ) {
        if ( $.settings != undefined && $.settings.user != undefined && $.settings.user.lang != null ) {
            displayLang = $.settings.user.lang;
        }
        else {
            displayLang = $.settings.lang.defaultLang;
        }
    }

    var lang = $.translations;
    $(lang).find('generic').each(function (){
        var trans_label = $(this).find('label').text();
        if ( label == trans_label ) {
            if ( plural == true ) {
                trans = $(this).find('plural > ' + displayLang).text();
                if ( trans == "" ) {
                    trans = $(this).find('plural > ' + $.settings.lang.defaultLang).text();
                }
            }
            else {
                trans = $(this).find('> ' + displayLang).text();
                if ( trans == "" ) {
                    trans = $(this).find($.settings.lang.defaultLang).text();
                }
            }
        }
    });
    return trans;
}

/** Find and return an error translation stored into XML file according to choosen language
 * @param id : The id of the error to translate                     [REQUIRED]
 * @param displayLang : Language in which to translate              [OPTIONAL]
 */
function getErrorTranslation(id, displayLang) {

	var trans = "";

	if (displayLang == undefined || displayLang == null) {
		if ($.settings != undefined && $.settings.user != undefined && $.settings.user.lang != null) {
			displayLang = $.settings.user.lang;
		}
		else {
			displayLang = $.settings.lang.defaultLang;
		}
	}

	var lang = $.translations;
	$(lang).find('error').each(function() {
		var msg_found = false;
		$(this).find('msgid').each(function() {
			var trans_id = $(this).text();
			if (id == trans_id) {
				msg_found = true;
				return false;
			}
		});
		if (msg_found) {
			trans = $(this).find(displayLang).text();
			if (trans == "") {
				trans = $(this).find($.settings.lang.defaultLang).text();
			}
		}
	});
	return trans;
}

/** Find and return a input translation stored into XML file according to choosen language
 * @param id : The id of the input to translate                     [REQUIRED]
 * @param displayLang : Language in which to translate              [OPTIONAL]
 */
function getInputTranslation( id, displayLang ){

    var trans = "";

    if ( displayLang == undefined || displayLang == null ) {
        if ( $.settings != undefined && $.settings.user != undefined && $.settings.user.lang != null ) {
            displayLang = $.settings.user.lang;
        }
        else {
            displayLang = $.settings.lang.defaultLang;
        }
    }

    var lang = $.translations;
    $(lang).find('input').each(function (){
        var trans_id = $(this).find('msgid').text();
        if ( id == trans_id ) {
            trans = $(this).find(displayLang).text();
            if ( trans == "" ) {
                trans = $(this).find($.settings.lang.defaultLang).text();
            }
        }
    });
    return trans;
}

/** Find and return a text translation stored into XML file according to choosen language
 * @param id : The id of the input to translate                     [REQUIRED]
 * @param displayLang : Language in which to translate              [OPTIONAL]
 */
function getTextTranslation( id, displayLang ){

    var trans = "";

    if ( displayLang == undefined || displayLang == null ) {
        if ( $.settings != undefined && $.settings.user != undefined && $.settings.user.lang != null ) {
            displayLang = $.settings.user.lang;
        }
        else {
            displayLang = $.settings.lang.defaultLang;
        }
    }

    var lang = $.translations;
    $(lang).find('text').each(function (){
        var trans_id = $(this).find('msgid').text();
        if ( id == trans_id ) {
            trans = $(this).find(displayLang).text();
            if ( trans == "" ) {
                trans = $(this).find($.settings.lang.defaultLang).text();
            }
        }
    });
    return trans;
}

/** Return translation of policy object according to choosen language
 * @param obj : Policy object                                       [REQUIRED]
 * @param lang : Choosen language                                   [OPTIONAL]
 */
function extractPolicyText( obj, lang ){
    var policy = "";
    var link;
    var text;

    if ( obj != undefined && obj.policy != undefined && obj.policy.display == true ) {
        if ( lang != undefined && obj.policy[lang] != undefined ) {
            text = obj.policy[lang].text;
            link = obj.policy[lang].link;
        }
        else if ( obj.policy.defaultLang != undefined && obj.policy[obj.policy.defaultLang] != undefined ) {
            text = obj.policy[obj.policy.defaultLang].text;
            link = obj.policy[obj.policy.defaultLang].link;
        }
        else if ( $.settings.lang.defaultLang != undefined && obj.policy[$.settings.lang.defaultLang] != undefined ) {
            text = obj.policy[$.settings.lang.defaultLang].text;
            link = obj.policy[$.settings.lang.defaultLang].link;
        }
        if (link != undefined) {
            policy = '<a target="_blank" href="' + link + '">' + text + '</a>';
        }
        else {
            policy = text;
        }
    }
    return policy;
}

/** Return translation of policy object according to choosen language
 * @param obj : Policy object                                       [REQUIRED]
 * @param lang : Choosen language                                   [OPTIONAL]
 */
function extractPolicyResume(obj, lang) {
    var policy = "";
    var resume;

    if (obj != undefined && obj.policy != undefined && obj.policy.display == true) {
        if (lang != undefined && obj.policy[lang] != undefined) {
            resume = obj.policy[lang].resume;
        } else if (obj.policy.defaultLang != undefined && obj.policy[obj.policy.defaultLang] != undefined) {
            resume = obj.policy[obj.policy.defaultLang].resume;
        } else if ($.settings.lang.defaultLang != undefined && obj.policy[$.settings.lang.defaultLang] != undefined) {
            resume = obj.policy[$.settings.lang.defaultLang].resume;
        }

        policy = resume;
    }

    return policy;
}

/** Start user refresh connection action at interval
 */
function startRefresh(){
    if ( refreshObj.ressource == undefined ) {
        refreshObj.ressource = window.setInterval(function (){
            doRefresh();
        }, refreshObj.refreshInterval);
    }
}

/** Stop user refresh connection action
 */
function stopRefresh(){
    if ( refreshObj.ressource != undefined ) {
        window.clearInterval(refreshObj.ressource);
    }
    refreshObj = new Object();
}

/** Send refresh connection request to controller
 */
function doRefresh(){
    var callbacks = new Object();
    // callbacks.beforeSend = function() {}; // TODO
    callbacks.success = function (){
        refreshCallback();
    };
    // callbacks.complete   = function() {}; // TODO

    refresh(callbacks, refreshObj);
}

/** Callback function of doRefresh function
 */
function refreshCallback(){

    displayErrorInfo();
    if ( $.settings.error != undefined ) {
        stopRefresh();
        /// TODO complete cases
        feedbackFormDisconnect();
        //displayStep();
    }
}

/** Clear user settings stored in javascript variables
*/
function clearUserSettings() {
    if ($.settings != undefined && $.settings.user != undefined) {
        var lang = $.settings.user.lang;
        if ($.settings.user.securePwd != undefined) {
            var securePwd = $.settings.user.securePwd.value;
        }
        delete $.settings.user;
        $.settings.user = new Object();
        $.settings.user.lang = lang;
        if (securePwd != undefined) {
            $.settings.user.securePwd = new Object();
            $.settings.user.securePwd.value = securePwd;
        }
		// clean user pms optional fields information
		if ($.settings.pmsoptionalfields != undefined) {
			delete $.settings.pmsoptionalfields;
		}
    }
}

/** Clear user settings stored in javascript variables
*/
function clearPaymentSettings() {
    if ($.settings != undefined && $.settings.payment != undefined && $.settings.payment.status != undefined) {
        if ($.settings.payment.status == "completed") {
            delete $.settings.payment;
            $.settings.payment = new Object();
        }
    }
}

/** Explode Javascript Date object into usable values
 * @param date : Javascript date object to explode                  [REQUIRED]
 */
function explodeDate( date ){
    var result = new Object();

    result.year = date.getFullYear(); // 4 digits year
    result.monthNumber = date.getMonth() + 1; // getMonth (0-11). January is 0, February is 1, and so on.
    var months = new Array('january', 'february', 'march', 'april', 'may', 'june', 'july', 'august', 'september', 'october', 'november', 'december');
    result.month = months[date.getMonth()];
    result.dayNumber = date.getDate(); // (1-31)
    var days = new Array('sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday');
    result.day = days[date.getDay()]; // getDate (0-6). Sunday is 0, Monday is 1, and so on.
    result.hours = new Array();
    result.hours[24] = date.getHours(); // (0-23)
    if ( date.getHours() == 0 ) {
        result.hours[12] = "12";
        result.hours['ext'] = "am";
    }
    else if ( date.getHours() == 12 ) {
        result.hours[12] = date.getHours();
        result.hours['ext'] = "pm";
    }
    else if ( date.getHours() > 12 ) {
        result.hours[12] = date.getHours() - 12;
        result.hours['ext'] = "pm";
    }
    else {
        result.hours[12] = date.getHours();
        result.hours['ext'] = "am";
    }
    result.minutes = date.getMinutes(); // (0-59)
    result.seconds = date.getSeconds(); // (0-59)

	return result;
}

/**
 * Convert quota bytes into proper human format
 */
function convertReadableQuota(vol_byte) {
	var res = new Object();
	res.val = vol_byte / (1024 *1024);
	res.unit = (res.val > 1000) ? 'GB' : 'MB';
	if (res.unit == 'GB') {
		res.val /= 1024;
	}
	return res;
}

function getForcedDisconnectionTimerDisplayText(value, displayLang) {
	var hours = Math.floor(value / 3600);
	var mins = Math.floor((value - (hours * 3600)) / 60);
	var seconds = value - (hours * 3600) - (mins * 60);

	var hours_label = getGenericTranslation('hour', displayLang, (hours > 1));
	var mins_label = getGenericTranslation('minute', displayLang, (mins > 1));
	var seconds_label = getGenericTranslation('second', displayLang, (seconds > 1));

	return $.sprintf(getGenericTranslation('forced-disconnection-display-with-seconds', displayLang), hours, hours_label, mins, mins_label, seconds, seconds_label);
}
/************************************
* duplicate block general condition *
*************************************/

function addPolicyText(eltId, policy, lang) {
    var policy_text = extractPolicyText(policy, lang);
    var policy_resume = extractPolicyResume(policy, lang);
    $('#' + eltId + '_text').html(policy_text);
    if ( ! policy_resume) {
        $('#' + eltId + '_resume').css("display", "none"); // Hide description block
        $('#' + eltId + '_style').removeClass('active'); // Reset toggle button
        $('#' + eltId + '_button').hide(); // Hide toggle description button
        $('#' + eltId + '_text').parent().css('width', '100%'); // Take full width of the block for the text
    }
    else {
        $('#' + eltId + '_resume').html(policy_resume);
        $('#' + eltId + '_button').show(); // Show toggle description button
        $('#' + eltId + '_text').parent().css('width', '');
    }
}

function condition_general_policy_configure(displayLang, src_elementid, dst_elementid, policyNew) {
    if (policyNew.policy != undefined && policyNew.policy.display) {
        $('#' + src_elementid).clone()
            .appendTo('#' + dst_elementid + '_container')
            .attr('id', dst_elementid + '_block')
            .show().find("*").each(function () {
                var regexp = /(condition_general_policy_)(.+)/i;
                var id = this.id || "";
                var name = this.name || "";
                var select = $(this).attr('for') || "";
                var match = id.match(regexp) || [];
                if (match.length == 3) {
                    this.id = dst_elementid + "_" + match[2];
                    if (name != "") {
                        this.name = dst_elementid + "_" + match[2]
                    }
                }
                match = select.match(regexp) || [];
                if (match.length == 3) {
                    $(this).attr('for', dst_elementid + '_' + match[2]);
                }
            });
        addPolicyText(dst_elementid, policyNew, displayLang);

        // CONFIGURE OPTIN MANDATORY
        if (policyNew.policy.mandatory != undefined && policyNew.policy.mandatory === false) {
            $('#' + dst_elementid + '_state').css("visibility", "hidden");
            $('.fields_state_block').css("display", "none");
        }
        else {
            $('#' + dst_elementid + '_state').css("visibility", "visible");
            $('.fields_state_block').css("display", "inline");
        }
    }
}

function configureDOM(displayLang, type) {
    var src_elementid = "condition_general_policy_block";
    var a_target_id = [];
    var dst_elementid;
    var i = 0;

    if (type == "policy" || type == "private_policy") {
        var policyNew = new Object();
        
        if (type == "policy") {
            // Policy for modes logon, One click, pps
            a_target_id = [
                            'logonForm_logon_policy',
                            'logonForm_socialNetwork_policy',
                            'oneSubscriptionForm_connect_policy',
                            'ppsSubscriptionForm_policy'
                        ];
            policyNew.policy = $.settings.logon.policy;
        }
        else if ($.settings.private_policy[0] != undefined){
            // OptIn for Logon, All subscription mode, Social networks, and manageAccount
            a_target_id = [
                            'subscriptionForm_privatePolicy',
                            'logonForm_logon_privatePolicy',
                            'manageAccountForm_privatePolicy',
                            'logonForm_socialNetwork_privatePolicy'
                        ];
            policyNew.policy = ($.settings.private_policy != undefined) ? $.settings.private_policy[0]: undefined;
            policyNew.policy.display = (policyNew.policy != undefined && policyNew.policy.display != undefined) ? policyNew.policy.display : true;
        }
        for (i = 0; a_target_id[i] != undefined; i++) {
            dst_elementid = a_target_id[i];
            if ($('#' + dst_elementid + '_container').is(':empty')) {
                condition_general_policy_configure(displayLang, src_elementid, dst_elementid, policyNew);
                spread_general_policy_value(dst_elementid, a_target_id);
            }
            else if (policyNew.policy != undefined) {
                addPolicyText(dst_elementid, policyNew, displayLang);
            }
        }
        if ($.settings != undefined && $.settings.informativeWidget != undefined && type == "private_policy") {
            // User is known through its IP. Set Optin By default on logon and social network (if exists) with this user's value
            if ($.settings.informativeWidget.privatePolicy != undefined) {
                optin_value = $.settings.informativeWidget.privatePolicy.value;
                $('#logonForm_logon_privatePolicy_accept').attr("checked", optin_value);
                $('#manageAccountForm_privatePolicy_accept').attr("checked", optin_value);
            }
        }
    }
}

function spread_general_policy_value(elt_clicked, $all_element) {
    $('#' + elt_clicked + '_accept').click(function () {
        for (var i = 0; $all_element[i] != undefined; i++) {
			$('#' + $all_element[i] + '_accept').attr('checked', $('#' + elt_clicked + '_accept').is(':checked'));
        }
	});
}

function is_in_ucopia_oob() {
	return ( $.settings.user != undefined && $.settings.user.satellite_URL != undefined
			&& $.settings.user.nas_constructor != null && $.settings.user.nas_constructor == 'ucopia' );
}

/*****************************************************************************/
/****                 Lang Block JavaScript functions                  ****/
/*****************************************************************************/

/** This function is triggered when the page is loaded
 */
$(document).ready(function (){

    /** Links triggers
     */
    $('#lang_link\\[fr\\]').click(function (){
        lang_block_translate('fr');
    });
    $('#lang_link\\[de\\]').click(function (){
        lang_block_translate('de');
    });
    $('#lang_link\\[en\\]').click(function (){
        lang_block_translate('en');
    });
    $('#lang_link\\[es\\]').click(function (){
        lang_block_translate('es');
    });
    $('#lang_link\\[it\\]').click(function (){
        lang_block_translate('it');
    });
    $('#lang_link\\[nl\\]').click(function (){
        lang_block_translate('nl');
    });
    $('#lang_link\\[pt\\]').click(function (){
        lang_block_translate('pt');
    });
    $('#lang_link\\[pl\\]').click(function (){
        lang_block_translate('pl');
    });
    $('#lang_link\\[zh_CN\\]').click(function (){
        lang_block_translate('zh_CN');
    });
    $('#lang_link\\[zh_TW\\]').click(function (){
        lang_block_translate('zh_TW');
    });
    $('#lang_link\\[ar_LB\\]').click(function (){
        lang_block_translate('ar');
    });
    $('#lang_link\\[ko\\]').click(function (){
        lang_block_translate('ko');
    });
    $('#lang_link\\[ja\\]').click(function (){
        lang_block_translate('ja');
    });
    $('#lang_link\\[th\\]').click(function (){
        lang_block_translate('th');
    });
    $('#lang_link\\[ru\\]').click(function (){
        lang_block_translate('ru');
    });
    $('#lang_link\\[id\\]').click(function (){
        lang_block_translate('id');
    });
});

/** Configure lang_block depending on settings
 */
function lang_block_configure(){

    if ( $.settings != undefined && $.settings.lang != undefined && $.settings.lang.displayLang != undefined ) {
        if ( $.settings.lang.displayLang.length == 1 ) {
            $('#lang_block').hide();
        }
        else {
            $('#lang_block').show();
            for ( lang_itt = 0; lang_itt < $.settings.lang.displayLang.length; lang_itt++ ) {
                if ( $.settings.lang.displayLang[lang_itt] == 'ar' ) {
                    $('#lang_link\\[ar_LB\\]').show();
                }
                else {
                    $('#lang_link\\[' + $.settings.lang.displayLang[lang_itt] + '\\]').show();
                }
            }
        }
    }
}

/** Executed when links are clicked
 * @param string displayLang - The choosen display language
 */
function lang_block_translate( displayLang ){
    if ( $.settings.user == undefined ) {
        $.settings.user = new Object();
    }
    $.settings.user.lang = displayLang;

    var params = new Object();
    params.language = displayLang;

    translate(displayLang);
    // Register the new language on the server

	var callbacks = new Object();
	callbacks.success = function () {
		// we have probably missed apple cna wispr sniff, reload the page to re-launch it
		if ( isAppleCNA && $.settings && $.settings.step == 'FEEDBACK'
				&& $.settings.user && $.settings.user.firstTimeArrivalFromRedirection ) {
			window.location.reload(true);
		}
	};

    switchLanguage(callbacks, params);
}

/*****************************************************************************/
/****              Secure Password Form JavaScript functions              ****/
/*****************************************************************************/

/** This function is triggered when the page is loaded
 */
$(document).ready(function (){

    /** Inputs triggers
     */
// 	$('form[name=securePwdForm] input[name=secure_pwd]').change(function() {
// 		///
// 	});

    /** Buttons triggers
     */
    $('#securePwdForm_access_button').click(function (){
        //securePwdFormAccess();
    });

    /** Form triggers
     */
    $('form[name="securePwdForm"]').submit(function (){
        securePwdFormAccess();
        return false;
    });
});

/** Configure securePwdForm depending on settings
 */
function securePwdForm_configure(){

    // Configure display
    if ( $.settings.securePwd == true ) {
        // Nothing to do
    }
    else {
        $('form[name="securePwdForm"]').remove();
    }
}

/** Display securePwdForm depending on settings
 * Can be overwritten by state
 * @param boolean state - Indicate if the form must be displayed or not
 */
function securePwdForm_display( state ){

    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }
    else if ( $.settings.step == "SECURE_PWD" ) {
        display = true;
    }

    if ( display == true ) {
        $('form[name="securePwdForm"]').show();
    }
    else {
        $('form[name="securePwdForm"]').hide();
        securePwdForm_empty();
    }
}

/** Empty securePwdForm
 */
function securePwdForm_empty(){

    $('form[name="securePwdForm"] input').each(function (){
        $(this).val('');
    });
}

/** Enable waiting mode on securePwdForm
 */
function securePwdFormWaiting( state ){
    switch ( state ) {
        case true:
            $('body').toggleClass("cursor-wait");
            break;
        case false:
            $('body').toggleClass("cursor-wait");
            break;
    }
}

/** Executed when button is clicked
 */
function securePwdFormAccess(){

    var params = new Object();
    // Mandatory parameters
    params.securePwd = $('form[name="securePwdForm"] input[name="secure_pwd"]').val();

    var callbacks = new Object();
    callbacks.beforeSend = function (){
        securePwdFormWaiting(true);
    };
    callbacks.success = function (){
        securePwdFormAccessCallback();
    };
    callbacks.complete = function (){
        securePwdFormWaiting(false);
    };

    securePwd(callbacks, params);
}

/** Executed on return of securePwdFormAccess function
 */
function securePwdFormAccessCallback(){

    displayErrorInfo();
    if ( $.settings.error == undefined ) {
        if ( $.settings.user == undefined ) {
            $.settings.user = new Object();
        }
        if ( $.settings.user.securePwd == undefined ) {
            $.settings.user.securePwd = new Object();
        }
        $.settings.user.securePwd.value = $('form[name="securePwdForm"] input[name="secure_pwd"]').val();
        displayStep();
    }
}

/*****************************************************************************/
/****           Force Modify Password Form JavaScript functions           ****/
/*****************************************************************************/

/** This function is triggered when the page is loaded
 */
$(document).ready(function (){

    /** Inputs triggers
     */
// 	$('form[name=forceModifyPwdForm] input[name=old_pwd]').change(function() {
// 		///
// 	});
// 	
// 	$('form[name=forceModifyPwdForm] input[name=new_pwd]').change(function() {
// 		///
// 	});
// 	
// 	$('form[name=forceModifyPwdForm] input[name=confirm_pwd]').change(function() {
// 		///
// 	});

    /** Buttons triggers
     */
    $('#forceModifyPwdForm_back_button').click(function (){
        forceModifyPwdFormBack();
    });

    $('#forceModifyPwdForm_confirm_button').click(function (){
        forceModifyPwdFormConfirm();
    });

    /** Form triggers
     */
    $('form[name="forceModifyPwdForm"]').submit(function (){
        return false;
    });
    $('#forceModifyPwdForm_help_link').click(function (){
        forceModifyPwdForm_HelpBlock_display();
    });
    // CHANGED_BY_HH
    // added to display the help, when user click on password field
    $('#uc-new_pwd_mod_force').click(function (){
        forceModifyPwdForm_HelpBlock_display(true);
    });


});

/** Configure forceModifyPwdForm depending on settings
 */
function forceModifyPwdForm_configure(){

    // Configure display
    if ( $.settings.forceModifyPwd == true ) {
        // Nothing to do
    }
    else {
        $('form[name="forceModifyPwdForm"]').remove();
    }
}

/** Display forceModifyPwdForm depending on settings
 * Can be overwritten by state
 * @param boolean state - Indicate if the form must be displayed or not
 */
function forceModifyPwdForm_display( state ){

    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }
    else if ( $.settings.step == "FORCE_MODIFY_PWD" ) {
        display = true;
    }

    if ( display == true ) {
        $('form[name="forceModifyPwdForm"]').show();
        if ( $.settings.user.pwdConstraint != undefined ) {
            $('#forceModifyPwdForm_help_tr').show();
        }
    }
    else {
        $("#forceModifyPwdForm_help_block").hide();
        $('form[name="forceModifyPwdForm"]').hide();
        forceModifyPwdForm_empty();
    }
}

/** Empty forceModifyPwdForm
 */
function forceModifyPwdForm_empty(){

    $('form[name="forceModifyPwdForm"] input').each(function (){
        $(this).val('');
    });
}

/** Executed when back button is clicked
 */
function forceModifyPwdFormBack(){

    var callbacks = new Object();
    // callbacks.beforeSend = function() {}; // TODO
    callbacks.success = function (){
        forceModifyPwdFormBackCallback();
    };
    // callbacks.complete   = function() {}; // TODO

    backAction(callbacks);
}

/** Executed on return of forceModifyPwdFormBack function
 */
function forceModifyPwdFormBackCallback(){

    displayErrorInfo();
    displayStep();
}

/** Enable waiting mode on forceModifyPwdForm
 */
function forceModifyPwdFormWaiting( state ){
    switch ( state ) {
        case true:
            $('#forceModifyPwdForm_back_button').attr("disabled", true);
            $('#forceModifyPwdForm_confirm_button').attr("disabled", true);
            $('body').toggleClass("cursor-wait");
            break;
        case false:
            $('#forceModifyPwdForm_back_button').attr("disabled", false);
            $('#forceModifyPwdForm_confirm_button').attr("disabled", false);
            $('body').toggleClass("cursor-wait");
            break;
    }
}

/** Executed when confirm button is clicked
 */
function forceModifyPwdFormConfirm(){

    var params = new Object();
    // Mandatory parameters
    params.login = $.settings.user.login.value;
    params.password = $('form[name="forceModifyPwdForm"] input[name="old_pwd"]').val();
    params.newPassword = $('form[name="forceModifyPwdForm"] input[name="new_pwd"]').val();
    params.newPasswordConfirm = $('form[name="forceModifyPwdForm"] input[name="confirm_pwd"]').val();

    if ( ($.settings.user != undefined) && ($.settings.user.securePwd != undefined) ) {
        params.securePwd = $.settings.user.securePwd.value;
    }

    var callbacks = new Object();
    callbacks.beforeSend = function (){
        forceModifyPwdFormWaiting(true);
    };
    callbacks.success = function (){
        forceModifyPwdFormConfirmCallback();
    };
    callbacks.complete = function (){
        forceModifyPwdFormWaiting(false);
    };

    forceModifyPwd(callbacks, params);
}

/** Executed on return of forceModifyPwdFormConfirm function
 */
function forceModifyPwdFormConfirmCallback(){

    displayErrorInfo();
    if ( $.settings.error == undefined ) {
        displayStep();
    }
}

/** Display forceModifyPwdFormHelpBlock_display when help link is clicked
 * @param boolean state - Indicate if the block must be displayed or not
 */
function forceModifyPwdForm_HelpBlock_display( state, displayLang ){
    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }
    else if ( $('#forceModifyPwdForm_help_block').is(':hidden') == true ) {
        display = true;
    }

    if ( display == true ) {
        if ( translationsAreLoaded == true ) {
            forceModifyPwdForm_HelpBlock_configure(displayLang);
        }
        $('#forceModifyPwdForm_help_block').show();
    }
    else {
        $('#forceModifyPwdForm_help_block').hide();
    }
}

/** Configure forceModifyPwdForm_help_block
 * @param string displayLang - The language whish to display the content
 */
function forceModifyPwdForm_HelpBlock_configure( displayLang ){
    if ( $.settings != undefined && $.settings.user != undefined && $.settings.user.pwdConstraint != undefined ) {
        if ( $('#forceModifyPwdForm_help_list').children().length > 1 ) {
            $('#forceModifyPwdForm_help_list li').not(":first").remove();
        }
        /* Update the content of the help box to display to the user the password
         * policy in use for his profile */
        //var help_block = $('#forceModifyPwdForm_help_block').clone();
        $("#forceModifyPwdHelpBlock_text").text(getInputTranslation('forceModifyPwdForm_help_text', displayLang));
        var constraintValues = new Array("minLength", "maxLength");
        for ( key in constraintValues ) {
            var val = constraintValues[key];
            var line = $('#forceModifyPwdForm_help_list li:first').clone();
            line.toggle();
            line.text($.sprintf(getInputTranslation("forceModifyPwdForm_help_" + val, displayLang), $.settings.user.pwdConstraint.value[val]));
            $('#forceModifyPwdForm_help_list').append(line);
        }
        for ( key in $.settings.user.pwdConstraint.value.characterSet ) {
            var set = $.settings.user.pwdConstraint.value.characterSet[key];
            if ( set.quota > 0 ) {
                var line = $('#forceModifyPwdForm_help_list li:first').clone();
                line.toggle();
                line.text($.sprintf(getInputTranslation("forceModifyPwdForm_help_character_set_text", displayLang), set.quota, set.set.join("")));
                $('#forceModifyPwdForm_help_list').append(line);
            }
        }
    }
}

/*****************************************************************************/
/****                   Logon Form JavaScript functions                   ****/
/*****************************************************************************/

/** This function is triggered when the page is loaded
 */
$(document).ready(function () {

	/** Input triggers
	 */
	// 	$('form[name=logonForm] input[name=login]').change(function() {
	// 		///
	// 	});
	//
	// 	$('form[name=logonForm] input[name=password]').change(function() {
	// 		///
	// 	});
	//
	// 	$('form[name=logonForm] input[name=policy_accept]').change(function() {
	// 		///
	// 	});

	/** Buttons triggers
	 */
	/*==============================
	  script toggle general condition
	  ===============================*/

	$('#logonForm_standard_authentication_button').click(function () {
		logonForm_toggle_show_authentication_modes(false);
	});

	$('#logonForm_authentication_form_back_button').click(function () {
		logonForm_toggle_show_authentication_modes(true);
	});

	$('#logonForm_shibboleth_authentication_button').click(function () {
		socialNetworkConnect("shibboleth");
	});

	$('#logonForm_privatePolicy_back_button').click(function () {
		logonForm_close_privatePolicy_dialog("logonForm");
	});

	$('#logonForm_privatePolicy_cross_span').click(function () {
		logonForm_close_privatePolicy_dialog("logonForm");
	});
	/** Link triggers
	 */
	$('#facebookLink').click(function () {
		socialNetworkConnect("facebook");
	});
	$('#googleLink').click(function () {
		socialNetworkConnect("google");
	});
	$('#linkedinLink').click(function () {
		socialNetworkConnect("linkedin");
	});
	$('#twitterLink').click(function () {
		socialNetworkConnect("twitter");
	});
	$('#samlLink').click(function() {
		socialNetworkConnect('saml');
	});

	/** Form triggers
	 */
	$('form[name="logonForm"]').submit(function () {
		logonFormConnect();
		return false;
	});
});

/** Configure logonForm depending on settings
 */
function logonForm_configure() {

	// Configure policy display
	if ($.settings.logon != undefined && $.settings.logon.policy != undefined && $.settings.logon.policy.display == true) {
		logonForm_policy_configure();
	} else {
		$('#logonForm_policy_block').remove();
	}

	// configure shibboleth
	if ($.settings.auth_modes && $.settings.auth_modes.shibboleth) {
		logonForm_toggle_show_authentication_modes(true);
		if (!$.settings.auth_modes.standard) {
			$('#logonForm_subscriptionChoice_top_title_block').hide();
			$('#logonForm_subscriptionChoice_block').hide();
			$('#logonForm_standard_authentication_button').hide();
			$('#logonForm_auth_modes_block').show();
		}
	}

	if ($.settings.auth_modes != undefined) {
		// Configure social networks
		if ($.settings.auth_modes.facebook) {
			$('#logonForm_socialNetworkChoice_grid').show();
			$('#facebookLink').show();
			if ($.settings.logon != undefined && $.settings.logon.facebook != undefined && $.settings.logon.facebook.need_like) {
				$('div#facebookLike').show();
				if ($.settings.logon.facebook.url_like != undefined && $.settings.logon.facebook.url_like != '') {
					$('label#logonForm_facebook_like_url').text($.settings.logon.facebook.url_like);
				}
			} else {
				$('div#facebookLike').hide();
			}
		}
		if ($.settings.auth_modes.google) {
			$('#logonForm_socialNetworkChoice_grid').show();
			$('#googleLink').show();
		}
		if ($.settings.auth_modes.linkedin) {
			$('#logonForm_socialNetworkChoice_grid').show();
			$('#linkedinLink').show();
		}
		if ($.settings.auth_modes.twitter) {
			$('#logonForm_socialNetworkChoice_grid').show();
			$('#twitterLink').show();
			if ($.settings.logon != undefined && $.settings.logon.twitter != undefined && $.settings.logon.twitter.need_follow) {
				$('div#twitterFollow').show();
				if ($.settings.logon.twitter.name_follow != undefined && $.settings.logon.twitter.name_follow != '') {
					$('label#logonForm_twitter_follow_auto_screen_name').text('@' + $.settings.logon.twitter.name_follow);
				}
			} else {
				$('div#twitterFollow').hide();
			}
		}

		//OpenID Connect providers
		var authModeOpenidconnectEnabled = false;
		for (key in $.settings.auth_modes) {
			if (key.match(/^openidconnect_[\d]*$/)) {
				$('#logonForm_socialNetworkChoice_openid_grid').append('<div class="openidDiv hoverLink" title="Use your OpenID Connect credentials" onclick="socialNetworkConnect(\'' + key + '\')"><div id="' + key + 'Link" class="openidconnectSmallBox" style="display:none"></div><label class="openidSpan">' + $.settings.auth_modes[key] + '</label></div>');
				$('#logonForm_socialNetworkChoice_openid_grid').show();
				$('#' + key + 'Link').show();

				authModeOpenidconnectEnabled = true;
			}
		}

		// wispr mode
		if ($.settings.auth_modes.wispr) {
			$('#logonForm_wispr_grid').show();
			if ($.settings.wispr && $.settings.wispr.operator_realm) {
				$.each($.settings.wispr.operator_realm, function (operator, realm) {
					$('select#user_wispr_operator').append('<option value="' + operator + '">' + operator + '</option>');
				});
				// link trigger on select list
				$('select#user_wispr_operator').change(function () {
					var current_operator = $(this).val();
					var potential_realm = $.settings.wispr.operator_realm[current_operator];
					var auto_complete_realm = null;
					if ('string' == typeof (potential_realm) && potential_realm.length > 0) {
						// do a little intelligence here to detect different format of realm
						var index_point = potential_realm.indexOf('.');
						// realm contains at least a point, and it is not the last character, then we consider it will be combined by @
						if (0 < index_point && index_point < potential_realm.length - 1) {
							auto_complete_realm = '@' + potential_realm;
						}
						// we will combine the realm by / as default case
						else {
							auto_complete_realm = potential_realm + '/';
						}
					}
					/*
					 * feel free to add customization to force some auto-complete realm here
					 * simple example in one line:
					 *  if (current_operator == 'ipass') { auto_complete_realm = 'IPASS/'; }
					 */
					if (auto_complete_realm) {
						// auto-complete the suggested realm into login
						$('form[name="logonForm"] input[name="login"]').val(auto_complete_realm);
					}
				});
			}
		}

		if ($.settings.auth_modes.saml) {
			$('#logonForm_saml_grid').show();
			if ($.settings.saml && $.settings.saml.name) {
				$('div#logonForm_saml_grid label.samlSpan').text($.settings.saml.name);
			}
		}

		/*
		 * In case authentification by credential is disabled and one of the social network connection is enabled
		 */
		if (!$.settings.auth_modes.standard &&
			($.settings.auth_modes.facebook ||
				$.settings.auth_modes.google ||
				$.settings.auth_modes.linkedin ||
				$.settings.auth_modes.twitter ||
				authModeOpenidconnectEnabled ||
				$.settings.auth_modes.saml)) {
			$('#logonForm_logon_block_credentials').hide();
		}
	}

	// Configure register link
	if ($.settings.subscribe != undefined && $.settings.subscribe.count > 0) {
		$('#logonForm_subscriptionChoice_top_title_block').show();
		$('#logonForm_subscriptionChoice_block').show();
	} else {
		// No subscribe mode
		$('#logonForm_subscriptionChoice_block').hide();
	}
}


/* If more than one authentication mode has been configured, this function
 * displays an additional step where the user can choose his mode.
 * if false is given, this step is hidden
 */
function logonForm_toggle_show_authentication_modes(show) {
	$('#logonForm_auth_modes_block').toggle(show);
	$('#logonForm_logon_block_credentials').toggle(!show);
	$('#logonForm_authentication_form_back_button').toggle(!show);
}

/* If a policy acceptance is required by the portal configuration, this function
 * checks that the corresponding checkbox has been clicked.
 */
function logonForm_policy_is_ok() {
	var need_policy = ($.settings.logon != undefined && $.settings.logon.policy != undefined && $.settings.logon.policy.display == true);
	var policy_checked = ($('form[name="logonForm"] input[name="logonForm_logon_policy_accept"]').is(':checked'));
	return !need_policy || policy_checked;
}

/** Configure logonForm_policy_block
 * @param string lang - The language whish to display the policy
 */
function logonForm_policy_configure(lang) {
	if ($.settings.auth_modes != undefined && !$.settings.auth_modes.standard) {
		$("#logonForm_policy_block").detach().appendTo('#no_logonForm_logon_block_credentials');
	}

	if ($.settings.logon != undefined && $.settings.logon.policy != undefined) {
		var policy = extractPolicyText($.settings.logon, lang);
		var policyResume = extractPolicyResume($.settings.logon, lang);
		$('#logonForm_logon_policy_text').html(policy);
		$('#logonForm_policy_resume').html(policyResume);
	}
}


/** Configure logonForm_privatePolicy_block
 * @param string displayLang - The language whish to display the policy
 * @param string mode - the mode to configure
 */
function logonForm_privatePolicy_configure(displayLang, mode) {

	var policy = null;
	try {
		policy = eval('$.settings.logon.' + mode + '.policy');
	} catch (ex) {
		policy = null;
	}
	if (policy == undefined || policy == null) {
		return;
	}
	var policyWrapper = new Object();
	policyWrapper.policy = policy;
	if (displayLang == undefined || displayLang == null) {
		displayLang = getUserLanguage_default();
	}
	$('#logonForm_socialNetwork_privatePolicy_text').html(extractPolicyText(policyWrapper, displayLang));
	$('#logonForm_socialNetwork_privatePolicy_resume').html(extractPolicyResume(policyWrapper, displayLang));
}


/** Display logonForm depending on settings
 * Can be overwritten by state
 * @param boolean state - Indicate if the form must be displayed or not
 */
function logonForm_display(state) {

	var display = false;
	if ((state == true) || (state == false)) {
		display = state;
	} else if (($.settings.step == "LOGON") && ((typeof informativeWidget_configure != 'function') || ($.settings.informativeWidget == undefined))) {
		display = true;
	}

	// Registration block to be displayed above login block
	if ($.settings.displayRegistrationFirst && ($.settings.subscribe.sms === undefined || $.settings.subscribe.sms.user === undefined)) {
		$('#logonForm_subscriptionChoice_block').insertBefore($("#logonForm_block"));
	}

	if (($.settings.subscribe.sms !== undefined && $.settings.subscribe.sms.user !== undefined)) {
		var usr = $.settings.subscribe.sms.user;
		logonForm_feedback_configure();

		$("#uc-logonForm-login").val(usr.login);
		if (usr.login.length > 0) {
			// Hide Login since user tries to register via sms
			$("#logonForm_login_block").hide();
			// Show phone number information
			$("#logonForm_login_sms_info_block").show();
		}
	}

	if (display == true) {
		$('form[name="logonForm"]').show();
	} else {
		$('form[name="logonForm"]').hide();
		logonForm_empty();
	}
}

function logonForm_feedback_configure(displayLang) {
	var trans = getTextTranslation('logonForm_login_info_text', displayLang);
	var usr = ($.settings.subscribe.sms !== undefined) ? $.settings.subscribe.sms.user:undefined;
	if (usr !== undefined) {
		var information_text = $.sprintf(trans, usr.prefix, usr.phone);
		$("#logonForm_login_info_text").text(information_text);
	}
}

/** Empty logonForm
 */
function logonForm_empty() {

	// Emptying only password input
	$('form[name="logonForm"] input[name="password"]').val('');
}

/** Enable waiting mode on logonForm
 */
function logonFormWaiting(state) {
	switch (state) {
		case true:
			$('body').toggleClass("cursor-wait");
			break;
		case false:
			$('body').toggleClass("cursor-wait");
			break;
	}
}

/** Executed when button is clicked **/
function logonFormConnect() {

	var params = new Object();
	params.login = $('form[name="logonForm"] input[name="login"]').val();
	params.password = $('form[name="logonForm"] input[name="password"]').val();
	params.policyAccept = $('form[name="logonForm"] input[name="logonForm_logon_policy_accept"]').is(':checked');
	params.privatePolicyAccept = $('form[name="logonForm"] input[name="logonForm_logon_privatePolicy_accept"]').is(':checked');
	params.wispr_mode = $('form[name="logonForm"] input[name="wispr_mode"]').is(':checked') ? 'true' : 'false';

	if (($.settings.user != undefined) && ($.settings.user.securePwd != undefined)) {
		params.securePwd = $.settings.user.securePwd.value;
	}

	// send cna id if necessary
	var send_cna_id = $.portal_api('isInAutoConnect');
	var cna_id = $.portal_api('getCnaId');
	if (send_cna_id == true && cna_id != null) {
		params.cna_id = cna_id;
	}

	var callbacks = new Object();
	callbacks.beforeSend = function () {
		logonFormWaiting(true);
	};
	callbacks.success = function () {
		logonFormConnectCallback();
	};
	callbacks.complete = function () {
		logonFormWaiting(false);
	};

	authenticate(callbacks, params);
}

/** Executed on return of logonConnect function **/
function logonFormConnectCallback() {

	displayErrorInfo();
	if ($.settings.error == undefined) {
		if ($.settings.user == undefined) {
			$.settings.user = new Object();
		}
		if ($.settings.user.login == undefined) {
			$.settings.user.login = new Object();
			$.settings.user.login.value = $('form[name="logonForm"] input[name="login"]').val();
		}

		// Refresh will be done by feedback
		displayStep();
		if (isAppleCNA && $.settings.step != undefined && $.settings.step == "FEEDBACK") {
			// try to refresh page to get feedback in normal browser (safari) on newer device of apple
			window.location.reload(true);
			// we arrive into this block only when we are in standalone mode, so it isn't necessary to pass information from CNA to real portal
		}
	}
}

/** Display the multi mode choice page depending on state
 * @param boolean state - Indicate if the page must be displayed or not
 */
function logonFormSubscribeChoice_display(state) {

	var display = false;
	if ((state == true) || (state == false)) {
		display = state;
	}

	if (display == true) {
		$('#subscriptionChoice').show();
	} else {
		$('#subscriptionChoice').hide();
	}
}

/** Executed when back button is clicked
 */
function logonFormSubscriptionLinkBack() {

	displayStep();
}

/** Social networks
 */
function do_socialNetworkConnect(params) {
	var callbacks = new Object();

	// Add user ip in social network walled garden
	//  for saml and shibboleth, we have no walled garden to open (perhaps it's also the case for openid)
	if ( is_in_ucopia_oob() && -1 == $.inArray(params.type, ['saml']) ) {
		$.ajax({
			type: "POST",
			url: $.settings.user.satellite_URL,
			data: {
				action: "social_network_walled_garden",
				type: params.type
			},
			beforeSend: function () {
				logonFormWaiting(true);
			},
			complete: function () {
				logonFormWaiting(false);
			},
			success: function () {
				callbacks.success = function () {
					socialNetworkConnectCallback();
				};
				socialNetworkAuthenticate(callbacks, params);
			},
			error: function () {
				$.settings.error = {
					"code": "error_logon_internal"
				};
				displayErrorInfo();
				return;
			},
			xhrFields: {
				withCredentials: true
			},
			crossDomain: true
		});
	} else {
		callbacks.beforeSend = function () {
			logonFormWaiting(true);
		};
		callbacks.success = function () {
			socialNetworkConnectCallback();
		};
		callbacks.complete = function () {
			logonFormWaiting(false);
		};
		socialNetworkAuthenticate(callbacks, params);
	}
}

function socialNetworkConnect(type) {
	var policy = null;
	var params = new Object();
	var private_policy = null;

	params.type = type;

	if (type == 'twitter') {
		params.userFollow = $('form[name="logonForm"] input[name="twitter_follow"]').is(':checked');
	}
	if (type == 'facebook') {
		params.userLike = $('form[name="logonForm"] input[name="facebook_like"]').is(':checked');
	}
	if (($.settings.user != undefined) && ($.settings.user.securePwd != undefined)) {
		params.securePwd = $.settings.user.securePwd.value;
	}

	try {
		private_policy = eval('$.settings.private_policy');
	} catch (ex) {
		private_policy = null;
	}
	try {
		policy = eval('$.settings.logon.policy');
	} catch (ex) {
		policy = null;
	}

	// Show a dialog window if private policy need to be accepted
	if ((private_policy != null && private_policy.display == true) || (policy != null && policy.display == true)) {
		// Hide private policy connection button in case of mandatory private policy
		if (private_policy.mandatory == true) {
			if ($('#logonForm_socialNetwork_privatePolicy_accept').is(':checked') == false) {
				$('#logonForm_privatePolicy_connect_button').hide();
			}
			$('#logonForm_socialNetwork_privatePolicy_accept').change(function () {
				$('#logonForm_privatePolicy_connect_button').toggle($('#logonForm_socialNetwork_privatePolicy_accept').is(':checked'));
			});
		}

		$('#logonForm_privatePolicy_connect_button').click(function () {

			logonForm_close_privatePolicy_dialog("logonForm");

			params.privatePolicyAccept = $('#logonForm_socialNetwork_privatePolicy_accept').is(':checked');

			if (policy != null && policy.display == true) {
				params.policyAccept = $("#logonForm_socialNetwork_policy_accept").is(':checked');
				if (!logonForm_policy_is_ok()) {
					$.settings.error = {
							"code": "error_logon_bad-policy-accept"
					};
					displayErrorInfo();
					return;
				}
			}

			if (type == "shibboleth") {
				// Proceed to shibboleth connexion
				self.location.href = '/shibauth.php';
			}
			else {
				// Proceed to social network connexion
				do_socialNetworkConnect(params);
			}
		});

		$('#logonForm_socialNetwork_privatePolicy_accept').attr('checked', $('#logonForm_logon_privatePolicy_accept').is(':checked'));
		$('.main_mode_container').slideToggle('easing');
		$("#logonForm_privatePolicy_dialog").show();
	} else {
		// No private policy needed. Proceed to social network connexion
		if (type == "shibboleth") {
			// Proceed to shibboleth connexion
			self.location.href = '/shibauth.php';
		}
		else {
			do_socialNetworkConnect(params);
		}
	}
}

/** Executed on return of logonConnect function
 */
function socialNetworkConnectCallback() {

	displayErrorInfo();
	if ($.settings.error == undefined) {
		if ($.settings.user != undefined && $.settings.user.socialNetwork != undefined && $.settings.user.socialNetwork.redirectURL != undefined) {
			window.location = $.settings.user.socialNetwork.redirectURL;
		}
		displayStep();
	}
}

function logonForm_close_privatePolicy_dialog(prefix) {
	$('#' + prefix + '_privatePolicy_connect_button').unbind('click');
	$('#' + prefix + '_privatePolicy_accept').unbind('change');
	$('#' + prefix + '_privatePolicy_dialog').hide();

	$('.main_mode_container').slideToggle('easing');
}

function showWisprConnect(display) {
	if (display == undefined) {
		display = false;
	}
	if (display) {
		$('.logonForm_classic_elements').hide();
		$('.logonForm_wispr_elements').show();
		$('form[name="logonForm"] input[name="wispr_mode"]').attr('checked', true);
	} else {
		$('.logonForm_classic_elements').show();
		$('.logonForm_wispr_elements').hide();
		$('form[name="logonForm"] input[name="wispr_mode"]').attr('checked', false);
	}
}

/*****************************************************************************/
/****                 Feedback Form JavaScript functions                  ****/
/*****************************************************************************/

/** This function is triggered when the page is loaded
 */
$(document).ready(function (){

    /** Buttons triggers
     */
    $('#feedbackForm_disconnect_button').click(function (){
        feedbackFormDisconnect();
    });

    /** Form triggers
     */
    $('form[name="feedbackForm"]').submit(function (){
        return false;
    });
});

/** Configure feedbackForm depending on settings
 */
function feedbackForm_configure(){
    // Configure display
    if ( $.settings.feedback != undefined ) {

        if ( $.settings.feedback.pms != undefined && $.settings.feedback.pms.customer != undefined && $.settings.feedback.pms.customer.display == true ) {
            $('#feedbackForm_pms_customer_block').show();
        }
        else {
            $('#feedbackForm_pms_customer_block').remove();
        }

        if ( $.settings.feedback.pms != undefined && $.settings.feedback.pms.message != undefined && $.settings.feedback.pms.message.display == true ) {
            $('#feedbackForm_pms_message_block').show();
        }
        else {
            $('#feedbackForm_pms_message_block').remove();
        }

        if ( $.settings.feedback.caution != undefined && $.settings.feedback.caution.display == true ) {
            $('#feedbackForm_caution_block').show();
        }
        else {
            $('#feedbackForm_caution_block').remove();
        }

        if ( $.settings.feedback.requestedURL != undefined && $.settings.feedback.requestedURL.display == true ) {
            $('#feedbackForm_requested_url_block').show();
        }
        else {
            $('#feedbackForm_requested_url_block').remove();
        }

        if ( $.settings.feedback.login != undefined && $.settings.feedback.login.display == true ) {
            $('#feedbackForm_login_block').show();
        }
        else {
            $('#feedbackForm_login_block').remove();
        }

        if ( $.settings.feedback.profile != undefined && $.settings.feedback.profile.display == true ) {
            $('#feedbackForm_profile_block').show();
        }
        else {
            $('#feedbackForm_profile_block').remove();
        }

        if ( $.settings.feedback.services != undefined && $.settings.feedback.services.display == true ) {
            $('#feedbackForm_services_block').show();
        }
        else {
            $('#feedbackForm_services_block').remove();
        }

        if ( $.settings.feedback.ipAddress != undefined && $.settings.feedback.ipAddress.display == true ) {
            $('#feedbackForm_ip_address_block').show();
        }
        else {
            $('#feedbackForm_ip_address_block').remove();
        }

        if ( $.settings.feedback.incomingNetwork != undefined && $.settings.feedback.incomingNetwork.display == true ) {
            $('#feedbackForm_incoming_network_block').show();
        }
        else {
            $('#feedbackForm_incoming_network_block').remove();
        }

        if ( $.settings.feedback.incomingZone != undefined && $.settings.feedback.incomingZone.display == true ) {
            $('#feedbackForm_incoming_zone_block').show();
        }
        else {
            $('#feedbackForm_incoming_zone_block').remove();
        }

        if ( $.settings.feedback.multidevice != undefined && $.settings.feedback.multidevice.display == true ) {
            $('feedbackForm_multidevice_block').hide();
        }
        else {
            $('feedbackForm_multidevice_block').remove();
        }

        if ( $.settings.feedback.validity != undefined && $.settings.feedback.validity.display == true ) {
            $('#feedbackForm_validity_block').show();
        }
        else {
            $('#feedbackForm_validity_block').remove();
        }

        if ( $.settings.feedback.totalTimeCredit != undefined && $.settings.feedback.totalTimeCredit.display == true ) {
            $('#feedbackForm_total_time_credit_block').show();
        }
        else {
            $('#feedbackForm_total_time_credit_block').remove();
        }

        if ( $.settings.feedback.forceDiscTimer != undefined && $.settings.feedback.forceDiscTimer.display == true ) {
            $('#feedbackForm_automatic_disconnection_block').show();
        }
        else {
            $('#feedbackForm_automatic_disconnection_block').remove();
        }

        if ( $.settings.feedback.totalConsumedTimeCredit != undefined && $.settings.feedback.totalConsumedTimeCredit.display == true ) {
            $('#feedbackForm_total_consumed_time_credit_block').show();
        }
        else {
            $('#feedbackForm_total_consumed_time_credit_block').remove();
        }

        if ( $.settings.feedback.timeCredit != undefined && $.settings.feedback.timeCredit.display == true ) {
            $('#feedbackForm_time_credit_block').show();
        }
        else {
            $('#feedbackForm_time_credit_block').remove();
        }
        if ( $.settings.feedback.consumedData != undefined && $.settings.feedback.consumedData.display == true ) {
            $('#feedbackForm_quota_total_consumed_data_block').show();
        }
        else {
            $('#feedbackForm_quota_total_consumed_data_block').remove();
        }
    }
}

/** Display feedbackForm depending on settings
 * Can be overwritten by state
 * @param boolean state - Indicate if the form must be displayed or not
 */
function feedbackForm_display( state ){
    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }
    else if ( $.settings.step == "FEEDBACK" ) {
        display = true;
    }

    if ( display == true ) {

        var userLang = navigator.language || navigator.userLanguage;

        var lang;

        if ( $.settings != undefined && $.settings.user != undefined && $.settings.user.lang != undefined ) {
            lang = $.settings.user.lang;
        }
        else if ( userLang != "" ) {
            lang = userLang.substring(0, 2);
        }
        else {
            lang = "en";
        }

        if ( isAppleCNA ) {
		/*
		 * a click on a real <a> link element will trigger safari when cna detected internet access
		 * we click an anchor link here, we don't profit the domain link that switch language sent to us yet
		 */
            var a = $('#lang_link\\[' + lang + '\\]').get(0);
            var e = document.createEvent('MouseEvents');

            isAppleCNA_fakeclick = true;
            e.initEvent('click', true, true);
            a.dispatchEvent(e);
        }
	else {
		// a fake click will also call switch language function, we should not do it twice
        	lang_block_translate(lang);
        }
        feedbackForm_fillIn();
        feedbackFormRefresh();
        $('form[name="feedbackForm"]').show();
    }
    else {
        $('form[name="feedbackForm"]').hide();
    }
}

/** Fill feedbackForm depending on settings
 */
function feedbackForm_fillIn( displayLang ){
    if ( $.settings.user != undefined ) {
        var userSettings = $.settings.user;

        if ( userSettings.PMS != undefined && userSettings.PMS.customer != undefined ) {
            $('#feedbackForm_pms_customer_value').text(userSettings.PMS.customer.value);
        }
        else {
            $('#feedbackForm_pms_customer_value').text('');
        }

        if ( userSettings.PMS != undefined && userSettings.PMS.message != undefined ) {
            $('#feedbackForm_pms_message_value').text(userSettings.PMS.message.value);
        }
        else {
            $('#feedbackForm_pms_message_value').text('');
        }

        if ( userSettings.autoDisconnect != undefined && userSettings.autoDisconnect.value == false ) {
            $('#feedbackForm_caution_block').show();

			// Display different message in case of standalone or OOB
			if ( userSettings.satellite_URL == undefined ) {
				$('#feedbackForm_caution_text').show();
				$('#feedbackForm_caution_oob_text').hide();
				$('#feedbackForm_caution_block').removeClass('warning');
				$('#feedbackForm_caution_block').addClass('caution');
			}
			else {
				$('#feedbackForm_caution_text').hide();
				$('#feedbackForm_caution_oob_text').show();
				$('#feedbackForm_caution_block').removeClass('caution');
				$('#feedbackForm_caution_block').addClass('warning');
			}
        }
        else {
            $('#feedbackForm_caution_block').hide();
        }

        if ( $.settings.postConnectRedirect != undefined && $.settings.postConnectRedirect.url != undefined ) {
            $('#feedbackForm_requested_url_link').attr("href", $.settings.postConnectRedirect.url);
            $('#feedbackForm_requested_url_block').show();

            if ( userSettings.autoDisconnect != undefined && userSettings.autoDisconnect.value == true && $.settings.postConnectRedirect.delay != undefined ) {
                $('#feedbackForm_postConnectRedirectDelay_block').show();
            }
        }
        else {
            $('#feedbackForm_postConnectRedirectDelay_block').hide();

            if ( userSettings.requestedURL != undefined ) {
                $('#feedbackForm_requested_url_link').attr("href", userSettings.requestedURL.value);
                $('#feedbackForm_requested_url_block').show();
            }
            else {
                $('#feedbackForm_requested_url_link').attr("href", "#");
                $('#feedbackForm_requested_url_block').hide();
            }
        }

        if ( userSettings.login != undefined && userSettings.login.value != undefined ) {
            $('#feedbackForm_login_value').text(userSettings.login.value);
        }
        else {
            $('#feedbackForm_login_value').text('');
        }

        if ( userSettings.profile != undefined && userSettings.profile.value != undefined ) {
            $('#feedbackForm_profile_value').text(userSettings.profile.value);
        }
        else {
            $('#feedbackForm_profile_value').text('');
        }

        feedbackForm_package_display(displayLang);
        if ( userSettings.package != undefined ) {
            $('#feedbackForm_package_block').show();
        }
        else {
            $('#feedbackForm_package_block').hide();
        }

        if ( userSettings.services != undefined && userSettings.services.value != undefined ) {
            $('#feedbackForm_services_value').text(userSettings.services.value);
        }
        else {
            $('#feedbackForm_services_value').text('');
        }

        if ( userSettings.ipAddress != undefined && userSettings.ipAddress.value != undefined ) {
            $('#feedbackForm_ip_address_value').text(userSettings.ipAddress.value);
        }
        else {
            $('#feedbackForm_ip_address_value').text('');
        }

        if ( userSettings.incomingNetwork != undefined && userSettings.incomingNetwork.value != undefined ) {
            $('#feedbackForm_incoming_network_value').text(userSettings.incomingNetwork.value);
        }
        else {
            $('#feedbackForm_incoming_network_value').text('');
        }

        if ( userSettings.incomingZone != undefined && userSettings.incomingZone.value != undefined ) {
            $('#feedbackForm_incoming_zone_value').text(userSettings.incomingZone.value);
        }
        else {
            $('#feedbackForm_incoming_zone_value').text('');
        }

        feedbackForm_multidevice_fillIn();

        if ( userSettings.schedule != undefined && userSettings.schedule.value != undefined ) {
            feedbackForm_schedule_display(displayLang);
        }
        else {
            $('#feedbackForm_schedule_value').text('');
        }

        if ( userSettings.validity != undefined && userSettings.validity.value != 0 ) {
            var timezoneLocalOffset = new Date();
            var validity = new Date(parseInt(userSettings.validity.value) * 1000); // Must give date in milliseconds
            validity = explodeDate(validity);
            var text = $.sprintf(getGenericTranslation('full-date-display', displayLang), validity.year, validity.monthNumber, getGenericTranslation(validity.month, displayLang), validity.dayNumber, getGenericTranslation(validity.day, displayLang), validity.hours[24], validity.minutes, validity.hours[12], validity.hours['ext']);
            $('#feedbackForm_validity_value').text($.sprintf(getGenericTranslation('feedbackForm_validity_valid-until', displayLang), text));
        }
        else {
            $('#feedbackForm_validity_value').text(getGenericTranslation('feedbackForm_validity_always-valid', displayLang));
        }

        if ( userSettings.timeCredit != undefined ) {
            var hours = Math.floor(userSettings.timeCredit.value / 3600);
            var mins = (userSettings.timeCredit.value - (hours * 3600)) / 60;
            var hours_label = getGenericTranslation('hour', displayLang, (hours > 1));
            var mins_label = getGenericTranslation('minute', displayLang, (mins > 1));
            var reneweach = 0;
            if ( userSettings.timeCredit.reneweach != undefined ) {
                reneweach = userSettings.timeCredit.reneweach.value;
                text = getGenericTranslation('feedbackForm_time-credit-renew-each', displayLang, (userSettings.timeCredit.reneweach.value > 1));
            }
            else {
                text = getGenericTranslation('feedbackForm_time-credit', displayLang);
            }
            text = $.sprintf(text, hours, hours_label, mins, mins_label, reneweach);
            $('#feedbackForm_time_credit_value').text(text);
            $('#feedbackForm_time_credit_block').show();
        }
        else {
            $('#feedbackForm_time_credit_value').text('');
            $('#feedbackForm_time_credit_block').hide()
        }

        if ( userSettings.timeCredit != undefined && userSettings.timeCredit.remaining != undefined ) {
            feedbackForm_remainingTimeCredit_timer_start(displayLang);
            $('#feedbackForm_remaining_time_credit_block').show();
        }
        else {
            $('#feedbackForm_remaining_time_credit_value').text('');
            $('#feedbackForm_remaining_time_credit_block').hide();
        }

        if ( userSettings.forceDiscTimer != undefined && userSettings.forceDiscTimer.value != undefined ) {
            feedbackForm_forceDiscTimer_start(displayLang);
            $('#feedbackForm_automatic_disconnection_block').show();
        }
        else {
            $('#feedbackForm_automatic_disconnection_value').text('');
            $('#feedbackForm_automatic_disconnection_block').hide();
        }

        if ( userSettings.consumedData != undefined && userSettings.consumedData.download.value != undefined ) {
			// check whether we have disconnect quota or not
			var text_date, text_used, text_max, vol_max_up, vol_max_down;
			var disconnect_quota = false, sum_quota = false;
			if (userSettings.consumedData.extra != undefined && userSettings.consumedData.extra.value != undefined) {
				$.each(userSettings.consumedData.extra.value, function(key, val) {
					if (val.isDisconnectQuota == true) {
						disconnect_quota = true;
						sum_quota = val.isSumQuota;
						vol_max_up = val.total.upload;
						vol_max_down = val.total.download;
						return false;
					}
				});
			}

			var timezoneLocalOffset = new Date();
			// we show timestamp with timezone of zone here if we have defined one (also with its name)
			if (userSettings.consumedData.renewTimestamp != undefined && userSettings.consumedData.renewTimestamp.value > 0) {

				text_date = getGenericTranslation('feedbackForm_quota_consumedData_with_renew', displayLang);
				var obj_date = new Date((parseInt(userSettings.consumedData.renewTimestamp.value) + parseInt(userSettings.timezoneOffset.value) + parseInt(timezoneLocalOffset.getTimezoneOffset()*60)) * 1000); // Must give date in milliseconds
			}
			else {
				text_date = getGenericTranslation('feedbackForm_quota_consumedData_with_sincnewe', displayLang);
				var obj_date = new Date((parseInt(userSettings.consumedData.timestamp.value) + parseInt(userSettings.timezoneOffset.value) + parseInt(timezoneLocalOffset.getTimezoneOffset()*60)) * 1000); // Must give date in milliseconds
				/* // to show timestamp with user local timezone, please use the following block
				var timezoneLocalOffset = new Date();
				var obj_date = new Date((parseInt(userSettings.consumedData.timestamp.value) + parseInt(userSettings.timezoneOffset.value) + parseInt(timezoneLocalOffset.getTimezoneOffset()*60)) * 1000); // Must give date in milliseconds
				 */
			}
			obj_date = explodeDate(obj_date);
			var date = $.sprintf(getGenericTranslation('full-date-display', displayLang), obj_date.year, obj_date.monthNumber, getGenericTranslation(obj_date.month, displayLang), obj_date.dayNumber, getGenericTranslation(obj_date.day, displayLang), obj_date.hours[24], obj_date.minutes, obj_date.hours[12], obj_date.hours['ext']);
			// to show only the date, please use the following line
//			var date = $.sprintf(getGenericTranslation('calendar-date-display', displayLang), obj_date.year, obj_date.monthNumber, getGenericTranslation(obj_date.month, displayLang), obj_date.dayNumber);
			text_date = $.sprintf(text_date, date);
			// add timezone identifier if we have no timezone in current zone by default
			if (userSettings.consumedData.timezone != undefined && userSettings.consumedData.timezone.value != undefined
					&& userSettings.consumedData.timezone.value.isControllerTimezone === false) {
				text_date += ' (' + userSettings.consumedData.timezone.value.zoneTimezone + ')';
			}
			// max data
			if (disconnect_quota) {
				var data_up = convertReadableQuota(vol_max_up);
				if (sum_quota) {
					if (data_up.val > -1) {
						var data_sum = convertReadableQuota(userSettings.consumedData.upload.value + userSettings.consumedData.download.value);
						text_used = $.sprintf(getGenericTranslation('feedbackForm_quota_consumedData_sum_with_max_sum', displayLang), data_sum.val, data_sum.unit, data_up.val, data_up.unit);
					}
				}
				else {
					var data_down = convertReadableQuota(vol_max_down);
					var data_consumed_up = convertReadableQuota(userSettings.consumedData.upload.value);
					var data_consumed_down = convertReadableQuota(userSettings.consumedData.download.value);

					text_used = "";
					if (data_up.val > -1) {
						// Empty value for down threthhold don't show on feedback
						text_used += $.sprintf(getGenericTranslation('feedbackForm_quota_up_consumedData_with_max_individual', displayLang), data_consumed_up.val, data_consumed_up.unit, data_up.val, data_up.unit);
						text_used += (data_down.val > -1 ? "\n" : '');
					}
					if (data_down.val > -1) {
						// Empty value for up threethhold. Don't show on feedback
						text_used += $.sprintf(getGenericTranslation('feedbackForm_quota_down_consumedData_with_max_individual', displayLang), data_consumed_down.val, data_consumed_down.unit, data_down.val, data_down.unit);
					}
				}
			}
			else {
				text_used = "";
			}

			if (!text_used || text_used == "") {
				// used data
				if (sum_quota) {
					var data_sum = convertReadableQuota(userSettings.consumedData.upload.value + userSettings.consumedData.download.value);
					text_used = $.sprintf(getGenericTranslation('feedbackForm_quota_consumedData_sum', displayLang), data_sum.val, data_sum.unit);
				}
				else {
					var data_up = convertReadableQuota(userSettings.consumedData.upload.value);
					var data_down = convertReadableQuota(userSettings.consumedData.download.value);
					text_used = $.sprintf(getGenericTranslation('feedbackForm_quota_consumedData_individial', displayLang), data_down.val, data_down.unit, data_up.val, data_up.unit);
				}
			}

			// concat text
			text = text_used + (text_date ? ("\n" + text_date) : '');

			$('#feedbackForm_quota_total_consumed_data_value').text(text).css('white-space', 'pre-wrap');
            $('#feedbackForm_quota_total_consumed_data_block').show();
        }
        else {
            $('#feedbackForm_quota_total_consumed_data_value').text('');
            $('#feedbackForm_quota_total_consumed_data_block').hide();
        }

        // Apply CSS style to bypass IE browsers problem
        // Correct CSS pseudo class :first-child IE error on dynamic content
        if ( $.browser.msie ) {
            $('#reserved_block form[name="feedbackForm"] td[colspan!="2"]:first-child').each(function (){
                $(this).attr('style', "text-align: right");
            });
        }

        if ( userSettings.autoDisconnect != undefined && userSettings.autoDisconnect.value == true && $.settings.postConnectRedirect != undefined && $.settings.postConnectRedirect.url != undefined && $.settings.postConnectRedirect.delay != undefined ) {
            if ( $.settings.postConnectRedirect.delay > 0 ) {
                feedbackForm_postConnectRedirectDelay_timer_start(displayLang);
            }
            else {
                feedbackForm_postConnectRedirectDelay_redirect();
            }
        }

        if ( userSettings.disconnectButton != undefined && userSettings.disconnectButton.value == false ) {
            $('#feedbackForm_disconnect_button').hide();
        }
        else {
            $('#feedbackForm_disconnect_button').show();
        }
    }
}

function feedbackFormRefresh(){
    // We must refresh the user connection
    if ( $.settings.user != undefined ) {
        refreshObj.login = $.settings.user.login.value;
        refreshObj.refreshInterval = ($.settings.refreshInterval == undefined) ? 50000 : $.settings.refreshInterval;

        if ( $.settings.user.securePwd != undefined ) {
            refreshObj.securePwd = $.settings.user.securePwd.value;
        }
        startRefresh();
        if ( $.settings.user.isConnected == true ) {
            doRefresh();
        }
    }
}

/** Enable waiting mode on feedbackForm
 */
function feedbackFormWaiting( state ){
    switch ( state ) {
        case true:
            $('#feedbackForm_disconnect_button').attr("disabled", true);
            $('body').toggleClass("cursor-wait");
            break;
        case false:
            $('#feedbackForm_disconnect_button').attr("disabled", false);
            $('body').toggleClass("cursor-wait");
            break;
    }
}

/** Executed when button is clicked
 */
function feedbackFormDisconnect(){

    var params = new Object();
    if ( $.settings.user != undefined ) {
        if ( $.settings.user.login != undefined ) {
            params.login = $.settings.user.login.value;
        }
        if ( $.settings.user.securePwd != undefined ) {
            params.securePwd = $.settings.user.securePwd.value;
        }
    }

    // Stopping refresh
    stopRefresh();
    feedbackForm_forceDiscTimer_stop();// Stop Force Diconnect timer in case it is runing and user clicks on disconnect button
    feedbackForm_remainingTimeCredit_timer_stop();

    var callbacks = new Object();
    callbacks.beforeSend = function (){
        feedbackFormWaiting(true);
    };
    callbacks.success = function (){
        feedbackFormDisconnectCallback();
    };
    callbacks.complete = function (){
        feedbackFormWaiting(false);
    };

    disconnect(callbacks, params);
}

/** Executed on return of feedbackFormDisconnect function
 */
function feedbackFormDisconnectCallback(){
    if ( $.settings.user.logout_URL_params != undefined && $.settings.user.isConnected != undefined && $.settings.user.isConnected == true ) {

        return buildRedirectionURL($.settings.user.logout_URL_params);

    }

    displayErrorInfo();
    displayStep();
    clearUserSettings();
}

function feedbackForm_package_display( displayLang ){
	if (	($.settings.subscribe != undefined && $.settings.subscribe.pms != undefined && $.settings.subscribe.pms.package != undefined)
		|| 	($.settings.subscribe != undefined && $.settings.subscribe.pms != undefined && $.settings.subscribe.pms.option != undefined)) {
        if ( displayLang == undefined ) { // No displayLang given, find user selected language, else default portal language else default package language
            if ( $.settings != undefined && $.settings.user != undefined && $.settings.user.lang != undefined ) {
                displayLang = $.settings.user.lang;
            }
        }
        var describe;
        var describeLanguage;
        if ( $.settings.user != undefined && $.settings.user.package != undefined ) {
            if ( $.settings.user.package[0][displayLang] != undefined ) {
                describe = $.settings.user.package[0][displayLang].text;
                describeLanguage = displayLang;
            }
            else if ( $.settings != undefined && $.settings.lang != undefined && $.settings.lang.defaultLang != undefined && $.settings.user.package[0][$.settings.lang.defaultLang] != undefined ) {
                describe = $.settings.user.package[0][$.settings.lang.defaultLang].text;
                describeLanguage = $.settings.lang.defaultLang;
            }
            else {
                describe = $.settings.user.package[0]["en"].text; // We take an arbitrary language
                describeLanguage = "en";
            }

			if (describe == undefined || describe == null) {
				describe = getTextTranslation('accountRefillForm_no_description');
			}

            if ( $.settings.user.package[0]['currency'] == "free" ) {
                describe += "&nbsp;" + "(" + getGenericTranslation('free_package', describeLanguage) + ")";
            }
            else {
                describe += "&nbsp;" + "(" + $.settings.user.package[0]['price'] + "&nbsp;" + $.settings.user.package[0]['currency'] + ")";
            }

            $('#feedbackForm_package_value').html(describe);
        }
        else {
            $('#feedbackForm_package_value').text('');
        }
    }
    else {
        $('#feedbackForm_package_value').text('');
    }
}

function feedbackForm_schedule_display( displayLang ){
    if ( $.settings.user != undefined && $.settings.user.schedule != undefined ) {
        var text = '<ul style="margin: 0px; padding: 0px; list-style-position: inside; list-style-type: circle">';
        for ( entry_itt = 0; entry_itt < $.settings.user.schedule.value.length; entry_itt++ ) {
            var entry_value_itt = $.settings.user.schedule.value[entry_itt];
            var begin_date = new Date();
            begin_date.setHours(entry_value_itt['begin']['hour']);
            begin_date.setMinutes(entry_value_itt['begin']['min']);
            begin_date = explodeDate(begin_date);

            var end_date = new Date();
            end_date.setHours(entry_value_itt['end']['hour']);
            end_date.setMinutes(entry_value_itt['end']['min']);
            end_date = explodeDate(end_date);
            if ( entry_value_itt['end']['hour'] == 24 ) {
                end_date.hours[24] = 23;
                end_date.hours[12] = 11;
                end_date.minutes = 59;
                end_date.hours['ext'] = "pm";
            }

            if ( $.settings.user.schedule.value.length > 1 ) {
                text += '<li>';
            }
            if ( entry_value_itt['begin']['day'] == entry_value_itt['end']['day'] ) { // Schedule on one day
                if ( begin_date.hours[24] == 0 && end_date.hours[24] == 23 && begin_date.minutes == 0 && end_date.minutes == 59 ) {
                    text += $.sprintf(getGenericTranslation('feedbackForm_schedule_all-day', displayLang), getGenericTranslation(entry_value_itt['begin']['day'], displayLang));
                }
                else {
                    text += $.sprintf(getGenericTranslation('feedbackForm_schedule_1-day', displayLang), getGenericTranslation(entry_value_itt['begin']['day'], displayLang), $.sprintf(getGenericTranslation('short-time-display-without-seconds', displayLang), begin_date.hours[24], begin_date.minutes, begin_date.hours[12], begin_date.hours['ext']), $.sprintf(getGenericTranslation('short-time-display-without-seconds', displayLang), end_date.hours[24], end_date.minutes, end_date.hours[12], end_date.hours['ext']));
                }
            }
            else { // Schedule over days
                if ( (entry_value_itt['begin']['day'] == "monday") && (entry_value_itt['end']['day'] == "sunday") ) { // All week
                    if ( begin_date.hours[24] == 0 && end_date.hours[24] == 23 && begin_date.minutes == 0 && end_date.minutes == 59 ) {
                        text += getGenericTranslation('feedbackForm_schedule_all-week', displayLang);
                        break;
                    }
                }
                text += $.sprintf(getGenericTranslation('feedbackForm_schedule_2-days', displayLang), getGenericTranslation(entry_value_itt['begin']['day'], displayLang), $.sprintf(getGenericTranslation('short-time-display-without-seconds', displayLang), begin_date.hours[24], begin_date.minutes, begin_date.hours[12], begin_date.hours['ext']), getGenericTranslation(entry_value_itt['end']['day'], displayLang), $.sprintf(getGenericTranslation('short-time-display-without-seconds', displayLang), end_date.hours[24], end_date.minutes, end_date.hours[12], end_date.hours['ext']));
            }
            if ( $.settings.user.schedule.value.length > 1 ) {
                text += '</li>';
            }
        }
        text += '</ul>';
        $('#feedbackForm_schedule_value').html(text);
    }
    else {
        $('#feedbackForm_schedule_value').html('');
    }
}

function feedbackForm_remainingTimeCredit_timer_start( displayLang ){
    if ( timerObj.remainingTimeCredit == undefined ) {
        timerObj.remainingTimeCredit = new Array();
        timerObj.remainingTimeCredit.refreshInterval = 1000;
        timerObj.remainingTimeCredit.ressource = window.setInterval(function (){
            feedbackForm_remainingTimeCredit_timer_display(displayLang);
        }, timerObj.remainingTimeCredit.refreshInterval);
    }
}
function feedbackForm_remainingTimeCredit_timer_stop(){
    if ( timerObj.remainingTimeCredit != undefined ) {
        window.clearInterval(timerObj.remainingTimeCredit.ressource);
        delete timerObj.remainingTimeCredit;
    }
}

function feedbackForm_remainingTimeCredit_timer_display( displayLang ){

    if ( timerObj.remainingTimeCredit != undefined && $.settings != undefined && $.settings.user != undefined && $.settings.user.timeCredit != undefined && $.settings.user.timeCredit.remaining != undefined ) {
        $.settings.user.timeCredit.remaining.value--;
        if ( $.settings.user.timeCredit.remaining.value > 0 ) {
            var hours = Math.floor($.settings.user.timeCredit.remaining.value / 3600);
            var mins = Math.floor(($.settings.user.timeCredit.remaining.value - (hours * 3600)) / 60);
            var seconds = $.settings.user.timeCredit.remaining.value - (hours * 3600) - (mins * 60);

            var hours_label = getGenericTranslation('hour', displayLang, (hours > 1));
            var mins_label = getGenericTranslation('minute', displayLang, (mins > 1));
            var seconds_label = getGenericTranslation('second', displayLang, (seconds > 1));

            $('#feedbackForm_remaining_time_credit_value').text($.sprintf(getGenericTranslation('feedbackForm_time-credit-with-seconds'), hours, hours_label, mins, mins_label, seconds, seconds_label));
        }
        else {
            feedbackForm_remainingTimeCredit_timer_stop();
            $('#feedbackForm_remaining_time_credit_value').text('-');
            // No remaining time credit, disconnect user
            //feedbackFormDisconnect();
        }
    }
}

function feedbackForm_forceDiscTimer_start( displayLang ) {
	if ( $('#feedbackForm_automatic_disconnection_block').is(':hidden') ) {
		if ( $.settings.user.forceDiscTimer != undefined && $.settings.user.forceDiscTimer.value != undefined ) {
			if ( timerObj.forceDiscTimer == undefined ) {
		                timerObj.forceDiscTimer = new Array();
				timerObj.forceDiscTimer.refreshInterval = 1000;
				timerObj.forceDiscTimer.value = $.settings.user.forceDiscTimer.value;
				timerObj.forceDiscTimer.resource = window.setInterval(function (){
					feedbackForm_forceDiscTimer_display(displayLang);
				}, timerObj.forceDiscTimer.refreshInterval);
			}
		}
	}
}

function feedbackForm_forceDiscTimer_stop(){
    $('#feedbackForm_automatic_disconnection_value').text('-');
    if ( timerObj.forceDiscTimer != undefined && timerObj.forceDiscTimer.resource != undefined ) {
        window.clearInterval(timerObj.forceDiscTimer.resource);
        delete timerObj.forceDiscTimer;
    }
}

function feedbackForm_forceDiscTimer_display( displayLang ){
	if ( timerObj.forceDiscTimer != undefined && timerObj.forceDiscTimer.value != undefined ) {
		timerObj.forceDiscTimer.value--;
		if ( timerObj.forceDiscTimer.value > 0 ) {
			$('#feedbackForm_automatic_disconnection_value').text(getForcedDisconnectionTimerDisplayText(timerObj.forceDiscTimer.value, displayLang));
		}
		else {
			feedbackForm_forceDiscTimer_stop();
			feedbackFormDisconnect();
		}
	}
}


function feedbackForm_multidevice_fillIn(){

    if ( $.settings.user.multidevice != undefined && $.settings.user.multidevice.value != undefined ) {
        $('#feedbackForm_multidevice_value').text($.settings.user.multidevice.value);
        $('#feedbackForm_multidevice_block').show();
    }
    else {
        $('#feedbackForm_multidevice_block').hide();
        $('#feedbackForm_multidevice_value').text('');
    }
}

// Redirect URL + delay
function feedbackForm_postConnectRedirectDelay_timer_start( displayLang ){
    if ( timerObj.postConnectRedirectDelay == undefined ) {
        timerObj.postConnectRedirectDelay = new Array();
        timerObj.postConnectRedirectDelay.refreshInterval = 1000;
        timerObj.postConnectRedirectDelay.remaining = $.settings.postConnectRedirect.delay;
        timerObj.postConnectRedirectDelay.ressource =
            window.setInterval(function (){
                feedbackForm_postConnectRedirectDelay_timer_display(displayLang);
            }, timerObj.postConnectRedirectDelay.refreshInterval);
    }
}
function feedbackForm_postConnectRedirectDelay_timer_stop(){
    if ( timerObj.postConnectRedirectDelay != undefined ) {
        window.clearInterval(timerObj.postConnectRedirectDelay.ressource);
        delete timerObj.postConnectRedirectDelay;
    }
}

function feedbackForm_postConnectRedirectDelay_timer_display( displayLang ){

    if ( timerObj.postConnectRedirectDelay.remaining ) {
        timerObj.postConnectRedirectDelay.remaining--;
        if ( timerObj.postConnectRedirectDelay.remaining > 0 ) {
            var seconds_label = getGenericTranslation('second', displayLang, (timerObj.postConnectRedirectDelay.remaining > 1));
            $('#feedbackForm_postConnectRedirectDelay_text').text($.sprintf(getTextTranslation('feedbackForm_postConnectRedirectDelay_value'), timerObj.postConnectRedirectDelay.remaining, seconds_label));
        }
        else {
            feedbackForm_postConnectRedirectDelay_timer_stop();
            $('#feedbackForm_postConnectRedirectDelay_block').hide();
            feedbackForm_postConnectRedirectDelay_redirect();
        }
    }
}

function feedbackForm_postConnectRedirectDelay_redirect(){
    window.location = $.settings.postConnectRedirect.url;
}

/*****************************************************************************/
/****              Modify Password Form JavaScript functions              ****/
/*****************************************************************************/

/** This function is triggered when the page is loaded
 */
$(document).ready(function (){

    /** Input triggers
     */
// 	$('form[name=modifyPwdForm] input[name=old_pwd]').change(function() {
// 		///
// 	});
// 	
// 	$('form[name=modifyPwdForm] input[name=new_pwd]').change(function() {
// 		///
// 	});
// 	
// 	$('form[name=modifyPwdForm] input[name=confirm_pwd]').change(function() {
// 		///
// 	});

    /** Buttons triggers
     */
    $('#modifyPwdForm_back_button').click(function (){
        modifyPwdLink_display();
    });

    $('#modifyPwdForm_confirm_button').click(function (){
        modifyPwdFormConfirm();
    });

    /** Form triggers
     */
    $('form[name="modifyPwdForm"]').submit(function (){
        return false;
    });

    /** Link triggers
     */
    $('#modifyPwdLink_link').click(function (){
        modifyPwdLink_display();
    });

    $('#modifyPwdForm_help_link').click(function (){
        modifyPwdForm_HelpBlock_display();
    });
    // CHANGED_BY_HH
    // added to display the help, when the user click on password field
    $('#uc-new_pwd_mod').click(function (){
        modifyPwdForm_HelpBlock_display(true);
    });

});

/** Configure modifyPwdForm depending on settings
 */
function modifyPwdForm_configure(){
    // Moving link to right location
    $('#modifyPwdLink').appendTo('#feedbackForm_settings_link').show();
    // CHANGED_BY_HH
    // I have removed the "td" (#feedbackForm_settings_link td),
    // to append elemtnts to the div, instead to a table
    // OLD: $('#modifyPwdLink').appendTo('#feedbackForm_settings_link td').show();
}

/** Display modifyPwdForm depending on settings
 * @param boolean state - Indicate if the form must be displayed or not
 */
function modifyPwdForm_display( state ){
    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }

    if ( display == true ) {
        $('form[name="modifyPwdForm"]').show();
        if ( $.settings.user.pwdConstraint != undefined ) {
            $('#modifyPwdForm_help_tr').show();
        }
    }
    else {
        $("#modifyPwdForm_help_block").hide();
        $('form[name="modifyPwdForm"]').hide();
        modifyPwdForm_empty();

        if ( $.settings.user && $.settings.user.allowModPwdBySelf == true ) {
            $('#modifyPwdLink_link').show();
        }
        else {
            $('#modifyPwdLink_link').hide();
        }
    }
}

/** Empty modifyPwdForm
 */
function modifyPwdForm_empty(){

    $('form[name="modifyPwdForm"] input').each(function (){
        $(this).val('');
    });
}

/** Enable waiting mode on modifyPwdForm
 */
function modifyPwdFormWaiting( state ){
    switch ( state ) {
        case true:
            $('#modifyPwdForm_back_button').attr("disabled", true);
            $('#modifyPwdForm_confirm_button').attr("disabled", true);
            $('body').toggleClass("cursor-wait");
            break;
        case false:
            $('#modifyPwdForm_back_button').attr("disabled", false);
            $('#modifyPwdForm_confirm_button').attr("disabled", false);
            $('body').toggleClass("cursor-wait");
            break;
    }
}

/** Executed when button is clicked
 */
function modifyPwdFormConfirm(){

    var params = new Object();
    // Mandatory parameters
    params.login = $.settings.user.login.value;
    params.password = $('form[name="modifyPwdForm"] input[name="old_pwd"]').val();
    params.newPassword = $('form[name="modifyPwdForm"] input[name="new_pwd"]').val();
    params.newPasswordConfirm = $('form[name="modifyPwdForm"] input[name="confirm_pwd"]').val();

    if ( ($.settings.user != undefined) && ($.settings.user.securePwd != undefined) ) {
        params.securePwd = $.settings.user.securePwd.value;
    }

    var callbacks = new Object();
    callbacks.beforeSend = function (){
        modifyPwdFormWaiting(true);
    };
    callbacks.success = function (){
        modifyPwdFormConfirmCallback();
    };
    callbacks.complete = function (){
        modifyPwdFormWaiting(false);
    };

    modifyPwd(callbacks, params);
}

/** Executed on return of modifyPwdFormConfirm function
 */
function modifyPwdFormConfirmCallback(){

    displayErrorInfo();
    if ( $.settings.error == undefined ) {
        modifyPwdLink_display(false);
        feedbackForm_display(true);
    }
}

/*****************************************************************************/

/** Display modifyPwdLink_block depending on settings
 * Can be overwritten by state
 * @param boolean state - Indicate if the form must be displayed or not
 */
function modifyPwdLink_display( state ){

    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }
    else if ( ($.settings.user == undefined) || ($.settings.user.modifyPwdForm == undefined) || ($.settings.user.modifyPwdForm.display != true) ) {
        display = true;
    }
    else {
        display = false;
    }

    if ( $.settings.user == undefined ) {
        $.settings.user = new Object();
    }
    if ( $.settings.user.modifyPwdForm == undefined ) {
        $.settings.user.modifyPwdForm = new Object();
    }
    $.settings.user.modifyPwdForm.display = display;
    modifyPwdForm_display(display);
    // We display the opposite the feedback
    feedbackForm_display(!display);
}

/** Display modifyPwdFormHelpBlock_display when help link is clicked
 * @param boolean state - Indicate if the block must be displayed or not
 */
function modifyPwdForm_HelpBlock_display( state, displayLang ){
    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }
    else if ( $('#modifyPwdForm_help_block').is(':hidden') == true ) {
        display = true;
    }

    if ( display == true ) {
        if ( translationsAreLoaded == true ) {
            modifyPwdForm_HelpBlock_configure(displayLang);
        }
        $('#modifyPwdForm_help_block').show();
    }
    else {
        $('#modifyPwdForm_help_block').hide();
    }
}

/** Configure modifyPwdForm_help_block
 * @param string displayLang - The language whish to display the content
 */
function modifyPwdForm_HelpBlock_configure( displayLang ){
    if ( $.settings != undefined && $.settings.user != undefined && $.settings.user.pwdConstraint != undefined ) {
        if ( $('#modifyPwdForm_help_list').children().length > 1 ) {
            $('#modifyPwdForm_help_list li').not(":first").remove();
        }
        /* Update the content of the help box to display to the user the password
         * policy in use for his profile */
        //var help_block = $('#modifyPwdForm_help_block').clone();
        $("#modifyPwdHelpBlock_text").text(getInputTranslation('modifyPwdForm_help_text', displayLang));
        var constraintValues = new Array("minLength", "maxLength");
        for ( key in constraintValues ) {
            var val = constraintValues[key];
            var line = $('#modifyPwdForm_help_list li:first').clone();
            line.toggle();
            line.text($.sprintf(getInputTranslation("modifyPwdForm_help_" + val, displayLang), $.settings.user.pwdConstraint.value[val]));
            $('#modifyPwdForm_help_list').append(line);
        }
        for ( key in $.settings.user.pwdConstraint.value.characterSet ) {
            var set = $.settings.user.pwdConstraint.value.characterSet[key];
            if ( set.quota > 0 ) {
                var line = $('#modifyPwdForm_help_list li:first').clone();
                line.toggle();
                line.text($.sprintf(getInputTranslation("modifyPwdForm_help_character_set_text", displayLang), set.quota, set.set.join("")));
                $('#modifyPwdForm_help_list').append(line);
            }
        }
    }
}

/*****************************************************************************/
/****          Get Purchase Summary Form JavaScript functions           ****/
/*****************************************************************************/

/** This function is triggered when the page is loaded
 */
$(document).ready(function (){

    /** Buttons triggers
     */
    $('#getPurchaseSummaryForm_back_button').click(function (){
        getPurchaseSummaryLink_display(false);
    });

    $('#getPurchaseSummaryForm_download_button').click(function (){
        getPurchaseSummaryFormConfirm();
    });

    /** Form triggers
     */
    $('form[name="getPurchaseSummaryForm"]').submit(function (){
        return false;
    });

    /** Link triggers
     */
    $('#getPurchaseSummaryLink_link').click(function (){
        getPurchaseSummaryFormGenerate();
    });
});

/** Configure getPurchaseSummaryForm depending on settings
 */
function getPurchaseSummaryForm_configure(){
    // Configure display
    if ( $.settings.getPurchaseSummary == true ) {
        // Moving link to right location
        $('#getPurchaseSummaryLink').appendTo('#feedbackForm_settings_link').show();
        // CHANGED_BY_HH
        // I have removed the "td" from (#feedbackForm_settings_link td),
        // to append elemtnts to the div, instead to a table
        // OLD: $('#getPurchaseSummaryLink').appendTo('#feedbackForm_settings_link td').show();
    }
    else {
        $('form[name="getPurchaseSummaryForm"]').remove();
        $('#getPurchaseSummaryLink').remove();
    }
}

/** Display getPurchaseSummaryForm depending on settings
 * @param boolean state - Indicate if the form must be displayed or not
 */
function getPurchaseSummaryForm_display( state ){
    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }
    if ( display == true ) {
        getPurchaseSummaryForm_fillIn();
        $('form[name="getPurchaseSummaryForm"]').show();
    }
    else {
        $('form[name="getPurchaseSummaryForm"]').hide();

        if ( $.settings.user && $.settings.user.getPurchaseSummary != undefined && $.settings.user.getPurchaseSummary.show == true ) {
            $('#getPurchaseSummaryLink_link').show();
        }
        else {
            $('#getPurchaseSummaryLink_link').hide();
        }
    }
}

function getPurchaseSummaryForm_fillIn( displayLang ){
    if ( $.settings.user != undefined && $.settings.user.getPurchaseSummary != undefined ) {
        var getPurchaseSummarySettings = $.settings.user.getPurchaseSummary;

        if ( getPurchaseSummarySettings.amount != undefined ) {
            $('#getPurchaseSummaryForm_amount_value').text(getPurchaseSummarySettings.amount.value);
        }
        else {
            $('#getPurchaseSummaryForm_amount_value').text('');
        }

        if ( getPurchaseSummarySettings.downloadLink != undefined ) {
            $('#getPurchaseSummaryForm_download_link').attr("href", getPurchaseSummarySettings.downloadLink.value);
        }
        else {
            $('#getPurchaseSummaryForm_download_link').attr("href", "#");
        }
    }
}

/** Enable waiting mode on getPurchaseSummaryForm
 */
function getPurchaseSummaryFormWaiting( state ){
    switch ( state ) {
        case true:
            $('body').toggleClass("cursor-wait");
            break;
        case false:
            $('body').toggleClass("cursor-wait");
            break;
    }
}

/** Executed when button is clicked
 */
function getPurchaseSummaryFormGenerate(){

    var params = new Object();
    // Mandatory parameters
    params.login = $.settings.user.login.value;

    if ( ($.settings.user != undefined) && ($.settings.user.securePwd != undefined) ) {
        params.securePwd = $.settings.user.securePwd.value;
    }

    var callbacks = new Object();
    callbacks.beforeSend = function (){
        getPurchaseSummaryFormWaiting(true);
    };
    callbacks.success = function (){
        getPurchaseSummaryFormGenerateCallback();
    };
    callbacks.complete = function (){
        getPurchaseSummaryFormWaiting(false);
    };

    getPurchaseSummary(callbacks, params);
}

/** Executed on return of getPurchaseSummaryFormConfirm function
 */
function getPurchaseSummaryFormGenerateCallback(){

    displayErrorInfo();
    if ( $.settings.error == undefined ) {
        getPurchaseSummaryLink_display();
    }
}

/*****************************************************************************/

/** Display getPurchaseSummaryLink_block depending on settings
 * Can be overwritten by state
 * @param boolean state - Indicate if the form must be displayed or not
 */
function getPurchaseSummaryLink_display( state ){

    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }
    else if ( ($.settings.user == undefined) || ($.settings.user.getPurchaseSummaryForm == undefined) || ($.settings.user.getPurchaseSummaryForm.display != true) ) {
        display = true;
    }
    else {
        display = false;
    }

    if ( $.settings.user == undefined ) {
        $.settings.user = new Object();
    }
    if ( $.settings.user.getPurchaseSummaryForm == undefined ) {
        $.settings.user.getPurchaseSummaryForm = new Object();
    }
    $.settings.user.getPurchaseSummaryForm.display = display;
    getPurchaseSummaryForm_display(display);
    // We display the opposite the feedback
    feedbackForm_display(!display);
}

/*****************************************************************************/
/****          Get Purchase Summary Form JavaScript functions           ****/
/*****************************************************************************/

/** This function is triggered when the page is loaded
 */
$(document).ready(function (){

    /** Input triggers
     */
    $('form[name="upgradeAccountForm"] input[name="multidevice"]').keyup(function (){
        upgradeAccountForm_change();
    });


    /** Buttons triggers
     */

    $('#upgradeAccountFormLinks_back_button').click(function (){
        upgradeAccountFormLink_display(false);
    });
    $('#upgradeAccountFormMultidevice_back_button').click(function (){
        upgradeAccountCheckForm_display(false);
        upgradeAccountOgoneRedirectForm_display(false);
        upgradeAccountFormLink_display(false);
        manageAccountForm_display(true);
    });
    $('#upgradeAccountFormMultidevice_update_button').click(function (){
        upgradeAccountForm_getAmount();
    });
    $('#upgradeAccountCheckForm_back_button').click(function (){
        upgradeAccountCheckForm_display(false);
        upgradeAccountFormLink_display(false);
        manageAccountForm_display(true);
    });
    $('#upgradeAccountCheckForm_check_button').click(function (){
        upgradeAccountCheckForm_check();
    });
    $('#upgradeAccountOgoneRedirectForm_pay_button').click(function (){
        upgradeAccountOgoneRedirectForm_pay();
    });
    $('#upgradeAccountOgoneRedirectForm_back_button').click(function (){
        upgradeAccountCheckForm_display(false);
        upgradeAccountOgoneRedirectForm_display(false);
        upgradeAccountFormLink_display(false);
        manageAccountForm_display(true);
    });

    /** Form triggers
     */
    $('form[name="upgradeAccountForm"]').submit(function (){
        return false;
    });
    $('form[name="upgradeAccountResultForm"]').submit(function (){
        return false;
    });

    /** Link triggers
     */
    $('#upgradeAccountLink_link').click(function (){
        upgradeAccountForm_links_display(true);
        manageAccountForm_display(false);
    });
    $('#upgradeAccountFormLinks_add_simultaneous_connection_link').click(function (){
        manageAccountForm_display(false);
        upgradeAccountFormGenerate();
    });
    $('#upgradeAccountFormLinks_check_payment_link').click(function (){
        upgradeAccountCheckForm_display(true);
        manageAccountForm_display(false);
    });
});

/** Configure upgradeAccountForm depending on settings
 */
function upgradeAccountForm_configure(){
    // Configure display
    if ( !$.settings.upgradeAccount ) {
        $('form[name="upgradeAccountForm"]').remove();
        $('form[name="upgradeAccountResultForm"]').remove();
        $('form[name="upgradeAccountOgoneRedirectForm"]').remove();
        $('#upgradeAccountForm_links_explain_text').remove();
        $('#upgradeAccountFormLinks_add_simultaneous_connection_link').remove();
        $('#upgradeAccountFormLinks_check_payment_link').remove();
        $('#upgradeAccountForm_explain_text').remove();
        $('#upgradeAccountForm_separator').remove();
    }
}

/** Display upgradeAccountForm depending on settings
 * @param boolean state - Indicate if the form must be displayed or not
 */
function upgradeAccountForm_display( state ){
    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }
    if ( display == true ) {
        upgradeAccountForm_fillIn();
        $('form[name="upgradeAccountForm"]').show();
    }
    else {
        $('form[name="upgradeAccountForm"]').hide();

        if ( $.settings.user && $.settings.user.upgradeAccount != undefined && $.settings.user.upgradeAccount.show == true ) {
            upgradeAccountForm_links_in_manage_display(true);
        }
        else {
            upgradeAccountForm_links_in_manage_display(false);
        }
    }
}

function upgradeAccountForm_links_in_manage_display( state ){
    if ( state == true ) {
        $('#upgradeAccountForm_links_explain_text').show();
        $('#upgradeAccountFormLinks_add_simultaneous_connection_link').show();
        $('#upgradeAccountFormLinks_check_payment_link').show();
        $('#upgradeAccountForm_explain_text').show();
        $('#upgradeAccountForm_separator').show();
    }
    else {
        $('#upgradeAccountForm_links_explain_text').hide();
        $('#upgradeAccountFormLinks_add_simultaneous_connection_link').hide();
        $('#upgradeAccountFormLinks_check_payment_link').hide();
        $('#upgradeAccountForm_explain_text').hide();
        $('#upgradeAccountForm_separator').hide();
    }
}

function upgradeAccountForm_links_display( state ){
    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }
    if ( display == true ) {
        upgradeAccountForm_change();
        upgradeAccountCheckForm_display(false);
        upgradeAccountForm_addSimultaneousConnection_display(false);
        upgradeAccountFormLink_display(true);
    }
}

function upgradeAccountForm_addSimultaneousConnection_display( state ){
    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }
    if ( display == true ) {
        // Restore clean state
        upgradeAccountForm_empty();
        upgradeAccountOgoneRedirectForm_empty();
        upgradeAccountOgoneRedirectForm_display(false);
        upgradeAccountForm_links_display(false);
        upgradeAccountCheckForm_display(false);
        $('#upgradeAccountFormMultidevice').show();
        upgradeAccountForm_display(true);
    }
    else {
        $('#upgradeAccountFormMultidevice').hide();
    }
}

function upgradeAccountCheckForm_display( state ){
    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }
    if ( display == true ) {
        upgradeAccountForm_display(false);
        upgradeAccountOgoneRedirectForm_display(false);
        $('form[name="upgradeAccountCheckForm"]').show();
    }
    else {
        $('form[name="upgradeAccountCheckForm"]').hide();
    }
}

function upgradeAccountOgoneRedirectForm_display( state ){
    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }
    if ( display == true ) {
        $('form[name="upgradeAccountOgoneRedirectForm"]').show();
        $('#upgradeAccountFormMultidevice_update_block').hide();
    }
    else {
        $('form[name="upgradeAccountOgoneRedirectForm"]').hide();
        $('#upgradeAccountFormMultidevice_update_block').show();
    }
}

function upgradeAccountForm_fillIn( displayLang ){
    if ( $.settings.user != undefined && $.settings.user.upgradeAccount != undefined && $.settings.user.upgradeAccount.package != undefined ) {
        var upgradeAccountPackage = $.settings.user.upgradeAccount.package;
        $(upgradeAccountPackage).each(function (){
            var package = $(this)[0];
            var text;
            var currencyLanguage;
            if ( package[displayLang] != undefined ) {
                text = package[displayLang].text;
                currencyLanguage = displayLang;
            }
            else if ( $.settings != undefined && $.settings.lang != undefined && $.settings.lang.defaultLang != undefined && package[$.settings.lang.defaultLang] != undefined ) {
                text = package[$.settings.lang.defaultLang].text;
                currencyLanguage = $.settings.lang.defaultLang;
            }
            else {
                text = package[package.defaultLang].text;
                currencyLanguage = package.defaultLang;
            }
            $('#upgradeAccountForm_package_description_value').text(text);

            // Add currency
            $('#upgradeAccountForm_amount_currency').text((package['currency'] == "free") ? getGenericTranslation('free_package', currencyLanguage) : package['currency']);
        });
    }
    else {
        $('#upgradeAccountForm_package_description_value').text('');
    }
}

/** Empty directSubscriptionForm
 */
function upgradeAccountForm_empty(){

    $('form[name="upgradeAccountForm"] input[type="text"]').each(function (){
        $(this).val('');
    });

    $('#upgradeAccountForm_amount_value').text("-");
}

function upgradeAccountForm_change(){

    $('#upgradeAccountForm_amount_value').text("-");
    upgradeAccountOgoneRedirectForm_empty();
    upgradeAccountOgoneRedirectForm_display(false);
}

/** Executed when multidevice input is changed
 */
function upgradeAccountForm_getAmount(){

    var params = new Object();

    // Mandatory parameters
    params.login = $.settings.user.login.value;
    params.multidevice = $('form[name="upgradeAccountForm"] input[name="multidevice"]').val();

    if ( ($.settings.user != undefined) && ($.settings.user.securePwd != undefined) ) {
        params.securePwd = $.settings.user.securePwd.value;
    }

    var callbacks = new Object();
    callbacks.beforeSend = function (){
        upgradeAccountForm_waiting(true);
    };
    callbacks.success = function (){
        upgradeAccountForm_getOrderCallback();
    };
    callbacks.complete = function (){
        upgradeAccountForm_waiting(false);
    };

    getUpgradeOrder(callbacks, params);
}

/** Enable waiting mode on upgradeAccountForm
 */
function upgradeAccountForm_waiting( state ){
    switch ( state ) {
        case true:
            $('body').toggleClass("cursor-wait");
            break;
        case false:
            $('body').toggleClass("cursor-wait");
            break;
    }
}

function upgradeAccountForm_getOrderCallback(){
    displayErrorInfo();
    if ( $.settings.error == undefined ) {
        if ( $.settings.user != undefined && $.settings.user.upgradeAccount != undefined && $.settings.user.upgradeAccount.amount != undefined ) {
            $('#upgradeAccountForm_amount_value').text($.settings.user.upgradeAccount.amount.value);
            upgradeAccountOgoneRedirectForm_fillIn();
            upgradeAccountOgoneRedirectForm_display(true);
        }
    }
}

function upgradeAccountOgoneRedirectForm_fillIn(){
    if ( $.settings.user != undefined && $.settings.user.upgradeAccount != undefined && $.settings.user.upgradeAccount.payment != undefined ) {
        $('form[name="upgradeAccountOgoneRedirectForm"] input[name="encrypted"]').val($.settings.user.upgradeAccount.payment.packageEncr);
        $('form[name="upgradeAccountOgoneRedirectForm"]').attr('action', $.settings.user.upgradeAccount.payment.ogoneUrlPost);
        $('form[name="upgradeAccountOgoneRedirectForm"] input[name="PSPID"]').val($.settings.user.upgradeAccount.payment.pspid);
        $('form[name="upgradeAccountOgoneRedirectForm"] input[name="USERID"]').val($.settings.user.upgradeAccount.payment.userid);
        $('form[name="upgradeAccountOgoneRedirectForm"] input[name="PSWD"]').val($.settings.user.upgradeAccount.payment.userpassword);
        $('form[name="upgradeAccountOgoneRedirectForm"] input[name="ORDERID"]').val($.settings.user.upgradeAccount.payment.orderid);
        $('form[name="upgradeAccountOgoneRedirectForm"] input[name="AMOUNT"]').val($.settings.user.upgradeAccount.payment.amount);
        $('form[name="upgradeAccountOgoneRedirectForm"] input[name="CURRENCY"]').val($.settings.user.upgradeAccount.payment.currency);
        $('form[name="upgradeAccountOgoneRedirectForm"] input[name="LANGUAGE"]').val($.settings.user.upgradeAccount.payment.language);
        $('form[name="upgradeAccountOgoneRedirectForm"] input[name="SHASIGN"]').val($.settings.user.upgradeAccount.payment.shasign);
    }
}

function upgradeAccountOgoneRedirectForm_empty(){
    $('form[name="upgradeAccountOgoneRedirectForm"] input[type="hidden"]').each(function (){
        $(this).val('');
    });
    $('form[name="upgradeAccountOgoneRedirectForm"]').removeAttr('action');
}

function upgradeAccountOgoneRedirectForm_pay(){
    var params = new Object();
    params.login = $.settings.user.login.value;
    params.orderId = $.settings.user.upgradeAccount.payment.orderid;

    if ( ($.settings.user != undefined) && ($.settings.user.securePwd != undefined) ) {
        params.securePwd = $.settings.user.securePwd.value;
    }

    var callbacks = new Object();
    callbacks.beforeSend = function (){
        ogonePaymentFormWaiting(true);
    };
    callbacks.success = function (){
        upgradeAccountOgoneRedirectForm_payCallback();
    };
    callbacks.complete = function (){
        ogonePaymentFormWaiting(false);
    };

    updateUpgradeOrder(callbacks, params);
}

/** Executed on return of upgradeAccountOgoneRedirectForm_pay function
 */
function upgradeAccountOgoneRedirectForm_payCallback(){

    displayErrorInfo();
    if ( $.settings.error == undefined ) {
        upgradeAccountCheckForm_display(true);
    }
}

function upgradeAccountCheckForm_check(){
    var params = new Object();
    params.login = $.settings.user.login.value;

    if ( ($.settings.user != undefined) && ($.settings.user.securePwd != undefined) ) {
        params.securePwd = $.settings.user.securePwd.value;
    }

    var callbacks = new Object();
    callbacks.beforeSend = function (){
        ogonePaymentFormWaiting(true);
    };
    callbacks.success = function (){
        upgradeAccountCheckForm_checkCallback();
    };
    callbacks.complete = function (){
        ogonePaymentFormWaiting(false);
    };

    checkUpgradeOrder(callbacks, params);
}

/** Executed on return of upgradeAccountCheckForm_check function
 */
function upgradeAccountCheckForm_checkCallback(){

    displayErrorInfo();
    if ( $.settings.error == undefined ) {
        upgradeAccountFormLink_display(false);
        upgradeAccountCheckForm_display(false);
    }
}

/** Executed when link is clicked
 */
function upgradeAccountFormGenerate(){

    var params = new Object();
    // Mandatory parameters
    params.login = $.settings.user.login.value;

    if ( ($.settings.user != undefined) && ($.settings.user.securePwd != undefined) ) {
        params.securePwd = $.settings.user.securePwd.value;
    }

    var callbacks = new Object();
    callbacks.beforeSend = function (){
        upgradeAccountForm_waiting(true);
    };
    callbacks.success = function (){
        upgradeAccountFormGenerateCallback();
    };
    callbacks.complete = function (){
        upgradeAccountForm_waiting(false);
    };

    getCurrentPackage(callbacks, params);
}

/** Executed on return of getPurchaseSummaryFormConfirm function
 */
function upgradeAccountFormGenerateCallback(){

    displayErrorInfo();
    if ( $.settings.error == undefined ) {
        upgradeAccountForm_fillIn();
        upgradeAccountForm_addSimultaneousConnection_display(true);
    }
}

/*****************************************************************************/

/** Display upgradeAccountForm depending on settings
 * Can be overwritten by state
 * @param boolean state - Indicate if the form must be displayed or not
 */
function upgradeAccountFormLink_display( state ){

    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }
    else if ( ($.settings.user == undefined) || ($.settings.user.upgradeAccountForm == undefined) || ($.settings.user.upgradeAccountForm.display != true) ) {
        display = true;
    }
    else {
        display = false;
    }

    if ( $.settings.user == undefined ) {
        $.settings.user = new Object();
    }
    if ( $.settings.user.upgradeAccountForm == undefined ) {
        $.settings.user.upgradeAccountForm = new Object();
    }
    $.settings.user.upgradeAccountForm.display = display;
    upgradeAccountForm_display(display);
    // We display the opposite the feedback
    feedbackForm_display(!display);
}


/*****************************************************************************/
/****           Password Recovery Form JavaScript functions               ****/
/*****************************************************************************/

/** Listen to modified element
 */
var pwdRecoveryForm_changed = new Object();

/** This function is triggered when the page is loaded
 */
$(document).ready(function() {

	/** Inputs triggers
	 */
	$('form[name="pwdRecoveryForm"] input[name="prefix"]').focus(function() {
		pwdRecoveryForm_modifyEvent('focus', $(this));
		pwdRecoveryForm_phoneHelpBlock_display(true);
	});

	$('form[name="pwdRecoveryForm"] input[name="prefix"]').blur(function() {
		pwdRecoveryForm_modifyEvent('blur', $(this));
	});

	$('form[name="pwdRecoveryForm"] input[name="phone"]').focus(function() {
		pwdRecoveryForm_modifyEvent('focus', $(this));
		pwdRecoveryForm_phoneHelpBlock_display(true);
	});

	$('form[name="pwdRecoveryForm"] input[name="phone"]').blur(function() {
		pwdRecoveryForm_modifyEvent('blur', $(this));
	});

	/** Form triggers
	 */
	$('form[name="pwdRecoverySetForm"]').submit(function (){
		return false;
	});

	$('form[name="pwdRecoveryForm"]').submit(function() {
		return false;
	});

	$('form[name="pwdRecoveryResendForm"]').submit(function() {
		return false;
	});

	$('form[name="pwdRecoveryResendResultForm"]').submit(function() {
		return false;
	});

	/** Link triggers
	 */
	$('#logonForm_forgotPasswordLink_link').click(function() {
		pwdRecoveryForm_display(true);
		logonForm_display(false);
	});

	$('#pwdRecoveryForm_phone_help_link').click(function() {
		pwdRecoveryForm_phoneHelpBlock_display();
	});

	$('#pwdRecoveryResendForm_sms_link').click(function() {
		pwdRecoveryResendForm_sendBySms();
	});

	$('#pwdRecoveryResendForm_email_link').click(function() {
		pwdRecoveryResendForm_sendByEmail();
	});

	$('#pwdRecoveryResendForm_questions_link').click(function() {
		pwdRecoveryResendForm_questions_block_display(true);
		$('#pwdRecoveryResendForm_links_block').hide();
	});

	$('#pwdRecoverySetLink_link').click(function() {
		pwdRecoverySetForm_display(true);
		manageAccountForm_display(false);
	});

	/** Buttons triggers
	 */
	$('#pwdRecoveryForm_back_button').click(function() {
		logonForm_display(true);
		pwdRecoveryForm_display(false);
	});

	$('#pwdRecoveryForm_confirm_button').click(function() {
		pwdRecoveryForm_confirm();
	});

	$('#pwdRecoveryResendForm_questions_back_button').click(function() {
		pwdRecoveryResendForm_questions_block_display(false);
		if ( $.settings.user.pwdRecovery.modes.sms == true || $.settings.user.pwdRecovery.modes.email == true ) {
			pwdRecoveryResendForm_display(true);
			pwdRecoveryResendForm_questions_block_display(false);
		}
		else {
			pwdRecoveryResendForm_display(false);
			pwdRecoveryForm_display(true);
			pwdRecoveryResendForm_questions_block_display(false);
		}
	});

	$('#pwdRecoveryResendForm_questions_update_button').click(function() {
		pwdRecoveryResendForm_sendByQuestions();
	});

	$('#pwdRecoveryResendForm_back_button').click(function() {
		pwdRecoveryResendForm_display(false);
		pwdRecoveryForm_display(true);
	});

	$('#pwdRecoverySetForm_back_button').click(function() {
		pwdRecoverySetForm_display(false);
		manageAccountForm_display(true);
	});

	$('#pwdRecoverySetForm_update_button').click(function() {
		pwdRecoverySetForm_update();
	});

	$('#pwdRecoveryResendResultForm_back_button').click(function() {
		logonForm_display(true);
		pwdRecoveryResendResultForm_display(false);
	});

});

// Live event bindings
$(document).delegate('form[name="pwdRecoverySetForm"] select', "change", pwdRecoverySetForm_updateQuestionChoices);

/** Configure pwdRecoveryForm depending on settings
 */
function pwdRecoveryForm_configure() {

	// Configure display
	if ( $.settings.pwdRecovery == true ) {
		$('#logonForm_forgotPasswordLink').show();
		// Configure help block
		pwdRecoveryForm_phoneHelpBlock_configure();
	}
	else {
		$('form[name="pwdRecoveryForm"]').remove();
	}
}

/** Display pwdRecoveryForm depending on settings
 * Can be overwritten by state
 * @param boolean state - Indicate if the form must be displayed or not
 */
function pwdRecoveryForm_display(state) {

	var display = false;
	if ( (state == true) || (state == false) ) {
		display = state;
	}

	if ( display == true ) {
		$('form[name="pwdRecoveryForm"]').show();
	}
	else {
		$('form[name="pwdRecoveryForm"]').hide();
// 		$('form[name="pwdRecoveryForm"] tr[id$="_block"]').hide();
		pwdRecoveryForm_empty();
	}
	pwdRecoveryForm_phoneHelpBlock_display(false);
}

/** Empty pwdRecoveryForm
 */
function pwdRecoveryForm_empty() {

	$('form[name="pwdRecoveryForm"] input').each(function() {
		$(this).val('');
	});

	// Adding examples values
	pwdRecoveryForm_phoneHelpBlock_configure();

	pwdRecoveryForm_changed['prefix'] = false;
	pwdRecoveryForm_changed['phone'] = false;
}

/** Configure directSubscriptionForm_phone_block
 * @param string displayLang - The language whish to display the content
 */
function pwdRecoveryForm_phoneHelpBlock_configure(displayLang) {
	if ( pwdRecoveryForm_changed['prefix'] != true ) {
		$('#pwdRecoveryForm_phone_prefix_value').val(getInputTranslation("pwdRecoveryForm_phone_prefix_value", displayLang));
	}
	if ( pwdRecoveryForm_changed['phone'] != true ) {
		$('#pwdRecoveryForm_phone_phone_value').val(getInputTranslation("pwdRecoveryForm_phone_phone_value", displayLang));
	}
	$('#pwdRecoveryForm_phone_help_prefix_example_value').val(getInputTranslation("pwdRecoveryForm_phone_help_prefix_example_value", displayLang));
	$('#pwdRecoveryForm_phone_help_phone_example_value').val(getInputTranslation("pwdRecoveryForm_phone_help_phone_example_value", displayLang));
}

/** Manage the modification of inputs and the help texts present on them
 * @param string type - The type on the event (focus | blur )
 * @param element element - The DOM element afected by the modification
 */
function pwdRecoveryForm_modifyEvent(type, element) {
	switch ( type ) {
		case 'focus':
			if ( pwdRecoveryForm_changed[element.attr("name")] != true ) {
				element.val("");
			}
			break;

		case 'blur':
			if ( element.val() == "" ) {
				element.val(getInputTranslation(element.attr("id")));
				pwdRecoveryForm_changed[element.attr("name")] = false;
			}
			else {
				pwdRecoveryForm_changed[element.attr("name")] = true;
			}
			break;
	}
}

/** Display pwdRecoveryForm_phone_help_block when help link is clicked
 * @param boolean state - Indicate if the block must be displayed or not
 */
function pwdRecoveryForm_phoneHelpBlock_display( state ) {

	var display = false;
	if ( (state == true) || (state == false) ) {
		display = state;
	}
	else if ( $('#pwdRecoveryForm_phone_help_block').is(':hidden') == true ) {
		display = true;
	}

	if ( display == true ) {
		$('#pwdRecoveryForm_phone_help_block').show();
	}
	else {
		$('#pwdRecoveryForm_phone_help_block').hide();
	}
}

function pwdRecoveryForm_confirm() {
	var params = new Object();

	params.login = $('form[name="pwdRecoveryForm"] input[name="login"]').val();
	params.emailAddress = $('form[name="pwdRecoveryForm"] input[name="email"]').val();
	params.prefix = (pwdRecoveryForm_changed['prefix'] == true) ? $('form[name="pwdRecoveryForm"] input[name="prefix"]').val() : "";
	params.phone = (pwdRecoveryForm_changed['phone'] == true) ? $('form[name="pwdRecoveryForm"] input[name="phone"]').val() : "";

	if ( ($.settings.user != undefined) && ($.settings.user.securePwd != undefined) ) {
		params.securePwd = $.settings.user.securePwd.value;
	}

	//Re-init settings to get up to date infos, caused by $.extend use, merging returned ajax data
	$.settings.user.pwdRecovery = undefined;

	var callbacks = new Object();
	callbacks.beforeSend = function() { pwdRecoveryFormWaiting(true); };
	callbacks.success    = function() { pwdRecoveryForm_confirmCallback(); };
	callbacks.complete   = function() { pwdRecoveryFormWaiting(false); };

	getPwdRecoveryOptionsFromUser(callbacks, params);
}

/** Executed on return of pwdRecoveryForm_update function
 */
function pwdRecoveryForm_confirmCallback() {

	displayErrorInfo();
	if ( $.settings.error == undefined ) {
		pwdRecoveryResendForm_display(true);
		pwdRecoveryForm_display(false);
		pwdRecoveryResendForm_questions_block_display(false);
	}
}

/** Enable waiting mode on pwdRecoverySetForm
 */
function pwdRecoveryFormWaiting(state) {
	switch ( state ) {
		case true:
			$('form[name="pwdRecoveryForm"] button').attr("disabled", true);
			$('body').toggleClass("cursor-wait");
			break;
		case false:
			$('form[name="pwdRecoveryForm"] button').attr("disabled", false);
			$('body').toggleClass("cursor-wait");
			break;
	}
}

function pwdRecoveryResendForm_display( state ){
    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }

    if ( display == true ) {
        $('form[name="pwdRecoveryResendForm"]').show();

        if ( $.settings.user != undefined && $.settings.user.pwdRecovery != undefined && $.settings.user.pwdRecovery.modes != undefined ) {
            // Display modes
            if ( $.settings.user.pwdRecovery.modes.questions == true ) {
                $('#pwdRecoveryResendForm_questions_link_block').show();
            }
            else {
                $('#pwdRecoveryResendForm_questions_link_block').hide();
            }
            if ( $.settings.user.pwdRecovery.modes.sms == true ) {
                $('#pwdRecoveryResendForm_sms_link_block').show();
            }
            else {
                $('#pwdRecoveryResendForm_sms_link_block').hide();
            }
            if ( $.settings.user.pwdRecovery.modes.email == true ) {
                $('#pwdRecoveryResendForm_email_link_block').show();
            }
            else {
                $('#pwdRecoveryResendForm_email_link_block').hide();
            }
            if ( $.settings.user.pwdRecovery.modes.sms == true || $.settings.user.pwdRecovery.modes.email == true || $.settings.user.pwdRecovery.modes.questions == true ) {
                $('#pwdRecoveryResendForm_links_block').show();
            }
            pwdRecoveryResendForm_questions_block_display($.settings.user.pwdRecovery.modes.questions);
        }
    }
    else {
        $('form[name="pwdRecoveryResendForm"]').hide();
        pwdRecoveryResendForm_empty();
        displayStep();
    }
}

function pwdRecoveryResendForm_questions_block_display( state ){
    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }

    if ( display == true ) {
        pwdRecoveryResendForm_fillInQuestions();
        $('#pwdRecoveryResendForm_questions_block').show();
    }
    else {
        $('#pwdRecoveryResendForm_questions_block').hide();
        pwdRecoveryResendForm_empty();
    }
}

function pwdRecoveryResendForm_empty(){
    $('form[name="pwdRecoveryResendForm"] div[id^="pwdRecoveryResendForm_question_"][id$="_block"][id!="pwdRecoveryResendForm_question_base_block"]').remove();
// 	$('form[name="pwdRecoveryResendForm"] input').each(function() {
// 		$(this).val('');
// 	});
}

function pwdRecoveryResendForm_fillInQuestions( displayLang ){
    if ( $.settings != undefined && $.settings.user != undefined && $.settings.user.pwdRecovery != undefined && $.settings.user.pwdRecovery.questions != undefined ) {
        var questions = $.settings.user.pwdRecovery.questions;
        var availableQuestions = $.settings.user.pwdRecovery.availableQuestions;

        $.each(questions, function ( questionIndex, questionValue ){
            var clone = $('#pwdRecoveryResendForm_question_base_block').clone().show();
            $(clone).attr("id", $(clone).attr("id").replace("_base", "_" + questionIndex));
            $(clone).find('span').each(function (){
                $(this).attr("id", $(this).attr("id").replace("_base", "_" + questionIndex));
                if ( getGenericTranslation('pwdRecoverySecretQuestion_' + questionValue, displayLang) != "" ) {
                    $(this).text(getGenericTranslation('pwdRecoverySecretQuestion_' + questionValue, displayLang));
                }
            });
            $(clone).find('input').each(function (){
                $(this).attr("name", $(this).attr("name").replace("_base", "_" + questionIndex));
            });
            $(clone).insertBefore($('#pwdRecoveryResendForm_question_base_block'));
        });
    }
}

function pwdRecoveryResendForm_questionsTranslate( displayLang ){
    if ( displayLang == undefined ) {
        if ( $.settings != undefined && $.settings.user != undefined && $.settings.user.lang != null ) {
            displayLang = $.settings.user.lang;
        }
        else {
            displayLang = $.settings.lang.defaultLang;
        }
    }
    pwdRecoveryResendForm_empty();
    pwdRecoveryResendForm_fillInQuestions(displayLang);
}

function pwdRecoveryResendForm_sendBySms(){
    var params = new Object();

    if ( ($.settings.user != undefined) && ($.settings.user.securePwd != undefined) ) {
        params.securePwd = $.settings.user.securePwd.value;
    }

    var callbacks = new Object();
    callbacks.beforeSend = function (){
        pwdRecoveryResendFormWaiting(true);
    };
    callbacks.success = function (){
        pwdRecoveryResendForm_sendCallback();
    };
    callbacks.complete = function (){
        pwdRecoveryResendFormWaiting(false);
    };

    regenPwdWithSmsResend(callbacks, params);
}

function pwdRecoveryResendForm_sendByEmail(){
    var params = new Object();

    if ( ($.settings.user != undefined) && ($.settings.user.securePwd != undefined) ) {
        params.securePwd = $.settings.user.securePwd.value;
    }

    var callbacks = new Object();
    callbacks.beforeSend = function (){
        pwdRecoveryResendFormWaiting(true);
    };
    callbacks.success = function (){
        pwdRecoveryResendForm_sendCallback();
    };
    callbacks.complete = function (){
        pwdRecoveryResendFormWaiting(false);
    };

    regenPwdWithEmailResend(callbacks, params);
}

function pwdRecoveryResendForm_sendCallback(){

    displayErrorInfo();
    if ( $.settings.error == undefined ) {
        logonForm_display(true);
        pwdRecoveryResendForm_display(false);
    }
}

function pwdRecoveryResendForm_sendByQuestions(){
    var params = new Object();

    $('form[name="pwdRecoveryResendForm"] input[name^="answer_"]').each(function (){
        params[$(this).attr("name")] = $.trim($(this).val());
    });

    if ( ($.settings.user != undefined) && ($.settings.user.securePwd != undefined) ) {
        params.securePwd = $.settings.user.securePwd.value;
    }

    var callbacks = new Object();
    callbacks.beforeSend = function (){
        pwdRecoveryResendFormWaiting(true);
    };
    callbacks.success = function (){
        pwdRecoveryResendForm_sendByQuestionsCallback();
    };
    callbacks.complete = function (){
        pwdRecoveryResendFormWaiting(false);
    };

    regenPwdWithSecretQuestions(callbacks, params);
}

function pwdRecoveryResendForm_sendByQuestionsCallback(){

    displayErrorInfo();
    if ( $.settings.error == undefined ) {
        pwdRecoveryResendResultForm_fillIn($.settings.info.pwdRecovery.password);
        pwdRecoveryResendResultForm_display(true);
        pwdRecoveryResendForm_display(false);
    }
}

function pwdRecoveryResendFormWaiting( state ){
    switch ( state ) {
        case true:
            $('form[name="pwdRecoveryResendForm"] button').attr("disabled", true);
            $('body').toggleClass("cursor-wait");
            break;
        case false:
            $('form[name="pwdRecoveryResendForm"] button').attr("disabled", false);
            $('body').toggleClass("cursor-wait");
            break;
    }
}

function pwdRecoverySetForm_configure(){
    // Moving link to right location
    $('#pwdRecoverySetLink').appendTo('#manageAccountForm_links_block');
    // CHANGED_BY_HH
    // Removed "td" and changed appending from #manageAccountForm_links_others_links_block to #manageAccountForm_links_block
    // to make the grid working without to know how many links will be append
    // OLD: $('#pwdRecoverySetLink').appendTo('#manageAccountForm_links_others_links_block td');
}

function pwdRecoverySetForm_display( state ){
    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }

    if ( $.settings != undefined && $.settings.user != undefined && $.settings.user.pwdRecovery != undefined ) {
        $('#pwdRecoverySetLink').show();
    }
    else {
        $('#pwdRecoverySetLink').hide();
    }

    if ( display == true ) {
        pwdRecoverySetForm_fillInQuestions();
        $('form[name="pwdRecoverySetForm"]').show();
        manageAccountForm_links_display(false);
    }
    else {
        $('form[name="pwdRecoverySetForm"]').hide();
        pwdRecoverySetForm_empty();
    }
}

function pwdRecoverySetForm_fillInQuestions(){


    if ( $.settings != undefined && $.settings.user != undefined && $.settings.user.pwdRecovery != undefined ) {
        for ( var itt = 0; itt < $.settings.user.pwdRecovery.maxQuestions; itt++ ) {
            var questions = $.settings.user.pwdRecovery.availableQuestions;

            var clone = $('#pwdRecoverySetForm_question_base_block').clone().show();
            $(clone).attr("id", $(clone).attr("id").replace("_base", "_" + itt));
            $(clone).find('pwdRecoverySetForm_question_base_default_option').each(function (){
                $(this).id("id", $(this).attr("id").replace("_base", "_" + itt));
            });
            $(clone).find('select').each(function (){
                var select = $(this).attr("name", $(this).attr("name").replace("_base", "_" + itt));

                $.each(questions, function ( questionIndex, questionValue ){
                    $(select).append('<option value="' + questionValue + '">' + questionValue + '</option>');
                });
            });
            $(clone).find('input').each(function (){
                $(this).attr("name", $(this).attr("name").replace("_base", "_" + itt));
            });

            // Set users values
            if ( $.settings.user.pwdRecovery.questions != undefined && $.settings.user.pwdRecovery.questions[itt] != undefined && $.settings.user.pwdRecovery.answers[itt] ) {
                $(clone).find('select').each(function (){
                    $(this).val($.settings.user.pwdRecovery.questions[itt]);
                });

                $(clone).find('input').each(function (){
                    $(this).val($.settings.user.pwdRecovery.answers[itt]);
                });
            }

            $(clone).insertBefore($('#pwdRecoverySetForm_question_base_block'));
        }
    }
    pwdRecoverySetForm_questionsTranslate();
    pwdRecoverySetForm_updateQuestionChoices();
}

function pwdRecoverySetForm_empty() {
	$('form[name="pwdRecoverySetForm"] div[id^="pwdRecoverySetForm_question_"][id$="_block"][id!="pwdRecoverySetForm_question_base_block"]').remove();
}

function pwdRecoverySetForm_questionsTranslate( displayLang ){
    $('form[name="pwdRecoverySetForm"] select option').each(function (){
        if ( getGenericTranslation('pwdRecoverySecretQuestion_' + $(this).val(), displayLang) != "" ) {
            $(this).text(getGenericTranslation('pwdRecoverySecretQuestion_' + $(this).val(), displayLang));
        }
    });
}

function pwdRecoverySetForm_updateQuestionChoices(){
    var selectedQuestions = new Array();
    // Gather selected questions
    $('form[name="pwdRecoverySetForm"] select').each(function (){
        if ( $(this).val() != "" ) {
            selectedQuestions.push($(this).val());
        }
    });

    // Disable this options in others select list
    $('form[name="pwdRecoverySetForm"] select').each(function (){
        var selectValue = $(this).val();

        $(this).find('option').each(function (){
            $(this).attr('disabled', false).show();
            if ( ($.inArray($(this).val(), selectedQuestions) != -1) && (selectValue != $(this).val()) ) {
                $(this).attr('disabled', true).hide();
            }
        });
    });
}

/** Enable waiting mode on pwdRecoverySetForm
 */
function pwdRecoverySetFormWaiting( state ){
    switch ( state ) {
        case true:
            $('form[name="pwdRecoverySetForm"] button').attr("disabled", true);
            $('body').toggleClass("cursor-wait");
            break;
        case false:
            $('form[name="pwdRecoverySetForm"] button').attr("disabled", false);
            $('body').toggleClass("cursor-wait");
            break;
    }
}

function pwdRecoverySetForm_update(){

    var params = new Object();

    $('form[name="pwdRecoverySetForm"] select[name^="question_"]').each(function (){
        params[$(this).attr("name")] = $(this).val();
    });

    $('form[name="pwdRecoverySetForm"] input[name^="answer_"]').each(function (){
        params[$(this).attr("name")] = $.trim($(this).val());
    });

    if ( ($.settings.user != undefined) && ($.settings.user.securePwd != undefined) ) {
        params.securePwd = $.settings.user.securePwd.value;
    }

    var callbacks = new Object();
    callbacks.beforeSend = function (){
        pwdRecoverySetFormWaiting(true);
    };
    callbacks.success = function (){
        pwdRecoverySetForm_updateCallback();
    };
    callbacks.complete = function (){
        pwdRecoverySetFormWaiting(false);
    };

    updatePwdRecoverySecretQuestions(callbacks, params);
}

/** Executed on return of pwdRecoverySetForm_update function
 */
function pwdRecoverySetForm_updateCallback(){

    displayErrorInfo();
    if ( $.settings.error == undefined ) {
        manageAccountForm_display(true);
        pwdRecoverySetForm_display(false);
    }
}

function pwdRecoveryResendResultForm_display( state ){
    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }

    if ( display == true ) {
        $('form[name="pwdRecoveryResendResultForm"]').show();
    }
    else {
        $('form[name="pwdRecoveryResendResultForm"]').hide();
        pwdRecoveryResendResultForm_empty();
    }
}

function pwdRecoveryResendResultForm_fillIn( newPassword ){
    $('form[name="pwdRecoveryResendResultForm"] #pwdRecoveryResendResultForm_password_value').text(newPassword);
}

function pwdRecoveryResendResultForm_empty(){
    $('form[name="pwdRecoveryResendResultForm"] #pwdRecoveryResendResultForm_password_value').text('');
}

/*****************************************************************************/
/****          Manage Account Form JavaScript functions                   ****/
/*****************************************************************************/

/** Listen to modified element
 */
var manageAccountForm_personal_settings_changed = new Object();

/** This function is triggered when the page is loaded
 */
$(document).ready(function (){

    /** Input triggers
     */
    $('form[name="manageAccountForm"] input[name="prefix"]').focus(function (){
        manageAccountForm_personal_settings_modifyEvent('focus', $(this));
        manageAccountForm_personal_settings_phoneHelpBlock_display(true);
    });

    $('form[name="manageAccountForm"] input[name="prefix"]').blur(function (){
        manageAccountForm_personal_settings_modifyEvent('blur', $(this));
    });

    $('form[name="manageAccountForm"] input[name="phone"]').focus(function (){
        manageAccountForm_personal_settings_modifyEvent('focus', $(this));
        manageAccountForm_personal_settings_phoneHelpBlock_display(true);
    });

    $('form[name="manageAccountForm"] input[name="phone"]').blur(function (){
        manageAccountForm_personal_settings_modifyEvent('blur', $(this));
    });

    /** Buttons triggers
     */
    $('#manageAccountForm_links_back_button').click(function (){
        displayStep();
    });
    $('#manageAccountForm_personal_settings_back_button').click(function (){
        manageAccountForm_display(true);
    });
    $('#manageAccountForm_personal_settings_update_button').click(function (){
        manageAccountForm_personal_settings_update();
    });
    $('#manageAccountForm_devices_back_button').click(function (){
        manageAccountForm_display(true);
    });
    $('#manageAccountForm_devices_update_button').click(function (){
        manageAccountForm_devices_update();
    });

    /** Form triggers
     */
    $('form[name="manageAccountForm"]').submit(function (){
        return false;
    });

    /** Link triggers
     */
    $('#manageAccountLink_link').click(function (){
        manageAccountForm_display(true);
    });
    $('#manageAccountForm_links_personal_settings_link').click(function (){
        manageAccountForm_personal_settings_display(true);
        manageAccountForm_devices_display(false);
        manageAccountForm_personal_settings_phoneHelpBlock_display(false);
    });

    $('#manageAccountForm_links_devices_link').click(function (){
        manageAccountForm_devices_display(true);
        manageAccountForm_personal_settings_display(false);
    });

    $('#manageAccountForm_links_account_refill_link').click(function (){
        accountRefillForm_display(true);
        manageAccountForm_display(false);
    });

    $('#manageAccountForm_personal_settings_phone_help_link').click(function (){
        manageAccountForm_personal_settings_phoneHelpBlock_display();
    });
    $('#manageAccountForm_links_modify_my_package_link').click(function (){
        modifyPackageForm_package_update();
    });
});

// Live event bindings
$(document).delegate('#manageAccountForm_devices_block div.trashButton', "click", manageAccountForm_devices_delete);

/** Configure manageAccountForm depending on settings
 */
function manageAccountForm_configure(){
    // Moving link to right location
    $('#manageAccountLink').appendTo('#feedbackForm_settings_link');
    // CHANGED_BY_HH
    // I have removed the "td" (#feedbackForm_settings_link td),
    // to append elemtnts to the div, instead to a table
    // OLD: $('#manageAccountLink').appendTo('#feedbackForm_settings_link td');
}

/** Display manageAccountForm depending on settings
 * @param boolean state - Indicate if the form must be displayed or not
 */
function manageAccountForm_display( state ){
    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }

    if ( $.settings.user.manageAccount == true ) {
        $('#manageAccountLink').show();
    }
    else {
        $('#manageAccountLink').hide();
    }
    manageAccountForm_links_display(true);
    manageAccountForm_devices_display(false);
    manageAccountForm_personal_settings_display(false);

    if ( display == true ) {
        $('form[name="manageAccountForm"]').show();
        feedbackForm_display(false);
    }
    else {
        $('form[name="manageAccountForm"]').hide();
    }
}

function manageAccountForm_links_display( state ){
    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }

    if ( $.settings.user.managePersonalSettings == true ) {
        $('#manageAccountForm_links_personal_settings_link_block').show();
    }
    else {
        $('#manageAccountForm_links_personal_settings_link_block').hide();
    }

    // Display devices management link
    if ( $.settings.user.manageDevices == true ) {
        $('#manageAccountForm_links_devices_link_block').show();
    }
    else {
        $('#manageAccountForm_links_devices_link_block').hide();
    }

    // Display change package link
    if ( $.settings.user.allowmodifypackage == true ) {
        $('#manageAccountForm_links_modify_my_package_block').show();
    }
    else {
        $('#manageAccountForm_links_modify_my_package_block').hide();
    }

    // Display account refill link
    if ( $.settings.accountRefill == true ) {
        $('#manageAccountForm_links_account_refill_link_block').show();
    }
    else {
        $('#manageAccountForm_links_account_refill_link_block').hide();
    }

    if ( display == true ) {
        $('#manageAccountForm_links_block').show();
    }
    else {
        $('#manageAccountForm_links_block').hide();
    }
}

function manageAccountForm_personal_settings_display( state ){
    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }

    if ( display == true ) {
        manageAccountForm_personal_settings_fillIn();
        $('#manageAccountForm_personal_settings_block').show();
        manageAccountForm_links_display(false);
    }
    else {
        $('#manageAccountForm_personal_settings_block').hide();
        manageAccountForm_personal_settings_empty();
    }
}

function manageAccountForm_devices_display( state ){
    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }
    if ( display == true ) {
        manageAccountForm_devices_fillIn();
        $('#manageAccountForm_devices_block').show();
        manageAccountForm_links_display(false);
    }
    else {
        $('#manageAccountForm_devices_block').hide();
        manageAccountForm_devices_empty();
    }
}

function manageAccountForm_personal_settings_fillIn(){
    if ( $.settings != undefined && $.settings.user != undefined ) {
        displayLang = $.settings.user.lang;
    }

    if ( $.settings.user != undefined ) {
        var userSettings = $.settings.user;
        var creationModeRegExp = new RegExp("^portal-([a-zA-Z_-]+)$");
        var creationModeMatches = creationModeRegExp.exec($.settings.user.creationMode.value);
        var defaultBehavior = false;
        if ( creationModeMatches != undefined ) {
            var creationMode = creationModeMatches[1];
            var creationModeSettings = $.settings.subscribe[creationMode];
        }
        else {
            // All field except custom fields are displayed and are optional (default behavior, if user was created by admin or deleg)
            defaultBehavior = true;
        }

        // Init fields
        $('tr[id^="manageAccountForm_personal_settings_"][id$="_block"]').show();
        $('span[id^="manageAccountForm_personal_settings_"][id$="_state"]').css("visibility", "");
        $('#manageAccountForm_personal_settings_postal_postoffice_box_state').css("visibility", "hidden");
        $('#manageAccountForm_personal_settings_postal_state_or_province_name_state').css("visibility", "hidden");

        // Configure lastName
        if ( defaultBehavior == true || (creationModeSettings.lastName != undefined && creationModeSettings.lastName.display == true) || (userSettings.lastName != undefined && userSettings.lastName.value != "") ) {
            if ( defaultBehavior == true || creationModeSettings.lastName == undefined || creationModeSettings.lastName.mandatory != true ) {
                $('#manageAccountForm_personal_settings_last_name_state').css("visibility", "hidden");
            }
            if ( userSettings.lastName != undefined && userSettings.lastName.value != undefined ) {
                $('form[name="manageAccountForm"] input[name="last_name"]').val(userSettings.lastName.value);
            }
        }
        else {
            $('#manageAccountForm_personal_settings_last_name_block').hide();
        }

        // Configure firstName
        if ( defaultBehavior == true || (creationModeSettings.firstName != undefined && creationModeSettings.firstName.display == true) || (userSettings.firstName != undefined && userSettings.firstName.value != "") ) {
            if ( defaultBehavior == true || creationModeSettings.firstName == undefined || creationModeSettings.firstName.mandatory != true ) {
                $('#manageAccountForm_personal_settings_first_name_state').css("visibility", "hidden");
            }
            if ( userSettings.firstName != undefined && userSettings.firstName.value != undefined ) {
                $('form[name="manageAccountForm"] input[name="first_name"]').val(userSettings.firstName.value);
            }
        }
        else {
            $('#manageAccountForm_personal_settings_first_name_block').hide();
        }

        // Configure email
        if ( defaultBehavior == true || (creationModeSettings.email != undefined && creationModeSettings.email.display == true) || (userSettings.email != undefined && userSettings.email.value != "") ) {
            if ( defaultBehavior == true || creationModeSettings.email == undefined || creationModeSettings.email.mandatory != true ) {
                $('#manageAccountForm_personal_settings_email_state').css("visibility", "hidden");
            }
            if ( userSettings.email != undefined && userSettings.email.value != undefined ) {
                $('form[name="manageAccountForm"] input[name="email"]').val(userSettings.email.value);
            }
        }
        else {
            $('#manageAccountForm_personal_settings_email_block').hide();
        }

        // Configure phoneNumber
        if ( defaultBehavior == true || (creationModeSettings.phone != undefined && creationModeSettings.phone.display == true) || (userSettings.phoneNumber != undefined && userSettings.phoneNumber.value != "") ) {
            if ( defaultBehavior == true || creationModeSettings.phone == undefined || creationModeSettings.phone.mandatory != true ) {
                $('#manageAccountForm_personal_settings_phone_state').css("visibility", "hidden");
            }
            if ( userSettings.phoneNumber != undefined && userSettings.phoneNumber.value != undefined ) {
                if ( userSettings.phoneNumber.value == "" ) {
                    $('form[name="manageAccountForm"] input[name="prefix"]').show();
                    $('#manageAccountForm_personal_settings_phone_help_link').show();
                }
                else {
                    $('form[name="manageAccountForm"] input[name="phone"]').val(userSettings.phoneNumber.value);
                    $('form[name="manageAccountForm"] input[name="prefix"]').hide();
                    $('#manageAccountForm_personal_settings_phone_help_link').hide();
                    manageAccountForm_personal_settings_changed['phone'] = true;
                }
            }
            else {
                // Display prefix field if there was no phone registered
                $('form[name="manageAccountForm"] input[name="prefix"]').show();
                $('#manageAccountForm_personal_settings_phone_help_link').show();
            }
        }
        else {
            $('#manageAccountForm_personal_settings_phone_block').hide();
        }

        // Configure organizationalUnitName
        if ( defaultBehavior == true || (creationModeSettings.organizationalUnitName != undefined && creationModeSettings.organizationalUnitName.display == true) || (userSettings.organizationalUnitName != undefined && userSettings.organizationalUnitName.value != "") ) {
            if ( defaultBehavior == true || creationModeSettings.organizationalUnitName == undefined || creationModeSettings.organizationalUnitName.mandatory != true ) {
                $('#manageAccountForm_personal_settings_organizational_unit_name_state').css("visibility", "hidden");
            }
            if ( userSettings.organizationalUnitName != undefined && userSettings.organizationalUnitName.value != undefined ) {
                $('form[name="manageAccountForm"] input[name="organizational_unit_name"]').val(userSettings.organizationalUnitName.value);
            }
        }
        else {
            $('#manageAccountForm_personal_settings_organizational_unit_name_block').hide();
        }

        // Configure postal fields
        if ( defaultBehavior == true || (creationModeSettings.postalAddress != undefined && creationModeSettings.postalAddress.display == true) || (userSettings.postalAddress != undefined && userSettings.postalAddress.value != "") ) {
            // Configure countryName
            if ( defaultBehavior == true || creationModeSettings.postalAddress == undefined || creationModeSettings.postalAddress.mandatory != true ) {
                $('#manageAccountForm_personal_settings_postal_country_name_state').css("visibility", "hidden");
            }
            if ( userSettings.countryName != undefined && userSettings.countryName.value != undefined ) {
                $('form[name="manageAccountForm"] input[name="postal_country_name"]').val(userSettings.countryName.value);
            }

            // Configure localityName
            if ( defaultBehavior == true || creationModeSettings.postalAddress == undefined || creationModeSettings.postalAddress.mandatory != true ) {
                $('#manageAccountForm_personal_settings_postal_locality_name_state').css("visibility", "hidden");
            }
            if ( userSettings.localityName != undefined && userSettings.localityName.value != undefined ) {
                $('form[name="manageAccountForm"] input[name="postal_locality_name"]').val(userSettings.localityName.value);
            }

            // Configure postalCode
            if ( defaultBehavior == true || creationModeSettings.postalAddress == undefined || creationModeSettings.postalAddress.mandatory != true ) {
                $('#manageAccountForm_personal_settings_postal_code_state').css("visibility", "hidden");
            }
            if ( userSettings.postalCode != undefined && userSettings.postalCode.value != undefined ) {
                $('form[name="manageAccountForm"] input[name="postal_code"]').val(userSettings.postalCode.value);
            }

            // Configure postalAddress
            if ( defaultBehavior == true || creationModeSettings.postalAddress == undefined || creationModeSettings.postalAddress.mandatory != true ) {
                $('#manageAccountForm_personal_settings_postal_address_state').css("visibility", "hidden");
            }
            if ( userSettings.postalAddress != undefined && userSettings.postalAddress.value != undefined ) {
                $('form[name="manageAccountForm"] input[name="postal_address"]').val(userSettings.postalAddress.value);
            }

            // Configure stateOrProvinceName
            if ( userSettings.stateOrProvinceName != undefined && userSettings.stateOrProvinceName.value != undefined ) {
                $('form[name="manageAccountForm"] input[name="postal_state_or_province_name"]').val(userSettings.stateOrProvinceName.value);
            }

            // Configure postOfficeBox
            if ( userSettings.postOfficeBox != undefined && userSettings.postOfficeBox.value != undefined ) {
                $('form[name="manageAccountForm"] input[name="postal_postoffice_box"]').val(userSettings.postOfficeBox.value);
            }
        }
        else {
            $('#manageAccountForm_personal_settings_postal_address_block').hide();
        }

        // Configure personal fields
        var userCustomFields = new Array();
        if ( userSettings.customFields != undefined ) {
            $.each(userSettings.customFields, function ( index, params ){
                userCustomFields[params.fieldid] = params.value;
            });
        }
        for ( var itt = 1; itt <= 3; itt++ ) {
            if ( defaultBehavior == false && ((creationModeSettings['personalField_' + itt] != undefined && creationModeSettings['personalField_' + itt].display == true)
                || (userCustomFields.length > 0 && userCustomFields[itt] != undefined && userCustomFields[itt] != "")) ) {
                if ( creationModeSettings['personalField_' + itt] == undefined || creationModeSettings['personalField_' + itt].mandatory != true ) {
                    $('#manageAccountForm_personal_settings_personal_field_' + itt + '_state').css("visibility", "hidden");
                }
                manageAccountForm_personal_settings_customFields_configure(displayLang);

                if ( userCustomFields[itt] != undefined ) {
                    $('form[name="manageAccountForm"] input[name="personal_field_' + itt + '"]').val(userCustomFields[itt]);
                }
            }
            else {
                $('#manageAccountForm_personal_settings_personal_field_' + itt + '_block').hide();
            }
        }

        // Configure OptIn
        if ( userSettings.privatePolicy != undefined && userSettings.privatePolicy.value != undefined ) {
            $('#manageAccountForm_privatePolicy_block').show();
            $('form[name="manageAccountForm"] input[name="manageAccountForm_privatePolicy_accept"]').attr("checked", (String(userSettings.privatePolicy.value) == "true"));
        }
        else {
            $('#manageAccountForm_privatePolicy_block').hide();
        }

    }
}

function manageAccountForm_personal_settings_empty(){
    $('#manageAccountForm_personal_settings_block input[type="text"]').val('');
    $('#manageAccountForm_personal_settings_block span[id^="manageAccountForm_personal_settings_personal_field_"][id$="_text"]').text("");

    manageAccountForm_personal_settings_phoneHelpBlock_configure();
    manageAccountForm_personal_settings_changed['prefix'] = false;
    manageAccountForm_personal_settings_changed['phone'] = false;
}

/** Manage the modification of inputs and the help texts present on them
 * @param string type - The type on the event (focus | blur )
 * @param element element - The DOM element afected by the modification
 */
function manageAccountForm_personal_settings_modifyEvent( type, element ){
    switch ( type ) {
        case 'focus':
            if ( manageAccountForm_personal_settings_changed[element.attr("name")] != true ) {
                element.val("");
            }
            break;

        case 'blur':
            if ( element.val() == "" ) {
                element.val(getInputTranslation(element.attr("id")));
                manageAccountForm_personal_settings_changed[element.attr("name")] = false;
            }
            else {
                manageAccountForm_personal_settings_changed[element.attr("name")] = true;
            }
            break;
    }
}

/** Display manageAccountForm_phone_help_block when help link is clicked
 * @param boolean state - Indicate if the block must be displayed or not
 */
function manageAccountForm_personal_settings_phoneHelpBlock_display( state ){

    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }
    else if ( $('#manageAccountForm_personal_settings_phone_help_block').is(':hidden') == true ) {
        display = true;
    }
    // Do not display phone help if the icon is hidden
    if ( $('#manageAccountForm_personal_settings_phone_help_link').is(':hidden') == true ) {
        display = false;
    }

    if ( display == true ) {
        $('#manageAccountForm_personal_settings_phone_help_block').show();
    }
    else {
        $('#manageAccountForm_personal_settings_phone_help_block').hide();
    }
}

/** Configure manageAccountForm_phone_block
 * @param string displayLang - The language whish to display the content
 */
function manageAccountForm_personal_settings_phoneHelpBlock_configure( displayLang ){
    if ( manageAccountForm_personal_settings_changed['prefix'] != true ) {
        $('#manageAccountForm_personal_settings_phone_prefix_value').val(getInputTranslation("manageAccountForm_personal_settings_phone_prefix_value", displayLang));
    }
    if ( manageAccountForm_personal_settings_changed['phone'] != true ) {
        $('#manageAccountForm_personal_settings_phone_phone_value').val(getInputTranslation("manageAccountForm_personal_settings_phone_phone_value", displayLang));
    }
    $('#manageAccountForm_personal_settings_phone_help_prefix_example_value').val(getInputTranslation("manageAccountForm_personal_settings_phone_help_prefix_example_value", displayLang));
    $('#manageAccountForm_personal_settings_phone_help_phone_example_value').val(getInputTranslation("manageAccountForm_personal_settings_phone_help_phone_example_value", displayLang));
}

function manageAccountForm_personal_settings_customFields_configure( displayLang ){

    var field_names = new Array("personalField_1", "personalField_2", "personalField_3");
    var itt = 1;
    var creationModeSettings = undefined;
    var userSettings = $.settings.user;

    if ( $.settings.user.creationMode != undefined ) {
        var creationModeRegExp = new RegExp("^portal-([a-zA-Z_-]+)$");
        var creationModeMatches = creationModeRegExp.exec($.settings.user.creationMode.value);
        if ( creationModeMatches != undefined ) {
            var creationMode = creationModeMatches[1];
            creationModeSettings = $.settings.subscribe[creationMode];
        }
    }

    var userCustomFields = new Array();
    if ( userSettings.customFields != undefined ) {
        $.each(userSettings.customFields, function ( index, params ){
            userCustomFields[params.fieldid] = params;
        });
    }

    if ( creationModeSettings != undefined ) {
        for ( key in field_names ) {
            var field_name = field_names[key];
            var labels = undefined;
            if ( creationModeSettings[field_name] != undefined ) {
                labels = creationModeSettings[field_name].labels;
            }
            else if ( userCustomFields[itt] != undefined ) {
                labels = userCustomFields[itt].label;
            }
            if ( labels != undefined ) {
                if ( labels[displayLang] != undefined ) {
                    $("#manageAccountForm_personal_settings_personal_field_" + itt + "_text").html(labels[displayLang]);
                }
                else if ( labels[$.settings.lang.defaultLang] != undefined ) {
                    $("#manageAccountForm_personal_settings_personal_field_" + itt + "_text").html(labels[$.settings.lang.defaultLang]);
                }
                else {
                    $("#manageAccountForm_personal_settings_personal_field_" + itt + "_text").html(labels[$.settings.lang.customFieldsDefaultLang]);
                }
            }
            itt++;
        }
    }
}


function manageAccountForm_devices_fillIn(){
    $('#manageAccountForm_devices_no_device_block').show();
    if ( $.settings.user != undefined && $.settings.user.devices != undefined && $.settings.user.manageDevices == true ) {
        var userDevices = $.settings.user.devices;
        if ( userDevices.length != 0 ) {
            $('#manageAccountForm_devices_no_device_block').hide();
            $.each(userDevices, function ( deviceIndex, deviceValues ){
                if ( deviceValues.address != undefined ) {
                    var clone = $('#manageAccountForm_devices_base_block').clone().show();
                    $(clone).attr("id", $(clone).attr("id").replace("_base", "_" + deviceIndex));
                    $(clone).find('span').each(function (){
                        $(this).attr("id", $(this).attr("id").replace("_base", "_" + deviceIndex));
                        $(this).text(deviceValues.address);
                    });
                    $(clone).find('input').each(function (){
                        $(this).attr("name", $(this).attr("name").replace("_base", "_" + deviceIndex));
                        $(this).val(deviceValues.comment);
                        if ( deviceValues.locked == true ) {
                            $(this).attr('disabled', 'disabled');
                        }
                    });
                    if ( deviceValues.current == true ) {
                        $(clone).addClass('currentDevice');
                    }
                    if ( deviceValues.locked == true ) {
                        $(clone).find('div.trashButton').remove();
                    }
                    $(clone).insertBefore($('#manageAccountForm_devices_base_block'));
                }
            });
        }
    }
}

function manageAccountForm_devices_empty(){
    $('#manageAccountForm_devices_no_device_block').show();
    $('#manageAccountForm_devices_block tr[id^="manageAccountForm_devices_"][id$="_block"][id!="manageAccountForm_devices_base_block"][id!="manageAccountForm_devices_no_device_block"]').remove();
}

function manageAccountForm_devices_delete(){
    $(this).parents('tr[id^="manageAccountForm_devices_"][id$="_block"]').remove();
}

/** Enable waiting mode on manageAccountForm
 */
function manageAccountFormWaiting( state ){
    switch ( state ) {
        case true:
            $('form[name="manageAccountForm"] button').attr("disabled", true);
            $('body').toggleClass("cursor-wait");
            break;
        case false:
            $('form[name="manageAccountForm"] button').attr("disabled", false);
            $('body').toggleClass("cursor-wait");
            break;
    }
}

/** Executed when manageAccountForm_personal_settings_update_button button is clicked
 */
function manageAccountForm_personal_settings_update(){

    var params = new Object();
    params.lastName = $('form[name="manageAccountForm"] input[name="last_name"]').val();
    params.firstName = $('form[name="manageAccountForm"] input[name="first_name"]').val();
    params.emailAddress = $('form[name="manageAccountForm"] input[name="email"]').val();

    params.organizationalUnitName = $('form[name="manageAccountForm"] input[name="organizational_unit_name"]').val();

    params.postalAddress = $('form[name="manageAccountForm"] input[name="postal_address"]').val();
    params.postalCode = $('form[name="manageAccountForm"] input[name="postal_code"]').val();
    params.postalLocalityName = $('form[name="manageAccountForm"] input[name="postal_locality_name"]').val();
    params.postalPostofficeBox = $('form[name="manageAccountForm"] input[name="postal_postoffice_box"]').val();
    params.postalStateOrProvinceName = $('form[name="manageAccountForm"] input[name="postal_state_or_province_name"]').val();
    params.postalCountryName = $('form[name="manageAccountForm"] input[name="postal_country_name"]').val();

    params.prefix = (manageAccountForm_personal_settings_changed['prefix'] == true) ? $('form[name="manageAccountForm"] input[name="prefix"]').val() : "";
    params.phone = (manageAccountForm_personal_settings_changed['phone'] == true) ? $('form[name="manageAccountForm"] input[name="phone"]').val() : "";

    // Custom fields
    params.personalField_1 = $('form[name="manageAccountForm"] input[name="personal_field_1"]').val();
    params.personalField_2 = $('form[name="manageAccountForm"] input[name="personal_field_2"]').val();
    params.personalField_3 = $('form[name="manageAccountForm"] input[name="personal_field_3"]').val();

    if ( ($.settings.user != undefined) && ($.settings.user.securePwd != undefined) ) {
        params.securePwd = $.settings.user.securePwd.value;
    }

    params.privatePolicyAccept = $('#manageAccountForm_privatePolicy_accept').is(':checked');

    var callbacks = new Object();
    callbacks.beforeSend = function (){
        manageAccountFormWaiting(true);
    };
    callbacks.success = function (){
        manageAccountForm_personal_settings_updateCallback();
    };
    callbacks.complete = function (){
        manageAccountFormWaiting(false);
    };

    updatePersonalSettings(callbacks, params);
}

/** Executed on return of manageAccountForm_personal_settings_update function
 */
function manageAccountForm_personal_settings_updateCallback(){

    displayErrorInfo();
    if ( $.settings.error == undefined ) {
        manageAccountForm_display(true);
    }
}

function manageAccountForm_devices_update(){
    var params = new Object();

    $('form[name="manageAccountForm"] input[name^="device_"]').each(function (){
        params[$(this).attr("name")] = $(this).val();
    });

    if ( ($.settings.user != undefined) && ($.settings.user.securePwd != undefined) ) {
        params.securePwd = $.settings.user.securePwd.value;
    }

    var callbacks = new Object();
    callbacks.beforeSend = function (){
        manageAccountFormWaiting(true);
    };
    callbacks.success = function (){
        manageAccountForm_personal_settings_updateCallback();
    };
    callbacks.complete = function (){
        manageAccountFormWaiting(false);
    };

    updateDevicesSettings(callbacks, params);
}

/** Executed on return of manageAccountForm_devices_update function
 */
function manageAccountForm_personal_settings_updateCallback(){

    displayErrorInfo();
    if ( $.settings.error == undefined ) {
        manageAccountForm_display(true);
    }
}


/*****************************************************************************/
/****          Modify package Form JavaScript functions                   ****/
/*****************************************************************************/


/** Enable waiting mode
 */
function modifyPackageForm_cancel_button_show_hide( state ){
    switch ( state ) {
        case true:
            $('form[name="modifyPackageForm"] button').hide();
            $('body').toggleClass("cursor-wait");
            break;
        case false:
            $('form[name="modifyPackageForm"] button').show();
            $('body').toggleClass("cursor-wait");
            break;
    }
}


function modifyPackageForm_package_update(){
    var params = new Object();


    if ( ($.settings.user != undefined) && ($.settings.user.securePwd != undefined) ) {
        params.securePwd = $.settings.user.securePwd.value;
    }

    var callbacks = new Object();
    callbacks.beforeSend = function (){
        modifyPackageForm_cancel_button_show_hide(true);
    };
    callbacks.success = function (){
        modifyPackageFormCallback();
    };
    callbacks.complete = function (){
        modifyPackageForm_cancel_button_show_hide(false);
    };

    $.settings.step = "PAYMENT";
    $.settings.type = "PMS";
    switch_package = true;
    pmsPaymentForm_display(true);
    manageAccountForm_display(false);

}

/** Executed on return of modifyPackageForm function
 */
function modifyPackageFormCallback(){
    switch_package = false;
    displayErrorInfo();
    if ( $.settings.error == undefined ) {
        modifyPackageForm_display(true);
    }
}


/*****************************************************************************/
/****           Account refill Form JavaScript functions                  ****/
/*****************************************************************************/

/** Listen to modified element
 */
var accountRefillForm_changed = new Object();

/** This function is triggered when the page is loaded
 */
$(document).ready(function() {

	/** Inputs triggers
	 */
	$('form[name="accountRefillForm"] select[name="select_package"]').change(function() {
		accountRefillForm_options_describe();
		accountRefillFormPay();
	});
	$('form[name="accountRefillForm"] select[name="select_package"]').keyup(function() {
		accountRefillForm_options_describe();
		accountRefillFormPay();
	});

	/** Form triggers
	 */
	$('form[name="accountRefillForm"]').submit(function() {
		return false;
	});

	/** Link triggers
	 */
	$('#logonForm_accountRefillLink_link').click(function() {
		accountRefillForm_options_configure();
		accountRefillForm_display(true);
		logonForm_display(false);
	});

	$('#paypalRefillLink').click(function() {
		accountRefillPaymentSubscribe('paypal');
	});

	$('#ogoneRefillLink').click(function() {
		accountRefillPaymentSubscribe('ogone');
	});

	/** Buttons triggers
	 */
	$('#accountRefillForm_back_button').click(function() {
		if ( $.settings.user != undefined && $.settings.user.login != undefined ) {
			manageAccountForm_display(true);
		}
		else {
			logonForm_display(true);
		}
		accountRefillForm_display(false);
		resetPaymentProcess();
	});

	$('#accountRefillForm_pay_button').click(function() {
		accountRefillFormPay();
	});

	$('#accountRefillForm_confirm_button').click(function() {
		if ($.settings.payment != undefined && $.settings.payment.type != undefined && $.settings.payment.type != 'free') {
			// Payed option
			accountRefillForm_confirm();
		}
		else {
			// Free option 2 possibilities
			if ($('form[name="accountRefillForm"] select[name="select_package"]').val() == "") {
				// manual written of code in dedicated field
				accountRefillForm_confirm();
			}
			else {
				// Automatic refill with the selected option in portal
				accountRefillForm_get_free_refill_code();
			}
		}
	});
});


function resetPaymentProcess() {

	var callbacks = new Object();
	callbacks.beforeSend = function() { accountRefillFormWaiting(true); };
	callbacks.success    = function() { accountRefillFormResetPayment_confirmCallback(this); };
	callbacks.complete   = function() { accountRefillFormWaiting(false); };

	backAction(callbacks);
}

function accountRefillFormResetPayment_confirmCallback() {
	displayErrorInfo();
}

function accountRefillForm_paymentValidate() {

	// Configure display
	if ($.settings.payment != undefined && $.settings.payment.login != undefined && $.settings.payment.code != undefined) {

		$('form[name="accountRefillForm"] input[name="login"]').val($.settings.payment.login);
		$('form[name="accountRefillForm"] input[name="refillcode"]').val($.settings.payment.code);
		if ($.settings.accountRefill == true) {
			$('form[name="accountRefillForm"]').show();
			$('#accountRefillForm_confirm_button').show();
			$('#accountRefillForm_table').hide();
			$('#accountRefillForm_explain').hide();
		}
	}
}

/** Configure accountRefillForm depending on settings
 */

function accountRefillForm_configure() {

	// Configure display
	if ($.settings.accountRefill == true) {
		$('#logonForm_accountRefillLink').show();
		accountRefillForm_options_configure();
	}
	else {
		$('form[name="accountRefillForm"]').remove();
	}
}

function accountRefillForm_options_configure(displayLang) {

	if ($.settings.refill_process != undefined && $.settings.refill_process.options != undefined) {
		var optionsInfos = null;
		var defaultOptionText;

		if ($.settings.refill_process.options.refill != undefined) {
			var optionsInfos = $.settings.refill_process.options.refill;
			defaultOptionText = getTextTranslation('paypalOptionPaymentForm_default_package_option');
			$('#accountRefillForm_select_option_text').text(getTextTranslation('accountRefillForm_select_option_text'));
			$('#accountRefillForm_title_text').text(getTextTranslation('accountRefillForm_title_text'));
			$('#accountRefillForm_explain_text').text(getTextTranslation('accountRefillForm_explain_text'));
			$('#accountRefillForm_option_description_explain').text(getTextTranslation('accountRefillForm_option_description_explain'));
			$('#accountRefillForm_option_description_text').text(getTextTranslation('accountRefillForm_option_description_text'));
		}
		else {
			return;
		}

		if (displayLang == undefined) { // No displayLang given, find user selected language, else default portal language else default package language
			if ($.settings != undefined && $.settings.user != undefined && $.settings.user.lang != undefined) {
				displayLang = $.settings.user.lang;
			}
		}

		// Empty the select list
		$('form[name="accountRefillForm"] select[name="select_package"]').empty();
		$('form[name="accountRefillForm"] select[name="select_package"]').append('<option id="accountRefillForm_default_option" selected value="">' + defaultOptionText + '</option>');
		// Populate list
		$(optionsInfos).each(function () {
			var package = $(this)[0];
			var text;
			var currencyLanguage;
			if (package[displayLang] != undefined) {
				text = package[displayLang].text;
				currencyLanguage = displayLang;
			}
			else if ($.settings != undefined && $.settings.lang != undefined && $.settings.lang.defaultLang != undefined && package[$.settings.lang.defaultLang] != undefined) {
				text = package[$.settings.lang.defaultLang].text;
				currencyLanguage = $.settings.lang.defaultLang;
			}
			else if (package[package.defaultLang] != undefined) {
				text = package[package.defaultLang].text;
				currencyLanguage = package.defaultLang;
			}
			else {
				text = "";
				currencyLanguage = package.defaultLang;
			}

			// Add price
			if (package['currency'] == "free") {
				text += "&nbsp;" + "(" + getGenericTranslation('free_package', currencyLanguage) + ")";
			}
			else {
				text += "&nbsp;" + "(" + package['price'] + "&nbsp;" + package['currency'] + ")";
			}

			var disabled = ' ';

			$('form[name="accountRefillForm"] select[name="select_package"]').append('<option value="' + package.name + '"' + disabled + '>' + text + '</option>');
		});
	}
}

/** Display accountRefillForm depending on settings
 * Can be overwritten by state
 * @param boolean state - Indicate if the form must be displayed or not
 */
function accountRefillForm_display(state) {

	var display = false;
	if ( (state == true) || (state == false) ) {
		display = state;
	}

	if (display == true) {
		// Fill in logon fields
		if ( $.settings.user != undefined && $.settings.user.login != undefined ) {
			$('form[name="accountRefillForm"] input[name="login"]').val($.settings.user.login.value);
		}

		$('form[name="accountRefillForm"]').show();
		$('#accountRefillForm_table').show();
		if ($.settings.refill_process != undefined && $.settings.refill_process.options != undefined && $.settings.refill_process.options.refill != undefined) {
			$('#accountRefillForm_option_user_explain').show();
			$('#accountRefillForm_table').show();
		}
		else {
			$('#accountRefillForm_option_user_explain').hide();
			$('#accountRefillForm_table').hide();
		}
	}
	else {
		$('form[name="accountRefillForm"]').hide();
		$('#paypalRefillLink').hide();
		$('#ogoneRefillLink').hide();
	}
}

function accountRefillPaymentSubscribe(type) {
	var params = new Object();

	params.login    = $('form[name = "accountRefillForm"] input[name = "login"]').val();
	params.type     = type;
	params.password = $('form[name = "accountRefillForm"] input[name = "password"]').val();
	params.package  = $('form[name = "accountRefillForm"] select[name = "select_package"]').val();

	var callbacks = new Object();
	callbacks.beforeSend = function() { accountRefillFormWaiting(true); };
	callbacks.success    = function() { accountRefillFormPaymentSubscribe_confirmCallback(this); };
	callbacks.complete   = function() { accountRefillFormWaiting(false); };

	refillAccountPaymentSubscribe(callbacks, params);
}

function accountRefillForm_confirm() {
	var params = new Object();

	params.login      = $('form[name = "accountRefillForm"] input[name = "login"]').val();
	params.refillCode = $('form[name = "accountRefillForm"] input[name = "refillcode"]').val();
	params.password   = $('form[name = "accountRefillForm"] input[name = "password"]').val();

	if ($.settings.payment && $.settings.payment.process) {
		params.process = $.settings.payment.process;

		// Particular case of free refill, code value is retrieved in settings parameters.
		if ($.settings.payment.process == "refill" && $.settings.payment.type == "free") {
			params.refillCode = $.settings.payment.code;
		}

		params.type = $.settings.payment.type;
	}
	//Re-init settings to get up to date infos, caused by $.extend use, merging returned ajax data
	clearUserSettings();

	// Re-init payment settings to be able to restart from a virgin  state
	clearPaymentSettings();

	var callbacks = new Object();
	callbacks.beforeSend = function() { accountRefillFormWaiting(true); };
	callbacks.success    = function() { accountRefillForm_confirmCallback(); };
	callbacks.complete   = function() { accountRefillFormWaiting(false); };

	refillAccount(callbacks, params);
}

function accountRefillForm_get_free_refill_code() {
	var params = new Object();

	params.login    = $('form[name = "accountRefillForm"] input[name  = "login"]').val();
	params.package  = $('form[name = "accountRefillForm"] select[name = "select_package"]').val();
	params.password = $('form[name = "accountRefillForm"] input[name  = "password"]').val();

	var callbacks = new Object();
	callbacks.beforeSend = function() { accountRefillFormWaiting(true); };
	callbacks.success    = function() { accountRefillForm_confirm(); };
	callbacks.complete   = function() { accountRefillFormWaiting(false); };

	getFreeRefillCode(callbacks, params);
}

function accountRefillFormPaymentSubscribe_confirmCallback() {

	if ($.settings.error == undefined) {
		if ( $.settings.user != undefined && $.settings.user.login != undefined ) {
			manageAccountForm_display(false);

			if ($.settings.type == 'PAYPAL') {
				paypalPaymentForm_options_describe();
				paypalPaymentForm_display(true);
			}
			else if ($.settings.type == 'OGONE') {
				ogonePaymentForm_options_describe();
				ogonePaymentForm_display(true);
			}
		}
		else {
			logonForm_display(true);
		}

		resetErrorInfo();

		accountRefillForm_display(false);
	}
	else {
		displayErrorInfo();
	}
}

/** Executed on return of accountRefillForm_update function
 */
function accountRefillForm_confirmCallback() {

	displayErrorInfo();
	if ($.settings.error == undefined) {
		if ( $.settings.user != undefined && $.settings.user.login != undefined ) {
			manageAccountForm_display(false);
			accountRefillForm_display(false);
			feedbackForm_display(true);
		}
		else {
			initPortal();
		}
	}
}

/** Enable waiting mode on accountRefillSetForm
 */
function accountRefillFormWaiting(state) {
	switch (state) {
		case true:
			$('form[name="accountRefillForm"] button').attr("disabled", true);
			$('body').toggleClass("cursor-wait");
			break;
		case false:
			$('form[name="accountRefillForm"] button').attr("disabled", false);
			$('body').toggleClass("cursor-wait");
			break;
	}
}

/** Executed when pay button is clicked
 */
function accountRefillFormPay() {

	var optionInfos = null;

	if ($.settings.refill_process != undefined && $.settings.refill_process.options != undefined) {

		if ($.settings.refill_process.options.refill != undefined) {
			for (var i = 0; i < $.settings.refill_process.options.refill.length; i++) {
				if ($.settings.refill_process.options.refill[i].name == $('form[name="accountRefillForm"] select[name="select_package"]').val()) {
					optionInfos = $.settings.refill_process.options.refill[i];
					break;
				}
			}

			if (optionInfos !== null && optionInfos.price != 0) {
				if ($.settings.subscribe.paypal && $.settings.subscribe.paypal.refill) {
					$('#paypalRefillLink').appendTo('#refillForm_subscriptionChoice_grid').show();
				}

				if ($.settings.subscribe.ogone && $.settings.subscribe.ogone.refill) {
					$('#ogoneRefillLink').appendTo('#refillForm_subscriptionChoice_grid').show();
				}

				$('#accountRefillForm_confirm_button').hide();
			}
			else {
				$('#paypalRefillLink').hide();
				$('#ogoneRefillLink').hide();

				$('#accountRefillForm_confirm_button').show();
			}
		}

		// accountRefillForm_free_refill_line must be always displayed to allow user to enter voucher manually
		// $('#accountRefillForm_free_refill_line').hide();
		$('#accountRefillForm_behavior_explain').show();
		$('form[name = "accountRefillForm"] input[name  = "refillcode"]').attr("disabled", !$('form[name="accountRefillForm"] select[name="select_package"] #accountRefillForm_default_option').is(":selected"));
	}
	else {
		// $('#accountRefillForm_free_refill_line').show();
		$('#accountRefillForm_behavior_explain').hide();
		$('form[name = "accountRefillForm"] input[name  = "refillcode"]').attr("disabled", false);
		$('#accountRefillForm_confirm_button').show();
	}
}

function accountRefillForm_options_describe(displayLang) {
	if ($.settings.refill_process != undefined && $.settings.refill_process.options != undefined) {

		var optionsInfos = null;
		if ($.settings.refill_process.options.refill != undefined) {
			var optionsInfos = $.settings.refill_process.options.refill;
		}
		else {
			return;
		}

		if (displayLang == undefined) { // No displayLang given, find user selected language, else default portal language else default package language
			if ($.settings != undefined && $.settings.user != undefined && $.settings.user.lang != undefined) {
				displayLang = $.settings.user.lang;
			}
		}
		// Update describe block
		if ($('form[name="accountRefillForm"] select[name="select_package"]').val() == "") {
			$('#accountRefillForm_option_description_explain').show();
			$('#accountRefillForm_option_description_value').html("");
		}
		else {
			$(optionsInfos).each(function () {
				var package = $(this)[0];
				if (package.name == $('form[name="accountRefillForm"] select[name="select_package"]').val()) {
					var describe;
					if (package[displayLang] != undefined) {
						describe = package[displayLang].description;
					}
					else if ($.settings != undefined && $.settings.lang != undefined && $.settings.lang.defaultLang != undefined && package[$.settings.lang.defaultLang] != undefined) {
						describe = package[$.settings.lang.defaultLang].description;
					}
					else if (package[package.defaultLang] != undefined) {
						describe = package[package.defaultLang].description;
					}

					if (describe == undefined) {
						describe = getTextTranslation('accountRefillForm_no_description');
					}

					$('#accountRefillForm_option_description_explain').hide();
					$('#accountRefillForm_option_description_value').html(describe);
				}
			});
		}
	}
}


/*****************************************************************************/
/****                    Auto Form JavaScript functions                   ****/
/*****************************************************************************/

/** This function is triggered when the page is loaded
 */
$(document).ready(function() {
	
	/** Buttons triggers
	 */
	$('#autoLogonForm_connect_button').click(function() {
		autoLogonFormConnect();
	});
	
	/** Form triggers
	 */
	$('form[name="autoLogonForm"]').submit(function() {
		return false;
	});
});

/**
 * Configure autoLogonForm depending on settings
 */
function autoLogonForm_configure() {

	// Configure display
	if ($.settings.subscribe != undefined && $.settings.subscribe.auto != undefined) {
	
		// Configure policy display
		if ($.settings.logon != undefined && $.settings.logon.policy != undefined && $.settings.logon.policy.display == true) {
			autoLogonForm_policy_configure();
		}
		else {
			// Modify event on securePwdForm 
			$('form[name="securePwdForm"]').unbind();
			$('form[name="securePwdForm"]').submit(function() {
				autoLogonWithSecurePasswordConnect(); return false;
			});
			
			$('#autoLogonForm_policy_block').remove();
		}
	}
	else {
		$('form[name="autoLogonForm"]').remove();
	}
}

/** Configure autoLogonForm_policy_block
 * @param string lang - The language whish to display the policy
 */
function autoLogonForm_policy_configure(lang) {
	
	if ($.settings.logon != undefined && $.settings.logon.policy != undefined) {
		var policy = extractPolicyText($.settings.logon, lang);
		$('#autoLogonForm_policy_text').html(policy);
	}
}

/** Display autoLogonForm depending on settings
 * Can be overwritten by state
 * @param boolean state - Indicate if the form must be displayed or not
 */
function autoLogonForm_display(state) {

	var display = false;
	if ( (state == true) || (state == false) ) {
		display = state;
	}
	else if ( ($.settings.step != undefined && $.settings.step == "SUBSCRIBE") && ($.settings.type != undefined && $.settings.type == "AUTO") ) {
		display = true;
	}
	
	if (display == true) {
		$('form[name="autoLogonForm"]').show();
	}
	else {
		$('form[name="autoLogonForm"]').hide();
	}
}

/** Enable waiting mode on autoLogonForm
 */
function autoLogonFormWaiting(state) {
	switch (state) {
		case true:
			$('#autoLogonForm_connect_button').attr("disabled", true);
			$('body').toggleClass("cursor-wait");
			break;
		case false:
			$('#autoLogonForm_connect_button').attr("disabled", false);
			$('body').toggleClass("cursor-wait");
			break;
	}
}

/** Executed when connect button is clicked
 */
function autoLogonFormConnect() {

	var params = new Object();
	params.policyAccept = $('form[name="autoLogonForm"] input[name="policy_accept"]').is(':checked');
	
	if ( ($.settings.user != undefined) && ($.settings.user.securePwd != undefined) ) {
		params.securePwd = $.settings.user.securePwd.value;
	}
	
	var callbacks = new Object();
	callbacks.beforeSend = function() { autoLogonFormWaiting(true); };
	callbacks.success    = function() { autoLogonFormConnectCallback(); };
	callbacks.complete   = function() { autoLogonFormWaiting(false); };
		
	autoAuthenticate(callbacks, params);
}

/** Executed on return of autoLogonFormConnect function
 */
function autoLogonFormConnectCallback() {

	if ($.settings.error == undefined) {
		// Redirect user to forced web page or requested web page
		window.location = $.settings.info.subscribe.autoUrl;
	}
	else {
		displayErrorInfo();
		displayStep();
	}
}

/** Executed on click on securePwdForm_access_button when secure password is required and no policy
 * Is from copy of securePwdFormAccess function
 */
function autoLogonWithSecurePasswordConnect() {

	var params = new Object();
	// Mandatory parameters
	params.securePwd = $('form[name="securePwdForm"] input[name="secure_pwd"]').val();
	
	var callbacks = new Object();
	callbacks.beforeSend = function() { autoLogonFormWaiting(true); };
	callbacks.success    = function() { autoLogonWithSecurePasswordConnectCallback(); };
	callbacks.complete   = function() { autoLogonFormWaiting(false); };
	
	securePwd(callbacks, params);
}

/** Executed on return of autoLogonWithSecurePasswordConnect function
 * Is from copy of securePwdFormAccessCallback function
 */
function autoLogonWithSecurePasswordConnectCallback() {
	displayErrorInfo();
	if ($.settings.error == undefined) {
		if ($.settings.user == undefined) {
			$.settings.user = new Object();
		}
		if ($.settings.user.securePwd == undefined) {
			$.settings.user.securePwd = new Object();
		}
		$.settings.user.securePwd.value = $('form[name="securePwdForm"] input[name="secure_pwd"]').val();
		autoLogonFormConnect();
	}
}

/*****************************************************************************/
/****            One Subscription Form JavaScript functions            ****/
/*****************************************************************************/

/** This function is triggered when the page is loaded
 */
$(document).ready(function (){
    /** Buttons triggers
     */
    var other_choices = null;
    if ( $('#oneSubscriptionForm_other_choices_button').length == 1 ) {

        other_choices = $('#oneSubscriptionForm_other_choices_button');
    }
    else {
        other_choices = $('#oneSubscriptionForm_other_choices_link');
    }
    if ( other_choices != null ) {
        other_choices.click(function (){
            oneSubscriptionFormOtherChoices();
        });
    }

    $('#oneSubscriptionForm_connect_button').click(function (){
        oneSubscriptionFormConnect();
    });

    /** Form triggers
     */
    $('form[name="oneSubscriptionForm"]').submit(function (){
        return false;
    });

    /** Link triggers
     */
    $('#oneSubscriptionLink').click(function (){
        oneSubscriptionLinkEnable();
    });

    //NSPE
    /** Link triggers
     */
    $('#one_facebookLink').click(function (){
        socialNetworkConnectOne("facebook");
    });
    $('#one_googleLink').click(function (){
        socialNetworkConnectOne("google");
    });
    $('#one_linkedinLink').click(function (){
        socialNetworkConnectOne("linkedin");
    });
    $('#one_twitterLink').click(function (){
        socialNetworkConnectOne("twitter");
    });


    $('.custom_checkbox').click(function (){
        toggle_checkbox($(this).attr('id'));
    });
    $('.custom_checkbox_1').click(function (){
        toggle_text($(this).attr('id'));
    });
//\NSPE

});

/** Configure oneSubscriptionForm depending on settings
 */
function oneSubscriptionForm_configure(){

    // Configure display
    if ( $.settings.subscribe != undefined && $.settings.subscribe.one != undefined ) {
        // Moving link to right location
        if ( $('#logonForm_subscriptionChoice_grid').length == 1 ) {
            $('#oneSubscriptionLink').appendTo('#logonForm_subscriptionChoice_grid').show();
        }
        else {
            if ( $.settings.subscribe.count > 1 ) {
                $('#oneSubscriptionLink').appendTo('#subscriptionChoiceInsert').show();
            }
            else if ( $.settings.subscribe.count == 1 ) {
                $('#logonFormSubscriptionLink_link').click(function (){
                    oneSubscriptionLinkEnable();
                });
            }
        }

        if(Object.keys($.settings.subscribe.one).length > 1){
            $('#directSubscriptionForm_explain_text').show();
        }else{
            $('#directSubscriptionForm_explain_text').remove();
        }        

        // Configure connect policy
        if ( $.settings.logon != undefined && $.settings.logon.policy != undefined && $.settings.logon.policy.display == true ) {
            oneSubscriptionForm_connect_policy_configure();
        }
        else {
            $('#oneSubscriptionForm_connect_policy_block').remove();
        }

        // Configure other choices link
        //alert(Object.keys($.settings.auth_modes).length);
        //console.log($.settings.auth_modes.length);
        //console.log($.settings.auth_modes.standard);
        //if ($.settings.auth_modes == undefined || $.settings.auth_modes.standard == false) {

        subscriptionForm_configure('one');
    }
    else {
        $('form[name="oneSubscriptionForm"]').remove();
        $('#oneSubscriptionLink').remove();
    }

	//NSPE
	// Configure social networks
	if ( $.settings.auth_modes != undefined && $.settings.auth_modes.facebook ) {
		var clonefbLike = $('div#facebookLike').clone().attr("id", "onefacebookLike");
		clonefbLike.find("#facebookInput").attr("id","onefacebookInput");
		clonefbLike.find("#logonForm_facebook_like_text").attr("for","onefacebookInput");
		clonefbLike.find("#logonForm_facebook_like_text").attr("id","oneSubscriptionForm_facebook_like_text");
		clonefbLike.find("#logonForm_facebook_like_url").attr("id","oneSubscriptionForm_facebook_like_url");
		$('#oneSubscriptionForm_socialNetworkChoice_grid').append(clonefbLike);
		$('#oneSubscriptionForm_socialNetworkChoice_grid').show();
		$('#one_facebookLink').show();
		if ($.settings.logon != undefined && $.settings.logon.facebook != undefined && $.settings.logon.facebook.need_like) {
			$('div#onefacebookLike').show();
			if ($.settings.logon.facebook.url_like != undefined && $.settings.logon.facebook.url_like != '') {
				$('label#logonForm_facebook_like_url').text($.settings.logon.facebook.url_like);
			}
		}
		else{
			$('div#onefacebookLike').hide();
		}
	}
    if ( $.settings.auth_modes != undefined && $.settings.auth_modes.google ) {
        $('#oneSubscriptionForm_socialNetworkChoice_grid').show();
        $('#one_googleLink').show();
    }
    if ( $.settings.auth_modes != undefined && $.settings.auth_modes.linkedin ) {
        $('#oneSubscriptionForm_socialNetworkChoice_grid').show();
        $('#one_linkedinLink').show();
    }
	if ( $.settings.auth_modes != undefined && $.settings.auth_modes.twitter ) {
		var cloneTwiterFollow = $('div#twitterFollow').clone().attr("id", "onetwitterFollow");
		cloneTwiterFollow.find("#twitterInput").attr("id","onetwitterInput");
		cloneTwiterFollow.find("#logonForm_twitter_follow_text").attr("for","onetwitterInput");
		cloneTwiterFollow.find("#logonForm_twitter_follow_text").attr("id","oneSubscriptionForm_twitter_follow_text");
		cloneTwiterFollow.find("#logonForm_twitter_follow_auto_screen_name").attr("id","oneSubscriptionForm_twitter_follow_auto_screen_name");
		$('#oneSubscriptionForm_socialNetworkChoice_grid').append(cloneTwiterFollow);
		$('#oneSubscriptionForm_socialNetworkChoice_grid').show();
		$('#one_twitterLink').show();
		if ($.settings.logon != undefined && $.settings.logon.twitter != undefined && $.settings.logon.twitter.need_follow) {
			$('div#onetwitterFollow').show();
			if ($.settings.logon.twitter.name_follow != undefined && $.settings.logon.twitter.name_follow != '') {
				$('label#oneSubscriptionForm_twitter_follow_auto_screen_name').text('@' + $.settings.logon.twitter.name_follow);
			}
		}else{
			$('div#onetwitterFollow').hide();
		}
	}

    if($.settings.auth_modes != undefined ){
        var modes = Object.keys($.settings.auth_modes);
        if((modes.indexOf("standard") > -1 || modes.indexOf("shibboleth") > -1) && modes.length > 0){
            $('#oneSubscriptionForm_other_choices_block').show();
        }else{
            $('#oneSubscriptionForm_other_choices_block').remove();
        }
    }
//\NSPE
}

/** Configure oneSubscriptionForm_connect_policy_block
 * @param string displayLang - The language whish to display the policy
 */
function oneSubscriptionForm_connect_policy_configure( displayLang ){

    if ( $.settings.logon != undefined && $.settings.logon.policy != undefined ) {
        var policy = extractPolicyText($.settings.logon, displayLang);
        $('#oneSubscriptionForm_connect_policy_text').html(policy);
        $('#oneSubscriptionForm_policy_resume').html(extractPolicyResume($.settings.logon, displayLang));
    }
}

/** Display oneSubscriptionForm depending on settings
 * Can be overwritten by state
 * @param boolean state - Indicate if the form must be displayed or not
 */
function oneSubscriptionForm_display( state ){

    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }
    else if ( ($.settings.step != undefined && $.settings.step == "SUBSCRIBE" && $.settings.type == "ONE") && ( (typeof informativeWidget_configure != 'function') || ($.settings.informativeWidget == undefined) ) ) {
        display = true;
    }
    if ( display == true ) {
        subscriptionForm_commonFields_display('one');
        $('form[name="oneSubscriptionForm"]').show();
        if ($('#subscriptionForm_fields_state_block')[0].style.display === 'block') {
            $('#subscriptionForm_fields_state_block').css("display", "none");
            $('#subscriptionForm_div_state').css("display", "none");
            $('#oneSubscriptionForm_fields_state_block').css("display", "block");
        }
    }
    else {
        $('form[name="oneSubscriptionForm"]').hide();
        subscriptionForm_empty('one');
        if ($('#subscriptionForm_div_state')[0].style.display === 'none') {
            $('#subscriptionForm_fields_state_block').css("display", "block");
            $('#subscriptionForm_div_state').css("display", "block");
        }
    }
    subscriptionForm_phoneHelpBlock_display(false);
    subscriptionForm_passwordHelpBlock_display(false);
}

/** Executed when other choices link is clicked
 */
function oneSubscriptionFormOtherChoices(){
    var callbacks = new Object();
    // callbacks.beforeSend = function() {}; // TODO
    callbacks.success = function (){
        displayStep();
    };
    // callbacks.complete   = function() {}; // TODO
    backAction(callbacks);
}

/** Enable waiting mode on oneSubscriptionForm
 */
function oneSubscriptionFormWaiting( state ){
    switch ( state ) {
        case true:
            $('#oneSubscriptionForm_other_choices_button').attr("disabled", true);
            $('#oneSubscriptionForm_connect_button').attr("disabled", true);
            $('body').toggleClass("cursor-wait");
            break;
        case false:
            $('#oneSubscriptionForm_other_choices_button').attr("disabled", false);
            $('#oneSubscriptionForm_connect_button').attr("disabled", false);
            $('body').toggleClass("cursor-wait");
            break;
    }
}

/** Executed when connect button is clicked **/
function oneSubscriptionFormConnect(){
    var params = subscriptionFormSubscribe('one');
    // Connect policy
    params.connectPolicyAccept = $('form[name="oneSubscriptionForm"] input[name="oneSubscriptionForm_connect_policy_accept"]').is(':checked');
    var callbacks = new Object();
    callbacks.beforeSend = function (){
        oneSubscriptionFormWaiting(true);
    };
    callbacks.success = function (){
        oneSubscriptionFormConnectCallback();
    };
    callbacks.complete = function (){
        oneSubscriptionFormWaiting(false);
    };
    subscribe(callbacks, params);
}

/** Executed on return of oneSubscriptionFormConnect function **/
function oneSubscriptionFormConnectCallback(){

    if ( $.settings.error == undefined ) {
        // Remember form values before trying to connect, to avoid multiple creation of a same account
        $('form[name="logonForm"] input[name="login"]').val($.settings.info.subscribe.login);
        $('form[name="logonForm"] input[name="password"]').val($.settings.info.subscribe.password);
        $('form[name="logonForm"] input[name="logonForm_logon_policy_accept"]').attr('checked', $('form[name="oneSubscriptionForm"] input[name="oneSubscriptionForm_connect_policy_accept"]').is(':checked'));
        $('form[name="logonForm"] input[name="logonForm_logon_privatePolicy_accept"]').attr('checked', $('form[name="oneSubscriptionForm"] input[name="subscriptionForm_privatePolicy_accept"]').is(':checked'));
        logonFormConnect();
    }
    else {
        displayErrorInfo();
    }
}


/** Social networks **/
function socialNetworkConnectOne( type ){
	var params = new Object();

	params.type = type;

	if (type == 'twitter') {
		params.userFollow = $('form[name="oneSubscriptionForm"] input[name="twitter_follow"]').is(':checked');
	}

	if (type == 'facebook' ) {
		params.userLike = $('form[name="oneSubscriptionForm"] input[name="facebook_like"]').is(':checked');
	}

	if ( ($.settings.user != undefined) && ($.settings.user.securePwd != undefined) ) {
		params.securePwd = $.settings.user.securePwd.value;
	}

	var private_policy = null;
	var policy = null;

	try {
		private_policy = eval('$.settings.logon.' + type + '.policy');
	}
	catch(ex) {
		private_policy = null;
	}

	try {
		policy = eval('$.settings.logon.policy');
	} catch (ex) {
		policy = null;
	}

	// Show a dialog window if private policy need to be accepted
	if ((private_policy != null && private_policy.display == true) || (policy != null && policy.display == true)) {

		// Hide private policy connection button in case of mandatory private policy (Twitter and Facebook)
		if (private_policy != null && private_policy !== undefined && private_policy.mandatory == true) {
			if ($('#logonForm_socialNetwork_privatePolicy_accept').is(':checked') == false) {
				$('#logonForm_privatePolicy_connect_button').hide();
			}
			$('#logonForm_socialNetwork_privatePolicy_accept').change(function () {
				$('#logonForm_privatePolicy_connect_button').toggle($('#logonForm_socialNetwork_privatePolicy_accept').is(':checked'));
			});
		}

		$('#logonForm_privatePolicy_connect_button').click(function () {

			logonForm_close_privatePolicy_dialog("logonForm");

			params.privatePolicyAccept = $('#logonForm_socialNetwork_privatePolicy_accept').is(':checked');

			if (policy.display == true) {
                params.policyAccept = $("#logonForm_socialNetwork_policy_accept").is(':checked');
//                $('#logonForm_logon_policy_accept').attr('checked', $('#logonForm_socialNetwork_policy_accept').is(':checked'));
                if (!logonForm_policy_is_ok()) {
                    $.settings.error = {
                        "code": "error_logon_bad-policy-accept"
                    };
                    displayErrorInfo();
                    return;
                }
			}
			// Proceed to social network connexion
			do_socialNetworkConnect(params);
        });

        $('.main_mode_container').slideToggle('easing');
		$("#logonForm_privatePolicy_dialog").show();
	}
	else {
		// No private policy needed. Proceed to social network connexion
		// do_socialNetworkConnect declared in portal_logon.js
		do_socialNetworkConnect(params);
	}
}

/*****************************************************************************/

/** Executed when link is clicked
 */
function oneSubscriptionLinkEnable(){

    var callbacks = new Object();
    // callbacks.beforeSend = function() {}; // TODO
    callbacks.success = function (){
        displayStep();
    };
    // callbacks.complete   = function() {}; // TODO

    backAction(callbacks);
}

/*****************************************************************************/
/*****************************************************************************/
/****            Direct Subscription Form JavaScript functions            ****/
/*****************************************************************************/

/** This function is triggered when the page is loaded
 */
$(document).ready(function (){

    /** Buttons triggers
     */
    $('#directSubscriptionForm_back_button').click(function (){
        directSubscriptionFormBack();
    });

    $('#directSubscriptionForm_subscribe_button').click(function (){
        directSubscriptionFormSubscribe();
    });

    $('#directSubscriptionResultForm_back_button').click(function (){
        displayStep();
    });

    /** Form triggers
     */
    $('form[name="directSubscriptionForm"]').submit(function (){
        return false;
    });

    $('form[name="directSubscriptionResultForm"]').submit(function (){
        return false;
    });

    /** Link triggers
     */
    $('#directSubscriptionLink').click(function (){
        directSubscriptionLinkEnable();
    });
});

/** Configure subscriptionForm depending on settings
 */
function directSubscriptionForm_configure(){

    // Configure display
    if ( $.settings.subscribe != undefined && $.settings.subscribe.direct != undefined ) {
        // Moving link to right location
        if ( $('#logonForm_subscriptionChoice_grid').length == 1 ) {
            $('#directSubscriptionLink').appendTo('#logonForm_subscriptionChoice_grid').show();
        }
        else {
            if ( $.settings.subscribe.count > 1 ) {
                $('#directSubscriptionLink').appendTo('#subscriptionChoiceInsert').show();
            }
            else if ( $.settings.subscribe.count == 1 ) {
                $('#logonFormSubscriptionLink_link').click(function (){
                    directSubscriptionLinkEnable();
                });
            }
        }

        if(Object.keys($.settings.subscribe.direct).length > 1){
            $('#directSubscriptionForm_explain_text').show();
        }else{
            $('#directSubscriptionForm_explain_text').remove();
        }         

        subscriptionForm_configure('direct');
    }
    else {
        $('form[name="directSubscriptionForm"]').remove();
        $('#directSubscriptionLink').remove();
    }

    // Configure directSubscriptionResultForm
    directSubscriptionResultForm_configure();
}

/** Display subscriptionForm depending on settings
 * Can be overwritten by state
 * @param boolean state - Indicate if the form must be displayed or not
 */
function directSubscriptionForm_display( state ){

    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }
    if ( display == true ) {
        subscriptionForm_commonFields_display('direct');
        $('form[name="directSubscriptionForm"]').show();
        $('form[name="directSubscriptionResultForm"]').hide();
    }
    else {
        $('form[name="directSubscriptionForm"]').hide();
        $('form[name="directSubscriptionResultForm"]').hide();
        subscriptionForm_empty('direct');
    }
    subscriptionForm_phoneHelpBlock_display(false);
    subscriptionForm_passwordHelpBlock_display(false);
}

/** Executed when back button is clicked
 */
function directSubscriptionFormBack(){
    displayStep();
}

/** Enable waiting mode on subscriptionForm
 */
function directSubscriptionFormWaiting( state ){
    switch ( state ) {
        case true:
            $('#directSubscriptionForm_back_button').attr("disabled", true);
            $('#directSubscriptionForm_subscribe_button').attr("disabled", true);
            $('body').toggleClass("cursor-wait");
            break;
        case false:
            $('#directSubscriptionForm_back_button').attr("disabled", false);
            $('#directSubscriptionForm_subscribe_button').attr("disabled", false);
            $('body').toggleClass("cursor-wait");
            break;
    }
}

/** Executed when subscribe button is clicked
 */
function directSubscriptionFormSubscribe(){
    var params = subscriptionFormSubscribe('direct');
    var callbacks = new Object();
    callbacks.beforeSend = function (){
        directSubscriptionFormWaiting(true);
    };
    callbacks.success = function (){
        directSubscriptionFormSubscribeCallback();
    };
    callbacks.complete = function (){
        directSubscriptionFormWaiting(false);
    };
    subscribe(callbacks, params);
}

/** Executed on return of subscriptionFormSubscribe function
 */
function directSubscriptionFormSubscribeCallback(){
    displayErrorInfo();
    if ( $.settings.error == undefined ) {
        directSubscriptionResultForm_display(true);
    }
}

/** Configure directSubscriptionResultForm depending on settings
 */
function directSubscriptionResultForm_configure(){

    if ( $.settings.subscribe != undefined && $.settings.subscribe.direct != undefined ) {
        if ( $.settings.subscribe.direct.dpsk != undefined && $.settings.subscribe.direct.dpsk.available == true ) {
            if ( $.settings.subscribe.direct.dpsk.wlan == undefined || $.settings.subscribe.direct.dpsk.wlan.display != true ) {
                $('#directSubscriptionResultForm_dpsk_wlan_block').remove();
            }
            if ( $.settings.subscribe.direct.dpsk.passphrase == undefined || $.settings.subscribe.direct.dpsk.passphrase.display != true ) {
                $('#directSubscriptionResultForm_dpsk_passphrase_block').remove();
                $('#directSubscriptionResultForm_dpsk_explain_text').remove();
            }
            if ( $.settings.subscribe.direct.dpsk.downloadLink == undefined || $.settings.subscribe.direct.dpsk.downloadLink.display != true ) {
                $('#directSubscriptionResultForm_dpsk_download_link_block').remove();
                $('#directSubscriptionResultForm_dpsk_download_explain_text').remove();
            }
        }
        else {
            $('#directSubscriptionResultForm_dpsk_title_block').remove();
            $('#directSubscriptionResultForm_dpsk_explain_block').remove();
            $('#directSubscriptionResultForm_dpsk_wlan_block').remove();
            $('#directSubscriptionResultForm_dpsk_passphrase_block').remove();
            $('#directSubscriptionResultForm_dpsk_download_link_block').remove();
        }
    }
    else {
        $('form[name="directSubscriptionResultForm"]').remove();
    }
}

/** Display directSubscriptionResultForm (Usualy Triggered when subscribtion succeed)
 * @param boolean state - Indicate if the results must be displayed or not
 */
function directSubscriptionResultForm_display( state ){

    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }

    if ( $.settings.info != undefined && $.settings.info.subscribe != undefined ) {
        if ( $.settings.info.subscribe.login != undefined ) {
            $('#directSubscriptionResultForm_login_value').html($.settings.info.subscribe.login);
        }
        if ( $.settings.info.subscribe.password != undefined ) {
		var tmp_input_params = subscriptionFormSubscribe('direct');
		if ( $.settings.subscribe != undefined && $.settings.subscribe.direct != undefined
				&& $.settings.subscribe.direct.userPassword != undefined && $.settings.subscribe.direct.userPassword.display == true
				&& tmp_input_params.password != '' ) {
                // We hide the given password
                $('#directSubscriptionResultForm_password_value').html('********');
            }
            else {
                $('#directSubscriptionResultForm_password_value').html($.settings.info.subscribe.password);
            }
        }
        // Fill in logon fields
        if ( $.settings.subscribe.direct.hidePortalCredentials == undefined || $.settings.subscribe.direct.hidePortalCredentials == false ) {
            $('form[name="logonForm"] input[name="login"]').val($.settings.info.subscribe.login);
            $('form[name="logonForm"] input[name="password"]').val($.settings.info.subscribe.password);
        }

        if ( $.settings.info.subscribe.dpsk != undefined ) {
            $('#directSubscriptionResultForm_dpsk_wlan_value').html($.settings.info.subscribe.dpsk.wlan);
            if ( $.settings.info.subscribe.dpsk.passphrase != undefined ) {
                $('#directSubscriptionResultForm_dpsk_passphrase_value').html($.settings.info.subscribe.dpsk.passphrase);
            }
            if ( $.settings.info.subscribe.dpsk.downloadURL != undefined ) {
                $('#directSubscription_dpsk_download_link').attr("href", $.settings.info.subscribe.dpsk.downloadURL);
            }
        }
    }

    if ( $.settings.subscribe.direct.hidePortalCredentials == undefined || $.settings.subscribe.direct.hidePortalCredentials == false ) {
        if ( display == true ) {
            $('form[name="directSubscriptionResultForm"]').show();
            $('form[name="directSubscriptionForm"]').hide();
        }
        else {
            $('form[name="directSubscriptionForm"]').show();
            $('form[name="directSubscriptionResultForm"]').hide();
            directSubscriptionResultForm_empty();
        }
    } else {
        displayStep();
    }
}

/** Empty directSubscriptionResultForm
 */
function directSubscriptionResultForm_empty(){
    $('#directSubscriptionResultForm_login_value').html('');
    $('#directSubscriptionResultForm_password_value').html('');
    $('#directSubscriptionResultForm_dpsk_wlan_value').html('');
    $('#directSubscriptionResultForm_dpsk_passphrase_value').html('');
    $('#directSubscription_dpsk_download_link').attr("href", "#");
}
/*****************************************************************************/

/** Executed when link is clicked
 */
function directSubscriptionLinkEnable(){

    logonForm_display(false);
    logonFormSubscribeChoice_display(false);
    directSubscriptionForm_display(true);
}

/*****************************************************************************/
/*****************************************************************************/
/****            Print Subscription Form JavaScript functions            ****/
/*****************************************************************************/

/** This function is triggered when the page is loaded
 */
$(document).ready(function (){

    /** Buttons triggers
     */
    $('#printSubscriptionForm_back_button').click(function (){
        printSubscriptionFormBack();
    });

    $('#printSubscriptionForm_subscribe_button').click(function (){
        printSubscriptionFormSubscribe();
    });

    $('#printSubscriptionResultForm_back_button').click(function (){
        displayStep();
    });

    /** Form triggers
     */
    $('form[name="printSubscriptionForm"]').submit(function (){
        return false;
    });

    $('form[name="printSubscriptionResultForm"]').submit(function (){
        return false;
    });

    /** Link triggers
     */
    $('#printSubscriptionLink').click(function (){
        printSubscriptionLinkEnable();
    });
});

/** Configure printSubscriptionForm depending on settings
 */
function printSubscriptionForm_configure(){

    // Configure display
    if ( $.settings.subscribe != undefined && $.settings.subscribe.print != undefined ) {
        // Moving link to right location
        if ( $('#logonForm_subscriptionChoice_grid').length == 1 ) {
            $('#printSubscriptionLink').appendTo('#logonForm_subscriptionChoice_grid').show();
        }
        else {
            if ( $.settings.subscribe.count > 1 ) {
                $('#printSubscriptionLink').appendTo('#subscriptionChoiceInsert').show();
            }
            else if ( $.settings.subscribe.count == 1 ) {
                $('#logonFormSubscriptionLink_link').click(function (){
                    printSubscriptionLinkEnable();
                });
            }
        }
        subscriptionForm_configure('print');
    }
    else {
        $('form[name="printSubscriptionForm"]').remove();
        $('form[name="printSubscriptionResultForm"]').remove();
        $('#printSubscriptionLink').remove();
    }
}

/** Display printSubscriptionForm depending on settings
 * Can be overwritten by state
 * @param boolean state - Indicate if the form must be displayed or not
 */
function printSubscriptionForm_display( state ){

    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }
    if ( display == true ) {
        subscriptionForm_commonFields_display('print');
        $('form[name="printSubscriptionForm"]').show();
        $('form[name="printSubscriptionResultForm"]').hide();
    }
    else {
        $('form[name="printSubscriptionForm"]').hide();
        $('form[name="printSubscriptionResultForm"]').hide();
        subscriptionForm_empty('print');
    }
    subscriptionForm_phoneHelpBlock_display(false);
    subscriptionForm_passwordHelpBlock_display(false);
}

/** Executed when back button is clicked
 */
function printSubscriptionFormBack(){
    displayStep();
}

/** Enable waiting mode on printSubscriptionForm
 */
function printSubscriptionFormWaiting( state ){
    switch ( state ) {
        case true:
            $('#printSubscriptionForm_back_button').attr("disabled", true);
            $('#printSubscriptionForm_subscribe_button').attr("disabled", true);
            $('body').toggleClass("cursor-wait");
            break;
        case false:
            $('#printSubscriptionForm_back_button').attr("disabled", false);
            $('#printSubscriptionForm_subscribe_button').attr("disabled", false);
            $('body').toggleClass("cursor-wait");
            break;
    }
}

/** Executed when subscribe button is clicked
 */
function printSubscriptionFormSubscribe(){
    var params = subscriptionFormSubscribe('print');
    var callbacks = new Object();
    callbacks.beforeSend = function (){
        printSubscriptionFormWaiting(true);
    };
    callbacks.success = function (){
        printSubscriptionFormSubscribeCallback();
    };
    callbacks.complete = function (){
        printSubscriptionFormWaiting(false);
    };
    subscribe(callbacks, params);
}

/** Executed on return of printSubscriptionFormSubscribe function
 */
function printSubscriptionFormSubscribeCallback(){
    displayErrorInfo();
    if ( $.settings.error == undefined ) {
        printSubscriptionResultForm_display(true);
    }
}

/** Display printSubscriptionResultForm (Usualy Triggered when subscribtion succeed)
 * @param boolean state - Indicate if the results must be displayed or not
 */
function printSubscriptionResultForm_display( state ){

    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }

    if ( display == true ) {
        $('form[name="printSubscriptionResultForm"]').show();
        $('form[name="printSubscriptionForm"]').hide();
    }
    else {
        $('form[name="printSubscriptionForm"]').show();
        $('form[name="printSubscriptionResultForm"]').hide();
    }
}

/*****************************************************************************/

/** Executed when link is clicked
 */
function printSubscriptionLinkEnable(){

    logonForm_display(false);
    logonFormSubscribeChoice_display(false);
    printSubscriptionForm_display(true);

}

/*****************************************************************************/
/*****************************************************************************/
/****              SMS Subscription Form JavaScript functions             ****/
/*****************************************************************************/

/** This function is triggered when the page is loaded
 */
$(document).ready(function (){

    /** Buttons triggers
     */
    $('#smsSubscriptionForm_back_button').click(function (){
        smsSubscriptionFormBack();
    });

    $('#smsSubscriptionForm_subscribe_button').click(function (){
        smsSubscriptionFormSubscribe();
    });

    /** Form triggers
     */
    $('form[name="smsSubscriptionForm"]').submit(function (){
        return false;
    });

    /** Link triggers
     */
    $('#smsSubscriptionLink').click(function (){
        smsSubscriptionLinkEnable();
    });
});

/** Configure smsSubscriptionForm depending on settings
 */
function smsSubscriptionForm_configure(){

    // Configure display
    if ( $.settings.subscribe != undefined && $.settings.subscribe.sms != undefined ) {
        // Moving link to right location
        if ( $('#logonForm_subscriptionChoice_grid').length == 1 ) {
            $('#smsSubscriptionLink').appendTo('#logonForm_subscriptionChoice_grid').show();
        }
        else {
            if ( $.settings.subscribe.count > 1 ) {
                $('#smsSubscriptionLink').appendTo('#subscriptionChoiceInsert').show();
            }
            else if ( $.settings.subscribe.count == 1 ) {
                $('#logonFormSubscriptionLink_link').click(function (){
                    smsSubscriptionLinkEnable();
                });
            }
        }
        subscriptionForm_configure('sms');
    }
    else {
        $('form[name="smsSubscriptionForm"]').remove();
        $('#smsSubscriptionLink').remove();
    }
}

/** Display smsSubscriptionForm depending on settings
 * Can be overwritten by state
 * @param boolean state - Indicate if the form must be displayed or not
 */
function smsSubscriptionForm_display( state ){

    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }
    if ( display == true ) {
        subscriptionForm_commonFields_display('sms');
        $('form[name="smsSubscriptionForm"]').show();
    }
    else {
        $('form[name="smsSubscriptionForm"]').hide();
        subscriptionForm_empty('sms');
    }
    subscriptionForm_phoneHelpBlock_display(false);
}

/** Executed when back button is clicked
 */
function smsSubscriptionFormBack(){
    displayStep();
}

/** Enable waiting mode on smsSubscriptionForm
 */
function smsSubscriptionFormWaiting( state ){
    switch ( state ) {
        case true:
            $('#smsSubscriptionForm_back_button').attr("disabled", true);
            $('#smsSubscriptionForm_subscribe_button').attr("disabled", true);
            $('body').toggleClass("cursor-wait");
            break;
        case false:
            $('#smsSubscriptionForm_back_button').attr("disabled", false);
            $('#smsSubscriptionForm_subscribe_button').attr("disabled", false);
            $('body').toggleClass("cursor-wait");
            break;
    }
}

/** Executed when subscribe button is clicked
 */
function smsSubscriptionFormSubscribe(){
    var params = subscriptionFormSubscribe('sms');
    var callbacks = new Object();
    callbacks.beforeSend = function (){
        smsSubscriptionFormWaiting(true);
    };
    callbacks.success = function (){
        smsSubscriptionFormSubscribeCallback();
    };
    callbacks.complete = function (){
        smsSubscriptionFormWaiting(false);
    };
    subscribe(callbacks, params);
}

/** Executed on return of smsSubscriptionFormSubscribe function
 */
function smsSubscriptionFormSubscribeCallback(){
    displayErrorInfo();
    if ( $.settings.error == undefined ) {
        displayStep();
    }
}

/*****************************************************************************/

/** Executed when link is clicked
 */
function smsSubscriptionLinkEnable(){

    logonForm_display(false);
    logonFormSubscribeChoice_display(false);
    smsSubscriptionForm_display(true);
}

/*****************************************************************************/

/*****************************************************************************/
/****              Mail Subscription Form JavaScript functions            ****/
/*****************************************************************************/

/** This function is triggered when the page is loaded
 */
$(document).ready(function (){

    /** Buttons triggers
     */
    $('#mailSubscriptionForm_back_button').click(function (){
        mailSubscriptionFormBack();
    });

    $('#mailSubscriptionForm_subscribe_button').click(function (){
        mailSubscriptionFormSubscribe();
    });

    /** Form triggers
     */
    $('form[name="mailSubscriptionForm"]').submit(function (){
        return false;
    });

    /** Link triggers
     */
    $('#mailSubscriptionLink').click(function (){
        mailSubscriptionLinkEnable();
    });
});


/** Configure mailSubscriptionForm depending on settings
 */
function mailSubscriptionForm_configure(){

    // Configure display
    if ( $.settings.subscribe != undefined && $.settings.subscribe.mail != undefined ) {
        // Moving link to right location
        if ( $('#logonForm_subscriptionChoice_grid').length == 1 ) {
            $('#mailSubscriptionLink').appendTo('#logonForm_subscriptionChoice_grid').show();
        }
        else {
            if ( $.settings.subscribe.count > 1 ) {
                $('#mailSubscriptionLink').appendTo('#subscriptionChoiceInsert').show();
            }
            else if ( $.settings.subscribe.count == 1 ) {
                $('#logonFormSubscriptionLink_link').click(function (){
                    mailSubscriptionLinkEnable();
                });
            }
        }

        // Configure autofill/autoconnect
        if ( $.settings.subscribe.mail.autofill != undefined ) {
            $('form[name="logonForm"] input[name="login"]').val($.settings.subscribe.mail.autofill.login);
            $('form[name="logonForm"] input[name="password"]').val($.settings.subscribe.mail.autofill.password);
        }

        subscriptionForm_configure('mail');
    }
    else {
        $('form[name="mailSubscriptionForm"]').remove();
        $('#mailSubscriptionLink').remove();
    }
}

/** Display mailSubscriptionForm depending on settings
 * Can be overwritten by state
 * @param boolean state - Indicate if the form must be displayed or not
 */
function mailSubscriptionForm_display( state ){

    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }
    if ( display == true ) {
        subscriptionForm_commonFields_display('mail');
        $('form[name="mailSubscriptionForm"]').show();
    }
    else {
        $('form[name="mailSubscriptionForm"]').hide();
        subscriptionForm_empty('mail');
    }
    subscriptionForm_phoneHelpBlock_display(false);
}

/** Executed when back button is clicked
 */
function mailSubscriptionFormBack(){
    displayStep();
}

/** Enable waiting mode on mailSubscriptionForm
 */
function mailSubscriptionFormWaiting( state ){
    switch ( state ) {
        case true:
            $('#mailSubscriptionForm_back_button').attr("disabled", true);
            $('#mailSubscriptionForm_subscribe_button').attr("disabled", true);
            $('body').toggleClass("cursor-wait");
            break;
        case false:
            $('#mailSubscriptionForm_back_button').attr("disabled", false);
            $('#mailSubscriptionForm_subscribe_button').attr("disabled", false);
            $('body').toggleClass("cursor-wait");
            break;
    }
}

/** Executed when subscribe button is clicked
 */
function mailSubscriptionFormSubscribe(){
    var params = subscriptionFormSubscribe('mail');
    var callbacks = new Object();
    callbacks.beforeSend = function (){
        mailSubscriptionFormWaiting(true);
    };
    callbacks.success = function (){
        mailSubscriptionFormSubscribeCallback();
    };
    callbacks.complete = function (){
        mailSubscriptionFormWaiting(false);
    };
    subscribe(callbacks, params);
}

/** Executed on return of mailSubscriptionFormSubscribe function
 */
function mailSubscriptionFormSubscribeCallback(){
    displayErrorInfo();
    if ( $.settings.error == undefined ) {
        displayStep();
    }
}

/*****************************************************************************/

/** Executed when link is clicked
 */
function mailSubscriptionLinkEnable(){

    logonForm_display(false);
    logonFormSubscribeChoice_display(false);
    mailSubscriptionForm_display(true);
}


/*****************************************************************************/
/****             Paypal Subscription Form JavaScript functions           ****/
/*****************************************************************************/

/** Listen to modified element
 */

var paypalSubscriptionResultForm_changed = new Object();

/** This function is triggered when the page is loaded
 */
$(document).ready(function() {

	/** Inputs triggers
	 */

	$('form[name="paypalSubscriptionResultForm"] input[name="send_sms"]').change(function() {
		paypalSubscriptionResultFormSend_display($(this).is(':checked'), "sms");
	});

	$('form[name="paypalSubscriptionResultForm"] input[name="send_mail"]').change(function() {
		paypalSubscriptionResultFormSend_display($(this).is(':checked'), "mail");
	});

	$('form[name="paypalSubscriptionResultForm"] input[name="email"]').focus(function() {
		paypalSubscriptionResultForm_modifyEvent('focus', $(this));
		paypalSubscriptionResultForm_phoneHelpBlock_display(false);
	});

	$('form[name="paypalSubscriptionResultForm"] input[name="email"]').blur(function() {
		paypalSubscriptionResultForm_modifyEvent('blur', $(this));
	});

	$('form[name="paypalSubscriptionResultForm"] input[name="email"]').change(function() {
		paypalSubscriptionResultForm_modifyEvent('blur', $(this));
	});

	$('form[name="paypalSubscriptionResultForm"] input[name="prefix"]').focus(function() {
		paypalSubscriptionResultForm_modifyEvent('focus', $(this));
		paypalSubscriptionResultForm_phoneHelpBlock_display(true);
	});

	$('form[name="paypalSubscriptionResultForm"] input[name="prefix"]').blur(function() {
		paypalSubscriptionResultForm_modifyEvent('blur', $(this));
	});

	$('form[name="paypalSubscriptionResultForm"] input[name="prefix"]').change(function() {
		paypalSubscriptionResultForm_modifyEvent('blur', $(this));
	});

	$('form[name="paypalSubscriptionResultForm"] input[name="phone"]').focus(function() {
		paypalSubscriptionResultForm_modifyEvent('focus', $(this));
		paypalSubscriptionResultForm_phoneHelpBlock_display(true);
	});

	$('form[name="paypalSubscriptionResultForm"] input[name="phone"]').blur(function() {
		paypalSubscriptionResultForm_modifyEvent('blur', $(this));
	});

	$('form[name="paypalSubscriptionResultForm"] input[name="phone"]').change(function() {
		paypalSubscriptionResultForm_modifyEvent('blur', $(this));
	});

	/** Buttons triggers
	 */
	$('#paypalSubscriptionForm_back_button').click(function() {
		paypalSubscriptionFormBack();
	});

	$('#paypalSubscriptionForm_subscribe_button').click(function() {
		paypalSubscriptionFormSubscribe();
	});

	$('#paypalSubscriptionResultForm_back_button').click(function() {
		displayStep();
	});

	$('#paypalSubscriptionResultForm_send_button').click(function() {
		paypalSubscriptionResultFormSendCredential();
	});

	/** Form triggers
	 */
	$('form[name="paypalSubscriptionForm"]').submit(function() {
		return false;
	});

	$('form[name="paypalSubscriptionResultForm"]').submit(function() {
		return false;
	});

	/** Link triggers
	 */
	$('#paypalSubscriptionLink').click(function() {
		paypalSubscriptionLinkEnable();
	});

	$('#paypalSubscriptionResultForm_send_sms_phone_help_link').click(function() {
		paypalSubscriptionResultForm_phoneHelpBlock_display();
	});
});

/** Configure paypalSubscriptionForm depending on settings
 */
function paypalSubscriptionForm_configure() {
	var showSendSms = true, showSendMail = true;
	// Configure display
	if ($.settings.subscribe != undefined && $.settings.subscribe.paypal != undefined) {

		if ($.settings.subscribe.paypal.option != undefined) {
			$('#paypalSubscriptionForm_explain_text').text(getTextTranslation('paypalOptionSubscriptionForm_explain_text'));
		}

		if (($.settings.subscribe.paypal.option != undefined) || ($.settings.subscribe.paypal.package != undefined)) {
		// Moving link to right location
			if($('#logonForm_subscriptionChoice_grid').length == 1) {
				$('#paypalSubscriptionLink').appendTo('#logonForm_subscriptionChoice_grid').show();
			}
			else {
				if ($.settings.subscribe.count > 1) {
					$('#paypalSubscriptionLink').appendTo('#subscriptionChoiceInsert').show();
				}
				else if ($.settings.subscribe.count == 1) {
					$('#logonFormSubscriptionLink_link').click(function() {
						paypalSubscriptionLinkEnable();
					});
				}
			}
		}

		// Configure paypalSubscriptionResultForm
		if ($.settings.subscribe.paypal.sendSms != undefined && $.settings.subscribe.paypal.sendSms.display == true) {
			$('#paypalSubscriptionResultForm_send_sms_block').show();
			$('#paypalSubscriptionResultForm_send_sms_phone_block').hide();
			// Configure help block
			paypalSubscriptionResultForm_phoneHelpBlock_configure();
		}
		else {
			$('#paypalSubscriptionResultForm_send_sms_block').remove();
			$('#paypalSubscriptionResultForm_send_sms_phone_block').remove();
			showSendSms = false;
		}

		if ($.settings.subscribe.paypal.sendMail != undefined && $.settings.subscribe.paypal.sendMail.display == true) {
			$('#paypalSubscriptionResultForm_send_mail_block').show();
			$('#paypalSubscriptionResultForm_send_email_address_block').hide();
		}
		else {
			$('#paypalSubscriptionResultForm_send_mail_block').remove();
			$('#paypalSubscriptionResultForm_send_email_address_block').remove();
			showSendMail = false;
		}

		if (showSendMail == false && showSendSms == false) {
			// Remove send button if Mail and Sms paypal subscription mode not activated
			$('#paypalSubscriptionResultForm_send_button').remove();
		}
		// autofill/autoconnect
		if ( $.settings.subscribe.paypal.autofill != undefined ) {
			$('form[name="logonForm"] input[name="login"]').val($.settings.subscribe.paypal.autofill.login);
			$('form[name="logonForm"] input[name="password"]').val($.settings.subscribe.paypal.autofill.password);
		}

		subscriptionForm_configure('paypal');
	}
	else {
		$('form[name="paypalSubscriptionForm"]').remove();
		$('form[name="paypalSubscriptionResultForm"]').remove();
		$('form[name="paypalRedirectForm"]').remove();
		$('#paypalSubscriptionLink').remove();
	}
}

/** Display paypalSubscriptionForm depending on settings
 * Can be overwritten by state
 * @param boolean state - Indicate if the form must be displayed or not
 */
function paypalSubscriptionForm_display(state) {

	var display = false;
	if ( (state == true) || (state == false) ) {
		display = state;
	}
	if (display == true) {
		subscriptionForm_commonFields_display('paypal');
		$('form[name="paypalSubscriptionForm"]').show();

		if ($.settings.subscribe.paypal.option != undefined) {
			$('#paypalSubscriptionForm_explain_text').text(getTextTranslation('paypalOptionSubscriptionForm_explain_text'));
		}
	}
	else {
		$('form[name="paypalSubscriptionForm"]').hide();
		subscriptionForm_empty('paypal');
	}

	$('form[name="paypalSubscriptionResultForm"]').hide();

	subscriptionForm_phoneHelpBlock_display(false);
	subscriptionForm_passwordHelpBlock_display(false);
}

/** Executed when back button is clicked
 */
function paypalSubscriptionFormBack() {
    displayStep();
}

/** Enable waiting mode on paypalSubscriptionForm
 */
function paypalSubscriptionFormWaiting(state) {
	switch (state) {
		case true:
			$('#paypalSubscriptionForm_back_button').attr("disabled", true);
			$('#paypalSubscriptionForm_subscribe_button').attr("disabled", true);
			$('body').toggleClass("cursor-wait");
			break;
		case false:
			$('#paypalSubscriptionForm_back_button').attr("disabled", false);
			$('#paypalSubscriptionForm_subscribe_button').attr("disabled", false);
			$('body').toggleClass("cursor-wait");
			break;
	}
}

/** Executed when subscribe button is clicked
 */
function paypalSubscriptionFormSubscribe() {
    var params = subscriptionFormSubscribe('paypal');
    var callbacks = new Object();
    callbacks.beforeSend = function() { paypalSubscriptionFormWaiting(true); };
    callbacks.success    = function() { paypalSubscriptionFormSubscribeCallback(); };
    callbacks.complete   = function() { paypalSubscriptionFormWaiting(false); };
    subscribe(callbacks, params);
}

/** Executed on return of paypalSubscriptionFormSubscribe function
 */
function paypalSubscriptionFormSubscribeCallback() {
    displayErrorInfo();
    if ($.settings.error == undefined) {
		paypalPaymentForm_packages_configure();
		paypalSubscriptionResultForm_display(true);
    }
}

/** Display paypalSubscriptionResultForm (Usualy Triggered when subscribtion succeed)
 * @param boolean state - Indicate if the results must be displayed or not
 */
function paypalSubscriptionResultForm_display(state) {

	var display = false;
	if ( (state == true) || (state == false) ) {
		display = state;
	}

	if ($.settings.info != undefined && $.settings.info.subscribe != undefined) {
		if ($.settings.info.subscribe.login != undefined) {
			$('#paypalSubscriptionResultForm_login_value').html($.settings.info.subscribe.login);
		}
		if ($.settings.info.subscribe.password != undefined) {
			var tmp_input_params = subscriptionFormSubscribe('paypal');
			if ($.settings.subscribe != undefined && $.settings.subscribe.paypal != undefined
					&& $.settings.subscribe.paypal.userPassword != undefined && $.settings.subscribe.paypal.userPassword.display == true
					&& tmp_input_params.password != '') {
				// We hide the given password
				$('#paypalSubscriptionResultForm_password_value').html('********');
			}
			else {
				$('#paypalSubscriptionResultForm_password_value').html($.settings.info.subscribe.password);
			}
		}
		$('form[name="paypalSubscriptionResultForm"] input[name="end_sms"]').attr("checked", false);

		if (subscriptionForm_changed['email'] == true) {
			paypalSubscriptionResultForm_changed['email'] = true;
			$('form[name="paypalSubscriptionResultForm"] input[name="email"]').val($('form[name="paypalSubscriptionForm"] input[name="email"]').val());
		}
		if (subscriptionForm_changed['prefix'] == true) {
			paypalSubscriptionResultForm_changed['prefix'] = true;
			$('form[name="paypalSubscriptionResultForm"] input[name="prefix"]').val($('form[name="paypalSubscriptionForm"] input[name="prefix"]').val());
		}
		if (subscriptionForm_changed['phone'] == true) {
			paypalSubscriptionResultForm_changed['phone'] = true;
			$('form[name="paypalSubscriptionResultForm"] input[name="phone"]').val($('form[name="paypalSubscriptionForm"] input[name="phone"]').val());
		}

		// Fill in logon fields
		$('form[name="logonForm"] input[name="login"]').val($.settings.info.subscribe.login);
		$('form[name="logonForm"] input[name="password"]').val($.settings.info.subscribe.password);
	}

	if (display == true) {
		$('form[name="paypalSubscriptionResultForm"]').show();
		$('form[name="paypalSubscriptionForm"]').hide();
	}
	else {
		$('form[name="paypalSubscriptionForm"]').show();

		if ($.settings.subscribe.paypal.option != undefined) {
			$('#paypalSubscriptionForm_explain_text').text(getTextTranslation('paypalOptionSubscriptionForm_explain_text'));
		}

		$('form[name="paypalSubscriptionResultForm"]').hide();
		paypalSubscriptionResultForm_empty();
	}
	paypalSubscriptionResultForm_phoneHelpBlock_display(false);

	if ($.settings.subscribe.paypal.option != undefined) {
		$('#paypalSubscriptionResultForm_back_button').text(getTextTranslation('paypalOptionSubscriptionResultForm_back_button'));
	}
}

/** Empty paypalSubscriptionResultForm
 */
function paypalSubscriptionResultForm_empty() {

	$('form[name="paypalSubscriptionResultForm"] input[type="text"]').each(function() {
		$(this).val('');
	});
	$('form[name="paypalSubscriptionResultForm"] input[type="checkbox"]').each(function() {
		$(this).attr("checked", false);
	});
	$('#paypalSubscriptionResultForm_result_login_value').html('');
	$('#paypalSubscriptionResultForm_result_password_value').html('');

	// Adding examples values
	paypalSubscriptionResultForm_phoneHelpBlock_configure();

	paypalSubscriptionResultForm_changed['prefix'] = false;
	paypalSubscriptionResultForm_changed['phone'] = false;
	paypalSubscriptionResultForm_changed['email'] = false;
}

/** Display paypalSubscriptionResultForm_send_sms_phone_help_block when help link is clicked
 * @param boolean state - Indicate if the block must be displayed or not
 */
function paypalSubscriptionResultForm_phoneHelpBlock_display(state) {

	var display = false;
	if ( (state == true) || (state == false) ) {
		display = state;
	}
	else if ($('#paypalSubscriptionResultForm_send_sms_phone_help_block').is(':hidden') == true) {
		display = true;
	}

	if (display == true) {
		$('#paypalSubscriptionResultForm_send_sms_phone_help_block').show();
	}
	else {
		$('#paypalSubscriptionResultForm_send_sms_phone_help_block').hide();
	}
}

/** Configure paypalSubscriptionResultForm_send_sms_phone_help_block
 * @param string displayLang - The language whish to display the content
 */
function paypalSubscriptionResultForm_phoneHelpBlock_configure(displayLang) {

	if (paypalSubscriptionResultForm_changed['prefix'] != true) {
		$('#paypalSubscriptionResultForm_send_sms_phone_prefix_value').val(getInputTranslation("paypalSubscriptionResultForm_send_sms_phone_prefix_value", displayLang));
	}
	if (paypalSubscriptionResultForm_changed['phone'] != true) {
		$('#paypalSubscriptionResultForm_send_sms_phone_phone_value').val(getInputTranslation("paypalSubscriptionResultForm_send_sms_phone_phone_value", displayLang));
	}
	$('#paypalSubscriptionResultForm_send_sms_phone_help_prefix_example_value').val(getInputTranslation("paypalSubscriptionResultForm_send_sms_phone_help_prefix_example_value", displayLang));
	$('#paypalSubscriptionResultForm_send_sms_phone_help_phone_example_value').val(getInputTranslation("paypalSubscriptionResultForm_send_sms_phone_help_phone_example_value", displayLang));
}

function paypalSubscriptionResultFormSend_display(state, mode) {

	var display = false;
	if ( (state == true) || (state == false) ) {
		display = state;
	}

	if (display == true) {
		if (mode == "sms") {
			$('#paypalSubscriptionResultForm_send_sms_phone_block').show();
		}
		if (mode == "mail") {
			$('#paypalSubscriptionResultForm_send_email_address_block').show();
		}
		if ($('#paypalSubscriptionResultForm_send_email_address_block').is(':visible') || $('#paypalSubscriptionResultForm_send_sms_phone_block').is(':visible')) {
			$('#paypalSubscriptionResultForm_send_button').show();
		}
	}
	else {
		if (mode == "sms") {
			$('#paypalSubscriptionResultForm_send_sms_phone_block').hide();
			if ($('#paypalSubscriptionResultForm_send_email_address_block').length == 0) {
				// Hide if SMS mode only visible on portal
				$('#paypalSubscriptionResultForm_send_button').hide();
			}
		}
		if (mode == "mail") {
			$('#paypalSubscriptionResultForm_send_email_address_block').hide();
			if ($('#paypalSubscriptionResultForm_send_sms_phone_block').length == 0) {
				// Hide if Mail mode only visible on portal
				$('#paypalSubscriptionResultForm_send_button').hide();
			}
		}
		if ($('#paypalSubscriptionResultForm_send_email_address_block').is(':hidden') && $('#paypalSubscriptionResultForm_send_sms_phone_block').is(':hidden')) {
			$('#paypalSubscriptionResultForm_send_button').hide();
		}
	}
	paypalSubscriptionResultForm_phoneHelpBlock_display(false);
}

/** Enable waiting mode on paypalSubscriptionResultForm
 */
function paypalSubscriptionResultFormWaiting(state) {
	switch (state) {
		case true:
			$('#paypalSubscriptionResultForm_back_button').attr("disabled", true);
			$('#paypalSubscriptionResultForm_send_button').attr("disabled", true);
			$('body').toggleClass("cursor-wait");
			break;
		case false:
			$('#paypalSubscriptionResultForm_back_button').attr("disabled", false);
			$('#paypalSubscriptionResultForm_send_button').attr("disabled", false);
			$('body').toggleClass("cursor-wait");
			break;
	}
}

function paypalSubscriptionResultFormSendCredential() {

	var params = new Object();
	var sendMailOption = $('form[name="paypalSubscriptionResultForm"] input[name="send_mail"]').is(":checked");
	var sendSmsOption = $('form[name="paypalSubscriptionResultForm"] input[name="send_sms"]').is(":checked");

	params.login = $('form[name="logonForm"] input[name="login"]').val();
	params.password = $('form[name="logonForm"] input[name="password"]').val();

	params.email = (paypalSubscriptionResultForm_changed['email'] == true) ? $('form[name="paypalSubscriptionResultForm"] input[name="email"]').val() : "";
	params.prefix = (paypalSubscriptionResultForm_changed['prefix'] == true) ? $('form[name="paypalSubscriptionResultForm"] input[name="prefix"]').val() : "";
	params.phone = (paypalSubscriptionResultForm_changed['phone'] == true) ? $('form[name="paypalSubscriptionResultForm"] input[name="phone"]').val() : "";

	if ( ($.settings.user != undefined) && ($.settings.user.securePwd != undefined) ) {
		params.securePwd = $.settings.user.securePwd.value;
	}

	var callbacks = new Object();
	callbacks.beforeSend = function() { paypalSubscriptionResultFormWaiting(true); };
	callbacks.success    = function() { paypalSubscriptionResultFormSendCredentialCallback(); };
	callbacks.complete   = function() { paypalSubscriptionResultFormWaiting(false); };

	if ($.settings.subscribe.paypal.sendMail != undefined && $.settings.subscribe.paypal.sendMail.display == true && sendMailOption) {
		params.action = "paypal_send_mail";
		subscriptionSendCredential(callbacks, params);
	}
	if ($.settings.subscribe.paypal.sendSms != undefined && $.settings.subscribe.paypal.sendSms.display == true && sendSmsOption) {
		params.action = "paypal_send_sms";
		subscriptionSendCredential(callbacks, params);
	}
}

function paypalSubscriptionResultFormSendCredentialCallback() {

	displayErrorInfo();
	if ($.settings.error == undefined) {
		displayStep();
	}
}

/*****************************************************************************/

/** Executed when link is clicked
 */
function paypalSubscriptionLinkEnable() {

	logonForm_display(false);
	logonFormSubscribeChoice_display(false);
	paypalSubscriptionForm_display(true);
}

/*****************************************************************************/

/** Manage the modification of inputs and the help texts present on them
 * @param string type - The type on the event (focus | blur )
 * @param element element - The DOM element afected by the modification
 */
function paypalSubscriptionResultForm_modifyEvent(type, element) {
	switch (type) {
		case 'focus':
			if (paypalSubscriptionResultForm_changed[element.attr("name")] != true) {
				element.val("");
			}
			break;

		case 'blur':
			if (element.val() == "") {
				element.val(getInputTranslation(element.attr("id")));
				paypalSubscriptionResultForm_changed[element.attr("name")] = false;
			}
			else {
				paypalSubscriptionResultForm_changed[element.attr("name")] = true;
			}
			break;
	}
}


/*****************************************************************************/
/****                Paypal Payment Form JavaScript functions             ****/
/*****************************************************************************/

/** This function is triggered when the page is loaded
 */
$(document).ready(function() {

	/** Inputs triggers
	 */
	$('form[name="paypalPaymentForm"] select[name="select_package"]').change(function() {
		paypalPaymentForm_packages_describe();
		paypalPaymentFormPay();
	});
	$('form[name="paypalPaymentForm"] select[name="select_package"]').keyup(function() {
		paypalPaymentForm_packages_describe();
		paypalPaymentFormPay();
	});

	/** Buttons triggers
	 */
	$('#paypalPaymentForm_back_button').click(function() {
		paypalPaymentFormRefillBack();
	});
	$('#paypalPaymentForm_disconnect_button').click(function() {
		paypalPaymentFormBack();
	});
	$('#paypalPaymentForm_pay_button').click(function() {
		paypalPaymentFormPay();
	});
	$('#paypalPaymentResultForm_disconnect_button').click(function() {
		paypalPaymentResultForm_disconnect();
	});
	$('#paypalPaymentResultForm_connect_button').click(function() {
		paypalPaymentResultForm_connect();
	});
	/** Form triggers
	 */
	$('form[name="paypalPaymentForm"]').submit(function() {
		return false;
	});
	$('form[name="paypalPaymentResultForm"]').click(function() {
		return false;
	});
	// CHANGED_BY_HH
	// Modified, to display the paypal PAY button (#payPalSendButton_Fake) right near the DISCONNECT button at one line!
	// In the past, the PAY button was in a seperate seperate form element
	// Which was display downwards to the DISCONNECT button
	// The original payment form is now hidden the whole time!
	//
	// Please see also: portal_paypal_payment.tmpl.html (line 36)
	//
	// OLD: $('#paypalRedirectionForm_pay_button').click(function (){
	$('#payPalSendButton_Fake').click(function (){
		// Update order status through API
		paypalRedirectFormPay();
	});
});


function paypalRedirectFormPay()
{
	var params = new Object();
	params.login = $.settings.payment.login;
	if ( ($.settings.user != undefined) && ($.settings.user.securePwd != undefined) ) {
		params.securePwd = $.settings.user.securePwd.value;
	}
	var callbacks = new Object();
	callbacks.beforeSend = function() { paypalPaymentFormWaiting(true); };
	callbacks.success    = function() { paypalRedirectFormPayCallback(); };
	callbacks.complete   = function() { paypalPaymentFormWaiting(false); };
	paypalSubmitPayment(callbacks, params);
}

function paypalRedirectFormPayCallback() {
	if ($.settings.error == undefined) {
		paypalPaymentForm_display(false);
		displayStep();

	}
	displayErrorInfo();
}


/** send and submit paypal payment information */

function paypalSendPaymentForm()
{
	$('form[name="paypalRedirectForm"] input[name="encrypted"]').val($.settings.payment.packageEncr);
	$('form[name="paypalRedirectForm"]').attr('action', $.settings.payment.paypalUrlPost);
	var url = $.settings.payment.paypalUrlPost + "?cmd=_express-checkout&useraction=commit&token=" + $.settings.payment.token;
	$.settings.payment.token="";
	displayWaitingIcon(true);
	window.location = url;
}



/** Configure paypalPaymentForm depending on settings
 */
function paypalPaymentForm_configure() {

	// Configure display
	if ($.settings.subscribe != undefined && $.settings.subscribe.paypal != undefined) {
		// Add packages
		paypalPaymentForm_packages_configure();
	}
	else {
		$('form[name="paypalPaymentForm"]').remove();
		$('form[name="paypalPaymentResultForm"]').remove();
	}
}

function paypalPaymentForm_packages_configure(displayLang) {

	if ($.settings.subscribe != undefined && $.settings.subscribe.paypal != undefined) {
		var paypalInfos = null;
		var defaultOptionText;

		if ($.settings.subscribe.paypal.package != undefined && ($.settings.payment && $.settings.payment.process == "create")) {
			var paypalInfos = $.settings.subscribe.paypal.package;
			// Keep default option
			defaultOptionText = $('#paypalPaymentForm_default_package_option').text();
		}
		else if ($.settings.subscribe.paypal.option != undefined && ($.settings.payment && $.settings.payment.process == "create")) {
			var paypalInfos = $.settings.subscribe.paypal.option;
			defaultOptionText = getTextTranslation('paypalOptionPaymentForm_default_package_option');
			$('#paypalPaymentForm_select_package_text').text(getTextTranslation('paypalOptionPaymentForm_select_package_text'));
			$('#paypalPaymentForm_title_text').text(getTextTranslation('paypalOptionPaymentForm_title_text'));
			$('#paypalPaymentForm_explain_text').text(getTextTranslation('paypalOptionPaymentForm_explain_text'));
			$('#paypalPaymentForm_package_description_explain').text(getTextTranslation('paypalOptionPaymentForm_package_description_explain'));
			$('#paypalPaymentForm_package_description_text').text(getTextTranslation('paypalOptionPaymentForm_package_description_text'));
		}
		else {
			return;
		}

		if (displayLang == undefined) { // No displayLang given, find user selected language, else default portal language else default package language
			if ($.settings != undefined && $.settings.user != undefined && $.settings.user.lang != undefined) {
				displayLang = $.settings.user.lang;
			}
		}

		// update forced disconnectin timer info
		if ( $.settings.subscribe.paypal.connectionProfile != undefined && $.settings.subscribe.paypal.connectionProfile.timeout > 0 ) {
			$('form[name="paypalPaymentForm"] small#paypalPaymentForm_payment_timer_text').show();
			$('form[name="paypalPaymentForm"] small#paypalPaymentForm_payment_timer_value').text(getForcedDisconnectionTimerDisplayText($.settings.subscribe.paypal.connectionProfile.timeout));
		}
		else {
			$('form[name="paypalPaymentForm"] small#paypalPaymentForm_payment_timer_text').hide();
			$('form[name="paypalPaymentForm"] small#paypalPaymentForm_payment_timer_value').text(' ');
		}

		// Empty the select list
		$('form[name="paypalPaymentForm"] select[name="select_package"]').empty();
		$('form[name="paypalPaymentForm"] select[name="select_package"]').append('<option id="paypalPaymentForm_default_package_option" disabled selected value="">' + defaultOptionText + '</option>');
		// Populate list
		$(paypalInfos).each(function () {
			var package = $(this)[0];
			var text;
			var currencyLanguage;
			if (package[displayLang] != undefined) {
				text = package[displayLang].text;
				currencyLanguage = displayLang;
			}
			else if ($.settings != undefined && $.settings.lang != undefined && $.settings.lang.defaultLang != undefined && package[$.settings.lang.defaultLang] != undefined) {
				text = package[$.settings.lang.defaultLang].text;
				currencyLanguage = $.settings.lang.defaultLang;
			}
			else if (package[package.defaultLang] != undefined) {
				text = package[package.defaultLang].text;
				currencyLanguage = package.defaultLang;
			}
			else {
				text = "";
				currencyLanguage = package.defaultLang;
			}

			// Add price
			if (package['currency'] == "free") {
				text += "&nbsp;" + "(" + getGenericTranslation('free_package', currencyLanguage) + ")";
			}
			else {
				text += "&nbsp;" + "(" + package['price'] + "&nbsp;" + package['currency'] + ")";
			}

			$('form[name="paypalPaymentForm"] select[name="select_package"]').append('<option value="' + package.name + '"' + '>' + text + '</option>');
		});
	}
}

/** Display paypalPaymentForm depending on settings
 * Can be overwritten by state
 * @param boolean state - Indicate if the form must be displayed or not
 */
function paypalPaymentForm_display(state) {

	var display = false;
	if ( (state == true) || (state == false) ) {
		display = state;
	}
	else if ( ($.settings.step != undefined && $.settings.step == "PAYMENT") && ($.settings.type != undefined && $.settings.type == "PAYPAL") ) {
		display = true;
	}
	if (display == true) {
		// waiting for payment, display result form
		if( $.settings.payment.status=="waiting_paypal" || $.settings.payment.status=="verifying"  )
		{
			paypalPaymentForm_display(false);
			if($.settings.payment.status=="verifying")paypalPaymentResultForm_verify();
			if($.settings.payment.status=="waiting_paypal")paypalSendPaymentForm();
		}
		// otherwise, select package form
		else
		{
			// deal with users already exists otherwise, select package form
			if ($.settings.payment && $.settings.payment.process == 'create' && $.settings.payment.status == 'init' && $.settings.payment.user_exists != undefined && $.settings.payment.user_exists == true) {
				paypalPaymentForm_packages_configure();
				paypalPaymentForm_packages_describe();
			}

			$('form[name="paypalPaymentForm"]').show();

			if ($.settings.payment && $.settings.payment.process == 'refill') {
				$('#paypalPaymentForm_back_button').show();
				$('#paypalPaymentForm_disconnect_button').hide();
			}
			else {
				$('#paypalPaymentForm_disconnect_button').show();
				$('#paypalPaymentForm_back_button').hide();
			}
		}
	}
	else {
		$('form[name="paypalPaymentForm"]').hide();
		$('#paypalPaymentForm_package_description_explain').show();
		$('#paypalPaymentForm_package_description_value').html('');
		paypalPaymentForm_packages_configure();
		paypalPaymentForm_packages_describe();
		// CHANGED_BY_HH
		// Please see also: portal_paypal_payment.tmpl.html (line: 36)
		// This change hide the new "fake" button, instead of the pay Button in the form: paypalRedirectForm
		// $('form[name="paypalRedirectForm"]').hide();
		$('#payPalSendButton_Fake').hide();
	}
}

/** Executed when back button is clicked
 */
function paypalPaymentFormBack() {
	var callbacks = new Object();
	// callbacks.beforeSend = function() {}; // TODO
	callbacks.success    = function() { paypalPaymentFormBackCallback(); };
	// callbacks.complete   = function() {}; // TODO
	backAction(callbacks);
}

/** Executed on return of paypalPaymentFormBack function
 */
function paypalPaymentFormBackCallback() {

	if ($.settings != undefined && $.settings.payment != undefined) {
		delete $.settings.payment;
		$.settings.payment = new Object();
	}

	displayErrorInfo();
	displayStep();
}

function paypalPaymentFormRefillBack() {
	var callbacks = new Object();
	// callbacks.beforeSend = function() {}; // TODO
	callbacks.success    = function() { paypalPaymentFormRefillBackCallback(); };
	// callbacks.complete   = function() {}; // TODO
	backAction(callbacks);
}

function paypalPaymentFormRefillBackCallback() {

	if ($.settings != undefined && $.settings.payment != undefined) {
		delete $.settings.payment;
		$.settings.payment = new Object();
	}

	paypalPaymentForm_display(false);
	accountRefillForm_display(true);
	accountRefillForm_options_configure();
	accountRefillForm_options_describe();
}

/** Enable waiting mode on paypalPaymentForm
 */
function paypalPaymentFormWaiting(state) {
	switch (state) {
		case true:
			$('#paypalPaymentForm_back_button').attr("disabled", true);
			$('#paypalPaymentForm_disconnect_button').attr("disabled", true);
			$('#paypalPaymentForm_pay_button').attr("disabled", true);
			$('#paypalPaymentResultForm_disconnect_button').attr("disabled", true);
			$('#paypalPaymentResultForm_connect_button').attr("disabled", true);
			$('body').toggleClass("cursor-wait");
			break;
		case false:
			$('#paypalPaymentForm_back_button').attr("disabled", false);
			$('#paypalPaymentForm_disconnect_button').attr("disabled", false);
			$('#paypalPaymentForm_pay_button').attr("disabled", false);
			$('#paypalPaymentResultForm_disconnect_button').attr("disabled", false);
			$('#paypalPaymentResultForm_connect_button').attr("disabled", false);
			$('body').toggleClass("cursor-wait");
			break;
	}
}

/** Executed when pay button is clicked
 */
function paypalPaymentFormPay() {

	var params = new Object();

	params.package = $('form[name="paypalPaymentForm"] select[name="select_package"]').val();

	if (($.settings.user != undefined) && ($.settings.user.securePwd != undefined)) {
		params.securePwd = $.settings.user.securePwd.value;
	}
	params.login = $.settings.payment.login;
	var callbacks = new Object();
	callbacks.beforeSend = function() { paypalPaymentFormWaiting(true); };
	callbacks.success    = function() { paypalPaymentFormPayCallback(); };
	callbacks.complete   = function() { paypalPaymentFormWaiting(false); };
	selectPaypalPackage(callbacks, params);
}

/** Executed on return of paypalPaymentFormPay function
 */
function paypalPaymentFormPayCallback() {

	displayErrorInfo();
	if($.settings.error == undefined)
	{
		// CHANGED_BY_HH
		// Please see also line: 46 and 195 in this file
		//
		// OLD: $('form[name="paypalRedirectForm"]').show();
		$('#payPalSendButton_Fake').show();
	}
	else
	{
		// CHANGED_BY_HH
		// Please see also line: 46 and 195 in this file
		//
		// OLD: $('form[name="paypalRedirectForm"]').hide();
		$('#payPalSendButton_Fake').hide();
	}
}

function paypalPaymentForm_packages_describe(displayLang) {
	if ($.settings.subscribe != undefined && $.settings.subscribe.paypal != undefined) {

		var paypalInfos = null;
		if ($.settings.subscribe.paypal.package != undefined && ($.settings.payment && $.settings.payment.process == "create")) {
			var paypalInfos = $.settings.subscribe.paypal.package;
		}
		else if ($.settings.subscribe.paypal.option != undefined && ($.settings.payment && $.settings.payment.process == "create")) {
			var paypalInfos = $.settings.subscribe.paypal.option;
		}
		else {
			return;
		}

		if (displayLang == undefined) { // No displayLang given, find user selected language, else default portal language else default package language
			if ($.settings != undefined && $.settings.user != undefined && $.settings.user.lang != undefined) {
				displayLang = $.settings.user.lang;
			}
		}
		// Update describe block
		if ($('form[name="paypalPaymentForm"] select[name="select_package"]').val() == "") {
			$('#paypalPaymentForm_package_description_explain').show();
			$('#paypalPaymentForm_package_description_value').html("");
		}
		else {
			$(paypalInfos).each(function () {
				var package = $(this)[0];
				if (package.name == $('form[name="paypalPaymentForm"] select[name="select_package"]').val()) {
					var describe;
					if (package[displayLang] != undefined) {
						describe = package[displayLang].description;
					}
					else if ($.settings != undefined && $.settings.lang != undefined && $.settings.lang.defaultLang != undefined && package[$.settings.lang.defaultLang] != undefined) {
						describe = package[$.settings.lang.defaultLang].description;
					}
					else if (package[package.defaultLang] != undefined) {
						describe = package[package.defaultLang].description;
					}

					if (describe == undefined) {
						describe = getTextTranslation('accountRefillForm_no_description');
					}

					$('#paypalPaymentForm_package_description_explain').hide();
					$('#paypalPaymentForm_package_description_value').html(describe);
				}
			});
		}
	}
}

function paypalPaymentForm_options_describe() {

	var displayLang = $.settings.user.lang;
	var paypalInfos = $.settings.subscribe.paypal.refill;
	var package = null;
	var describe;
	var text;
	var currencyLanguage;
	$('#paypalPaymentForm_select_package_text').text(getTextTranslation('accountRefillForm_option_buyed_text'));
	$('#paypalPaymentForm_title_text').text(getTextTranslation('paypalOptionPaymentForm_title_text'));
	$('#paypalPaymentForm_explain_text').text(getTextTranslation('paypalOptionPaymentForm_refill_text'));
	$('#paypalPaymentForm_package_description_explain').text(getTextTranslation('paypalOptionPaymentForm_package_description_explain'));
	$('#paypalPaymentForm_package_description_text').text(getTextTranslation('paypalOptionPaymentForm_package_description_text'));

	$(paypalInfos).each(function () {
		var package = $(this)[0];

		if (package.name == $.settings.payment.package) {

			if (package[displayLang] != undefined) {
				text             = package[displayLang].text;
				currencyLanguage = displayLang;
				describe         = package[displayLang].description;
			}
			else if ($.settings != undefined && $.settings.lang != undefined && $.settings.lang.defaultLang != undefined && package[$.settings.lang.defaultLang] != undefined) {
				text             = package[$.settings.lang.defaultLang].text;
				currencyLanguage = $.settings.lang.defaultLang;
				describe         = package[$.settings.lang.defaultLang].description;
			}
			else if (package[package.defaultLang] != undefined) {
				text             = package[package.defaultLang].text;
				currencyLanguage = package.defaultLang;
				describe         = package[package.defaultLang].description;
			}
			else {
				text             = "";
				currencyLanguage = package.defaultLang;
			}

			if (describe == undefined) {
				describe = getTextTranslation('accountRefillForm_no_description');
			}

			// Add price
			if (package['currency'] == "free") {
				text += "&nbsp;" + "(" + getGenericTranslation('free_package', currencyLanguage) + ")";
			}
			else {
				text += "&nbsp;" + "(" + package['price'] + "&nbsp;" + package['currency'] + ")";
			}
			$('#paypalPaymentForm_package_description_explain').hide();
			$('#paypal_select_list').hide();
			$('#paypalPaymentForm_package_description_value').html(describe);
			$('#paypalPaymentForm_payment_detail_value').html(text);
		}
	});

	if($.settings.error == undefined)
	{
		$('form[name="paypalRedirectForm"]').show();
		$('#payPalSendButton_Fake').show();
	}
}

/** Display paypalPaymentResultForm (Usualy Triggered when pay button clicked)
 * @param boolean state - Indicate if the results must be displayed or not
 */
function paypalPaymentResultForm_display(state) {

	var display = false;
	if ( (state == true) || (state == false) ) {
		display = state;
	}
	if (display == true) {
		displayWaitingIcon(false);
		$('form[name="paypalPaymentResultForm"]').show();
		if($.settings.payment.status=="completed")
		{
			if ($.settings.user.verifyTimer != undefined) {
				paypalPaymentVerify_payment_timer_stop();
				delete $.settings.user.verifyTimer;
			}

			displayErrorInfo();
			$("#paypalPaymentResultForm_payment_timer_text").hide();
			if ($.settings.payment.process == "create") {
				$("#paypalPaymentResultForm_connect_button").show();
			}
			else if ($.settings.payment.process == "refill") {
				$('form[name="paypalPaymentForm"]').remove();
				$('form[name="paypalPaymentResultForm"]').remove();
				accountRefillForm_paymentValidate();
			}
		}
		else if ($.settings != undefined && $.settings.error != undefined && $.settings.error.code == "error_logon_waiting-paypal-payment-validation") {
			if ($.settings.user.verifyTimer == undefined) {
				paypalPaymentVerify_payment_timer_start();
			}
		}
		else {
			displayErrorInfo();
			$("#paypalPaymentResultForm_connect_button").hide();
			if ($.settings.user.paymentTimer != undefined && $.settings.user.paymentTimer.value != undefined) {
				$("#paypalPaymentResultForm_payment_timer_text").show();
				$.settings.user.paymentTimer.value = 10;
				paypalPaymentResultForm_payment_timer_start();
			}
			else {
				$("#paypalPaymentResultForm_payment_timer_text").hide();
			}
		}
	}
	else {
		$('form[name="paypalPaymentResultForm"]').hide();
	}

	if (($.settings.subscribe.paypal.option != undefined) || ($.settings.subscribe.paypal.refill != undefined)){
		$('#paypalSubscriptionResultForm_back_button').text(getTextTranslation('paypalOptionSubscriptionResultForm_back_button'));
	}
}



/** Executed when connect comming back from Paypal payment site
 */
function paypalPaymentResultForm_verify() {
	if ($.settings.payment != undefined) {
		var params = new Object();
		var callbacks = new Object();
		params.login = $.settings.payment.login;
		params.policyAccept = $.settings.payment.policyAccept;
		callbacks.beforeSend = function() { paypalPaymentFormWaiting(true); };
		callbacks.success    = function() { paypalPaymentResultForm_display(true); };
		callbacks.complete   = function() { paypalPaymentFormWaiting(false); };
		displayWaitingIcon(true);
		verifyPayment(callbacks,params);
	}
	else {
		displayStep();
	}

}

function paypalPaymentVerify_payment_timer_start() {
    if ($.settings.user.verifyTimer == undefined) {
		$("#paypalPaymentResultForm_explain_text").hide();
		$("#paypalPaymentResultForm_payment_timer_text").hide();
		$("#paypalPaymentResultForm_connect_button").hide();
		$('form[name="paypalPaymentWaitingForm"]').show();
		$('#paypalPaymentWaitingForm_payment_timer_text').text(getTextTranslation('paypalPaymentWaitingForm_payment_timer_text'));
		$('#paypalPaymentWaitingForm_payment_timer_text').show();

		$.settings.user.verifyTimer = 10;
		if (timerObj.paymentTimer == undefined) {
			timerObj.paymentTimer = new Array();
			timerObj.paymentTimer.refreshInterval = 10000;
			timerObj.paymentTimer.value = $.settings.user.verifyTimer;
			timerObj.paymentTimer.resource = window.setInterval(function () { paypalPaymentResultForm_verify(); }, timerObj.paymentTimer.refreshInterval);
		}
	}
}

function paypalPaymentVerify_payment_timer_stop() {
	$("#paypalPaymentResultForm_explain_text").show();
	$("#paypalPaymentResultForm_payment_timer_text").hide();
	$("#paypalPaymentResultForm_connect_button").show();
	$('form[name="paypalPaymentWaitingForm"]').hide();
	if (timerObj.paymentTimer != undefined && timerObj.paymentTimer.resource != undefined) {
		window.clearInterval(timerObj.paymentTimer.resource);
		delete timerObj.paymentTimer;
	}
}

/** Executed on return of verification of Paypal payment
 */
function paypalPaymentResultForm_connect() {
	if($.settings.error == undefined)
	{
		// user payed, follow auto connect link
		paypalPaymentResultForm_payment_timer_stop();
		delete $.settings.user.paymentTimer;
		if($.settings.payment.status=="completed")
		{
			paypalPaymentResultForm_display(false);
			window.location = $.settings.payment.a_connect_link;
		}
		else {
			paypalPaymentResultForm_disconnect();
		}
	}
	else
	{
		paypalPaymentResultForm_disconnect();
		displayErrorInfo();
	}
}


/** Executed when disconnect button is clicked
 */
function paypalPaymentResultForm_disconnect() {
	paypalPaymentResultForm_payment_timer_stop();
	paypalPaymentResultForm_display(false);
	delete $.settings.user.paymentTimer;
	if($.settings.user.isConnected)
		feedbackFormDisconnect();
	else
		paypalPaymentFormBack();
}

function paypalPaymentResultForm_payment_timer_start() {
	if($.settings.user.paymentTimer != undefined && $.settings.user.paymentTimer.value != undefined) {
			if (timerObj.paymentTimer == undefined) {
				timerObj.paymentTimer = new Array();
				timerObj.paymentTimer.refreshInterval = 1000;
				timerObj.paymentTimer.value = $.settings.user.paymentTimer.value;
				timerObj.paymentTimer.resource = window.setInterval(function() { paypalPaymentResultForm_payment_timer_display();}, timerObj.paymentTimer.refreshInterval);

			}
	}
}


function paypalPaymentResultForm_payment_timer_stop() {
	$('#paypalPaymentResultForm_payment_timer').text('-');
	if (timerObj.paymentTimer != undefined && timerObj.paymentTimer.resource != undefined) {
		window.clearInterval(timerObj.paymentTimer.resource);
		delete timerObj.paymentTimer;
	}
}

function paypalPaymentResultForm_payment_timer_display() {
	if (timerObj.paymentTimer != undefined && timerObj.paymentTimer.value != undefined) {
		timerObj.paymentTimer.value--;
		if (timerObj.paymentTimer.value > 0) {
			var hours = Math.floor(timerObj.paymentTimer.value / 3600);
			var mins = Math.floor((timerObj.paymentTimer.value - (hours * 3600)) / 60);
			var seconds = timerObj.paymentTimer.value - (hours * 3600) - (mins * 60);

			var hours_label = getGenericTranslation('hour', null, (hours > 1));
			var mins_label = getGenericTranslation('minute', null, (mins > 1));
			var seconds_label = getGenericTranslation('second', null, (seconds > 1));

			$('#paypalPaymentResultForm_payment_timer_text').text(getTextTranslation('feedbackForm_automatic_disconnection_text'));

			if( hours > 0 )
			{
				$('#paypalPaymentResultForm_payment_timer_value').text($.sprintf(getGenericTranslation('feedbackForm_time-credit-with-seconds'), hours, hours_label, mins, mins_label,
												seconds, seconds_label));
			}
			else
			{
				$('#paypalPaymentResultForm_payment_timer_value').text($.sprintf(getGenericTranslation('feedbackForm_time-credit-without-hours'), mins, mins_label, seconds, seconds_label));
			}
		}
		else {
			paypalPaymentResultForm_disconnect();
		}
	}
}


/*****************************************************************************/
/****             Ogone Subscription Form JavaScript functions           ****/
/*****************************************************************************/

/** Listen to modified element
 */
var ogoneSubscriptionResultForm_changed = new Object();

/** This function is triggered when the page is loaded
 */
$(document).ready(function() {

	/** Inputs triggers
	 */
	$('form[name="ogoneSubscriptionResultForm"] input[name="send_sms"]').change(function() {
		ogoneSubscriptionResultFormSend_display($(this).is(':checked'), "sms");
	});
	$('form[name="ogoneSubscriptionResultForm"] input[name="send_mail"]').change(function() {
		ogoneSubscriptionResultFormSend_display($(this).is(':checked'), "mail");
	});

	$('form[name="ogoneSubscriptionResultForm"] input[name="email"]').focus(function() {
		ogoneSubscriptionResultForm_modifyEvent('focus', $(this));
		ogoneSubscriptionResultForm_phoneHelpBlock_display(false);
	});

	$('form[name="ogoneSubscriptionResultForm"] input[name="email"]').blur(function() {
		ogoneSubscriptionResultForm_modifyEvent('blur', $(this));
	});

	$('form[name="ogoneSubscriptionResultForm"] input[name="email"]').change(function() {
		ogoneSubscriptionResultForm_modifyEvent('blur', $(this));
	});

	$('form[name="ogoneSubscriptionResultForm"] input[name="prefix"]').focus(function() {
		ogoneSubscriptionResultForm_modifyEvent('focus', $(this));
		ogoneSubscriptionResultForm_phoneHelpBlock_display(true);
	});
	$('form[name="ogoneSubscriptionResultForm"] input[name="prefix"]').blur(function() {
		ogoneSubscriptionResultForm_modifyEvent('blur', $(this));
	});
	$('form[name="ogoneSubscriptionResultForm"] input[name="prefix"]').change(function() {
		ogoneSubscriptionResultForm_modifyEvent('blur', $(this));
	});
	$('form[name="ogoneSubscriptionResultForm"] input[name="phone"]').focus(function() {
		ogoneSubscriptionResultForm_modifyEvent('focus', $(this));
		ogoneSubscriptionResultForm_phoneHelpBlock_display(true);
	});
	$('form[name="ogoneSubscriptionResultForm"] input[name="phone"]').blur(function() {
		ogoneSubscriptionResultForm_modifyEvent('blur', $(this));
	});
	$('form[name="ogoneSubscriptionResultForm"] input[name="phone"]').change(function() {
		ogoneSubscriptionResultForm_modifyEvent('blur', $(this));
	});
	/** Buttons triggers
	 */
	$('#ogoneSubscriptionForm_back_button').click(function() {
		ogoneSubscriptionFormBack();
	});
	$('#ogoneSubscriptionForm_subscribe_button').click(function() {
		ogoneSubscriptionFormSubscribe();
	});
	$('#ogoneSubscriptionResultForm_back_button').click(function() {
		displayStep();
	});
	$('#ogoneSubscriptionResultForm_send_button').click(function() {
		ogoneSubscriptionResultFormSendCredential();
	});
	/** Form triggers
	 */
	$('form[name="ogoneSubscriptionForm"]').submit(function() {
		return false;
	});
	$('form[name="ogoneSubscriptionResultForm"]').submit(function() {
		return false;
	});
	/** Link triggers
	 */
	$('#ogoneSubscriptionLink').click(function() {
		ogoneSubscriptionLinkEnable();
	});
	$('#ogoneSubscriptionResultForm_send_sms_phone_help_link').click(function() {
		ogoneSubscriptionResultForm_phoneHelpBlock_display();
	});
});

/** Configure ogoneSubscriptionForm depending on settings
 */
function ogoneSubscriptionForm_configure() {
	var showSendSms = true, showSendMail = true;
	// Configure display
	if ($.settings.subscribe != undefined && $.settings.subscribe.ogone != undefined) {

		if ($.settings.subscribe.ogone.option != undefined) {
			$('#ogoneSubscriptionForm_explain_text').text(getTextTranslation('ogoneOptionSubscriptionForm_explain_text'));
		}

		if (($.settings.subscribe.ogone.option != undefined) || ($.settings.subscribe.ogone.package != undefined)) {
			// Moving link to right location
			if($('#logonForm_subscriptionChoice_grid').length == 1) {
				$('#ogoneSubscriptionLink').appendTo('#logonForm_subscriptionChoice_grid').show();
			}
			else {
				if ($.settings.subscribe.count > 1) {
					$('#ogoneSubscriptionLink').appendTo('#subscriptionChoiceInsert').show();
				}
				else if ($.settings.subscribe.count == 1) {
					$('#logonFormSubscriptionLink_link').click(function() {
						ogoneSubscriptionLinkEnable();
					});
				}
			}
		}
		// Configure ogoneSubscriptionResultForm
		if ($.settings.subscribe.ogone.sendSms != undefined && $.settings.subscribe.ogone.sendSms.display == true) {
			$('#ogoneSubscriptionResultForm_send_sms_block').show();
			$('#ogoneSubscriptionResultForm_send_sms_phone_block').hide();
			// Configure help block
			ogoneSubscriptionResultForm_phoneHelpBlock_configure();
		}
		else {
			$('#ogoneSubscriptionResultForm_send_sms_block').remove();
			$('#ogoneSubscriptionResultForm_send_sms_phone_block').remove();
			showSendSms = false;
		}

		if ($.settings.subscribe.ogone.sendMail != undefined && $.settings.subscribe.ogone.sendMail.display == true) {
			$('#ogoneSubscriptionResultForm_send_mail_block').show();
			$('#ogoneSubscriptionResultForm_send_email_address_block').hide();
		}
		else {
			$('#ogoneSubscriptionResultForm_send_mail_block').remove();
			$('#ogoneSubscriptionResultForm_send_email_address_block').remove();
			showSendMail = false;
		}

		if (showSendMail == false && showSendSms == false) {
			// Remove send button if Mail and Sms ogone subscription mode not activated
			$('#ogoneSubscriptionResultForm_send_button').remove();
		}

		// autofill/autoconnect link
		if ( $.settings.subscribe.ogone.autofill != undefined ) {
			$('form[name="logonForm"] input[name="login"]').val($.settings.subscribe.ogone.autofill.login);
			$('form[name="logonForm"] input[name="password"]').val($.settings.subscribe.ogone.autofill.password);
		}

		subscriptionForm_configure('ogone');
	}
	else {
		$('form[name="ogoneSubscriptionForm"]').remove();
		$('form[name="ogoneSubscriptionResultForm"]').remove();
		$('form[name="ogoneRedirectForm"]').remove();
		$('#ogoneSubscriptionLink').remove();
	}
}

/** Display ogoneSubscriptionForm depending on settings
 * Can be overwritten by state
 * @param boolean state - Indicate if the form must be displayed or not
 */
function ogoneSubscriptionForm_display(state) {

	var display = false;
	if ( (state == true) || (state == false) ) {
		display = state;
	}
	if (display == true) {
		subscriptionForm_commonFields_display('ogone');
		$('form[name="ogoneSubscriptionForm"]').show();

		if ($.settings.subscribe.ogone.option != undefined) {
			$('#ogoneSubscriptionForm_explain_text').text(getTextTranslation('ogoneOptionSubscriptionForm_explain_text'));
		}

	}
	else {
		$('form[name="ogoneSubscriptionForm"]').hide();
		subscriptionForm_empty('ogone');
	}

	$('form[name="ogoneSubscriptionResultForm"]').hide();

	subscriptionForm_phoneHelpBlock_display(false);
	subscriptionForm_passwordHelpBlock_display(false);
}

/** Executed when back button is clicked
 */
function ogoneSubscriptionFormBack() {
    displayStep();
}

/** Enable waiting mode on ogoneSubscriptionForm
 */
function ogoneSubscriptionFormWaiting(state) {
	switch (state) {
		case true:
			$('#ogoneSubscriptionForm_back_button').attr("disabled", true);
			$('#ogoneSubscriptionForm_subscribe_button').attr("disabled", true);
			$('body').toggleClass("cursor-wait");
			break;
		case false:
			$('#ogoneSubscriptionForm_back_button').attr("disabled", false);
			$('#ogoneSubscriptionForm_subscribe_button').attr("disabled", false);
			$('body').toggleClass("cursor-wait");
			break;
	}
}

/** Executed when subscribe button is clicked
 */
function ogoneSubscriptionFormSubscribe() {
    var params = subscriptionFormSubscribe('ogone');
    var callbacks = new Object();
    callbacks.beforeSend = function() { ogoneSubscriptionFormWaiting(true); };
    callbacks.success    = function() { ogoneSubscriptionFormSubscribeCallback(); };
    callbacks.complete   = function() { ogoneSubscriptionFormWaiting(false); };
    subscribe(callbacks, params);
}

/** Executed on return of ogoneSubscriptionFormSubscribe function
 */
function ogoneSubscriptionFormSubscribeCallback() {
    displayErrorInfo();
    if ($.settings.error == undefined) {
		ogonePaymentForm_packages_configure();
		ogoneSubscriptionResultForm_display(true);
    }
}

/** Display ogoneSubscriptionResultForm (Usualy Triggered when subscribtion succeed)
 * @param boolean state - Indicate if the results must be displayed or not
 */
function ogoneSubscriptionResultForm_display(state) {

	var display = false;
	if ( (state == true) || (state == false) ) {
		display = state;
	}
	if ($.settings.info != undefined && $.settings.info.subscribe != undefined) {
		if ($.settings.info.subscribe.login != undefined) {
			$('#ogoneSubscriptionResultForm_login_value').html($.settings.info.subscribe.login);
		}
		if ($.settings.info.subscribe.password != undefined) {
			var tmp_input_params = subscriptionFormSubscribe('ogone');
			if ($.settings.subscribe != undefined && $.settings.subscribe.ogone != undefined
					&& $.settings.subscribe.ogone.userPassword != undefined && $.settings.subscribe.ogone.userPassword.display == true
					&& tmp_input_params.password != '') {
				// We hide the given password
				$('#ogoneSubscriptionResultForm_password_value').html('********');
			}
			else {
				$('#ogoneSubscriptionResultForm_password_value').html($.settings.info.subscribe.password);
			}
		}
		$('form[name="ogoneSubscriptionResultForm"] input[name="end_sms"]').attr("checked", false);
		if (subscriptionForm_changed['prefix'] == true) {
			ogoneSubscriptionResultForm_changed['prefix'] = true;
			$('form[name="ogoneSubscriptionResultForm"] input[name="prefix"]').val($('form[name="ogoneSubscriptionForm"] input[name="prefix"]').val());
		}
		if (subscriptionForm_changed['phone'] == true) {
			ogoneSubscriptionResultForm_changed['phone'] = true;
			$('form[name="ogoneSubscriptionResultForm"] input[name="phone"]').val($('form[name="ogoneSubscriptionForm"] input[name="phone"]').val());
		}
		if (subscriptionForm_changed['email'] == true) {
			ogoneSubscriptionResultForm_changed['email'] = true;
			$('form[name="ogoneSubscriptionResultForm"] input[name="email"]').val($('form[name="ogoneSubscriptionForm"] input[name="email"]').val());
		}
		// Fill in logon fields
		$('form[name="logonForm"] input[name="login"]').val($.settings.info.subscribe.login);
		$('form[name="logonForm"] input[name="password"]').val($.settings.info.subscribe.password);
	}

	if (display == true) {
		$('form[name="ogoneSubscriptionResultForm"]').show();
		$('form[name="ogoneSubscriptionForm"]').hide();
	}
	else {
		$('form[name="ogoneSubscriptionForm"]').show();

		if ($.settings.subscribe.ogone.option != undefined) {
			$('#ogoneSubscriptionForm_explain_text').text(getTextTranslation('ogoneOptionSubscriptionForm_explain_text'));
		}

		$('form[name="ogoneSubscriptionResultForm"]').hide();
		ogoneSubscriptionResultForm_empty();
	}
	ogoneSubscriptionResultForm_phoneHelpBlock_display(false);

	if ($.settings.subscribe.ogone.option != undefined) {
		$('#ogoneSubscriptionResultForm_back_button').text(getTextTranslation('ogoneOptionSubscriptionResultForm_back_button'));
	}
}

/** Empty ogoneSubscriptionResultForm
 */
function ogoneSubscriptionResultForm_empty() {
	$('form[name="ogoneSubscriptionResultForm"] input[type="text"]').each(function() {
		$(this).val('');
	});
	$('form[name="ogoneSubscriptionResultForm"] input[type="checkbox"]').each(function() {
		$(this).attr("checked", false);
	});
	$('#ogoneSubscriptionResultForm_result_login_value').html('');
	$('#ogoneSubscriptionResultForm_result_password_value').html('');
	// Adding examples values
	ogoneSubscriptionResultForm_phoneHelpBlock_configure();
	ogoneSubscriptionResultForm_changed['prefix'] = false;
	ogoneSubscriptionResultForm_changed['phone'] = false;
	ogoneSubscriptionResultForm_changed['email'] = false;
}

/** Display ogoneSubscriptionResultForm_send_sms_phone_help_block when help link is clicked
 * @param boolean state - Indicate if the block must be displayed or not
 */
function ogoneSubscriptionResultForm_phoneHelpBlock_display(state) {

	var display = false;
	if ( (state == true) || (state == false) ) {
		display = state;
	}
	else if ($('#ogoneSubscriptionResultForm_send_sms_phone_help_block').is(':hidden') == true) {
		display = true;
	}
	if (display == true) {
		$('#ogoneSubscriptionResultForm_send_sms_phone_help_block').show();
	}
	else {
		$('#ogoneSubscriptionResultForm_send_sms_phone_help_block').hide();
	}
}

/** Configure ogoneSubscriptionResultForm_send_sms_phone_help_block
 * @param string displayLang - The language whish to display the content
 */
function ogoneSubscriptionResultForm_phoneHelpBlock_configure(displayLang) {
	if (ogoneSubscriptionResultForm_changed['prefix'] != true) {
		$('#ogoneSubscriptionResultForm_send_sms_phone_prefix_value').val(getInputTranslation("ogoneSubscriptionResultForm_send_sms_phone_prefix_value", displayLang));
	}
	if (ogoneSubscriptionResultForm_changed['phone'] != true) {
		$('#ogoneSubscriptionResultForm_send_sms_phone_phone_value').val(getInputTranslation("ogoneSubscriptionResultForm_send_sms_phone_phone_value", displayLang));
	}
	$('#ogoneSubscriptionResultForm_send_sms_phone_help_prefix_example_value').val(getInputTranslation("ogoneSubscriptionResultForm_send_sms_phone_help_prefix_example_value", displayLang));
	$('#ogoneSubscriptionResultForm_send_sms_phone_help_phone_example_value').val(getInputTranslation("ogoneSubscriptionResultForm_send_sms_phone_help_phone_example_value", displayLang));
}

function ogoneSubscriptionResultFormSend_display(state, mode) {
	var display = false;
	if ( (state == true) || (state == false) ) {
		display = state;
	}
	if (display == true) {
		if (mode == "sms") {
			$('#ogoneSubscriptionResultForm_send_sms_phone_block').show();
		}
		if (mode == "mail") {
			$('#ogoneSubscriptionResultForm_send_email_address_block').show();
		}
		if ($('#ogoneSubscriptionResultForm_send_email_address_block').is(':visible') || $('#ogoneSubscriptionResultForm_send_sms_phone_block').is(':visible')) {
			$('#ogoneSubscriptionResultForm_send_button').show();
		}
	}
	else {
		if (mode == "sms") {
			$('#ogoneSubscriptionResultForm_send_sms_phone_block').hide();
			if ($('#ogoneSubscriptionResultForm_send_email_address_block').length == 0) {
				// Hide if SMS mode only visible on portal
				$('#ogoneSubscriptionResultForm_send_button').hide();
			}
		}
		if (mode == "mail") {
			$('#ogoneSubscriptionResultForm_send_email_address_block').hide();
			if ($('#ogoneSubscriptionResultForm_send_sms_phone_block').length == 0) {
				// Hide if Mail mode only visible on portal
				$('#ogoneSubscriptionResultForm_send_button').hide();
			}
		}
		if ($('#ogoneSubscriptionResultForm_send_email_address_block').is(':hidden') && $('#ogoneSubscriptionResultForm_send_sms_phone_block').is(':hidden')) {
			$('#ogoneSubscriptionResultForm_send_button').hide();
		}
	}
	ogoneSubscriptionResultForm_phoneHelpBlock_display(false);
}

/** Enable waiting mode on ogoneSubscriptionResultForm
 */
function ogoneSubscriptionResultFormWaiting(state) {
	switch (state) {
		case true:
			$('#ogoneSubscriptionResultForm_back_button').attr("disabled", true);
			$('#ogoneSubscriptionResultForm_send_button').attr("disabled", true);
			$('body').toggleClass("cursor-wait");
			break;
		case false:
			$('#ogoneSubscriptionResultForm_back_button').attr("disabled", false);
			$('#ogoneSubscriptionResultForm_send_button').attr("disabled", false);
			$('body').toggleClass("cursor-wait");
			break;
	}
}

function ogoneSubscriptionResultFormSendCredential() {

	var params = new Object();
	var sendMailOption = $('form[name="ogoneSubscriptionResultForm"] input[name="send_mail"]').is(":checked");
	var sendSmsOption = $('form[name="ogoneSubscriptionResultForm"] input[name="send_sms"]').is(":checked");

	params.login = $('form[name="logonForm"] input[name="login"]').val();
	params.password = $('form[name="logonForm"] input[name="password"]').val();

	params.prefix = (ogoneSubscriptionResultForm_changed['prefix'] == true) ? $('form[name="ogoneSubscriptionResultForm"] input[name="prefix"]').val() : "";
	params.phone = (ogoneSubscriptionResultForm_changed['phone'] == true) ? $('form[name="ogoneSubscriptionResultForm"] input[name="phone"]').val() : "";
	params.email = (ogoneSubscriptionResultForm_changed['email'] == true) ? $('form[name="ogoneSubscriptionResultForm"] input[name="email"]').val() : "";

	if ( ($.settings.user != undefined) && ($.settings.user.securePwd != undefined) ) {
		params.securePwd = $.settings.user.securePwd.value;
	}

	var callbacks = new Object();
	callbacks.beforeSend = function() { ogoneSubscriptionResultFormWaiting(true); };
	callbacks.success    = function() { ogoneSubscriptionResultFormSendCredentialCallback(); };
	callbacks.complete   = function() { ogoneSubscriptionResultFormWaiting(false); };

	if ($.settings.subscribe.ogone.sendMail != undefined && $.settings.subscribe.ogone.sendMail.display == true && sendMailOption) {
		params.action = "ogone_send_mail";
		subscriptionSendCredential(callbacks, params);
	}
	if ($.settings.subscribe.ogone.sendSms != undefined && $.settings.subscribe.ogone.sendSms.display == true && sendSmsOption) {
		params.action = "ogone_send_sms";
		subscriptionSendCredential(callbacks, params);
	}
}

function ogoneSubscriptionResultFormSendCredentialCallback() {

	displayErrorInfo();
	if ($.settings.error == undefined) {
		displayStep();
	}
}

/*****************************************************************************/

/** Executed when link is clicked
 */
function ogoneSubscriptionLinkEnable() {

	logonForm_display(false);
	logonFormSubscribeChoice_display(false);
	ogoneSubscriptionForm_display(true);
}

/*****************************************************************************/

/** Manage the modification of inputs and the help texts present on them
 * @param string type - The type on the event (focus | blur )
 * @param element element - The DOM element afected by the modification
 */
function ogoneSubscriptionResultForm_modifyEvent(type, element) {
	switch (type) {
		case 'focus':
			if (ogoneSubscriptionResultForm_changed[element.attr("name")] != true) {
				element.val("");
			}
			break;

		case 'blur':
			if (element.val() == "") {
				element.val(getInputTranslation(element.attr("id")));
				ogoneSubscriptionResultForm_changed[element.attr("name")] = false;
			}
			else {
				ogoneSubscriptionResultForm_changed[element.attr("name")] = true;
			}
			break;
	}
}


/*****************************************************************************/
/****                ogone Payment Form JavaScript functions             ****/
/*****************************************************************************/

/** This function is triggered when the page is loaded
 */
$(document).ready(function() {

	/** Inputs triggers
	 */
	$('form[name="ogonePaymentForm"] select[name="select_package"]').change(function() {
		ogonePaymentForm_packages_describe();
		ogonePaymentFormPay();
	});
	$('form[name="ogonePaymentForm"] select[name="select_package"]').keyup(function() {
		ogonePaymentForm_packages_describe();
		ogonePaymentFormPay();
	});

	/** Buttons triggers
	 */
	$('#ogonePaymentForm_back_button').click(function() {
		ogonePaymentFormRefillBack();
	});
	$('#ogonePaymentForm_disconnect_button').click(function() {
		ogonePaymentFormBack();
	});
	$('#ogonePaymentForm_pay_button').click(function() {
		ogonePaymentFormPay();
	});
	$('#ogonePaymentResultForm_disconnect_button').click(function() {
		ogonePaymentResultForm_disconnect();
	});
	$('#ogonePaymentResultForm_connect_button').click(function() {
		ogonePaymentResultForm_connect();
	});
	/** Form triggers
	 */
	$('form[name="ogonePaymentForm"]').submit(function() {
		return false;
	});
	$('form[name="ogonePaymentResultForm"]').click(function() {
		return false;
	});

	// CHANGED_BY_HH
	// Modified, to display the ogone PAY button (#ogoneSendButton_Fake) right near the DISCONNECT button at one line!
	// In the past, the PAY button was in a seperate seperate form element
	// Which was display downwards the DISCONNECT button
	// The original payment form is now hidden the whole time!
	//
	// Please see also: portal_ogone_payment.tmpl.html (line 37)
	//
	// OLD: $('#ogoneRedirectionForm_pay_button').click(function (){
	$('#ogoneSendButton_Fake').click(function (){
		// Update order status through API
		ogoneRedirectFormPay();
	});
});

/** Configure ogonePaymentForm depending on settings
 */
function ogonePaymentForm_configure() {

	// Configure display
	if ($.settings.subscribe != undefined && $.settings.subscribe.ogone != undefined) {
		// Add packages
		ogonePaymentForm_packages_configure();
	}
	else {
		$('form[name="ogonePaymentForm"]').remove();
		$('form[name="ogonePaymentResultForm"]').remove();
	}
}

function ogonePaymentForm_packages_configure(displayLang) {

	if ($.settings.subscribe != undefined && $.settings.subscribe.ogone != undefined) {
		var ogoneInfos = null;
		var defaultOptionText;
		if ($.settings.subscribe.ogone.package != undefined && ($.settings.payment && $.settings.payment.process == "create")) {
			var ogoneInfos = $.settings.subscribe.ogone.package;
			// Keep default option
			defaultOptionText = $('#ogonePaymentForm_default_package_option').text();
		}
		else if ($.settings.subscribe.ogone.option != undefined && ($.settings.payment && $.settings.payment.process == "create")) {
			var ogoneInfos = $.settings.subscribe.ogone.option;
			defaultOptionText = getTextTranslation('ogoneOptionPaymentForm_default_package_option');
			$('#ogonePaymentForm_select_package_text').text(getTextTranslation('ogoneOptionPaymentForm_select_package_text'));
			$('#ogonePaymentForm_title_text').text(getTextTranslation('ogoneOptionPaymentForm_title_text'));
			$('#ogonePaymentForm_explain_text').text(getTextTranslation('ogoneOptionPaymentForm_explain_text'));
			$('#ogonePaymentForm_package_description_explain').text(getTextTranslation('ogoneOptionPaymentForm_package_description_explain'));
			$('#ogonePaymentForm_package_description_text').text(getTextTranslation('ogoneOptionPaymentForm_package_description_text'));
		}
		else {
			return;
		}

		if (displayLang == undefined) { // No displayLang given, find user selected language, else default portal language else default package language
			if ($.settings != undefined && $.settings.user != undefined && $.settings.user.lang != undefined) {
				displayLang = $.settings.user.lang;
			}
		}

		// update forced disconnectin timer info
		if ( $.settings.subscribe.ogone.connectionProfile != undefined && $.settings.subscribe.ogone.connectionProfile.timeout > 0 ) {
			$('form[name="ogonePaymentForm"] small#ogonePaymentForm_payment_timer_text').show();
			$('form[name="ogonePaymentForm"] small#ogonePaymentForm_payment_timer_value').text(getForcedDisconnectionTimerDisplayText($.settings.subscribe.ogone.connectionProfile.timeout));
		}
		else {
			$('form[name="ogonePaymentForm"] small#ogonePaymentForm_payment_timer_text').hide();
			$('form[name="ogonePaymentForm"] small#ogonePaymentForm_payment_timer_value').text(' ');
		}

		// Empty the select list
		$('form[name="ogonePaymentForm"] select[name="select_package"]').empty();
		$('form[name="ogonePaymentForm"] select[name="select_package"]').append('<option id="ogonePaymentForm_default_package_option" disabled selected value="">' + defaultOptionText + '</option>');
		// Populate list
		$(ogoneInfos).each(function () {
			var package = $(this)[0];
			var text;
			var currencyLanguage;
			if (package[displayLang] != undefined) {
				text = package[displayLang].text;
				currencyLanguage = displayLang;
			}
			else if ($.settings != undefined && $.settings.lang != undefined && $.settings.lang.defaultLang != undefined && package[$.settings.lang.defaultLang] != undefined) {
				text = package[$.settings.lang.defaultLang].text;
				currencyLanguage = $.settings.lang.defaultLang;
			}
			else if (package[package.defaultLang] != undefined) {
				text = package[package.defaultLang].text;
				currencyLanguage = package.defaultLang;
			}
			else {
				text = "";
				currencyLanguage = package.defaultLang;
			}
			// Add price
			if (package['currency'] == "free") {
				text += "&nbsp;" + "(" + getGenericTranslation('free_package', currencyLanguage) + ")";
			}
			else {
				text += "&nbsp;" + "(" + package['price'] + "&nbsp;" + package['currency'] + ")";
			}

			$('form[name="ogonePaymentForm"] select[name="select_package"]').append('<option value="' + package.name + '"' + '>' + text + '</option>');
		});
	}
}

/** Display ogonePaymentForm depending on settings
 * Can be overwritten by state
 * @param boolean state - Indicate if the form must be displayed or not
 */
function ogonePaymentForm_display(state) {

	var display = false;
	if ( (state == true) || (state == false) ) {
		display = state;
	}
	else if ( ($.settings.step != undefined && $.settings.step == "PAYMENT") && ($.settings.type != undefined && $.settings.type == "OGONE") ) {
		display = true;
	}
	if (display == true) {
		if( $.settings.payment.status=="waiting_ogone" || $.settings.payment.status=="verifying"  )
		{
			ogonePaymentForm_display(false);
			if($.settings.payment.status=="verifying")ogonePaymentResultForm_verify();
			if($.settings.payment.status=="waiting_ogone")ogoneSendPaymentForm();
		}
		// otherwise, select package form
		else
		{
			// deal with users already exists otherwise, select package form
			if ($.settings.payment && $.settings.payment.process == 'create' && $.settings.payment.status == 'init' && $.settings.payment.user_exists != undefined && $.settings.payment.user_exists == true) {
				ogonePaymentForm_packages_configure();
				ogonePaymentForm_packages_describe();
			}

			$('form[name="ogonePaymentForm"]').show();

			if ($.settings.payment && $.settings.payment.process == 'refill') {
				$('#ogonePaymentForm_back_button').show();
				$('#ogonePaymentForm_disconnect_button').hide();
			}
			else {
				$('#ogonePaymentForm_disconnect_button').show();
				$('#ogonePaymentForm_back_button').hide();
			}
		}
	}
	else {
		$('form[name="ogonePaymentForm"]').hide();
		$('#ogonePaymentForm_package_description_explain').show();
		$('#ogonePaymentForm_package_description_value').html('');
		ogonePaymentForm_packages_configure();
		ogonePaymentForm_packages_describe();
		// CHANGED_HH
		// hide the "fake" button, instead of the real form
		// $('form[name="ogoneRedirectForm"]').hide();
		$('#ogoneSendButton_Fake').hide();
	}
}

/** Executed when back button is clicked
 */
function ogonePaymentFormBack() {
	var callbacks = new Object();
	// callbacks.beforeSend = function() {}; // TODO
	callbacks.success    = function() { ogonePaymentFormBackCallback(); };
	// callbacks.complete   = function() {}; // TODO
	backAction(callbacks);
}

/** Executed on return of ogonePaymentFormBack function
 */
function ogonePaymentFormBackCallback() {

	if ($.settings != undefined && $.settings.payment != undefined) {
		delete $.settings.payment;
		$.settings.payment = new Object();
	}

	displayErrorInfo();
	displayStep();
}

function ogonePaymentFormRefillBack() {
	var callbacks = new Object();
	// callbacks.beforeSend = function() {}; // TODO
	callbacks.success    = function() { ogonePaymentFormRefillBackCallback(); };
	// callbacks.complete   = function() {}; // TODO
	backAction(callbacks);
}

function ogonePaymentFormRefillBackCallback() {

	if ($.settings != undefined && $.settings.payment != undefined) {
		delete $.settings.payment;
		$.settings.payment = new Object();
	}

	ogonePaymentForm_display(false);
	accountRefillForm_display(true);
	accountRefillForm_options_configure();
	accountRefillForm_options_describe();
}

/** Enable waiting mode on ogonePaymentForm
 */
function ogonePaymentFormWaiting(state) {
	switch (state) {
		case true:
			$('#ogonePaymentForm_back_button').attr("disabled", true);
			$('#ogonePaymentForm_disconnect_button').attr("disabled", true);
			$('#ogonePaymentForm_pay_button').attr("disabled", true);
			$('#ogonePaymentResultForm_disconnect_button').attr("disabled", true);
			$('#ogonePaymentResultForm_connect_button').attr("disabled", true);
			$('body').toggleClass("cursor-wait");
			break;
		case false:
			$('#ogonePaymentForm_back_button').attr("disabled", false);
			$('#ogonePaymentForm_disconnect_button').attr("disabled", false);
			$('#ogonePaymentForm_pay_button').attr("disabled", false);
			$('#ogonePaymentResultForm_disconnect_button').attr("disabled", false);
			$('#ogonePaymentResultForm_connect_button').attr("disabled", false);
			$('body').toggleClass("cursor-wait");
			break;
	}
}

/** Executed when pay button is clicked
 */
function ogonePaymentFormPay() {

	var params = new Object();

	params.package = $('form[name="ogonePaymentForm"] select[name="select_package"]').val();

	params.login = $.settings.payment.login;
	if (($.settings.user != undefined) && ($.settings.user.securePwd != undefined)) {
		params.securePwd = $.settings.user.securePwd.value;
	}
	var callbacks = new Object();
	callbacks.beforeSend = function() { ogonePaymentFormWaiting(true); };
	callbacks.success    = function() { ogonePaymentFormPayCallback(); };
	callbacks.complete   = function() { ogonePaymentFormWaiting(false); };
	selectOgonePackage(callbacks, params);
}

/** Executed on return of ogonePaymentFormPay function
 */
function ogonePaymentFormPayCallback() {
	displayErrorInfo();
	if($.settings.error == undefined)
	{
		// CHANGED_HH
		// show the "fake" button, instead of the real form
		// $('form[name="ogoneRedirectForm"]').show();
		$('#ogoneSendButton_Fake').show();
	}
	else
	{
		// CHANGED_HH
		// hide the "fake" button, instead of the real form
		// $('form[name="ogoneRedirectForm"]').hide();
		$('#ogoneSendButton_Fake').hide();
	}
}

/* Fill and send Ogone payment infos */

function ogoneSendPaymentForm()
{
	displayWaitingIcon(true);
	$('form[name="ogoneRedirectForm"]').attr('action', $.settings.payment.ogoneUrlPost);
	$('form[name="ogoneRedirectForm"] input[name="PSPID"]').val($.settings.payment.pspid);
	$('form[name="ogoneRedirectForm"] input[name="USERID"]').val($.settings.payment.userid);
	$('form[name="ogoneRedirectForm"] input[name="PSWD"]').val($.settings.payment.userpassword);
	$('form[name="ogoneRedirectForm"] input[name="ORDERID"]').val($.settings.payment.orderid);
	$('form[name="ogoneRedirectForm"] input[name="AMOUNT"]').val($.settings.payment.amount);
	$('form[name="ogoneRedirectForm"] input[name="CURRENCY"]').val($.settings.payment.currency);
	$('form[name="ogoneRedirectForm"] input[name="LANGUAGE"]').val($.settings.payment.language);
	$('form[name="ogoneRedirectForm"] input[name="SHASIGN"]').val($.settings.payment.shasign);
	$('form[name="ogoneRedirectForm"] input[name="ACCEPTURL"]').val($.settings.payment.portal_url);
	$('form[name="ogoneRedirectForm"] input[name="DECLINEURL"]').val($.settings.payment.portal_url);
	$('form[name="ogoneRedirectForm"] input[name="EXCEPTIONURL"]').val($.settings.payment.portal_url);
	$('form[name="ogoneRedirectForm"] input[name="CANCELURL"]').val($.settings.payment.portal_url);
	$('form[name="ogoneRedirectForm"]').submit();
}


/** Executed on return of ogonePaymentFormPay function
 */
function ogoneRedirectFormPayCallback() {

	if ($.settings.error == undefined) {
		ogonePaymentForm_display(false);
		displayStep();
	}
	displayErrorInfo();

}

/** Executed on return of ogonePaymentFormPay function
 */
function ogoneRedirectFormPay()
{
	var params = new Object();
	params.orderid = $('form[name="ogoneRedirectForm"] input[name="ORDERID"]').val();
	params.login = $.settings.payment.login;
	if ( ($.settings.user != undefined) && ($.settings.user.securePwd != undefined) ) {
		params.securePwd = $.settings.user.securePwd.value;
	}
	var callbacks = new Object();
	callbacks.beforeSend = function() { ogonePaymentFormWaiting(true); };
	callbacks.success    = function() { ogoneRedirectFormPayCallback(); };
	callbacks.complete = function (){
		// CHANGED_BY_HH
		// added a little timeout (2sec.)
		// This is done, to show the fullscreen waiting overlay a bit longer
		// So we get a uninterrupted animation, till the ogone website is displayed
		setTimeout(function (){
		    ogonePaymentFormWaiting(false);
		}, 2000);
	    };

	ogoneSubmitPayment(callbacks, params);
}


function ogonePaymentForm_packages_describe(displayLang) {

	if ($.settings.subscribe != undefined && $.settings.subscribe.ogone != undefined) {
		 var ogoneInfos = null;
		 if ($.settings.subscribe.ogone.package != undefined && ($.settings.payment && $.settings.payment.process == "create")) {
			 var ogoneInfos = $.settings.subscribe.ogone.package;
		 }
		 else if ($.settings.subscribe.ogone.option != undefined && ($.settings.payment && $.settings.payment.process == "create")) {
			 var ogoneInfos = $.settings.subscribe.ogone.option;
		 }
		 else {
			 return;
		 }

		if (displayLang == undefined) { // No displayLang given, find user selected language, else default portal language else default package language
			if ($.settings != undefined && $.settings.user != undefined && $.settings.user.lang != undefined) {
				displayLang = $.settings.user.lang;
			}
		}
		// Update describe block
		if ($('form[name="ogonePaymentForm"] select[name="select_package"]').val() == "") {
			$('#ogonePaymentForm_package_description_explain').show();
			$('#ogonePaymentForm_package_description_value').html("");
		}
		else {
			$(ogoneInfos).each(function () {
				var package = $(this)[0];
				if (package.name == $('form[name="ogonePaymentForm"] select[name="select_package"]').val()) {
					var describe;
					if (package[displayLang] != undefined) {
						describe = package[displayLang].description;
					}
					else if ($.settings != undefined && $.settings.lang != undefined && $.settings.lang.defaultLang != undefined && package[$.settings.lang.defaultLang] != undefined) {
						describe = package[$.settings.lang.defaultLang].description;
					}
					else if (package[package.defaultLang] != undefined) {
						describe = package[package.defaultLang].description;
					}

					if (describe == undefined) {
						describe = getTextTranslation('accountRefillForm_no_description');
					}

					$('#ogonePaymentForm_package_description_explain').hide();
					$('#ogonePaymentForm_package_description_value').html(describe);
				}
			});
		}
	}
}

function ogonePaymentForm_options_describe() {

	var displayLang = $.settings.user.lang;
	var ogoneInfos = $.settings.subscribe.ogone.refill;
	var package = null;
	var describe;
	var text;
	var currencyLanguage;
	$('#ogonePaymentForm_select_package_text').text(getTextTranslation('accountRefillForm_option_buyed_text'));
	$('#ogonePaymentForm_title_text').text(getTextTranslation('ogoneOptionPaymentForm_title_text'));
	$('#ogonePaymentForm_explain_text').text(getTextTranslation('ogoneOptionPaymentForm_refill_text'));
	$('#ogonePaymentForm_package_description_explain').text(getTextTranslation('ogoneOptionPaymentForm_package_description_explain'));
	$('#ogonePaymentForm_package_description_text').text(getTextTranslation('ogoneOptionPaymentForm_package_description_text'));

	$(ogoneInfos).each(function () {
		var package = $(this)[0];

		// if (package.name == $('form[name="ogonePaymentForm"] select[name="select_package"]').val()) {
		if (package.name == $.settings.payment.package) {

			if (package[displayLang] != undefined) {
				text             = package[displayLang].text;
				currencyLanguage = displayLang;
				describe         = package[displayLang].description;
			}
			else if ($.settings != undefined && $.settings.lang != undefined && $.settings.lang.defaultLang != undefined && package[$.settings.lang.defaultLang] != undefined) {
				text             = package[$.settings.lang.defaultLang].text;
				currencyLanguage = $.settings.lang.defaultLang;
				describe         = package[$.settings.lang.defaultLang].description;
			}
			else if (package[package.defaultLang] != undefined) {
				text             = package[package.defaultLang].text;
				currencyLanguage = package.defaultLang;
				describe         = package[package.defaultLang].description;
			}
			else {
				text             = "";
				currencyLanguage = package.defaultLang;
			}

			if (describe == undefined) {
				describe = getTextTranslation('accountRefillForm_no_description');
			}

			// Add price
			if (package['currency'] == "free") {
				text += "&nbsp;" + "(" + getGenericTranslation('free_package', currencyLanguage) + ")";
			}
			else {
				text += "&nbsp;" + "(" + package['price'] + "&nbsp;" + package['currency'] + ")";
			}
			$('#ogonePaymentForm_package_description_explain').hide();
			$('#ogone_select_list').hide();
			$('#ogonePaymentForm_package_description_value').html(describe);
			$('#ogonePaymentForm_payment_detail_value').html(text);
		}
	});

	if($.settings.error == undefined)
	{
		$('form[name="ogoneRedirectForm"]').show();
		$('#ogoneSendButton_Fake').show();
	}
}

/** Display ogonePaymentResultForm (Usualy Triggered when pay button clicked)
 * @param boolean state - Indicate if the results must be displayed or not
 */
function ogonePaymentResultForm_display(state) {

	var display = false;
	if ( (state == true) || (state == false) ) {
		display = state;
	}
	if (display == true) {
		$('form[name="ogonePaymentResultForm"]').show();
		displayWaitingIcon(false);
		if($.settings.payment.status=="completed")
		{
			displayErrorInfo();
			$("#ogonePaymentResultForm_payment_timer_text").hide();
			if ($.settings.payment.process == "create") {
				$("#ogonePaymentResultForm_connect_button").show();
			}
			else if ($.settings.payment.process == "refill") {
				$('form[name="ogonePaymentForm"]').remove();
				$('form[name="ogonePaymentResultForm"]').remove();
				accountRefillForm_paymentValidate();
			}
			else {
				displayErrorInfo();
				$("#ogonePaymentResultForm_connect_button").hide();
				if ($.settings.user.paymentTimer != undefined && $.settings.user.paymentTimer.value != undefined) {
					$("#ogonePaymentResultForm_payment_timer_text").show();
					$.settings.user.paymentTimer.value = 10;
					ogonePaymentResultForm_payment_timer_start();
				}
			}
		}
	}
	else {
		$('form[name="ogonePaymentResultForm"]').hide();
	}

	if (($.settings.subscribe.ogone.option != undefined) || ($.settings.subscribe.ogone.refill != undefined)){
		$('#ogoneSubscriptionResultForm_back_button').text(getTextTranslation('ogoneOptionSubscriptionResultForm_back_button'));
	}
}

/** Executed when comming back from Ogone paymen website
 */
function ogonePaymentResultForm_verify() {
	if ($.settings.payment != undefined) {
		var params = new Object();
		var callbacks = new Object();
		params.login = $.settings.payment.login;
		params.policyAccept = $.settings.payment.policyAccept;

		callbacks.beforeSend = function() { ogonePaymentFormWaiting(true); };
		callbacks.success    = function() { ogonePaymentResultForm_display(true); };
		callbacks.complete   = function() { ogonePaymentFormWaiting(false); };
		displayWaitingIcon(true);
		verifyPayment(callbacks,params);
	}
	else {

		displayStep();
	}
}


/** Executed when connect button is clicked
 */
function ogonePaymentResultForm_connect() {
	if($.settings.error == undefined)
	{
		// user payed, follow auto connect link
		ogonePaymentResultForm_payment_timer_stop();
		delete $.settings.user.paymentTimer;
		if($.settings.payment.status=="completed")
		{
			ogonePaymentResultForm_display(false);
			window.location = $.settings.payment.a_connect_link;
		}
		else {
			ogonePaymentResultForm_disconnect();
		}
	}
	else
	{
		ogonePaymentResultForm_disconnect();
		displayErrorInfo();
	}
}

/** Executed on return of authenticate shortcut for ogone package choice
 */
function ogonePaymentResultFormConnectCallback() {
	if($.settings.error == undefined)
	{
		// user payed, autoconnect
		ogonePaymentResultForm_payment_timer_stop();
		delete $.settings.user.paymentTimer;
		window.location = $.settings.payment.a_connect_link;
	}
	else
	{
		displayErrorInfo();
	}
}

/** Executed when disconnect button is clicked
 */
function ogonePaymentResultForm_disconnect() {
	ogonePaymentResultForm_payment_timer_stop();
	ogonePaymentResultForm_display(false);
	delete $.settings.user.paymentTimer;
	if($.settings.user.isConnected)
		feedbackFormDisconnect();
	else
		ogonePaymentFormBack();

}


function ogonePaymentResultForm_payment_timer_start() {
	if($.settings.user.paymentTimer != undefined && $.settings.user.paymentTimer.value != undefined) {
			if (timerObj.paymentTimer == undefined) {
				timerObj.paymentTimer = new Array();
				timerObj.paymentTimer.refreshInterval = 1000;
				timerObj.paymentTimer.value = $.settings.user.paymentTimer.value;
				timerObj.paymentTimer.resource = window.setInterval(function() { ogonePaymentResultForm_payment_timer_display();}, timerObj.paymentTimer.refreshInterval);

			}
	}
}


function ogonePaymentResultForm_payment_timer_stop() {
	$('#ogonePaymentResultForm_payment_timer').text('-');
	if (timerObj.paymentTimer != undefined && timerObj.paymentTimer.resource != undefined) {
		window.clearInterval(timerObj.paymentTimer.resource);
		delete timerObj.paymentTimer;
	}
}

function ogonePaymentResultForm_payment_timer_display() {
	if (timerObj.paymentTimer != undefined && timerObj.paymentTimer.value != undefined) {
		timerObj.paymentTimer.value--;
		if (timerObj.paymentTimer.value > 0) {
			var hours = Math.floor(timerObj.paymentTimer.value / 3600);
			var mins = Math.floor((timerObj.paymentTimer.value - (hours * 3600)) / 60);
			var seconds = timerObj.paymentTimer.value - (hours * 3600) - (mins * 60);

			var hours_label = getGenericTranslation('hour', null, (hours > 1));
			var mins_label = getGenericTranslation('minute', null, (mins > 1));
			var seconds_label = getGenericTranslation('second', null, (seconds > 1));

			if( hours > 0 )
			{
				$('#ogonePaymentResultForm_payment_timer_value').text($.sprintf(getGenericTranslation('feedbackForm_time-credit-with-seconds'), hours, hours_label, mins, mins_label,
												seconds, seconds_label));
			}
			else
			{
				$('#ogonePaymentResultForm_payment_timer_value').text($.sprintf(getGenericTranslation('feedbackForm_time-credit-without-hours'), mins, mins_label, seconds, seconds_label));
			}
		}
		else {
			ogonePaymentResultForm_disconnect();
		}
	}
}

/*****************************************************************************/
/****                 PMS Payment Form JavaScript functions               ****/
/*****************************************************************************/

/** This function is triggered when the page is loaded
 */
$(document).ready(function (){

    /** Inputs triggers
     */
    $('form[name="pmsPaymentForm"] select[name="select_package"]').change(function (){
        pmsPaymentForm_packages_describe();
    });
    $('form[name="pmsPaymentForm"] select[name="select_package"]').keyup(function (){
        pmsPaymentForm_packages_describe();
    });

    /** Buttons triggers
     */
    $('#pmsPaymentForm_cancel_button').click(function (){
        pmsPaymentForm_display(false);
        $.settings.step = "FEEDBACK";
        manageAccountForm_display(true);
    });

    $('#pmsPaymentForm_disconnect_button').click(function (){
        pmsPaymentFormBack();
    });

    $('#pmsPaymentForm_pay_button').click(function (){
        pmsPaymentFormPay();
    });

    /** Form triggers
     */
    $('form[name="pmsPaymentForm"]').submit(function (){
        return false;
    });
});

/** Configure pmsPaymentForm depending on settings
 */
function pmsPaymentForm_configure(){

    // Configure display
    if ( $.settings.subscribe != undefined && $.settings.subscribe.pms != undefined ) {
        // Add packages
        pmsPaymentForm_packages_configure();
    }
    else {
        $('form[name="pmsPaymentForm"]').remove();
    }
}


function pmsPaymentForm_packages_configure( displayLang ){
	if ($.settings.subscribe != undefined && $.settings.subscribe.pms != undefined) {

		var pmsInfos = null;
		var defaultOptionText;

		// Depending on portal configuration, select package or option => works for both 5.1 and 5.2 versions
		if ($.settings.subscribe.pms.package != undefined) {
			if ($.settings.subscribe.pms.package != undefined) {
				pmsInfos = $.settings.subscribe.pms.package;
				// Keep default option
				defaultOptionText = $('#pmsPaymentForm_default_package_option').text();
			}
		}
		else if ($.settings.subscribe.pms.option != undefined) {
			pmsInfos = $.settings.subscribe.pms.option;
			defaultOptionText = getTextTranslation('pmsOptionPaymentForm_default_package_option');
			$('#pmsPaymentForm_select_package_text').text(getTextTranslation('pmsOptionPaymentForm_select_package_text'));
			$('#pmsPaymentForm_title_text').text(getTextTranslation('pmsOptionPaymentForm_title_text'));
			$('#pmsPaymentForm_explain_text').text(getTextTranslation('pmsOptionPaymentForm_explain_text'));
			$('#pmsPaymentForm_package_description_explain').text(getTextTranslation('pmsOptionPaymentForm_package_description_explain'));
			$('#pmsPaymentForm_package_description_text').text(getTextTranslation('pmsOptionPaymentForm_package_description_text'));
		}
		else {
			return;
		}

		if (displayLang == undefined) { // No displayLang given, find user selected language, else default portal language else default package language
			if ($.settings != undefined && $.settings.user != undefined && $.settings.user.lang != undefined) {
				displayLang = $.settings.user.lang;
			}
		}

		// Empty the select list
		$('form[name="pmsPaymentForm"] select[name="select_package"]').empty();
		$('form[name="pmsPaymentForm"] select[name="select_package"]').append('<option id="pmsPaymentForm_default_package_option" disabled selected value="">' + defaultOptionText + '</option>');
		// Populate list
		$(pmsInfos).each(function () {
			var package = $(this)[0];
			var text;
			var currencyLanguage;
			if (package[displayLang] != undefined) {
				text = package[displayLang].text;
				currencyLanguage = displayLang;
			}
			else if ($.settings != undefined && $.settings.lang != undefined && $.settings.lang.defaultLang != undefined && package[$.settings.lang.defaultLang] != undefined) {
				text = package[$.settings.lang.defaultLang].text;
				currencyLanguage = $.settings.lang.defaultLang;
			}
			else if (package[package.defaultLang] != undefined) {
				text = package[package.defaultLang].text;
				currencyLanguage = package.defaultLang;
			}
			else {
				text = "";
				currencyLanguage = package.defaultLang;
			}

			// Add price
			if (package['currency'] == "free") {
				text += "&nbsp;" + "(" + getGenericTranslation('free_package', currencyLanguage) + ")";
			}
			else {
				text += "&nbsp;" + "(" + package['price'] + "&nbsp;" + package['currency'] + ")";
			}
			$('form[name="pmsPaymentForm"] select[name="select_package"]').append('<option value="' + package.name + '">' + text + '</option>');
		});
	}
}

/** Display pmsPaymentForm depending on settings
 * Can be overwritten by state
 * @param boolean state - Indicate if the form must be displayed or not
 */
function pmsPaymentForm_display( state ){

    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }
    else if ( ($.settings.step != undefined && $.settings.step == "PAYMENT") && ($.settings.type != undefined && $.settings.type == "PMS") ) {
        display = true;
    }

    if ( display == true ) {
        $('form[name="pmsPaymentForm"]').show();
        if ( ($.settings.user.allowmodifypackage == true ) && (switch_package == true) ) {
            pmsPaymentForm_cancel_button_show_hide(true);

        } else {
            pmsPaymentForm_cancel_button_show_hide(false);
        }

		if ( ($.settings.user.PMS != undefined) && ($.settings.user.PMS.session_has_expired != undefined) && ($.settings.user.PMS.session_has_expired == true ) ) {
            $('#pmsPaymentForm_missingInfo_block').show();

		} else {
            $('#pmsPaymentForm_missingInfo_block').hide();
		}
    }
    else {
        $('form[name="pmsPaymentForm"]').hide();
        pmsPaymentForm_packages_configure();
        pmsPaymentForm_packages_describe();
    }
}

/** Executed when back button is clicked
 */
function pmsPaymentFormBack(){

    var callbacks = new Object();
    // callbacks.beforeSend = function() {}; // TODO
    callbacks.success = function (){
        pmsPaymentFormBackCallback();
    };
    // callbacks.complete   = function() {}; // TODO

    backAction(callbacks);
}

/** Executed on return of pmsPaymentFormBack function
 */
function pmsPaymentFormBackCallback(){

    displayErrorInfo();
    displayStep();
}

function pmsPaymentForm_cancel_button_show_hide( state ){
    switch ( state ) {
        case true:
            $('#pmsPaymentForm_cancel_button').show();
            $('#pmsPaymentForm_disconnect_button').hide();
            $('#pmsPaymentForm_caution_block').show();
            break;
        case false:
            $('#pmsPaymentForm_cancel_button').hide();
            $('#pmsPaymentForm_disconnect_button').show();
            $('#pmsPaymentForm_caution_block').hide();
            break;
    }
}

/** Enable waiting mode on pmsPaymentForm
 */
function pmsPaymentFormWaiting( state ){
    switch ( state ) {
        case true:
            $('#pmsPaymentForm_disconnect_button').attr("disabled", true);
            $('#pmsPaymentForm_pay_button').attr("disabled", true);
            $('body').toggleClass("cursor-wait");
            break;
        case false:
            $('#pmsPaymentForm_disconnect_button').attr("disabled", false);
            $('#pmsPaymentForm_pay_button').attr("disabled", false);
            $('body').toggleClass("cursor-wait");
            break;
    }
}


/** Executed when pay button is clicked
 */
function pmsPaymentFormPay(){

    var params = new Object();
    params.package = $('form[name="pmsPaymentForm"] select[name="select_package"]').val();

    if ( ($.settings.user != undefined) && ($.settings.user.securePwd != undefined) ) {
        params.securePwd = $.settings.user.securePwd.value;
    }

	if ( ($.settings.user != undefined) && ($.settings.user.password == undefined) ) {
		params.password   = $('form[name = "pmsPaymentForm"] input[name = "password"]').val();
	}

    var callbacks = new Object();
    callbacks.beforeSend = function (){
        pmsPaymentFormWaiting(true);
    };
    callbacks.success = function (){
        pmsPaymentFormPayCallback();
    };
    callbacks.complete = function (){
        pmsPaymentFormWaiting(false);
    };

    selectPmsPackage(callbacks, params);
}

/** Executed on return of pmsPaymentFormPay function
 */
function pmsPaymentFormPayCallback(){

    displayErrorInfo();
    if ( $.settings.error == undefined ) {
        if ( $.settings.payment != undefined ) {
            var params = new Object();
            params.login = $.settings.payment.login;
			params.policyAccept = $.settings.payment.policyAccept;
			params.privatePolicyAccept = $.settings.payment.privatePolicyAccept;

			if ($.settings.payment.option != undefined) {
				params.option = $.settings.payment.option;
			}

            if ( ($.settings.user.allowmodifypackage != undefined) && ($.settings.user.allowmodifypackage == true) && (switch_package == true) ) {
                params.lastProfile = $.settings.payment.lastProfile;
                params.switchPackage = switch_package;
            }

            if ( ($.settings.user != undefined) && ($.settings.user.securePwd != undefined) ) {
                params.securePwd = $.settings.user.securePwd.value;
            }

            var callbacks = new Object();
            callbacks.beforeSend = function (){
                pmsPaymentFormWaiting(true);
            };
            callbacks.success = function (){
                pmsPaymentFormConnectCallback();
            };
            callbacks.complete = function (){
                pmsPaymentFormWaiting(false);
            };
            authenticate(callbacks, params)
        }
        else {
            displayStep();
        }
    }
}

/** Executed on return of authenticate shortcut for PMS package choice
 */
function pmsPaymentFormConnectCallback(){
    switch_package = false;
    if ( $.settings.error == undefined ) {
        logonFormConnectCallback();
    }
    else {
        $.settings.step = "LOGON";
        displayErrorInfo();
        displayStep();
    }
}

function pmsPaymentForm_packages_describe( displayLang ){
	if ($.settings.subscribe != undefined && $.settings.subscribe.pms != undefined) {

		var pmsInfos = null;

		// Depending on portal configuration, select package or option => works for both 5.1 and 5.2 versions
		if ($.settings.subscribe.pms.package != undefined) {
			 var pmsInfos = $.settings.subscribe.pms.package;
		}
		else if ($.settings.subscribe.pms.option != undefined) {
			 var pmsInfos = $.settings.subscribe.pms.option;
		}
		else {
			return;
		}

		if (displayLang == undefined) { // No displayLang given, find user selected language, else default portal language else default package language
			if ($.settings != undefined && $.settings.user != undefined && $.settings.user.lang != undefined) {
				displayLang = $.settings.user.lang;
			}
		}
		// Update describe block
		if ($('form[name="pmsPaymentForm"] select[name="select_package"]').val() == "") {
			$('#pmsPaymentForm_explain_text').show();
			$('#pmsPaymentForm_package_description_explain').show();
			$('#pmsPaymentForm_package_description_value').html("");
		}
		else {
			$(pmsInfos).each(function () {
				var package = $(this)[0];
				if (package.name == $('form[name="pmsPaymentForm"] select[name="select_package"]').val()) {
					var describe;
					if (package[displayLang] != undefined) {
						describe = package[displayLang].description;
					}
					else if ($.settings != undefined && $.settings.lang != undefined && $.settings.lang.defaultLang != undefined && package[$.settings.lang.defaultLang] != undefined) {
						describe = package[$.settings.lang.defaultLang].description;
					}
					else if (package[package.defaultLang] != undefined) {
						describe = package[package.defaultLang].description;
					}
					else {
						describe = getTextTranslation('accountRefillForm_no_description');
					}

					if (describe == undefined || describe == null) {
						describe = getTextTranslation('accountRefillForm_no_description');
					}

					$('#pmsPaymentForm_explain_text').hide();
					$('#pmsPaymentForm_package_description_explain').hide();
					$('#pmsPaymentForm_package_description_value').html(describe);
				}
			});
		}
	}
}

function pmsPaymentForm_options_describe() {

	var displayLang = $.settings.user.lang;
	var pmsInfos = $.settings.subscribe.pms.refill;
	var package = null;
	var describe;
	var text;
	var currencyLanguage;
	$('#pmsPaymentForm_select_package_text').text(getTextTranslation('accountRefillForm_option_buyed_text'));
	$('#pmsPaymentForm_title_text').text(getTextTranslation('pmsOptionPaymentForm_title_text'));
	$('#pmsPaymentForm_explain_text').text(getTextTranslation('pmsOptionPaymentForm_refill_text'));
	$('#pmsPaymentForm_package_description_explain').text(getTextTranslation('pmsOptionPaymentForm_package_description_explain'));
	$('#pmsPaymentForm_package_description_text').text(getTextTranslation('pmsOptionPaymentForm_package_description_text'));

	$(pmsInfos).each(function () {
		var package = $(this)[0];

		// if (package.name == $('form[name="pmsPaymentForm"] select[name="select_package"]').val()) {
		if (package.name == $.settings.payment.package) {

			if (package[displayLang] != undefined) {
				text             = package[displayLang].text;
				currencyLanguage = displayLang;
				describe         = package[displayLang].description;
			}
			else if ($.settings != undefined && $.settings.lang != undefined && $.settings.lang.defaultLang != undefined && package[$.settings.lang.defaultLang] != undefined) {
				text             = package[$.settings.lang.defaultLang].text;
				currencyLanguage = $.settings.lang.defaultLang;
				describe         = package[$.settings.lang.defaultLang].description;
			}
			else if (package[package.defaultLang] != undefined) {
				text             = package[package.defaultLang].text;
				currencyLanguage = package.defaultLang;
				describe         = package[package.defaultLang].description;
			}
			else {
				text             = "";
				currencyLanguage = package.defaultLang;
			}

			if (describe == undefined || describe == null) {
				describe = getTextTranslation('accountRefillForm_no_description');
			}

			// Add price
			if (package['currency'] == "free") {
				text += "&nbsp;" + "(" + getGenericTranslation('free_package', currencyLanguage) + ")";
			}
			else {
				text += "&nbsp;" + "(" + package['price'] + "&nbsp;" + package['currency'] + ")";
			}
			$('#pmsPaymentForm_explain_text').hide();
			$('#pmsPaymentForm_package_description_explain').hide();
			$('#pms_select_list').hide();
			$('#pmsPaymentForm_package_description_value').html(describe);
			$('#pmsPaymentForm_payment_detail_value').html(text);
		}
	});

	if($.settings.error == undefined)
	{
		$('form[name="pmsRedirectForm"]').show();
	}
}

/*****************************************************************************/
/****              PPS Subscription Form JavaScript functions             ****/
/*****************************************************************************/

/** This function is triggered when the page is loaded
 */
$(document).ready(function (){

    /** Inputs triggers
     */
// 	$('form[name=ppsSubscriptionForm] input[name=scratch_code]').change(function() {
// 		///
// 	});
// 	
// 	$('form[name=ppsSubscriptionForm] input[name=captcha_code]').change(function() {
// 		///
// 	});
// 	
// 	$('form[name=ppsSubscriptionForm] input[name=policy_accept]').change(function() {
// 		///
// 	});

    /** Buttons triggers
     */
    $('#ppsSubscriptionForm_connect_button').click(function (){
        ppsSubscriptionFormSubscribe();
    });

    /** Form triggers
     */
    $('form[name="ppsSubscriptionForm"]').submit(function (){
        return false;
    });
});


/** Configure ppsSubscriptionForm depending on settings
 */
function ppsSubscriptionForm_configure(){

    // Configure display
    if ( $.settings.subscribe != undefined && $.settings.subscribe.pps != undefined ) {
        // Add captcha source to avoid generating this if PPS mode not enable
        $('#ppsSubscriptionForm_captcha_code_img').attr("src", "/_INC/gen_random_img.php?#");
        $('#ppsSubscriptionForm_captcha_code_img').fadeIn();

        if ( $.settings.subscribe.pps.policy != undefined && $.settings.subscribe.pps.policy.display == true ) {
            ppsSubscriptionForm_policy_configure();
        }
        else {
            $('#ppsSubscriptionForm_policy_block').remove();
        }
    }
    else {
        $('form[name="ppsSubscriptionForm"]').remove();
    }
}

/** Configure ppsSubscriptionForm_policy_block
 * @param string lang - The language whish to display the policy
 */
function ppsSubscriptionForm_policy_configure( displayLang ){

    if ( $.settings.subscribe != undefined && $.settings.subscribe.pps != undefined && $.settings.subscribe.pps.policy != undefined ) {
        var policy = extractPolicyText($.settings.subscribe.pps, displayLang);
        $('#ppsSubscriptionForm_policy_text').html(policy);
    }
    /* TODO configure back_action portal_api call and add GUI in template html if we need support other portals when PPS is set */
}

/** Display ppsSubscriptionForm depending on settings
 * Can be overwritten by state
 * @param boolean state - Indicate if the form must be displayed or not
 */
function ppsSubscriptionForm_display( state ){

    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }
    else if ( ($.settings.step != undefined && $.settings.step == "SUBSCRIBE") && ($.settings.type != undefined && $.settings.type == "PPS") ) {
        display = true;
    }

    if ( display == true ) {
        $('form[name="ppsSubscriptionForm"]').show();
    }
    else {
        $('form[name="ppsSubscriptionForm"]').hide();
        ppsSubscriptionForm_empty();
    }
}

/** Empty ppsSubscriptionForm
 */
function ppsSubscriptionForm_empty(){
    $('form[name="ppsSubscriptionForm"] input[type="text"]').each(function (){
        $(this).val('');
    });
    $('form[name="ppsSubscriptionForm"] input[type="checkbox"]').each(function (){
        $(this).attr("checked", false);
    });
}

/** Enable waiting mode on ppsSubscriptionForm
 */
function ppsSubscriptionFormWaiting( state ){
    switch ( state ) {
        case true:
            $('#ppsSubscriptionForm_connect_button').attr("disabled", true);
            $('body').toggleClass("cursor-wait");
            break;
        case false:
            $('#ppsSubscriptionForm_connect_button').attr("disabled", false);
            $('body').toggleClass("cursor-wait");
            break;
    }
}

/** Executed when button is clicked
 */
function ppsSubscriptionFormSubscribe(){

    var params = new Object();
    // Mandatory parameters
    params.type = "pps";
    params.scratchCode = $('form[name="ppsSubscriptionForm"] input[name="scratch_code"]').val();
    params.captchaCode = $('form[name="ppsSubscriptionForm"] input[name="captcha_code"]').val();
    params.policyAccept = $('#ppsSubscriptionForm_policy_accept').is(':checked');

    if ( ($.settings.user != undefined) && ($.settings.user.securePwd != undefined) ) {
        params.securePwd = $.settings.user.securePwd.value;
    }

    var callbacks = new Object();
    callbacks.beforeSend = function (){
        ppsSubscriptionFormWaiting(true);
    };
    callbacks.success = function (){
        ppsSubscriptionFormSubscribeCallback();
    };
    callbacks.complete = function (){
        ppsSubscriptionFormWaiting(false);
    };

    subscribe(callbacks, params);
}

/** Executed on return of ppsSubscriptionFormSubscribe function
 */
function ppsSubscriptionFormSubscribeCallback(){

    displayErrorInfo();
    if ( $.settings.error == undefined ) {
        var params = new Object();
        params.login = $.settings.user.login;
        params.password = $.settings.user.password;
        params.policyAccept = $('#ppsSubscriptionForm_policy_accept').is(':checked');

        if ( ($.settings.user != undefined) && ($.settings.user.securePwd != undefined) ) {
            params.securePwd = $.settings.user.securePwd.value;
        }

        // We authenticate the user
        var callbacks = new Object();
        callbacks.beforeSend = function (){
            ppsSubscriptionFormWaiting(true);
        };
        callbacks.success = function (){
            ppsSubscriptionFormConnectCallback();
        };
        callbacks.complete = function (){
            ppsSubscriptionFormWaiting(false);
        };

        authenticate(callbacks, params);
    }
}

/** Executed on ppsSubscriptionFormSubscribeCallback function
 */
function ppsSubscriptionFormConnectCallback(){

    displayErrorInfo();
    if ( $.settings.error == undefined ) {
        displayStep();

        if ( $.settings.step == "FEEDBACK" ) {
            // We must refresh the user connection
            refreshObj.login = $.settings.user.login.value;
            refreshObj.refreshInterval = ($.settings.refreshInterval == undefined) ? 50000 : $.settings.refreshInterval;

            if ( ($.settings.user != undefined) && ($.settings.user.securePwd != undefined) ) {
                refreshObj.securePwd = $.settings.user.securePwd.value;
            }
            startRefresh();
        }
    }
}

/*****************************************************************************/
/****            Subscription Form JavaScript functions            ****/
/*****************************************************************************/

/** Listen to modified element
 */
var subscriptionForm_changed = new Object();

/** This function is triggered when the page is loaded
 */
$(document).ready(function () {
	$('#common_subscription_fields').prependTo('#reserved_block');
	$('#common_subscription_fields').hide();

	$('#subscriptionForm_phone_prefix_value').focus(function () {
		subscriptionForm_modifyEvent('focus', $(this));
		subscriptionForm_phoneHelpBlock_display(true);
	});

	$('#subscriptionForm_phone_prefix_value').blur(function () {
		subscriptionForm_modifyEvent('blur', $(this));
	});

	$('#subscriptionForm_phone_phone_value').focus(function () {
		subscriptionForm_modifyEvent('focus', $(this));
		subscriptionForm_phoneHelpBlock_display(true);
	});

	$('#subscriptionForm_phone_phone_value').blur(function () {
		subscriptionForm_modifyEvent('blur', $(this));
	});

	$('#subscriptionForm_phone_help_link').click(function () {
		subscriptionForm_phoneHelpBlock_display();
	});
});

/** Configure subscriptionForm common fields depending on settings
 */
function subscriptionForm_configure(mode) {
	var subscription_mode = null;
	var mandatory_bool = false;
	var policyNew = ($.settings.private_policy != undefined) ? $.settings.private_policy[0] : undefined;
	try {
		subscription_mode = eval('$.settings.subscribe.' + mode);
	} catch (ex) {
		subscription_mode = null;
	}

	if (subscription_mode == undefined || subscription_mode == null) {
		return;
	}
	// Configure login
	if (subscription_mode.userLogin != undefined && subscription_mode.userLogin.display == true) {
		if (subscription_mode.userLogin.mandatory) {
			mandatory_bool = true;
			$('#subscriptionForm_user_login_state').css("visibility", "visible");
		}
	} else {
		$('#subscriptionForm_user_login_block').hide();
	}

	// Configure password
	if (subscription_mode.userPassword != undefined && subscription_mode.userPassword.display == true) {
		if (subscription_mode.userPassword.mandatory) {
			mandatory_bool = true;
			$('#subscriptionForm_user_password_state').css("visibility", "visible");
		}
	} else {
		$('#subscriptionForm_user_password_block').hide();
		$('#subscriptionForm_user_password_confirm_block').hide();
	}

	// Configure last name
	if (subscription_mode.lastName != undefined && subscription_mode.lastName.display == true) {
		if (subscription_mode.lastName.mandatory) {
			mandatory_bool = true;
			$('#subscriptionForm_last_name_state').css("visibility", "visible");
		}
	} else {
		$('#subscriptionForm_last_name_block').remove();
	}

	// Configure first name
	if (subscription_mode.firstName != undefined && subscription_mode.firstName.display == true) {
		if (subscription_mode.firstName.mandatory) {
			mandatory_bool = true;
			$('#subscriptionForm_first_name_state').css("visibility", "visible");
		}
	} else {
		$('#subscriptionForm_first_name_block').remove();
	}

	// Configure gender
	if (subscription_mode.gender != undefined && subscription_mode.gender.display == true) {
		if (subscription_mode.gender.mandatory) {
			mandatory_bool = true;
			$('#subscriptionForm_gender_state').css("visibility", "visible");
		}
	} else {
		$('#subscriptionForm_gender_block').remove();
	}

	// Configure birth date
	if (subscription_mode.birthDate != undefined && subscription_mode.birthDate.display == true) {
		if (subscription_mode.birthDate.mandatory) {
			mandatory_bool = true;
			$('#subscriptionForm_birth_date_state').css("visibility", "visible");
		}
	} else {
		$('#subscriptionForm_birth_date_block').remove();
	}

	// Configure user languages
	if (subscription_mode.userLanguage != undefined && subscription_mode.userLanguage.display == true) {
		if (subscription_mode.userLanguage.mandatory) {
			mandatory_bool = true;
			$('#subscriptionForm_user_language_state').css("visibility", "visible");
		}
	} else {
		$('#subscriptionForm_user_language_block').remove();
	}

	// Configure interests
	if (subscription_mode.interests != undefined && subscription_mode.interests.display == true) {
		if (subscription_mode.interests.mandatory) {
			mandatory_bool = true;
			$('#subscriptionForm_interests_state').css("visibility", "visible");
		}
	} else {
		$('#subscriptionForm_interests_block').remove();
	}

	// Configure email
	if (subscription_mode.email != undefined && subscription_mode.email.display == true) {
		if (subscription_mode.email.mandatory) {
			mandatory_bool = true;
			$('#subscriptionForm_email_state').css("visibility", "visible");
		}
	} else {
		$('#subscriptionForm_email_block').hide();
	}

	// Configure phone
	if (subscription_mode.phone != undefined && subscription_mode.phone.display == true) {
		if (subscription_mode.phone.mandatory) {
			mandatory_bool = true;
			$('#subscriptionForm_phone_state').css("visibility", "visible");
		}
		// Configure help block
		subscriptionForm_phoneHelpBlock_configure();
	} else {
		$('#subscriptionForm_phone_block').hide();
		$('#subscriptionForm_phone_help_block').hide();
	}

	// Configure Organizational unit name "Company name"
	if (subscription_mode.organizationalUnitName != undefined && subscription_mode.organizationalUnitName.display == true) {
		if (subscription_mode.organizationalUnitName.mandatory) {
			mandatory_bool = true;
			$('#subscriptionForm_organizational_unit_name_state').css("visibility", "visible");
		}
	} else {
		$('#subscriptionForm_organizational_unit_name_block').remove();
	}

	// Configure Postal address
	if (subscription_mode.postalAddress != undefined && subscription_mode.postalAddress.display == true) {
		if (subscription_mode.postalAddress.mandatory) {
			mandatory_bool = true;
			$('#subscriptionForm_postal_address_state').css("visibility", "visible");
			$('#subscriptionForm_postal_code_state').css("visibility", "visible");
			$('#subscriptionForm_postal_locality_name_state').css("visibility", "visible");
			$('#subscriptionForm_postal_postoffice_box_state').css("visibility", "visible");
			$('#subscriptionForm_postal_state_or_province_name_state').css("visibility", "visible");
			$('#subscriptionForm_postal_country_name_state').css("visibility", "visible");
		}
	} else {
		$('#subscriptionForm_postal_address_block').remove();
	}

	// Configure personal fields
	if (subscription_mode.personalField_1 != undefined && subscription_mode.personalField_1.display == true) {
		if (subscription_mode.personalField_1.mandatory) {
			mandatory_bool = true;
			$('#subscriptionForm_personal_field_1_state').css("visibility", "visible");
		}
	} else {
		$('#subscriptionForm_personal_field_1_block').remove();
	}
	if (subscription_mode.personalField_2 != undefined && subscription_mode.personalField_2.display == true) {
		if (subscription_mode.personalField_2.mandatory) {
			mandatory_bool = true;
			$('#subscriptionForm_personal_field_2_state').css("visibility", "visible");
		}
	} else {
		$('#subscriptionForm_personal_field_2_block').remove();
	}
	if (subscription_mode.personalField_3 != undefined && subscription_mode.personalField_3.display == true) {
		if (subscription_mode.personalField_3.mandatory) {
			mandatory_bool = true;
			$('#subscriptionForm_personal_field_3_state').css("visibility", "visible");
		}
	} else {
		$('#subscriptionForm_personal_field_3_block').remove();
	}

	// Configure sponsoring
	if (subscription_mode.sponsoringEnabled == undefined || subscription_mode.sponsoringEnabled != true) {
		$('#subscriptionForm_sponsor_email_block').hide();
		$('#' + mode + 'SubscriptionForm_explain_sponsoring_text').hide();
	}
	else {
		// when sponsoring is enabled, this field is always mandatory
		$('#subscriptionForm_sponsor_email_state').css("visibility", "visible");
	}
	// Configure optin
	if ($.settings.private_policy.display == true && policyNew.mandatory == true) {
		mandatory_bool = true;
	}

	// Configure bool for the general condition
	if (mandatory_bool == true) {
		$('#subscriptionForm_fields_state_block').css("display", "block");
	}
}

function subscriptionForm_customFields_configure(displayLang, mode) {
	var subscription_mode = null;
	try {
		subscription_mode = eval('$.settings.subscribe.' + mode);
	}
	catch (ex) {
		subscription_mode = null;
	}
	if (subscription_mode == undefined || subscription_mode == null) {
		return;
	}
	var field_names = new Array("personalField_1", "personalField_2", "personalField_3");
	var itt = 1;
	if (displayLang == undefined || displayLang == null) {
		displayLang = getUserLanguage_default();
	}
	for (key in field_names) {
		var field_name = field_names[key];
		if (subscription_mode[field_name] != undefined && subscription_mode[field_name].display == true) {
			if (subscription_mode[field_name].labels[displayLang] != undefined) {
				$("#subscriptionForm_personal_field_" + itt + "_text").html(subscription_mode[field_name].labels[displayLang]);
			}
			else if (subscription_mode[field_name].labels[$.settings.lang.defaultLang] != undefined) {
				$("#subscriptionForm_personal_field_" + itt + "_text").html(subscription_mode[field_name].labels[$.settings.lang.defaultLang]);
			}
			else {
				$("#subscriptionForm_personal_field_" + itt + "_text").html(subscription_mode[field_name].labels[$.settings.lang.customFieldsDefaultLang]);
			}
		}
		itt++;
	}
}

/** Empty subscriptionForm
 */
function subscriptionForm_empty(mode) {
	if (mode == undefined || mode == null) {
		return;
	}

	$('form[name="' + mode + 'SubscriptionForm"] input[type="text"]').each(function () {
		$(this).val('');
	});
	$('form[name="' + mode + 'SubscriptionForm"] input[type="password"]').each(function () {
		$(this).val('');
	});
	$('form[name="' + mode + 'SubscriptionForm"] input[type="checkbox"]').each(function () {
		$(this).attr("checked", false);
	});
	$('form[name="' + mode + 'SubscriptionForm"] input[type="radio"]').each(function () {
		$(this).attr("checked", false);
	});
	$('form[name="' + mode + 'SubscriptionForm"] select > option').each(function () {
		$(this).attr("selected", false);
	});
	// Adding examples values
	subscriptionForm_phoneHelpBlock_configure();

	subscriptionForm_changed['prefix'] = false;
	subscriptionForm_changed['phone'] = false;
	subscriptionForm_changed['email'] = false;
}

/** Display subscriptionForm_phone_help_block when help link is clicked
 * @param boolean state - Indicate if the block must be displayed or not
 */
function subscriptionForm_phoneHelpBlock_display(state) {

	var display = false;
	if ((state == true) || (state == false)) {
		display = state;
	} else if ($('#subscriptionForm_phone_help_block').is(':hidden') == true) {
		display = true;
	}

	if (display == true) {
		$('#subscriptionForm_phone_help_block').show();
	} else {
		$('#subscriptionForm_phone_help_block').hide();
	}
}

/*****************************************************************************/

/** Manage the modification of inputs and the help texts present on them
 * @param string type - The type on the event (focus | blur )
 * @param element element - The DOM element afected by the modification
 */
function subscriptionForm_modifyEvent(type, element) {
	switch (type) {
		case 'focus':
			if (subscriptionForm_changed[element.attr("name")] != true) {
				element.val("");
			}
			break;

		case 'blur':
			if (element.val() == "") {
				element.val(getInputTranslation(element.attr("id")));
				subscriptionForm_changed[element.attr("name")] = false;
			} else {
				subscriptionForm_changed[element.attr("name")] = true;
			}
			break;
	}
}

/** Display subscriptionForm_passwordHelpBlock_display when help link is clicked
 * @param boolean state - Indicate if the block must be displayed or not
 */
function subscriptionForm_passwordHelpBlock_display(state, displayLang, mode) {
	var display = false;
	if ((state == true) || (state == false)) {
		display = state;
	} else if ($('#subscriptionForm_password_help_block').is(':hidden') == true) {
		display = true;
	}

	if (display == true) {
		if (translationsAreLoaded == true) {
			subscriptionForm_passwordHelpBlock_configure(displayLang, mode);
		}
		$('#subscriptionForm_password_help_block').show();
	} else {
		$('#subscriptionForm_password_help_block').hide();
	}
}

/** Configure subscriptionForm_password_help_block
 * @param string displayLang - The language whish to display the content
 */
function subscriptionForm_passwordHelpBlock_configure(displayLang, mode) {
	var pwdConstraint = null;
	try {
		pwdConstraint = eval('$.settings.subscribe.' + mode + '.pwdConstraint');
	} catch (ex) {
		pwdConstraint = null;
	}
	if (pwdConstraint != undefined && pwdConstraint != null) {
		if ($('#subscriptionForm_password_help_list').children().length > 1) {
			$('#subscriptionForm_password_help_list li').not(":first").remove();
		}
		/* Update the content of the help box to display to the user the password policy in use for his profile */
		if (displayLang == undefined || displayLang == null) {
			displayLang = getUserLanguage_default();
		}
		var constraintValues = new Array("minLength", "maxLength");
		for (key in constraintValues) {
			var val = constraintValues[key];
			var line = $('#subscriptionForm_password_help_list li:first').clone();
			line.toggle();
			line.text($.sprintf(getInputTranslation("subscriptionForm_password_help_" + val, displayLang), pwdConstraint.value[val]));
			$('#subscriptionForm_password_help_list').append(line);
		}
		for (key in pwdConstraint.value.characterSet) {
			var set = pwdConstraint.value.characterSet[key];
			if (set.quota > 0) {
				var line = $('#subscriptionForm_password_help_list li:first').clone();
				line.toggle();
				line.text($.sprintf(getInputTranslation("subscriptionForm_password_help_character_set_text", displayLang), set.quota, set.set.join("")));
				$('#subscriptionForm_password_help_list').append(line);
			}
		}
	}
}

function subscriptionForm_commonFields_display(mode) {
	if (mode == undefined || mode == null || mode == '') {
		return;
	}
	// Global
	$('#common_subscription_fields').prependTo('#' + mode + '_common_subscription_fields');
	$('#common_subscription_fields').show();

	// Login in case of sms mode or mail mode
	var login = null;
	try {
		login = eval('$.settings.subscribe.' + mode + '.userLogin');
	} catch (ex) {
		login = null;
	}
	if (mode == 'sms' || mode == 'mail' || login == null || !login.display) {
		$('#subscriptionForm_user_login_block').hide();
	} else {
		$('#subscriptionForm_user_login_block').show();
		$('#subscriptionForm_user_login_state').css("visibility", login.mandatory ? "visible" : "hidden");
	}

	// Password
	var pwd = null;
	try {
		pwd = eval('$.settings.subscribe.' + mode + '.userPassword');
	} catch (ex) {
		pwd = null;
	}
	if (mode != 'mail' && mode != 'sms' && mode != 'print' && pwd != null && pwd.display == true) {
		$('#subscriptionForm_user_password_block').show();
		$('#subscriptionForm_user_password_confirm_block').show();
		$('#subscriptionForm_user_password_state').css("visibility", pwd.mandatory ? "visible" : "hidden");
		$('#subscriptionForm_user_password_confirm_state').css("visibility", pwd.mandatory ? "visible" : "hidden");
	} else {
		$('#subscriptionForm_user_password_block').hide();
		$('#subscriptionForm_user_password_confirm_block').hide();
	}

	// Password help link
	var pwdConstraint = null;
	try {
		pwdConstraint = eval('$.settings.subscribe.' + mode + '.pwdConstraint');
	} catch (ex) {
		pwdConstraint = null;
	}
	if (pwdConstraint == undefined || pwdConstraint == null) {
		$('#subscriptionForm_password_help_link').hide();
	} else {
		$('#subscriptionForm_password_help_link').show();
		$('#subscriptionForm_password_help_link').unbind('click').click(function () {
			subscriptionForm_passwordHelpBlock_display(undefined, undefined, mode);
		});
	}

	// Email in case of mail mode
	var email = null;
	try {
		email = eval('$.settings.subscribe.' + mode + '.email');
	} catch (ex) {
		email = null;
	}
	if (mode == 'mail') {
		$('#subscriptionForm_email_block').show();
		$('#subscriptionForm_email_state').css("visibility", "visible");
	} else if (email != null && email.display == true) {
		$('#subscriptionForm_email_block').show();
		$('#subscriptionForm_email_state').css("visibility", email.mandatory ? "visible" : "hidden");
	} else {
		$('#subscriptionForm_email_block').hide();
	}

	// Phone in case of sms mode
	var phone = null;
	try {
		phone = eval('$.settings.subscribe.' + mode + '.phone');
	} catch (ex) {
		phone = null;
	}
	if (mode == 'sms') {
		$('#subscriptionForm_phone_block').show();
		$('#subscriptionForm_phone_help_block').show();
		$('#subscriptionForm_phone_state').css("visibility", "visible");
	} else if (phone != null && phone.display == true) {
		$('#subscriptionForm_phone_block').show();
		$('#subscriptionForm_phone_help_block').show();
		$('#subscriptionForm_phone_state').css("visibility", phone.mandatory ? "visible" : "hidden");
	} else {
		$('#subscriptionForm_phone_block').hide();
		$('#subscriptionForm_phone_help_block').hide();
	}

	// Custom fields
	subscriptionForm_customFields_configure(undefined, mode);

	// Policy
	var policy = eval('$.settings.private_policy');
	if (policy == undefined || policy == null || !policy.display) {
		$('#subscriptionForm_policy_block').remove();
	} else {
		subscriptionForm_policy_configure(undefined, mode);
	}

	// Sponsoring
	var sponsoringEnabled = null;
	try {
		sponsoringEnabled = eval('$.settings.subscribe.' + mode + '.sponsoringEnabled');
	} catch (ex) {
		sponsoringEnabled = null;
	}
	if (sponsoringEnabled == undefined || sponsoringEnabled == null || !sponsoringEnabled) {
		$('#subscriptionForm_sponsor_email_block').hide();
		$('#' + mode + 'SubscriptionForm_explain_sponsoring_text').hide();
	} else {
		$('#subscriptionForm_sponsor_email_block').show();
		$('#' + mode + 'SubscriptionForm_explain_sponsoring_text').show();
	}
}

function subscriptionForm_policy_configure(displayLang, mode) {

	var policy = null;
	try {
		policy = eval('$.settings.private_Policy');
	}
	catch (ex) {
		policy = null;
	}
	if (policy == undefined || policy == null) {
		return;
	}
	var policyWrapper = new Object();
	policyWrapper.policy = policy;
	if (displayLang == undefined || displayLang == null) {
		displayLang = getUserLanguage_default();
	}
	$('#subscriptionForm_policy_text').html(extractPolicyText(policyWrapper, displayLang));
	$('#subscriptionForm_policy_resume').html(extractPolicyResume(policyWrapper, displayLang));
}

/** Manage the modification of inputs and the help texts present on them
 * @param string type - The type on the event (focus | blur )
 * @param element element - The DOM element afected by the modification
 */
function subscriptionForm_modifyEvent(type, element) {
	switch (type) {
		case 'focus':
			if (subscriptionForm_changed[element.attr("name")] != true) {
				element.val("");
			}
			break;

		case 'blur':
			if (element.val() == "") {
				element.val(getInputTranslation(element.attr("id")));
				subscriptionForm_changed[element.attr("name")] = false;
			} else {
				subscriptionForm_changed[element.attr("name")] = true;
			}
			break;
	}
}

/** Configure subscriptionForm_phone_block
 * @param string displayLang - The language whish to display the content
 */
function subscriptionForm_phoneHelpBlock_configure(displayLang) {
	if (subscriptionForm_changed['prefix'] != true) {
		$('#subscriptionForm_phone_prefix_value').val(getInputTranslation("subscriptionForm_phone_prefix_value", displayLang));
	}
	if (subscriptionForm_changed['phone'] != true) {
		$('#subscriptionForm_phone_phone_value').val(getInputTranslation("subscriptionForm_phone_phone_value", displayLang));
	}
	$('#subscriptionForm_phone_help_prefix_example_value').val(getInputTranslation("subscriptionForm_phone_help_prefix_example_value", displayLang));
	$('#subscriptionForm_phone_help_phone_example_value').val(getInputTranslation("subscriptionForm_phone_help_phone_example_value", displayLang));
}

function subscriptionFormSubscribe(mode) {
	var params = new Object();
	if (mode == undefined || mode == null) {
		return params;
	}
	// Mandatory parameters
	params.type = mode;
	params.login = $('#subscriptionForm_user_login').val();
	params.password = $('#subscriptionForm_user_password').val();
	params.passwordConfirm = $('#subscriptionForm_user_password_confirm').val();
	params.lastName = $('#subscriptionForm_last_name').val();
	params.firstName = $('#subscriptionForm_first_name').val();
	params.emailAddress = $('#subscriptionForm_email').val();
	params.prefix = (subscriptionForm_changed['prefix'] == true) ? $('#subscriptionForm_phone_prefix_value').val() : "";
	params.phone = (subscriptionForm_changed['phone'] == true) ? $('#subscriptionForm_phone_phone_value').val() : "";
	params.organizationalUnitName = $('#subscriptionForm_organizational_unit_name').val();
	params.postalAddress = $('#subscriptionForm_postal_address').val();
	params.postalCode = $('#subscriptionForm_postal_code').val();
	params.postalLocalityName = $('#subscriptionForm_postal_locality_name').val();
	params.postalPostofficeBox = $('#subscriptionForm_postal_postoffice_box').val();
	params.postalStateOrProvinceName = $('#subscriptionForm_postal_state_or_province_name').val();
	params.postalCountryName = $('#subscriptionForm_postal_country_name').val();
	params.gender = $('#subscriptionForm_gender_m').is(':checked') ? $('#subscriptionForm_gender_m').val() : $('#subscriptionForm_gender_f').is(':checked') ? $('#subscriptionForm_gender_f').val() : "";
	params.birthDate = $('#subscriptionForm_birth_date').val();
	params.userLanguage = $('#subscriptionForm_user_language').val();
	params.interests = ($('#subscriptionForm_interests').val() != null) ? $('#subscriptionForm_interests').val() : "";

	//Custom fields
	params.personalField_1 = ($('#subscriptionForm_personal_field_1').val() != "") ? $('#subscriptionForm_personal_field_1').val() : undefined;
	params.personalField_2 = ($('#subscriptionForm_personal_field_2').val() != "") ? $('#subscriptionForm_personal_field_2').val() : undefined;
	params.personalField_3 = ($('#subscriptionForm_personal_field_3').val() != "") ? $('#subscriptionForm_personal_field_3').val() : undefined;

	// Sponsoring
	params.sponsorEmail = ($('#subscriptionForm_sponsor_email').val() != "") ? $('#subscriptionForm_sponsor_email').val() : undefined;

	params.privatePolicyAccept = $('#subscriptionForm_privatePolicy_accept').is(':checked');
	if (($.settings.user != undefined) && ($.settings.user.securePwd != undefined)) {
		params.securePwd = $.settings.user.securePwd.value;
	}
	return params;
}

function getUserLanguage_default() {
	var userLang = eval('$.settings.user.lang');
	if (userLang != null && userLang != undefined) {
		return userLang;
	}
	var defaultLang = eval('$.settings.lang.defaultLang');
	if (defaultLang != null && defaultLang != undefined) {
		return defaultLang;
	}
}

/*****************************************************************************/
/****                   Pre portal JavaScript functions                   ****/
/*****************************************************************************/

$(document).ready(function () {
	$('#pre_portal_close_cna_link').click(function () {
		pre_portal_close_cna();
	});
	$('#pre_portal_step1_pass_link').click(function () {
		pre_portal_switch_step(1, 4);
	});
});

function pre_portal_wait() {
	if (!$('body').hasClass('cursor-wait')) {
		$('body').toggleClass('cursor-wait');
	}
}

function pre_portal_fake_click() {
	// we don't care about the current anchor status, we just want to simulate a url change, even in anchor part
	window.location.href += '#fake_anchor_change1';
	setTimeout(function() {
		window.location.href += '#fake_anchor_change2';
		// still wait a moment, then display a "try again" message
		setTimeout(function() {
			if ($('body').hasClass('cursor-wait')) {
				$('body').toggleClass('cursor-wait');
			}
			$.settings.error = {
					code: 'error_pre_portal_try_again_android8',
			};
			displayErrorInfo();
		}, 3000);
	}, 3000);
}

function pre_portal_add_success_trigger(struct_ajax) {
	// only simulate fake click at the first time
	if (!$('body').hasClass('cursor-wait')) {
		struct_ajax.success = pre_portal_fake_click;
	}
}

function pre_portal_configure() {
	// use the domain sent from controller
	if ($.settings.pre_portal && $.settings.pre_portal.domain) {
		$('span#pre_portal_domain').text($.settings.pre_portal.domain);
	}
	$('span#pre_portal_domain').click(function() {
		var copy_textarea = document.createElement('textarea');
		$(copy_textarea).text($('span#pre_portal_domain').text())
				.attr('readonly', 'readonly')
				.css('position', 'absolute')
				.css('left', '-9999px');
		document.body.appendChild(copy_textarea);
		copy_textarea.select();
		document.execCommand('copy');
		document.body.removeChild(copy_textarea);
		$('span#pre_portal_domain_copied').fadeIn();
	});
}

function pre_portal_display(state) {
	var display = false;
	if ((state == true) || (state == false)) {
		display = state;
	}
	else if ($.settings.step == 'PRE_PORTAL') {
		display = true;
	}

	var pre_portal_div = $('div#pre_portal_block');
	if (display) {
		pre_portal_div.show();
	} else {
		pre_portal_div.hide();
	}
}

function pre_portal_switch_step(old_step, new_step) {
	var step_block_prefix = 'pre_portal_step';
	$('#' + step_block_prefix + old_step).hide();
	$('#' + step_block_prefix + new_step).show();
	var step_indicator_prefix = 'pre_portal_indicator_step';
	$('#' + step_indicator_prefix + old_step).removeClass('active');
	$('#' + step_indicator_prefix + new_step).addClass('active');
	$('span#pre_portal_domain_copied').hide();
}

function pre_portal_go_next_step(current_step) {
	pre_portal_switch_step(current_step, current_step + 1);
}

function pre_portal_go_back_step(current_step) {
	pre_portal_switch_step(current_step, current_step - 1);
}

function pre_portal_close_cna() {
	if (is_in_ucopia_oob()) {
		var pre_portal_oob_ajax = {
				type: 'POST',
				url: $.settings.user.satellite_URL,
				data: {
					action: 'pre_portal_start',
				},
				beforeSend: pre_portal_wait,
				error: function () {
					$.settings.error = {
						code: 'error_pre_portal_internal',
					};
					displayErrorInfo();
					return;
				}
		};
		pre_portal_add_success_trigger(pre_portal_oob_ajax);
		$.ajax(pre_portal_oob_ajax);
	}
	else {
		var request = new Object();
		request.action = 'pre_portal_start';
		var callbacks = new Object();
		callbacks.beforeSend = pre_portal_wait;
		pre_portal_add_success_trigger(callbacks);
		$.portal_api('action', request, callbacks);
	}
}

/*****************************************************************************/
/***** Javascript functions used by informative widget                   *****/
/***** ***** ***** ***** ***** ***** ***** ***** ***** ***** ***** ***** *****/


/** This function is triggered when the page is loaded
 */
$(document).ready(function() {
	$('#informativeWidget_connect_button').click(function() {
		informativeWidgetConnect();
	});
});

/** Replace keywords by user content
 * If text is empty the whole keyword section delimited by section delimiters is removed
 * - section delimiters look like this %<keyword>_B% and %<keyword>_E%
 * @param keyword - The keyword to be replaced (ex: firstname)      [REQUIRED]
 * @param content - The html content where keyword must be replaced [REQUIRED]
 * @param text    - The text used instead of the keyword            [REQUIRED]
 */
function informativeWidget_replace(keyword, content, text)
{
	var return_content = content;
	var regexp;
	if (text != "") // Replace keyword by text and remove keyword section delimiters
	{
		regexp = new RegExp("%" + keyword + "%", "g");
		return_content = return_content.replace(regexp, text);
		regexp = new RegExp("%" + keyword + "_B%", "g");
		return_content = return_content.replace(regexp, "");
		regexp = new RegExp("%" + keyword + "_E%", "g");
		return_content = return_content.replace(regexp, "");
	}
	else // Remove the whole keyword section
	{
		regexp = new RegExp("%" + keyword + "_B%.*%" + keyword + "_E%", "g");
		return_content = return_content.replace(regexp, "");
	}
	
	return return_content;
}

function informativeWidget_configure()
{
	// Modifying keywork content
	if ($.settings != undefined && $.settings.informativeWidget != undefined)
	{
		var html_content = "";
		var text = "";
		var validity;
		var hours, mins, seconds;
		var hours_label, mins_label, seconds_label;
		var reneweach;
		var timezoneLocalOffset = new Date();
		var informativeWidgetSettings = $.settings.informativeWidget;
		
		if ($.settings != undefined && $.settings.lang != undefined && $.settings.lang.displayLang != undefined)
		{
			for (lang_itt = 0; lang_itt < $.settings.lang.displayLang.length; lang_itt++)
			{
				var lang_value_itt = $.settings.lang.displayLang[lang_itt];
				html_content = $('#widget_informative_' + lang_value_itt).html();
				if (html_content === undefined || html_content == null) {
					html_content = ""; // Set default to empty string in case of empty DOM
				}
				// Replace %lastname%
				text = "";
				if (informativeWidgetSettings.lastName != undefined)
				{
					text = informativeWidgetSettings.lastName.value;
				}
				html_content = informativeWidget_replace("lastname", html_content, text);
				
				// Replace %firstname%
				text = "";
				if (informativeWidgetSettings.firstName != undefined)
				{
					text = informativeWidgetSettings.firstName.value;
				}
				html_content = informativeWidget_replace("firstname", html_content, text);
				
				// Replace %validity_stardate%
				text = "";
				if (informativeWidgetSettings.validity != undefined && informativeWidgetSettings.validity.startDate != undefined)
				{
					validity = new Date((parseInt(informativeWidgetSettings.validity.startDate.value) + parseInt(informativeWidgetSettings.timezoneOffset.value) + parseInt(timezoneLocalOffset.getTimezoneOffset()*60)) * 1000); // Must give date in milliseconds
					validity = explodeDate(validity);
					text = $.sprintf(getGenericTranslation('full-date-display', lang_value_itt), validity.year, validity.monthNumber, getGenericTranslation(validity.month, lang_value_itt), validity.dayNumber, getGenericTranslation(validity.day, lang_value_itt), validity.hours[24], validity.minutes, validity.hours[12], validity.hours['ext']);
				}
				html_content = informativeWidget_replace("validity_startdate", html_content, text);
				
				// Replace %validity_enddate%
				text = "";
				if (informativeWidgetSettings.validity != undefined && informativeWidgetSettings.validity.endDate != undefined)
				{
					validity = new Date((parseInt(informativeWidgetSettings.validity.endDate.value) + parseInt(informativeWidgetSettings.timezoneOffset.value) + parseInt(timezoneLocalOffset.getTimezoneOffset()*60)) * 1000); // Must give date in milliseconds
					validity = explodeDate(validity);
					text = $.sprintf(getGenericTranslation('full-date-display', lang_value_itt), validity.year, validity.monthNumber, getGenericTranslation(validity.month, lang_value_itt), validity.dayNumber, getGenericTranslation(validity.day, lang_value_itt), validity.hours[24], validity.minutes, validity.hours[12], validity.hours['ext']);
				}
				html_content = informativeWidget_replace("validity_enddate", html_content, text);
				
				text = "";
				if (informativeWidgetSettings.timeCredit != undefined)
				{
					hours = Math.floor(informativeWidgetSettings.timeCredit.value / 3600);
					mins = (informativeWidgetSettings.timeCredit.value - (hours * 3600)) / 60;
					hours_label = getGenericTranslation('hour', lang_value_itt, (hours > 1));
					mins_label = getGenericTranslation('minute', lang_value_itt, (mins > 1));
					reneweach = 0;
					if (informativeWidgetSettings.timeCredit.reneweach != undefined)
					{
						reneweach = informativeWidgetSettings.timeCredit.reneweach.value;
						text = getGenericTranslation('feedbackForm_time-credit-renew-each', lang_value_itt, (reneweach > 1));
					}
					else
					{
						text = getGenericTranslation('feedbackForm_time-credit', lang_value_itt);
					}
					text = $.sprintf(text, hours, hours_label, mins, mins_label, reneweach);
				}
				html_content = informativeWidget_replace("timecredit_available", html_content, text);
				
				text = "";
				if (informativeWidgetSettings.timeCredit != undefined && informativeWidgetSettings.timeCredit.remaining != undefined && informativeWidgetSettings.timeCredit.remaining.value > 0)
				{
					hours = Math.floor(informativeWidgetSettings.timeCredit.remaining.value / 3600);
					mins = Math.floor((informativeWidgetSettings.timeCredit.remaining.value - (hours * 3600)) / 60);
					seconds = informativeWidgetSettings.timeCredit.remaining.value - (hours * 3600) - (mins * 60);
					
					hours_label = getGenericTranslation('hour', lang_value_itt, (hours > 1));
					mins_label = getGenericTranslation('minute', lang_value_itt, (mins > 1));
					seconds_label = getGenericTranslation('second', lang_value_itt, (seconds > 1));
					
					text = $.sprintf(getGenericTranslation('feedbackForm_time-credit-with-seconds', lang_value_itt), hours, hours_label, mins, mins_label, seconds, seconds_label);
				}
				html_content = informativeWidget_replace("timecredit_remaining", html_content, text);
				
				$('#widget_informative_' + lang_value_itt).html(html_content);
			}
		}
	}
}

function informativeWidget_display(state) {
	
	var display = false;
	if ( (state == true) || (state == false) ) {
		display = state;
	}
	else if ($.settings.informativeWidget != undefined && ($.settings.step == "LOGON" || ($.settings.step != undefined && $.settings.step == "SUBSCRIBE" && $.settings.type == "ONE") ) ) {
		display = true;
	}
	
	if (display == true) {
		if (translationsAreLoaded == true)
		{
			informativeWidget_configure();
		}
		$('#welcomeHeadline').hide();
		$('#reserved_block').hide();
		$('#widget_informative').fadeIn('slow');
	}
	else {
		$('#widget_informative').hide();
		$('#welcomeHeadline').fadeIn('slow');
		$('#reserved_block').fadeIn('slow');
	}
}

function informativeWidgetConnect()
{
	var callbacks = new Object();
	callbacks.beforeSend = function() { };
	callbacks.success    = function() { informativeWidgetConnectCallback(); };
	callbacks.complete   = function() { };
	
	informativeWidgetAuthenticate(callbacks /*, params */);
}

function informativeWidgetConnectCallback()
{
	if ($.settings.error != undefined)
	{
		$('#reserved_block').fadeIn('slow')
	}
	
	logonFormConnectCallback();
}
           20211215221728-8lB   https://ucopia-lvbca.ngeconnect.fr/100/portal/portal.js?1637144850   ' /**
 * Fichier JavaScript global
 */

// Global variables
var refreshObj = new Object();
var timerObj = new Object();
var translationsAreLoaded = false;
var switch_package = false;

var isAppleCNA = (navigator.userAgent.match(/iPhone|iPad|iPod/i)
	&& navigator.userAgent.match(/mozilla\//i)
	&& navigator.userAgent.match(/applewebkit\//i)
	&& navigator.userAgent.match(/mobile\//i)
	&& ! navigator.userAgent.match(/safari/i));

var isAppleCNA_fakeclick = false;

$(document).ready(function() {
	// Patch to avoid intempestive informative widget apparition before its display management
	// at the end of the function displayStep cf #15143 and #15121.
	// Report from default portal even if we can't edit standard portal yet.
	if (typeof informativeWidget_configure == 'function') {
		$('#widget_informative').hide();
	}
	// Initialize portal
	$.portal_api('init', initPortal);
});


function handle_force_disconnect()
{
	if ($.settings.user != undefined && $.settings.user.force_feedback_disconnect != undefined && $.settings.user.force_feedback_disconnect) {
		displayWaitingIcon(true);
		feedbackFormDisconnect();
		return true;
	}
	return false;
}


function handle_autoconnect()
{
	if ( $.settings.subscribe != undefined && $.settings.subscribe.autoconnect != undefined && $.settings.step=="LOGON") {
		$('form[name="logonForm"] input[name="login"]').val($.settings.subscribe.autoconnect.login);
		$('form[name="logonForm"] input[name="password"]').val($.settings.subscribe.autoconnect.password);
		// Since autoConnect, set by default the policy to true
		$('form[name="logonForm"] input[name="logonForm_logon_policy_accept"]').attr("checked", true);

		var policy_accepted = $('form[name="logonForm"] input[name="logonForm_logon_policy_accept"]').is(':checked');
		if ( $.settings.logon != undefined && $.settings.logon.policy != undefined && $.settings.logon.policy.display == true && ! policy_accepted ) {
			// Policy is displayed and not accepted. User has to accept it before login.
			return false;
		}
		else {
			$.portal_api('setInAutoConnect', true);
			logonFormConnect();
			// avoid to display portal
			if ( $.settings.subscribe.autoconnect.follow_cloud_redirect == true ) {
				return true;
			}
		}

	}

	return false;
}

function displayWaitingIcon( state )
{
	var display = false;
	if ( (state == true) || (state == false) ) {
		display = state;
	}

	if( display == true)
	{
		$("#waiting_icon_block").show();
		$("#reserved_block").show();
	}
	else
	{
		$("#waiting_icon_block").hide();
	}
}


/* Called just after the portal was loaded in order to get all translations and configure all sub-modules */
function initPortal( data ){

    if ( $.settings != undefined && $.settings.redirect != undefined ) {
        window.location = $.settings.redirect;
    }


    /* Gather translation file then translate */
    var portal_format = null;
    var path_tokens = window.location.pathname.split('/');
    for ( var i = 0; i < path_tokens.length; i++ ) {
        if ( path_tokens[i].toUpperCase().indexOf('PORTAL') === 0 ) {
            portal_format = path_tokens[i];
        }
    }
    if ( portal_format == null ) {
        portal_format = 'portal';
    }
    $.portal_api('getTranslations', portal_format, function (){
        // Translate informative widget first
        if ( typeof informativeWidget_configure == 'function' ) {
            informativeWidget_configure();
        }
        translate($.settings.user.lang);
        translationsAreLoaded = true;
    });

    /* Configure Portal */
    lang_block_configure();
    replaceAllFreeURLs();
	configureDOM($.settings.user.lang, "policy");
	configureDOM($.settings.user.lang, "private_policy");

    if ( handle_force_disconnect() ) {
        return;
    }

    if ( handle_autoconnect() ) {
        return;
    }


    /* Configure reserved_block */
    if ( $.settings != undefined && $.settings.auth_modes != undefined ) {
        // Order is important
        securePwdForm_configure();
        autoLogonForm_configure();
        logonForm_configure();
        forceModifyPwdForm_configure();
        feedbackForm_configure();
        modifyPwdForm_configure();
        getPurchaseSummaryForm_configure();
        upgradeAccountForm_configure();
        manageAccountForm_configure();

        smsSubscriptionForm_configure();
        mailSubscriptionForm_configure();
        oneSubscriptionForm_configure();
        directSubscriptionForm_configure();
        printSubscriptionForm_configure();
        paypalSubscriptionForm_configure();
        ogoneSubscriptionForm_configure();
        ppsSubscriptionForm_configure();

        paypalPaymentForm_configure();
        ogonePaymentForm_configure();
        pmsPaymentForm_configure();

        pwdRecoveryForm_configure();
        pwdRecoverySetForm_configure();

        accountRefillForm_configure();

        shibAuthenticated();

	pre_portal_configure();

        // Analize step
        displayStep();
    }
}

/* Display the portal accordingly to its step or configuration */
function displayStep(){

    if ( !handleCentralPortalRedirection() ) {
        return;
    }

    /* Display right block */
    securePwdForm_display();
    autoLogonForm_display();
    logonForm_display();
    forceModifyPwdForm_display();
    feedbackForm_display();
    modifyPwdForm_display();
    getPurchaseSummaryForm_display();
    upgradeAccountForm_display();
    manageAccountForm_display();

    smsSubscriptionForm_display();
    mailSubscriptionForm_display();
    oneSubscriptionForm_display();
    directSubscriptionForm_display();
    printSubscriptionForm_display();
    paypalSubscriptionForm_display();
    ogoneSubscriptionForm_display();
    ppsSubscriptionForm_display();

    paypalPaymentForm_display();
    ogonePaymentForm_display();
    pmsPaymentForm_display();

    pwdRecoveryForm_display();
    pwdRecoverySetForm_display();

    logonFormSubscribeChoice_display(false);

	pre_portal_display();

    // Widgets
    if ( typeof informativeWidget_display == 'function' ) {
        informativeWidget_display();
    }
    else {
        // Display reserved_block slowly
        $('#reserved_block').fadeIn('slow');
    }
}

/** Handles central portal redirection to post credentials on the local
 * controller
 */
function handleCentralPortalRedirection(){

    if ( $.settings.user.login_URL_params != undefined && ($.settings.user.isConnected == undefined || $.settings.user.isConnected != true) ) {
        displayWaitingIcon(true);
        return buildRedirectionURL($.settings.user.login_URL_params);

    }

    return true;

}

function buildRedirectionURL( url_params ){

    /* When we are a central controller, we need to redirect the client to his
     * local controller (AKA remote controller)
     * This creates a temporary form populated with the client's credentials
     * The form is submitted to the URL given by the remote controller
     * According to
     * http://stackoverflow.com/questions/3770324/jquerys-form-submit-not-working-in-ie/6694054#6694054
     * it only works this way on IE 9
     */
    if ( url_params != undefined ) {

        var target_URL;
        var port = '443';
        var protocol = 'https';
        var host = '';
        var uri = '';

        if ( url_params.url != undefined ) {
            target_URL = url_params.url;
        }
        else {

            if ( url_params.host != undefined ) {
                host = url_params.host;
            }
            if ( url_params.port != undefined ) {
                port = url_params.port;
            }
            if ( url_params.protocol != undefined ) {
                protocol = url_params.protocol;
            }
            if ( url_params.uri != undefined ) {
                uri = url_params.uri;
            }

            target_URL = protocol + '://' + host + ':' + port + '/' + uri;

        }

	var parameters = url_params.parameters;
	var send_cna_id = $.portal_api('isInAutoConnect');
	var cna_id = $.portal_api('getCnaId');
	if (send_cna_id == true && cna_id != null) {
		if (parameters === undefined) {
			parameters = new Object();
		}
		parameters.cna_id = cna_id;
	}
	if ($('form[name="logonForm"] input[name="wispr_mode"]').is(':checked')) {
		parameters.wispr_mode = 'true';
	}

        if ( url_params.type != undefined && url_params.type == "POST" ) {
            var form = document.createElement("form");
            $(form).attr("action", target_URL);
            $(form).attr("method", "POST");
            if ( parameters != undefined ) {
                $.each(parameters, function ( index, value ){
                    $(form).append('<input name="' + index + '" value="' + value + '">');
                });
            }
            document.body.appendChild(form);
            $(form).submit();
            document.removeChild(form);
            return false;

        }
        else { /* GET */
            if ( parameters != undefined ) {
                var get_params = (target_URL.indexOf('?') == -1) ? '?' : '&';
                $.each(parameters, function ( index, value ){
                    get_params += index + '=' + value + '&';
                });

                get_params = get_params.substr(0, get_params.length - 1);

                target_URL += get_params;

            }

            window.location = target_URL;
            return false;
        }
    }
}

/* Display and translate all the error or information message on top of the reserved_block */
function displayErrorInfo( displayLang ){
    if ( displayLang == undefined ) {
        if ( $.settings != undefined && $.settings.user != undefined ) {
            displayLang = $.settings.user.lang;
        }
    }

    if ( $.settings != undefined ) {
        var lang = $.translations;

        if ( $.settings.error != undefined ) {
            // This exception indicate that user maybe attempt to bypass controller portal zone redirection
            if ( $.settings.error.code == "error_redirect-to-index" && $.settings.redirect != undefined ) {
                window.location = $.settings.redirect;
            }

            $('#error_info_value').text($.settings.error.code).removeClass("info").addClass("error");
            // Use a better query or xpath
            $(lang).find('error').each(function (){
                var error = $(this);
                $(this).find('msgid').each(function (){
                    var id = $(this).text();
                    if ( id == $.settings.error.code ) {
                        var trans = error.find(displayLang).text();
                        if ( trans == "" ) {
                            trans = error.find($.settings.lang.defaultLang).text();
                        }
                        if ( trans != "" ) {
                            // For custom fields name in the error message
                            var subscription_modes = new Array("direct", "mail", "sms", "paypal", "ogone", "one", "print"); // Differents subscription mode where custom fields are available
                            var custom_field_error = false;

                            var creationMode = undefined;
                            if ( $.settings.error.code.indexOf("error_personal-settings") > -1 ) {
                                var creationModeRegExp = new RegExp("^portal-([a-zA-Z]+)$");
                                var creationModeMatches = creationModeRegExp.exec($.settings.user.creationMode.value);
                                if ( creationModeMatches != undefined ) {
                                    creationMode = creationModeMatches[1];
                                }
                            }

                            for ( key in subscription_modes ) {
                                var subscription_mode = subscription_modes[key];
                                if ( ($.settings.error.code == "error_" + subscription_mode + "-subscribe_no-custom-field")
                                    || (creationMode != undefined && $.settings.error.code.indexOf("no-custom-field") > -1 && subscription_mode == creationMode)
									|| ($.settings.error.code == 'error_subscribe_no-custom-field' && $.settings.subscribe[subscription_mode] != undefined)) {

                                    custom_field_error = true;
                                    if ( $.settings.subscribe[subscription_mode][$.settings.error.value].labels[displayLang] != undefined ) {
                                        $('#error_info_value').text($.sprintf(trans, $.settings.subscribe[subscription_mode][$.settings.error.value].labels[displayLang]));
                                    }
                                    else if ( $.settings.subscribe[subscription_mode][$.settings.error.value].labels[$.settings.lang.defaultLang] != undefined ) {
                                        $('#error_info_value').text($.sprintf(trans, $.settings.subscribe[subscription_mode][$.settings.error.value].labels[$.settings.lang.defaultLang]));
                                    }
                                    else {
                                        $('#error_info_value').text($.sprintf(trans, $.settings.subscribe[subscription_mode][$.settings.error.value].labels[$.settings.lang.customFieldsDefaultLang]));
                                    }
                                }
                                else if ( ($.settings.error.code == "error_" + subscription_mode + "-subscribe_invalid-custom-field")
                                    || (creationMode != undefined && $.settings.error.code.indexOf("invalid-custom-field") > -1 && subscription_mode == creationMode)
									|| ($.settings.error.code == 'error_subscribe_invalid-custom-field' && $.settings.subscribe[subscription_mode] != undefined)) {

                                    custom_field_error = true;
                                    if ( $.settings.subscribe[subscription_mode][$.settings.error.value[0]].labels[displayLang] != undefined ) {
                                        $('#error_info_value').text($.sprintf(trans, $.settings.subscribe[subscription_mode][$.settings.error.value[0]].labels[displayLang], $.settings.error.value[1]));
                                    }
                                    else if ( $.settings.subscribe[subscription_mode][$.settings.error.value[0]].labels[$.settings.lang.defaultLang] != undefined ) {
                                        $('#error_info_value').text($.sprintf(trans, $.settings.subscribe[subscription_mode][$.settings.error.value[0]].labels[$.settings.lang.defaultLang], $.settings.error.value[1]));
                                    }
                                    else {
                                        $('#error_info_value').text($.sprintf(trans, $.settings.subscribe[subscription_mode][$.settings.error.value[0]].labels[$.settings.lang.customFieldsDefaultLang], $.settings.error.value[1]));
                                    }
									break;
                                }
                            }

                            var error_block;
                            for ( key in subscription_modes ) {
                                var subscription_mode = subscription_modes[key];
                                if ( $.settings.error.code == 'error_' + subscription_mode + '-subscribe_invalid-password' ) {
                                    error_block = $('#SubscriptionErrorBlock').clone();
                                    $('#SubscriptionErrorBlock_text', error_block).text($.sprintf(trans, ""));
                                }
                            }
                            if ( error_block != undefined || $.settings.error.code.indexOf('error_modify-pwd_invalid-password') > -1
                                || $.settings.error.code.indexOf('error_force-modify-pwd_invalid-password') > -1 ) {
                                if ( $.settings.error.code.indexOf('error_force-modify-pwd_invalid-password') > -1 ) {
                                    error_block = $('#forceModifyPwdErrorBlock').clone();
                                    $("#forceModifyPwdErrorBlock_text", error_block).text($.sprintf(trans, ""));
                                }
                                else if ( $.settings.error.code.indexOf('error_modify-pwd_invalid-password') > -1 ) {
                                    var error_block = $('#modifyPwdErrorBlock').clone();
                                    $("#modifyPwdErrorBlock_text", error_block).text($.sprintf(trans, ""));
                                }
                                $.each($.settings.error.value, function ( index, value ){
                                    var translation = getErrorTranslation($.settings.error.code + '-' + value.cause, displayLang);
                                    if ( translation == "" ) {
                                        translation = getErrorTranslation($.settings.error.code + '-' + value.cause, $.settings.lang.defaultLang);
                                    }
                                    switch ( value.cause ) {
                                        case "small":
                                            var error_line = $('li:first', error_block).clone();
                                            error_line.show();
                                            error_line.text($.sprintf(translation, value.minimum));
                                            $('ul:first', error_block).append(error_line);
                                            break;
                                        case "big":
                                            var error_line = $('li:first', error_block).clone();
                                            error_line.show();
                                            error_line.text($.sprintf(translation, value.maximum));
                                            $('ul:first', error_block).append(error_line);
                                            break;
                                        case "missing-occurance":
                                            $.each(value.classes, function ( index, char_class ){
                                                if ( char_class.quota > 0 ) {
                                                    var error_line = $('li:first', error_block).clone();
                                                    error_line.show();
                                                    error_line.text($.sprintf(translation, char_class.quota, char_class.set.join("")));
                                                    $('ul:first', error_block).append(error_line);
                                                }
                                            });
                                            break;
                                    }
                                });
                                error_block.show();
                                $('#error_info_value').html(error_block);
                            }
                            else if ($.settings.error.code == 'error_logon_volume-quota-reached-detail') {
                                // it's only next renew timestamp in which we have an interest
                                if ($.settings.error.value.renewTimeStamp != undefined && $.settings.error.value.zoneOffset != undefined) {
                                    var data_renew = explodeDate(new Date((parseInt($.settings.error.value.renewTimeStamp) + parseInt($.settings.error.value.zoneOffset)) * 1000)); // Must give date in milliseconds
                                    var date_renew = $.sprintf(
                                            getGenericTranslation('full-date-display', displayLang),
                                            data_renew.year,
                                            data_renew.monthNumber,
                                            getGenericTranslation(data_renew.month, displayLang),
                                            data_renew.dayNumber,
                                            getGenericTranslation(data_renew.day, displayLang),
                                            data_renew.hours[24],
                                            data_renew.minutes,
                                            data_renew.hours[12],
                                            data_renew.hours['ext']
                                    );
                                    if ($.settings.error.value.isControllerTimezone === false && $.settings.error.value.zoneTimezone != undefined) {
                                        date_renew += ' (' + $.settings.error.value.zoneTimezone + ')';
                                    }
                                    var error_text = $.sprintf(trans, date_renew);
                                    $('#error_info_value').text(error_text);
                                }
                                else {
                                    // rollback error message without renew timestamp if we have an error
                                    $.settings.error.code = 'error_logon_volume-quota-reached';
                                }
                            }
                            else {
                                if ( custom_field_error == false ) {
                                    $('#error_info_value').text($.sprintf(trans, $.settings.error.value));
                                }
                            }
                        }
                    }
                });
            });
			setTimeout(resetErrorInfo, 10000); // Show the error message for 10 seconds before hidding it
        }
        else if ( $.settings.info != undefined ) {
            $('#error_info_value').text($.settings.info.code).removeClass("error").addClass("info");
            // Use a better query or xpath
            $(lang).find('info').each(function (){
                var info = $(this);
                $(this).find('msgid').each(function (){
                    var id = $(this).text();
                    if ( id == $.settings.info.code ) {
                        var trans = info.find(displayLang).text();
                        if ( trans == "" ) {
                            trans = info.find($.settings.lang.defaultLang).text();
                        }
                        if ( trans != "" ) {
                            $('#error_info_value').text($.sprintf(trans, $.settings.info.value));
                        }
                    }
                });
            });
			setTimeout(resetErrorInfo, 30000); // Show the error message for 30 seconds before hidding it
        }
        else {
            $('#error_info_value').html('&nbsp;').removeClass("error info");
        }
    }
    else {
        $('#error_info_value').html('&nbsp;').removeClass("error info");
    }
}

function resetErrorInfo() {
	$('#error_info_value').html('&nbsp;').removeClass("error info");
}


/*****************************************************************************/
/***** Communication Functions                                           *****/
/***** ***** ***** ***** ***** ***** ***** ***** ***** ***** ***** ***** *****/


/** Authenticate an user on the controller
 * @param callbacks - Callback functions                            [REQUIRED]
 * @param params - The params used to connect a user                [REQUIRED]
 * - login : The user's account login                               [REQUIRED]
 * - password : The user's account password                         [REQUIRED]
 * - securePwd : The portal securization password                   [OPTIONAL, we'll be required if option enabled on portal configuration]
 * - policyAccept : Proove that user agreed the policy (boolean)    [OPTIONAL, we'll be required if option enabled on portal configuration]
 */
function authenticate( callbacks, params ){

    var request = new Object();
    request.action = "authenticate";

    if ( params == undefined ) {
        return false;
    }

    // Check package change
    if ( (params.switchPackage != undefined) && (params.switchPackage == true) ) {
        request.switch_package = params.switchPackage;
        if ( $.settings.user.timeCredit != undefined ) {
            delete $.settings.user.timeCredit;
        }
    }

    if ( ($.settings.step != undefined && $.settings.step == "PAYMENT") && ($.settings.type != undefined && $.settings.type == "PMS") ) {
        // Check only login
        if ( params.login == undefined ) {
            return false;
        } else {
            request.login = params.login;
        }
    } else {
        // Check required parameters
        if ( (params.login == undefined) || (params.password == undefined) ) {
            return false;
        }
        else {
            request.login = params.login;
            request.password = params.password;
        }
    }

    // Get optional parameters
    request.secure_pwd = params.securePwd;
    request.policy_accept = params.policyAccept;
    request.private_policy_accept = params.privatePolicyAccept;

    // Let the portal know the request came from AJAX
    request.from_ajax = true;

    // For package change
    if ( params.lastProfile != undefined )
        request.last_profile = params.lastProfile;

	// send cna id
	if (params.cna_id != undefined) {
		request.cna_id = params.cna_id;
	}
	// send wispr mode
	if (params.wispr_mode != undefined) {
		request.wispr_mode = params.wispr_mode;
	}

	// send option mode
	if (params.option != undefined) {
		request.option = params.option;
	}

    $.portal_api('action', request, callbacks);
}

/** Authenticate an user on the controller for automatic connection
 * @param callbacks - Callback functions                            [REQUIRED]
 * @param params - The params used to connect a user                [OPTIONAL]
 * - securePwd : The portal securization password                   [OPTIONAL, we'll be required if option enabled on portal configuration]
 * - policyAccept : Proove that user agreed the policy              [OPTIONAL, we'll be required if option enabled on portal configuration]
 */
function autoAuthenticate( callbacks, params ){

    var request = new Object();
    request.action = "automatic_authenticate";

    // Get optional parameters
    request.secure_pwd = params.securePwd;
    request.policy_accept = params.policyAccept;

    $.portal_api('action', request, callbacks);
}

/** Authenticate an user on the controller for automatic connection
 * @param callbacks - Callback functions                            [REQUIRED]
 * @param params - The params used to connect a user                [NOT USED]
 */
function informativeWidgetAuthenticate( callbacks, params ){

    var request = new Object();
    request.action = "informativeWidget_authenticate";

    $.portal_api('action', request, callbacks);
}

/** Authenticate an user on with social network credential
 *  Only used to check policy accept
 * @param callbacks - Callback functions                            [REQUIRED]
 * @param params - The params used to connect a user                [REQUIRED]
 * - securePwd : The portal securization password                   [OPTIONAL, we'll be required if option enabled on portal configuration]
 * - policyAccept : Proove that user agreed the policy (boolean)    [OPTIONAL, we'll be required if option enabled on portal configuration]
 */
function socialNetworkAuthenticate( callbacks, params ){

    var request = new Object();
    request.action = "social_network_authenticate";

    if ( params == undefined ) {
        return false;
    }

    // Get optional parameters
    request.secure_pwd = params.securePwd;
    request.policy_accept = params.policyAccept;
	if ( params.privatePolicyAccept != undefined ) {
		request.private_policy_accept = params.privatePolicyAccept;
	}
    request.type = params.type;
    if (request.type == 'twitter') {
        request.user_follow = params.userFollow;
    }
	if (request.type == 'facebook') {
		request.user_like = params.userLike;
	}
    $.portal_api('action', request, callbacks);
}

/** Disconnect an user on the controller
 * @param callbacks - Callback functions                            [REQUIRED]
 * @param params - The params used to disconnect a user             [REQUIRED]
 * - login : The user's account login                               [REQUIRED]
 * - securePwd : The portal securization password                   [OPTIONAL, we'll be required if option enabled on portal configuration]
 */
function disconnect( callbacks, params ){

    var request = new Object();
    request.action = "disconnect";

    if ( params == undefined ) {
        return false;
    }

    // Check required parameters
    if ( params.login == undefined ) {
        return false;
    }
    else {
        request.login = params.login;
    }

    // Get optional parameters
    request.secure_pwd = params.securePwd;

    $.portal_api('action', request, callbacks);
}

/** Refresh the connection of an user on the controller
 * @param callbacks - Callback functions                            [REQUIRED]
 * @param params - The params used to refresh a user                [REQUIRED]
 * - login : The user's account login                               [REQUIRED]
 * - securePwd : The portal securization password                   [OPTIONAL, we'll be required if option enabled on portal configuration]
 */
function refresh( callbacks, params ){
    var request = new Object();
    request.action = "refresh";

    if ( params == undefined ) {
        return false;
    }

    // Check required parameters
    if ( params.login == undefined ) {
        return false;
    }
    else {
        request.login = params.login;
        var currentDate = new Date();
        request.time = currentDate.getTime();
    }

    // Get optional parameters
    request.secure_pwd = params.securePwd;

    if ( ( ($.settings.type == "CONNECT") || ($.settings.type == "REFRESH") ) && ($.settings.user.autoDisconnect != undefined && $.settings.user.autoDisconnect.value != true) ) {
        $.portal_api('action', request, callbacks);
    }
}

/** Request a check of the secure password to know if the user can go further
 * @param callbacks - Callback functions                            [REQUIRED]
 * @param params - The params used to access the portal             [REQUIRED]
 * - securePassword : The portal securization password              [REQUIRED]
 */
function securePwd( callbacks, params ){

    var request = new Object();
    request.action = "secure_pwd";

    if ( params == undefined ) {
        return false;
    }

    // Check required parameters
    if ( params.securePwd == undefined ) {
        return false;
    }
    else {
        request.secure_pwd = params.securePwd;
    }

    $.portal_api('action', request, callbacks);
}

/** Modify the user's account password on the controller (after been connected)
 * @param callbacks - Callback functions                            [REQUIRED]
 * @param params - The params used to modify the user's password    [REQUIRED]
 * - login : The user's account login                               [REQUIRED]
 * - password : The current user's account password                 [REQUIRED]
 * - newPassword : The new account password                         [REQUIRED]
 * - newPasswordConfirm : The new account password confirmation     [REQUIRED]
 * - securePwd : The portal securization password                   [OPTIONAL, we'll be required if option enabled on portal configuration]
 */
function modifyPwd( callbacks, params ){

    var request = new Object();
    request.action = "modify_pwd";

    if ( params == undefined ) {
        return false;
    }

    // Check required parameters
    if ( (params.login == undefined) || (params.password == undefined) || (params.newPassword == undefined) || (params.newPasswordConfirm == undefined) ) {
        return false;
    }
    else {
        request.login = params.login;
        request.password = params.password;
        request.new_password = params.newPassword;
        request.new_password_confirm = params.newPasswordConfirm;
    }

    // Get optional parameters
    request.secure_pwd = params.securePwd;

    $.portal_api('action', request, callbacks);
}

/** Modify the user's account password on the controller (before been connected)
 * @param callbacks - Callback functions                            [REQUIRED]
 * @param params - The params used to modify the user's password    [REQUIRED]
 * - login : The user's account login                               [REQUIRED]
 * - password : The current user's account password                 [REQUIRED]
 * - newPassword : The new account password                         [REQUIRED]
 * - newPasswordConfirm : The new account password confirmation     [REQUIRED]
 * - securePwd : The portal securization password                   [OPTIONAL, we'll be required if option enabled on portal configuration]
 */
function forceModifyPwd( callbacks, params ){

    var request = new Object();
    request.action = "force_modify_pwd";

    if ( params == undefined ) {
        return false;
    }

    // Check required parameters
    if ( (params.login == undefined) || (params.password == undefined) || (params.newPassword == undefined) || (params.newPasswordConfirm == undefined) ) {
        return false;
    }
    else {
        request.login = params.login;
        request.password = params.password;
        request.new_password = params.newPassword;
        request.new_password_confirm = params.newPasswordConfirm;
    }

    // Get optional parameters
    request.secure_pwd = params.securePwd;

    $.portal_api('action', request, callbacks);
}

/** Cancel the current action then go back
 * @param callbacks - Callback functions                            [REQUIRED]
 */
function backAction( callbacks ){

    var request = new Object();
    request.action = "back_action";

    $.portal_api('action', request, callbacks);
}

/** Send the parameters on an user subscribing on the controller
 * @param callbacks - Callback functions                            [REQUIRED]
 * @param params - The params used to create a user account         [REQUIRED]
 * - type : The subcription type                                    [REQUIRED]
 * - securePwd : The portal securization password                   [OPTIONAL, we'll be required if option enabled on portal configuration]
 * + SMS Type
 *   - prefix : The prefix (country code) of the user phone number  [REQUIRED]
 (33 for France, 49 for Germany)
 *   - phone : The user phone number                                [REQUIRED]
 *   - lastName : The user last name                                [REQUIRED]
 *   - firstName : The user first name                              [REQUIRED]
 *   - emailAddress : The user email address                        [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - organizationUnitName : The user company name                 [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - postalAddress : The user postal address                      [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - postalCode : The user address postal code                    [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - postalLocalityName : The user address locality name          [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - postalPostofficeBox : The user address postoffice box        [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - postalStateOrProvinceName : The user address st. or pr. name [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - postalCountryName : The user address country name            [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - personalField_1 : First additional field                     [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - personalField_2 : Second additional field                    [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - personalField_3 : Third additional field                     [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - sponsor_email : The sponsor email                            [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - policyAccept : Proove that user agreed the policy            [OPTIONAL, we'll be required if option enabled on portal configuration]
 * + Mail Type
 *   - emailAddress : The user email address                        [REQUIRED]
 *   - prefix : The prefix (country code) of the user phone number  [OPTIONAL, we'll be required if option enabled on portal configuration]
 (33 for France, 49 for Germany)
 *   - phone : The user phone number                                [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - lastName : The user last name                                [REQUIRED]
 *   - firstName : The user first name                              [REQUIRED]
 *   - organizationUnitName : The user company name                 [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - postalAddress : The user postal address                      [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - postalCode : The user address postal code                    [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - postalLocalityName : The user address locality name          [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - postalPostofficeBox : The user address postoffice box        [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - postalStateOrProvinceName : The user address st. or pr. name [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - postalCountryName : The user address country name            [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - personalField_1 : First additional field                     [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - personalField_2 : Second additional field                    [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - personalField_3 : Third additional field                     [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - sponsor_email : The sponsor email                            [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - policyAccept : Proove that user agreed the policy            [OPTIONAL, we'll be required if option enabled on portal configuration]
 * + One type
 * + Direct Type
 * + Print Type
 * + Paypal Type
 * + Ogone Type
 *   - lastName : The user last name                                [REQUIRED]
 *   - firstName : The user first name                              [REQUIRED]
 *   - login : The user's account login                             [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - password : The new account password                          [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - passwordConfirm : The new account password confirmation      [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - prefix : The prefix (country code) of the user phone number  [OPTIONAL, we'll be required if option enabled on portal configuration]
 ( 33 for France, 49 for Germany)
 *   - phone : The user phone number                                [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - emailAddress : The user email address                        [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - organizationUnitName : The user company name                 [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - postalAddress : The user postal address                      [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - postalCode : The user address postal code                    [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - postalLocalityName : The user address locality name          [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - postalPostofficeBox : The user address postoffice box        [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - postalStateOrProvinceName : The user address st. or pr. name [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - postalCountryName : The user address country name            [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - personalField_1 : First additional field                     [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - personalField_2 : Second additional field                    [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - personalField_3 : Third additional field                     [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - sponsor_email : The sponsor email                            [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - policyAccept : Proove that user agreed the policy            [OPTIONAL, we'll be required if option enabled on portal configuration]
 * + PPS Type
 *   - scratchCode : Scratch code from prepay card                  [REQUIRED]
 *   - captchaCode : Code from portal display to validate logon     [REQUIRED]
 *   - policyAccept : Proove that user agreed the policy            [OPTIONAL, we'll be required if option enabled on portal configuration]
 */
function subscribe( callbacks, params ){

    var request = new Object();
    request.action = "subscribe";

    if ( params == undefined ) {
        return false;
    }

    // Check required parameter
    if ( params.type == undefined ) {
        return false;
    }
    else {
        request.type = params.type;
    }

    switch ( params.type ) {
        case "sms":
        case "mail":
            // Get parameters for subscription
            request.last_name = params.lastName;
            request.first_name = params.firstName;
            request.email_address = params.emailAddress;
            request.prefix = params.prefix;
            request.phone = params.phone;
            request.private_policy_accept = params.privatePolicyAccept;
            request.organizational_unit_name = params.organizationalUnitName;
            // Postal address
            request.postal_address = params.postalAddress;
            request.postal_code = params.postalCode;
            request.postal_locality_name = params.postalLocalityName;
            request.postal_postoffice_box = params.postalPostofficeBox;
            request.postal_state_or_province_name = params.postalStateOrProvinceName;
            request.postal_country_name = params.postalCountryName;

            request.personal_field_1 = params.personalField_1;
            request.personal_field_2 = params.personalField_2;
            request.personal_field_3 = params.personalField_3;

            request.sponsor_email = params.sponsorEmail;
            request.gender = params.gender;
            request.birth_date = params.birthDate;
            request.user_language = params.userLanguage;
            request.interests = params.interests;
            break;

        case "one":
            request.connect_policy_accept = params.connectPolicyAccept;
        case "direct":
        case "print":
        case "paypal":
        case "ogone":
            // Get parameters for subscription
            request.user_login = params.login;
            request.user_password = params.password;
            request.user_password_confirm = params.passwordConfirm;
            request.last_name = params.lastName;
            request.first_name = params.firstName;
            request.email_address = params.emailAddress;
            request.prefix = params.prefix;
            request.phone = params.phone;
            request.private_policy_accept = params.privatePolicyAccept;
            request.organizational_unit_name = params.organizationalUnitName;
            // Postal address
            request.postal_address = params.postalAddress;
            request.postal_code = params.postalCode;
            request.postal_locality_name = params.postalLocalityName;
            request.postal_postoffice_box = params.postalPostofficeBox;
            request.postal_state_or_province_name = params.postalStateOrProvinceName;
            request.postal_country_name = params.postalCountryName;

            request.personal_field_1 = params.personalField_1;
            request.personal_field_2 = params.personalField_2;
            request.personal_field_3 = params.personalField_3;

            request.sponsor_email = params.sponsorEmail;
            request.gender = params.gender;
            request.birth_date = params.birthDate;
            request.user_language = params.userLanguage;
            request.interests = params.interests;
            break;

        case "pps":
            // Get parameters for pps subscription
            request.scratch_code = params.scratchCode;
            request.captcha_code = params.captchaCode;
            request.policy_accept = params.policyAccept;
            //TODO: Check if optin is to be seen here
            break;

        default:
            return false;
            break;
    }

    // Get optional parameters
    request.secure_pwd = params.securePwd;

    $.portal_api('action', request, callbacks);
}

/** Select PMS package for user
 * @param callbacks - Callback functions                            [REQUIRED]
 * @param params - The params used to select a PMS package          [REQUIRED]
 * - login : The user's account login                               [REQUIRED]
 * - package : The package choosen by user                          [REQUIRED]
 * - securePwd : The portal securization password                   [OPTIONAL, we'll be required if option enabled on portal configuration]
 * - policyAccept : Proove that user agreed the policy              [OPTIONAL, we'll be required if option enabled on portal configuration]
 */
function selectPmsPackage( callbacks, params ){

    var request = new Object();
    request.action = "select_pms_package";

    if ( params == undefined ) {
        return false;
    }

    if ( $.settings.payment == undefined ) {
        return false;
    }

	request.login = $.settings.payment.login;

	if ( params.password != undefined ) {
		request.password = params.password;
	}

    request.secure_pwd = $.settings.payment.securePwd;
	request.policy_accept = $.settings.payment.policyAccept;
	request.private_policy_accept = $.settings.payment.privatePolicyAccept;

    request.package = params.package;

    // Get optional parameters
    request.secure_pwd = params.securePwd;

    $.portal_api('action', request, callbacks);
}

/** Select Paypal package for user
 * @param callbacks - Callback functions                            [REQUIRED]
 * @param params - The params used to select a Paypal package       [REQUIRED]
 * - login : The user's account login                               [REQUIRED]
 * - password : The current user's account password                 [REQUIRED]
 * - package : The package choosen by user                          [REQUIRED]
 * - securePwd : The portal securization password                   [OPTIONAL, we'll be required if option enabled on portal configuration]
 * - policyAccept : Proove that user agreed the policy              [OPTIONAL, we'll be required if option enabled on portal configuration]
 */
function selectPaypalPackage( callbacks, params ){

    var request = new Object();
    request.action = "select_paypal_package";

    if ( params == undefined ) {
        return false;
    }

    if ($.settings.payment == undefined) {
        return false;
    }
    request.login = $.settings.payment.login;
    request.process = $.settings.payment.process;
    request.secure_pwd = $.settings.payment.securePwd;
    request.policy_accept = $.settings.payment.policyAccept;
    request.package = params.package;

    // Get optional parameters
    request.secure_pwd = params.securePwd;

    $.portal_api('action', request, callbacks);
}

/** Select Ogone package for user
 * @param callbacks - Callback functions                            [REQUIRED]
 * @param params - The params used to select an Ogone package       [REQUIRED]
 * - login : The user's account login                               [REQUIRED]
 * - password : The current user's account password                 [REQUIRED]
 * - package : The package choosen by user                          [REQUIRED]
 * - securePwd : The portal securization password                   [OPTIONAL, we'll be required if option enabled on portal configuration]
 * - policyAccept : Proove that user agreed the policy              [OPTIONAL, we'll be required if option enabled on portal configuration]
 */
function selectOgonePackage( callbacks, params ){

    var request = new Object();
    request.action = "select_ogone_package";

    if ( params == undefined ) {
        return false;
    }

    if ($.settings.payment == undefined) {
        return false;
    }
    request.login = $.settings.payment.login;
    request.process = $.settings.payment.process;
    request.secure_pwd = $.settings.payment.securePwd;
    request.policy_accept = $.settings.payment.policyAccept;
    request.package = params.package;

    // Get optional parameters
    request.secure_pwd = params.securePwd;

    $.portal_api('action', request, callbacks);
}

/** Send Paypal subscription credential to user email or sms
 * @param callbacks - Callback functions                                     [REQUIRED]
 * @param params - The params used to send Paypal credentials by Mail or Sms [REQUIRED]
 * - action : The mode used to send credentials                              [REQUIRED]
 (paypal_send_sms for sms, paypal_send_mail for mail)
 * - login : The user's account login                                        [REQUIRED]
 * - password : The current user's account password                          [REQUIRED]
 * - email : The user email address                                          [REQUIRED, for mail action]
 * - prefix : The prefix (country code) of the user phone number             [REQUIRED, for sms action]
 (33 for France, 49 for Germany)
 * - phone : The user phone number                                           [REQUIRED, for sms action]
 * - securePwd : The portal securization password                    [OPTIONAL, we'll be required if option enabled on portal configuration]
 */
function subscriptionSendCredential( callbacks , params ) {

	var request = new Object();

	if (params == undefined) {
		return false;
	}

	request.action = params.action;
	request.login = params.login;
	request.password = params.password;
	request.prefix = params.prefix;
	request.phone = params.phone;
	request.email = params.email;

	// Get optional parameters
	request.secure_pwd = params.securePwd;
	$.portal_api('action', request, callbacks);
}

/** Send Paypal subscription SMS to user phone
 * @param callbacks - Callback functions                             [REQUIRED]
 * @param params - The params used to send Paypal credentials by SMS [REQUIRED]
 * - login : The user's account login                                [REQUIRED]
 * - password : The current user's account password                  [REQUIRED]
 * - prefix : The prefix (country code) of the user phone number     [REQUIRED]
 (33 for France, 49 for Germany)
 * - phone : The user phone number                                   [REQUIRED]
 * - securePwd : The portal securization password                    [OPTIONAL, we'll be required if option enabled on portal configuration]
 */
function paypalSendSms( callbacks, params ){

    var request = new Object();
    request.action = "paypal_send_sms";

    if ( params == undefined ) {
        return false;
    }

    request.login = params.login;
    request.password = params.password;
    request.prefix = params.prefix;
    request.phone = params.phone;

    // Get optional parameters
    request.secure_pwd = params.securePwd;

    $.portal_api('action', request, callbacks);
}

/** Send Ogone subscription SMS to user phone
 * @param callbacks - Callback functions                            [REQUIRED]
 * @param params - The params used to send Ogone credentials by SMS [REQUIRED]
 * - login : The user's account login                               [REQUIRED]
 * - password : The current user's account password                 [REQUIRED]
 * - prefix : The prefix (country code) of the user phone number    [REQUIRED]
 (33 for France, 49 for Germany)
 * - phone : The user phone number                                  [REQUIRED]
 * - securePwd : The portal securization password                   [OPTIONAL, we'll be required if option enabled on portal configuration]
 */
function ogoneSendSms( callbacks, params ){

    var request = new Object();
    request.action = "ogone_send_sms";

    if ( params == undefined ) {
        return false;
    }

    request.login = params.login;
    request.password = params.password;
    request.prefix = params.prefix;
    request.phone = params.phone;

    // Get optional parameters
    request.secure_pwd = params.securePwd;

    $.portal_api('action', request, callbacks);
}

/** Request portal API after return from  Ogone/Paypal payment page
 * @param callbacks - Callback functions                            [REQUIRED]
 * @param params - The params used to confirm payment type  [REQUIRED]
 * - login : The user's account login                               [REQUIRED]
 * - password : The user's account login                               [REQUIRED]
 * - type : payment type                    [REQUIRED]
 */
function verifyPayment( callbacks, params ){

    var request = new Object();

    if ( params == undefined ) {
        return false;
    }

    request.action = "verify_payment";
    request.login = params.login;
    request.process = $.settings.payment.process;
    request.type = $.settings.payment.type;
    $.portal_api('action', request, callbacks);
}


/** Request portal API after pay button pushed for Ogone portal
 * @param callbacks - Callback functions                            [REQUIRED]
 * @param params - The params used to confirm Ogone package choice  [REQUIRED]
 * - login : The user's account login                               [REQUIRED]
 * - orderid : ...
 */
function ogoneSubmitPayment( callbacks, params ){

    var request = new Object();
    request.action = "ogone_submit_payment";

    if (params == undefined) {
        return false;
    }
    request.login = params.login;
    request.orderid = params.orderid;
    request.password = params.password;
    request.package = $.settings.payment.package;
    request.process = $.settings.payment.process;
    $.portal_api('action', request, callbacks);
}

/** Request portal API after pay button pushed for Ogone portal
 * @param callbacks - Callback functions                            [REQUIRED]
 * @param params - The params used to confirm Ogone package choice  [REQUIRED]
 * - login : The user's account login                               [REQUIRED]
 * - orderid : ...
 */
function paypalSubmitPayment( callbacks , params ) {

    var request = new Object();
    request.action = "paypal_submit_payment";

    if (params == undefined) {
        return false;
    }
    request.login = params.login;
    request.password = params.password;
    request.package = $.settings.payment.package;
    request.process = $.settings.payment.process;
    $.portal_api('action', request, callbacks);
}

/** Request portal API on feedback to have a purchase summary
 * @param callbacks - Callback functions                            [REQUIRED]
 * @param params - The params used to get a purchase summary        [REQUIRED]
 * - login : The user's account login                               [REQUIRED]
 * - securePwd : The portal securization password                   [OPTIONAL, we'll be required if option enabled on portal configuration]
 */
function getPurchaseSummary( callbacks, params ){

    var request = new Object();
    request.action = "get_purchase_summary";

    if ( params == undefined ) {
        return false;
    }
    request.login = params.login;

    // Get optional parameters
    request.secure_pwd = params.securePwd;

    $.portal_api('action', request, callbacks);
}

/** Request portal API on feedback to have the current package settings
 * This functionnality isn't in portal config anymore since 6.x version
 * but it kept for backward portal compatibility in 5.x versions
 * @param callbacks - Callback functions                            [REQUIRED]
 * @param params - The params used to get the current user package  [REQUIRED]
 * - login : The user's account login                               [REQUIRED]
 * - securePwd : The portal securization password                   [OPTIONAL, we'll be required if option enabled on portal configuration]
 */
function getCurrentPackage( callbacks, params ){

    var request = new Object();
    request.action = "get_current_package";

    if ( params == undefined ) {
        return false;
    }
    request.login = params.login;

    // Get optional parameters
    request.secure_pwd = params.securePwd;

    $.portal_api('action', request, callbacks);
}

/** Request portal API on feedback to create a new upgrade order (allowing new multidevice sessions)
 * This functionnality isn't in portal config anymore since 6.x version
 * but it kept for backward portal compatibility in 5.x versions
 * @param callbacks - Callback functions                            [REQUIRED]
 * @param params - The params used to create a new upgrade order    [REQUIRED]
 * - login : The user's account login                               [REQUIRED]
 * - multidevice : The number of simultaneous sessions wanted       [REQUIRED]
 * - securePwd : The portal securization password                   [OPTIONAL, we'll be required if option enabled on portal configuration]
 */
function getUpgradeOrder( callbacks, params ){

    var request = new Object();
    request.action = "get_upgrade_order";

    if ( params == undefined ) {
        return false;
    }
    request.login = params.login;
    request.multidevice = params.multidevice;

    // Get optional parameters
    request.secure_pwd = params.securePwd;

    $.portal_api('action', request, callbacks);
}

/** Request portal API on feedback to update status of an existing order
 * This functionnality isn't in portal config anymore since 6.x version
 * but it kept for backward portal compatibility in 5.x versions
 * @param callbacks - Callback functions                               [REQUIRED]
 * @param params - The params used to update an existing upgrade order [REQUIRED]
 * - login : The user's account login                                  [REQUIRED]
 * - orderId : The order ID                                            [REQUIRED]
 * - securePwd : The portal securization password                      [OPTIONAL, we'll be required if option enabled on portal configuration]
 */
function updateUpgradeOrder( callbacks, params ){

    var request = new Object();
    request.action = "update_upgrade_order";

    if ( params == undefined ) {
        return false;
    }
    request.login = params.login;
    request.order_id = params.orderId;

    // Get optional parameters
    request.secure_pwd = params.securePwd;

    $.portal_api('action', request, callbacks);
}

/** Request portal API on feedback to check an existing order triggering modification account or not
 * This functionnality isn't in portal config anymore since 6.x version
 * but it kept for backward portal compatibility in 5.x versions
 * @param callbacks - Callback functions                              [REQUIRED]
 * @param params - The params used to check an existing upgrade order [REQUIRED]
 * - login : The user's account login                                 [REQUIRED]
 * - securePwd : The portal securization password                     [OPTIONAL, we'll be required if option enabled on portal configuration]
 */
function checkUpgradeOrder( callbacks, params ){

    var request = new Object();
    request.action = "check_upgrade_order";

    if ( params == undefined ) {
        return false;
    }
    request.login = params.login;

    // Get optional parameters
    request.secure_pwd = params.securePwd;

    $.portal_api('action', request, callbacks);
}

/** Switch display from current language to choosen one
 * @param callbacks - Callback functions                            [REQUIRED]
 * @param params - The params used to change the display language   [REQUIRED]
 * - language : The required display language                       [REQUIRED]
 */
function switchLanguage( callbacks, params ){

    var request = new Object();
    request.action = "switch_language";
    request.isAppleCNA_fakeclick = isAppleCNA ? isAppleCNA_fakeclick : false;

    isAppleCNA_fakeclick = false;
    if ( params == undefined ) {
        return false;
    }

    request.lang = params.language;

    $.portal_api('action', request, callbacks);
}

/** Push new personal information regarding the user account
 * @param callbacks - Callback functions                            [REQUIRED]
 * @param params - The params used to update user personal settings [OPTIONAL]
 *   - lastName : The user last name                                [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - firstName : The user first name                              [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - prefix : The prefix (country code) of the user phone number  [OPTIONAL, we'll be required if option enabled on portal configuration]
 ( 33 for France, 49 for Germany)
 *   - phone : The user phone number                                [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - emailAddress : The user email address                        [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - organizationUnitName : The user company name                 [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - postalAddress : The user postal address                      [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - postalCode : The user address postal code                    [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - postalLocalityName : The user address locality name          [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - postalPostofficeBox : The user address postoffice box        [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - postalStateOrProvinceName : The user address st. or pr. name [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - postalCountryName : The user address country name            [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - personalField_1 : First additional field                     [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - personalField_2 : Second additional field                    [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - personalField_3 : Third additional field                     [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - sponsor_email : The sponsor email                            [OPTIONAL, we'll be required if option enabled on portal configuration]
 *   - securePwd : The portal securization password                 [OPTIONAL, we'll be required if option enabled on portal configuration]
 */
function updatePersonalSettings( callbacks, params ){

    var request = new Object();
    request.action = "personal_settings_update";

    if ( params == undefined ) {
        return false;
    }

    request.last_name = params.lastName;
    request.first_name = params.firstName;
    request.email_address = params.emailAddress;
    request.prefix = params.prefix;
    request.phone = params.phone;
    request.organizational_unit_name = params.organizationalUnitName;
    // Postal address
    request.postal_address = params.postalAddress;
    request.postal_code = params.postalCode;
    request.postal_locality_name = params.postalLocalityName;
    request.postal_postoffice_box = params.postalPostofficeBox;
    request.postal_state_or_province_name = params.postalStateOrProvinceName;
    request.postal_country_name = params.postalCountryName;

    request.personal_field_1 = params.personalField_1;
    request.personal_field_2 = params.personalField_2;
    request.personal_field_3 = params.personalField_3;

    request.sponsor_email = params.sponsorEmail;
    // Get optional parameters
    request.secure_pwd = params.securePwd;
    if ( $.settings.user.privatePolicy !== undefined && params.privatePolicyAccept != $.settings.user.privatePolicy.value ) {
        // Send the OptOut only if value different from Optin
        request.private_policy_accept = params.privatePolicyAccept;
    }

    $.portal_api('action', request, callbacks);
}

/** Push new comments regarding the user account linked devices
 * @param callbacks - Callback functions                            [REQUIRED]
 * @param params - The params used to manage user devices           [REQUIRED]
 */
function updateDevicesSettings( callbacks, params ){

    var request = params; //new Object();
    request.action = "devices_settings_update";

    $.portal_api('action', request, callbacks);
}

/** Push new answers/questions regarding the password recovery feature
 * @param callbacks - Callback functions                            [REQUIRED]
 * @param params - The params used by the password recovery feature [REQUIRED]
 */
function updatePwdRecoverySecretQuestions( callbacks, params ){

    var request = params; //new Object();
    request.secure_pwd = params.securePwd;
    request.action = "pwd_recovery_secret_questions_update";

    $.portal_api('action', request, callbacks);
}

/** Get user account and password recovery options according to the given settings
 * @param callbacks - Callback functions                                [REQUIRED]
 * @param params - The params used to retreive an existing user account [REQUIRED]
 *   - login : The user's account login                                 [OPTIONAL]
 *   - prefix : The prefix (country code) of the user phone number      [OPTIONAL]
 ( 33 for France, 49 for Germany)
 *   - phone : The user phone number                                    [OPTIONAL]
 *   - emailAddress : The user email address                            [OPTIONAL]
 *   - securePwd : The portal securization password                     [OPTIONAL, we'll be required if option enabled on portal configuration]
 */
function getPwdRecoveryOptionsFromUser( callbacks, params ){

    var request = new Object();
    request.action = "get_pwd_recovery_options_from_user";

    if ( params == undefined ) {
        return false;
    }

    request.login = params.login;
    request.email_address = params.emailAddress;
    request.prefix = params.prefix;
    request.phone = params.phone;

    // Get optional parameters
    request.secure_pwd = params.securePwd;

    $.portal_api('action', request, callbacks);
}

/** Send a new user's password by SMS
 * @param callbacks - Callback functions                            [REQUIRED]
 * @param params - The params used to send a new user's password    [REQUIRED]
 *   - securePwd : The portal securization password                 [OPTIONAL, we'll be required if option enabled on portal configuration]
 */
function regenPwdWithSmsResend( callbacks, params ){

    var request = new Object();
    request.action = "regen_pwd_with_sms_resend";

    if ( params == undefined ) {
        return false;
    }

    // Get optional parameters
    request.secure_pwd = params.securePwd;

    $.portal_api('action', request, callbacks);
}

/** Send a new user's password by email
 * @param callbacks - Callback functions                            [REQUIRED]
 * @param params - The params used to send a new user's password    [REQUIRED]
 *   - securePwd : The portal securization password                 [OPTIONAL, we'll be required if option enabled on portal configuration]
 */
function regenPwdWithEmailResend( callbacks, params ){

    var request = new Object();
    request.action = "regen_pwd_with_email_resend";

    if ( params == undefined ) {
        return false;
    }

    // Get optional parameters
    request.secure_pwd = params.securePwd;

    $.portal_api('action', request, callbacks);
}

/** Return a new user's password on the portal
 * @param callbacks - Callback functions                            [REQUIRED]
 * @param params - The params used to send a new user's password    [REQUIRED]
 *   - securePwd : The portal securization password                 [OPTIONAL, we'll be required if option enabled on portal configuration]
 */
function regenPwdWithSecretQuestions( callbacks, params ){

    var request = params; //new Object();
    request.action = "regen_pwd_with_secret_questions";

    if ( params == undefined ) {
        return false;
    }

    // Get optional parameters
    request.secure_pwd = params.securePwd;

    $.portal_api('action', request, callbacks);
}

/** Replace href attribute if URL is a free access URL
 */
function replaceAllFreeURLs(){

    if ( $.settings != undefined && $.settings.freeUrls != undefined ) {
        $('a').each(function (){
            for ( freeUrlKey in $.settings.freeUrls ) {
                if ( freeUrlKey == $(this).attr('href') ) {
                    $(this).attr('href', $.settings.freeUrls[freeUrlKey]);
                }
            }
        });
    }
}

function shibAuthenticated(){
    if ( !$.settings.user.isAuthenticatedThroughShibboleth ) {
        return;
    }
    $.settings.user.isAuthenticatedThroughShibboleth = false;
    var params = new Object();
    params.login = "shibuser";
    params.password = "shibpwd";
    params.policyAccept = true;
    if ( ($.settings.user != undefined) && ($.settings.user.securePwd != undefined) ) {
        params.securePwd = $.settings.user.securePwd.value;
    }

    var callbacks = new Object();
    callbacks.beforeSend = function() {logonFormWaiting(true);};
    callbacks.success    = function() {logonFormConnectCallback();};
    callbacks.complete   = function() {logonFormWaiting(false);};

    authenticate(callbacks, params);
}

function refillAccountPaymentSubscribe( callbacks , params ) {

    var request = new Object();
    request.action = "refill_payment_subscribe";

    if (params == undefined) {
        return false;
    }

    request.login    = params.login;
    request.type     = params.type;
    request.password = params.password;
    request.package  = params.package;

    $.portal_api('action', request, callbacks);
}

/** Request portal API to check voucher and change account options
 * @param callbacks - Callback functions                                [REQUIRED]
 * @param params - The params used to check an existing upgrade order   [REQUIRED]
 * - login : The user's account login                                   [REQUIRED]
 * - refillCode : The voucher to use                                    [REQUIRED]
 */
function refillAccount( callbacks, params ){

    var request = new Object();
    request.action = "refill_account";

    if (params == undefined) {
        return false;
    }

    request.login      = params.login;
    request.refillCode = params.refillCode;
    request.password   = params.password;

    if (params.process != undefined) {
        request.process = params.process;
    }

    if (params.type != undefined) {
        request.type = params.type;
    }

    $.portal_api('action', request, callbacks);
}

/** Request portal API to generate free voucher and change account options
 * @param callbacks - Callback functions                              [REQUIRED]
 * @param params - The params used to check an existing upgrade order [REQUIRED]
 * - login : The user's account login                                 [REQUIRED]
 * - password : user password                                         [REQUIRED]
 * - package : The option used to generate code                       [REQUIRED]
 */
function getFreeRefillCode( callbacks , params ) {

    var request = new Object();
    request.action = "get_free_refill_code";

    if (params == undefined) {
        return false;
    }

    request.login    = params.login;
    request.password = params.password;
    request.package  = params.package;

    if (params.process != undefined) {
        request.process = params.process;
    }

    $.portal_api('action', request, callbacks);
}

/*****************************************************************************/

/** Find all known translations into XML file and replace them in display according to choosen language
 * @param displayLang : Language in which to translate              [OPTIONAL]
 */
function translate(displayLang) {
    if (displayLang == undefined) {
        if ($.settings != undefined && $.settings.user != undefined && $.settings.user.lang != null) {
            displayLang = $.settings.user.lang;
        }
        else {
            displayLang = $.settings.lang.defaultLang;
        }
    }

    var lang = $.translations;

    /* From translations file */
    // Translate title
    $(lang).find('title:eq(0)').each(function() {
        var trans = $(this).find(displayLang).text();
        if (trans == "") {
            trans = $(this).find($.settings.lang.defaultLang).text();
            if (trans == "") {
                trans = $(this).find("en").text();
            }
        }
        document.title = trans;
    });
    // Translate texts
    $(lang).find('text').each(function() {
        var trans = $(this).find(displayLang).text();
        if (trans == "") {
            trans = $(this).find($.settings.lang.defaultLang).text();
            if (trans == "") {
                trans = $(this).find("en").text();
            }
        }
        $(this).find('msgid').each(function() {
            var id = $(this).text();
            $('#' + id).text(trans);
        });
    });
    // Translate buttons
    $(lang).find('button').each(function() {
        var trans = $(this).find(displayLang).text();
        if (trans == "") {
            trans = $(this).find($.settings.lang.defaultLang).text();
            if (trans == "") {
                trans = $(this).find("en").text();
            }
        }
        $(this).find('msgid').each(function() {
            var id = $(this).text();
            var needTranslate = false;
            $('#' + id).contents().filter(function() {
                if(this.nodeType === 3) {//Node.TEXT_NODE
                needTranslate = true;
                }
            });
            if(needTranslate) {
                $('#' + id).text(trans); // old code
            }
        });
    });
    // Translate attribute
    $(lang).find('attribute').each(function() {
        var attribute = $(this);
        $(attribute).find('msgid').each(function() {
            var id = $(this).text();
            $(attribute).find('title').each(function() {
                var trans = $(this).find(displayLang).text();
                if (trans == "") {
                    trans = $(this).find($.settings.lang.defaultLang).text();
                    if (trans == "") {
                        trans = $(this).find("en").text();
                    }
                }
                $('#' + id).attr("title", trans);
            });
        });
    });

    /* From configuration */
    // Translate phone help
    subscriptionForm_phoneHelpBlock_configure(displayLang);
    paypalSubscriptionResultForm_phoneHelpBlock_configure(displayLang);
    ogoneSubscriptionResultForm_phoneHelpBlock_configure(displayLang);
    pwdRecoveryForm_phoneHelpBlock_configure(displayLang);
    manageAccountForm_personal_settings_phoneHelpBlock_configure(displayLang);

    // Translate policies
    configureDOM(displayLang, "policy");
    configureDOM(displayLang, "private_policy");
    logonForm_policy_configure(displayLang);
    autoLogonForm_policy_configure(displayLang);
    subscriptionForm_policy_configure(displayLang, 'one');
    oneSubscriptionForm_connect_policy_configure(displayLang);
    subscriptionForm_policy_configure(displayLang, 'direct');
    subscriptionForm_policy_configure(displayLang, 'print');
    subscriptionForm_policy_configure(displayLang, 'mail');
    subscriptionForm_policy_configure(displayLang, 'sms');
    subscriptionForm_policy_configure(displayLang, 'paypal');
    subscriptionForm_policy_configure(displayLang, 'ogone');
    subscriptionForm_policy_configure(displayLang, 'pps');


    logonForm_privatePolicy_configure(displayLang, 'facebook');
    logonForm_privatePolicy_configure(displayLang, 'twitter');
    logonForm_privatePolicy_configure(displayLang, 'linkedin');
    logonForm_privatePolicy_configure(displayLang, 'google');

    // Translate custom fields
    subscriptionForm_customFields_configure(displayLang, 'direct');
    subscriptionForm_customFields_configure(displayLang, 'one');
    subscriptionForm_customFields_configure(displayLang, 'print');
    subscriptionForm_customFields_configure(displayLang, 'paypal');
    subscriptionForm_customFields_configure(displayLang, 'ogone');
    subscriptionForm_customFields_configure(displayLang, 'mail');
    subscriptionForm_customFields_configure(displayLang, 'sms');
    manageAccountForm_personal_settings_customFields_configure(displayLang);

    // Translate packages
    pmsPaymentForm_packages_configure(displayLang);
    paypalPaymentForm_packages_configure(displayLang);
    paypalPaymentForm_packages_describe(displayLang);
    ogonePaymentForm_packages_configure(displayLang);
    ogonePaymentForm_packages_describe(displayLang);
    accountRefillForm_options_configure(displayLang);
    accountRefillForm_options_describe(displayLang);
    pmsPaymentForm_packages_describe(displayLang);
    upgradeAccountForm_fillIn(displayLang);

    // Translate feedback
    feedbackForm_fillIn(displayLang);
    pwdRecoverySetForm_questionsTranslate(displayLang);
    pwdRecoveryResendForm_questionsTranslate(displayLang);

    //Translate password helpblock
    forceModifyPwdForm_HelpBlock_configure(displayLang);
    modifyPwdForm_HelpBlock_configure(displayLang);
    subscriptionForm_passwordHelpBlock_configure(displayLang, 'print');
    subscriptionForm_passwordHelpBlock_configure(displayLang, 'direct');
    subscriptionForm_passwordHelpBlock_configure(displayLang, 'one');
    subscriptionForm_passwordHelpBlock_configure(displayLang, 'ogone');
    subscriptionForm_passwordHelpBlock_configure(displayLang, 'paypal');

	// Translate Logon feedback
	logonForm_feedback_configure(displayLang);

    /* From custom adds (editor or export) */
    // Translate custom blocks
    // Custom blocks from editor have the lang attribute defined
    $('#body div[lang][id]').each(function() {
        $(this).hide();
    });
    $('#body div[lang="' + displayLang + '"][id]').each(function() {
        $(this).show();
    });

    // Translate error/info message
    displayErrorInfo(displayLang);

    // Switching text direction
    if (displayLang == 'ar') {
        $('body').attr('dir', "rtl");
    }
    else {
        $('body').attr('dir', "ltr");
    }
}

/** Find and return a generic label translation stored into XML file according to choosen language
 * @param label : The label to search translation                   [REQUIRED]
 * @param displayLang : Language in which to translate              [OPTIONAL]
 * @param plural : Return plural label translation                  [OPTIONAL]
 */
function getGenericTranslation( label, displayLang, plural ){

    var trans = "";

    if ( displayLang == undefined || displayLang == null ) {
        if ( $.settings != undefined && $.settings.user != undefined && $.settings.user.lang != null ) {
            displayLang = $.settings.user.lang;
        }
        else {
            displayLang = $.settings.lang.defaultLang;
        }
    }

    var lang = $.translations;
    $(lang).find('generic').each(function (){
        var trans_label = $(this).find('label').text();
        if ( label == trans_label ) {
            if ( plural == true ) {
                trans = $(this).find('plural > ' + displayLang).text();
                if ( trans == "" ) {
                    trans = $(this).find('plural > ' + $.settings.lang.defaultLang).text();
                }
            }
            else {
                trans = $(this).find('> ' + displayLang).text();
                if ( trans == "" ) {
                    trans = $(this).find($.settings.lang.defaultLang).text();
                }
            }
        }
    });
    return trans;
}

/** Find and return an error translation stored into XML file according to choosen language
 * @param id : The id of the error to translate                     [REQUIRED]
 * @param displayLang : Language in which to translate              [OPTIONAL]
 */
function getErrorTranslation(id, displayLang) {

	var trans = "";

	if (displayLang == undefined || displayLang == null) {
		if ($.settings != undefined && $.settings.user != undefined && $.settings.user.lang != null) {
			displayLang = $.settings.user.lang;
		}
		else {
			displayLang = $.settings.lang.defaultLang;
		}
	}

	var lang = $.translations;
	$(lang).find('error').each(function() {
		var msg_found = false;
		$(this).find('msgid').each(function() {
			var trans_id = $(this).text();
			if (id == trans_id) {
				msg_found = true;
				return false;
			}
		});
		if (msg_found) {
			trans = $(this).find(displayLang).text();
			if (trans == "") {
				trans = $(this).find($.settings.lang.defaultLang).text();
			}
		}
	});
	return trans;
}

/** Find and return a input translation stored into XML file according to choosen language
 * @param id : The id of the input to translate                     [REQUIRED]
 * @param displayLang : Language in which to translate              [OPTIONAL]
 */
function getInputTranslation( id, displayLang ){

    var trans = "";

    if ( displayLang == undefined || displayLang == null ) {
        if ( $.settings != undefined && $.settings.user != undefined && $.settings.user.lang != null ) {
            displayLang = $.settings.user.lang;
        }
        else {
            displayLang = $.settings.lang.defaultLang;
        }
    }

    var lang = $.translations;
    $(lang).find('input').each(function (){
        var trans_id = $(this).find('msgid').text();
        if ( id == trans_id ) {
            trans = $(this).find(displayLang).text();
            if ( trans == "" ) {
                trans = $(this).find($.settings.lang.defaultLang).text();
            }
        }
    });
    return trans;
}

/** Find and return a text translation stored into XML file according to choosen language
 * @param id : The id of the input to translate                     [REQUIRED]
 * @param displayLang : Language in which to translate              [OPTIONAL]
 */
function getTextTranslation( id, displayLang ){

    var trans = "";

    if ( displayLang == undefined || displayLang == null ) {
        if ( $.settings != undefined && $.settings.user != undefined && $.settings.user.lang != null ) {
            displayLang = $.settings.user.lang;
        }
        else {
            displayLang = $.settings.lang.defaultLang;
        }
    }

    var lang = $.translations;
    $(lang).find('text').each(function (){
        var trans_id = $(this).find('msgid').text();
        if ( id == trans_id ) {
            trans = $(this).find(displayLang).text();
            if ( trans == "" ) {
                trans = $(this).find($.settings.lang.defaultLang).text();
            }
        }
    });
    return trans;
}

/** Return translation of policy object according to choosen language
 * @param obj : Policy object                                       [REQUIRED]
 * @param lang : Choosen language                                   [OPTIONAL]
 */
function extractPolicyText( obj, lang ){
    var policy = "";
    var link;
    var text;

    if ( obj != undefined && obj.policy != undefined && obj.policy.display == true ) {
        if ( lang != undefined && obj.policy[lang] != undefined ) {
            text = obj.policy[lang].text;
            link = obj.policy[lang].link;
        }
        else if ( obj.policy.defaultLang != undefined && obj.policy[obj.policy.defaultLang] != undefined ) {
            text = obj.policy[obj.policy.defaultLang].text;
            link = obj.policy[obj.policy.defaultLang].link;
        }
        else if ( $.settings.lang.defaultLang != undefined && obj.policy[$.settings.lang.defaultLang] != undefined ) {
            text = obj.policy[$.settings.lang.defaultLang].text;
            link = obj.policy[$.settings.lang.defaultLang].link;
        }
        if (link != undefined) {
            policy = '<a target="_blank" href="' + link + '">' + text + '</a>';
        }
        else {
            policy = text;
        }
    }
    return policy;
}

/** Return translation of policy object according to choosen language
 * @param obj : Policy object                                       [REQUIRED]
 * @param lang : Choosen language                                   [OPTIONAL]
 */
function extractPolicyResume(obj, lang) {
    var policy = "";
    var resume;

    if (obj != undefined && obj.policy != undefined && obj.policy.display == true) {
        if (lang != undefined && obj.policy[lang] != undefined) {
            resume = obj.policy[lang].resume;
        } else if (obj.policy.defaultLang != undefined && obj.policy[obj.policy.defaultLang] != undefined) {
            resume = obj.policy[obj.policy.defaultLang].resume;
        } else if ($.settings.lang.defaultLang != undefined && obj.policy[$.settings.lang.defaultLang] != undefined) {
            resume = obj.policy[$.settings.lang.defaultLang].resume;
        }

        policy = resume;
    }

    return policy;
}

/** Start user refresh connection action at interval
 */
function startRefresh(){
    if ( refreshObj.ressource == undefined ) {
        refreshObj.ressource = window.setInterval(function (){
            doRefresh();
        }, refreshObj.refreshInterval);
    }
}

/** Stop user refresh connection action
 */
function stopRefresh(){
    if ( refreshObj.ressource != undefined ) {
        window.clearInterval(refreshObj.ressource);
    }
    refreshObj = new Object();
}

/** Send refresh connection request to controller
 */
function doRefresh(){
    var callbacks = new Object();
    // callbacks.beforeSend = function() {}; // TODO
    callbacks.success = function (){
        refreshCallback();
    };
    // callbacks.complete   = function() {}; // TODO

    refresh(callbacks, refreshObj);
}

/** Callback function of doRefresh function
 */
function refreshCallback(){

    displayErrorInfo();
    if ( $.settings.error != undefined ) {
        stopRefresh();
        /// TODO complete cases
        feedbackFormDisconnect();
        //displayStep();
    }
}

/** Clear user settings stored in javascript variables
*/
function clearUserSettings() {
    if ($.settings != undefined && $.settings.user != undefined) {
        var lang = $.settings.user.lang;
        if ($.settings.user.securePwd != undefined) {
            var securePwd = $.settings.user.securePwd.value;
        }
        delete $.settings.user;
        $.settings.user = new Object();
        $.settings.user.lang = lang;
        if (securePwd != undefined) {
            $.settings.user.securePwd = new Object();
            $.settings.user.securePwd.value = securePwd;
        }
		// clean user pms optional fields information
		if ($.settings.pmsoptionalfields != undefined) {
			delete $.settings.pmsoptionalfields;
		}
    }
}

/** Clear user settings stored in javascript variables
*/
function clearPaymentSettings() {
    if ($.settings != undefined && $.settings.payment != undefined && $.settings.payment.status != undefined) {
        if ($.settings.payment.status == "completed") {
            delete $.settings.payment;
            $.settings.payment = new Object();
        }
    }
}

/** Explode Javascript Date object into usable values
 * @param date : Javascript date object to explode                  [REQUIRED]
 */
function explodeDate( date ){
    var result = new Object();

    result.year = date.getFullYear(); // 4 digits year
    result.monthNumber = date.getMonth() + 1; // getMonth (0-11). January is 0, February is 1, and so on.
    var months = new Array('january', 'february', 'march', 'april', 'may', 'june', 'july', 'august', 'september', 'october', 'november', 'december');
    result.month = months[date.getMonth()];
    result.dayNumber = date.getDate(); // (1-31)
    var days = new Array('sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday');
    result.day = days[date.getDay()]; // getDate (0-6). Sunday is 0, Monday is 1, and so on.
    result.hours = new Array();
    result.hours[24] = date.getHours(); // (0-23)
    if ( date.getHours() == 0 ) {
        result.hours[12] = "12";
        result.hours['ext'] = "am";
    }
    else if ( date.getHours() == 12 ) {
        result.hours[12] = date.getHours();
        result.hours['ext'] = "pm";
    }
    else if ( date.getHours() > 12 ) {
        result.hours[12] = date.getHours() - 12;
        result.hours['ext'] = "pm";
    }
    else {
        result.hours[12] = date.getHours();
        result.hours['ext'] = "am";
    }
    result.minutes = date.getMinutes(); // (0-59)
    result.seconds = date.getSeconds(); // (0-59)

	return result;
}

/**
 * Convert quota bytes into proper human format
 */
function convertReadableQuota(vol_byte) {
	var res = new Object();
	res.val = vol_byte / (1024 *1024);
	res.unit = (res.val > 1000) ? 'GB' : 'MB';
	if (res.unit == 'GB') {
		res.val /= 1024;
	}
	return res;
}

function getForcedDisconnectionTimerDisplayText(value, displayLang) {
	var hours = Math.floor(value / 3600);
	var mins = Math.floor((value - (hours * 3600)) / 60);
	var seconds = value - (hours * 3600) - (mins * 60);

	var hours_label = getGenericTranslation('hour', displayLang, (hours > 1));
	var mins_label = getGenericTranslation('minute', displayLang, (mins > 1));
	var seconds_label = getGenericTranslation('second', displayLang, (seconds > 1));

	return $.sprintf(getGenericTranslation('forced-disconnection-display-with-seconds', displayLang), hours, hours_label, mins, mins_label, seconds, seconds_label);
}
/************************************
* duplicate block general condition *
*************************************/

function addPolicyText(eltId, policy, lang) {
    var policy_text = extractPolicyText(policy, lang);
    var policy_resume = extractPolicyResume(policy, lang);
    $('#' + eltId + '_text').html(policy_text);
    if ( ! policy_resume) {
        $('#' + eltId + '_resume').css("display", "none"); // Hide description block
        $('#' + eltId + '_style').removeClass('active'); // Reset toggle button
        $('#' + eltId + '_button').hide(); // Hide toggle description button
        $('#' + eltId + '_text').parent().css('width', '100%'); // Take full width of the block for the text
    }
    else {
        $('#' + eltId + '_resume').html(policy_resume);
        $('#' + eltId + '_button').show(); // Show toggle description button
        $('#' + eltId + '_text').parent().css('width', '');
    }
}

function condition_general_policy_configure(displayLang, src_elementid, dst_elementid, policyNew) {
    if (policyNew.policy != undefined && policyNew.policy.display) {
        $('#' + src_elementid).clone()
            .appendTo('#' + dst_elementid + '_container')
            .attr('id', dst_elementid + '_block')
            .show().find("*").each(function () {
                var regexp = /(condition_general_policy_)(.+)/i;
                var id = this.id || "";
                var name = this.name || "";
                var select = $(this).attr('for') || "";
                var match = id.match(regexp) || [];
                if (match.length == 3) {
                    this.id = dst_elementid + "_" + match[2];
                    if (name != "") {
                        this.name = dst_elementid + "_" + match[2]
                    }
                }
                match = select.match(regexp) || [];
                if (match.length == 3) {
                    $(this).attr('for', dst_elementid + '_' + match[2]);
                }
            });
        addPolicyText(dst_elementid, policyNew, displayLang);

        // CONFIGURE OPTIN MANDATORY
        if (policyNew.policy.mandatory != undefined && policyNew.policy.mandatory === false) {
            $('#' + dst_elementid + '_state').css("visibility", "hidden");
            $('.fields_state_block').css("display", "none");
        }
        else {
            $('#' + dst_elementid + '_state').css("visibility", "visible");
            $('.fields_state_block').css("display", "inline");
        }
    }
}

function configureDOM(displayLang, type) {
    var src_elementid = "condition_general_policy_block";
    var a_target_id = [];
    var dst_elementid;
    var i = 0;

    if (type == "policy" || type == "private_policy") {
        var policyNew = new Object();
        
        if (type == "policy") {
            // Policy for modes logon, One click, pps
            a_target_id = [
                            'logonForm_logon_policy',
                            'logonForm_socialNetwork_policy',
                            'oneSubscriptionForm_connect_policy',
                            'ppsSubscriptionForm_policy'
                        ];
            policyNew.policy = $.settings.logon.policy;
        }
        else if ($.settings.private_policy[0] != undefined){
            // OptIn for Logon, All subscription mode, Social networks, and manageAccount
            a_target_id = [
                            'subscriptionForm_privatePolicy',
                            'logonForm_logon_privatePolicy',
                            'manageAccountForm_privatePolicy',
                            'logonForm_socialNetwork_privatePolicy'
                        ];
            policyNew.policy = ($.settings.private_policy != undefined) ? $.settings.private_policy[0]: undefined;
            policyNew.policy.display = (policyNew.policy != undefined && policyNew.policy.display != undefined) ? policyNew.policy.display : true;
        }
        for (i = 0; a_target_id[i] != undefined; i++) {
            dst_elementid = a_target_id[i];
            if ($('#' + dst_elementid + '_container').is(':empty')) {
                condition_general_policy_configure(displayLang, src_elementid, dst_elementid, policyNew);
                spread_general_policy_value(dst_elementid, a_target_id);
            }
            else if (policyNew.policy != undefined) {
                addPolicyText(dst_elementid, policyNew, displayLang);
            }
        }
        if ($.settings != undefined && $.settings.informativeWidget != undefined && type == "private_policy") {
            // User is known through its IP. Set Optin By default on logon and social network (if exists) with this user's value
            if ($.settings.informativeWidget.privatePolicy != undefined) {
                optin_value = $.settings.informativeWidget.privatePolicy.value;
                $('#logonForm_logon_privatePolicy_accept').attr("checked", optin_value);
                $('#manageAccountForm_privatePolicy_accept').attr("checked", optin_value);
            }
        }
    }
}

function spread_general_policy_value(elt_clicked, $all_element) {
    $('#' + elt_clicked + '_accept').click(function () {
        for (var i = 0; $all_element[i] != undefined; i++) {
			$('#' + $all_element[i] + '_accept').attr('checked', $('#' + elt_clicked + '_accept').is(':checked'));
        }
	});
}

function is_in_ucopia_oob() {
	return ( $.settings.user != undefined && $.settings.user.satellite_URL != undefined
			&& $.settings.user.nas_constructor != null && $.settings.user.nas_constructor == 'ucopia' );
}

/*****************************************************************************/
/****                 Lang Block JavaScript functions                  ****/
/*****************************************************************************/

/** This function is triggered when the page is loaded
 */
$(document).ready(function (){

    /** Links triggers
     */
    $('#lang_link\\[fr\\]').click(function (){
        lang_block_translate('fr');
    });
    $('#lang_link\\[de\\]').click(function (){
        lang_block_translate('de');
    });
    $('#lang_link\\[en\\]').click(function (){
        lang_block_translate('en');
    });
    $('#lang_link\\[es\\]').click(function (){
        lang_block_translate('es');
    });
    $('#lang_link\\[it\\]').click(function (){
        lang_block_translate('it');
    });
    $('#lang_link\\[nl\\]').click(function (){
        lang_block_translate('nl');
    });
    $('#lang_link\\[pt\\]').click(function (){
        lang_block_translate('pt');
    });
    $('#lang_link\\[pl\\]').click(function (){
        lang_block_translate('pl');
    });
    $('#lang_link\\[zh_CN\\]').click(function (){
        lang_block_translate('zh_CN');
    });
    $('#lang_link\\[zh_TW\\]').click(function (){
        lang_block_translate('zh_TW');
    });
    $('#lang_link\\[ar_LB\\]').click(function (){
        lang_block_translate('ar');
    });
    $('#lang_link\\[ko\\]').click(function (){
        lang_block_translate('ko');
    });
    $('#lang_link\\[ja\\]').click(function (){
        lang_block_translate('ja');
    });
    $('#lang_link\\[th\\]').click(function (){
        lang_block_translate('th');
    });
    $('#lang_link\\[ru\\]').click(function (){
        lang_block_translate('ru');
    });
    $('#lang_link\\[id\\]').click(function (){
        lang_block_translate('id');
    });
});

/** Configure lang_block depending on settings
 */
function lang_block_configure(){

    if ( $.settings != undefined && $.settings.lang != undefined && $.settings.lang.displayLang != undefined ) {
        if ( $.settings.lang.displayLang.length == 1 ) {
            $('#lang_block').hide();
        }
        else {
            $('#lang_block').show();
            for ( lang_itt = 0; lang_itt < $.settings.lang.displayLang.length; lang_itt++ ) {
                if ( $.settings.lang.displayLang[lang_itt] == 'ar' ) {
                    $('#lang_link\\[ar_LB\\]').show();
                }
                else {
                    $('#lang_link\\[' + $.settings.lang.displayLang[lang_itt] + '\\]').show();
                }
            }
        }
    }
}

/** Executed when links are clicked
 * @param string displayLang - The choosen display language
 */
function lang_block_translate( displayLang ){
    if ( $.settings.user == undefined ) {
        $.settings.user = new Object();
    }
    $.settings.user.lang = displayLang;

    var params = new Object();
    params.language = displayLang;

    translate(displayLang);
    // Register the new language on the server

	var callbacks = new Object();
	callbacks.success = function () {
		// we have probably missed apple cna wispr sniff, reload the page to re-launch it
		if ( isAppleCNA && $.settings && $.settings.step == 'FEEDBACK'
				&& $.settings.user && $.settings.user.firstTimeArrivalFromRedirection ) {
			window.location.reload(true);
		}
	};

    switchLanguage(callbacks, params);
}

/*****************************************************************************/
/****              Secure Password Form JavaScript functions              ****/
/*****************************************************************************/

/** This function is triggered when the page is loaded
 */
$(document).ready(function (){

    /** Inputs triggers
     */
// 	$('form[name=securePwdForm] input[name=secure_pwd]').change(function() {
// 		///
// 	});

    /** Buttons triggers
     */
    $('#securePwdForm_access_button').click(function (){
        //securePwdFormAccess();
    });

    /** Form triggers
     */
    $('form[name="securePwdForm"]').submit(function (){
        securePwdFormAccess();
        return false;
    });
});

/** Configure securePwdForm depending on settings
 */
function securePwdForm_configure(){

    // Configure display
    if ( $.settings.securePwd == true ) {
        // Nothing to do
    }
    else {
        $('form[name="securePwdForm"]').remove();
    }
}

/** Display securePwdForm depending on settings
 * Can be overwritten by state
 * @param boolean state - Indicate if the form must be displayed or not
 */
function securePwdForm_display( state ){

    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }
    else if ( $.settings.step == "SECURE_PWD" ) {
        display = true;
    }

    if ( display == true ) {
        $('form[name="securePwdForm"]').show();
    }
    else {
        $('form[name="securePwdForm"]').hide();
        securePwdForm_empty();
    }
}

/** Empty securePwdForm
 */
function securePwdForm_empty(){

    $('form[name="securePwdForm"] input').each(function (){
        $(this).val('');
    });
}

/** Enable waiting mode on securePwdForm
 */
function securePwdFormWaiting( state ){
    switch ( state ) {
        case true:
            $('body').toggleClass("cursor-wait");
            break;
        case false:
            $('body').toggleClass("cursor-wait");
            break;
    }
}

/** Executed when button is clicked
 */
function securePwdFormAccess(){

    var params = new Object();
    // Mandatory parameters
    params.securePwd = $('form[name="securePwdForm"] input[name="secure_pwd"]').val();

    var callbacks = new Object();
    callbacks.beforeSend = function (){
        securePwdFormWaiting(true);
    };
    callbacks.success = function (){
        securePwdFormAccessCallback();
    };
    callbacks.complete = function (){
        securePwdFormWaiting(false);
    };

    securePwd(callbacks, params);
}

/** Executed on return of securePwdFormAccess function
 */
function securePwdFormAccessCallback(){

    displayErrorInfo();
    if ( $.settings.error == undefined ) {
        if ( $.settings.user == undefined ) {
            $.settings.user = new Object();
        }
        if ( $.settings.user.securePwd == undefined ) {
            $.settings.user.securePwd = new Object();
        }
        $.settings.user.securePwd.value = $('form[name="securePwdForm"] input[name="secure_pwd"]').val();
        displayStep();
    }
}

/*****************************************************************************/
/****           Force Modify Password Form JavaScript functions           ****/
/*****************************************************************************/

/** This function is triggered when the page is loaded
 */
$(document).ready(function (){

    /** Inputs triggers
     */
// 	$('form[name=forceModifyPwdForm] input[name=old_pwd]').change(function() {
// 		///
// 	});
// 	
// 	$('form[name=forceModifyPwdForm] input[name=new_pwd]').change(function() {
// 		///
// 	});
// 	
// 	$('form[name=forceModifyPwdForm] input[name=confirm_pwd]').change(function() {
// 		///
// 	});

    /** Buttons triggers
     */
    $('#forceModifyPwdForm_back_button').click(function (){
        forceModifyPwdFormBack();
    });

    $('#forceModifyPwdForm_confirm_button').click(function (){
        forceModifyPwdFormConfirm();
    });

    /** Form triggers
     */
    $('form[name="forceModifyPwdForm"]').submit(function (){
        return false;
    });
    $('#forceModifyPwdForm_help_link').click(function (){
        forceModifyPwdForm_HelpBlock_display();
    });
    // CHANGED_BY_HH
    // added to display the help, when user click on password field
    $('#uc-new_pwd_mod_force').click(function (){
        forceModifyPwdForm_HelpBlock_display(true);
    });


});

/** Configure forceModifyPwdForm depending on settings
 */
function forceModifyPwdForm_configure(){

    // Configure display
    if ( $.settings.forceModifyPwd == true ) {
        // Nothing to do
    }
    else {
        $('form[name="forceModifyPwdForm"]').remove();
    }
}

/** Display forceModifyPwdForm depending on settings
 * Can be overwritten by state
 * @param boolean state - Indicate if the form must be displayed or not
 */
function forceModifyPwdForm_display( state ){

    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }
    else if ( $.settings.step == "FORCE_MODIFY_PWD" ) {
        display = true;
    }

    if ( display == true ) {
        $('form[name="forceModifyPwdForm"]').show();
        if ( $.settings.user.pwdConstraint != undefined ) {
            $('#forceModifyPwdForm_help_tr').show();
        }
    }
    else {
        $("#forceModifyPwdForm_help_block").hide();
        $('form[name="forceModifyPwdForm"]').hide();
        forceModifyPwdForm_empty();
    }
}

/** Empty forceModifyPwdForm
 */
function forceModifyPwdForm_empty(){

    $('form[name="forceModifyPwdForm"] input').each(function (){
        $(this).val('');
    });
}

/** Executed when back button is clicked
 */
function forceModifyPwdFormBack(){

    var callbacks = new Object();
    // callbacks.beforeSend = function() {}; // TODO
    callbacks.success = function (){
        forceModifyPwdFormBackCallback();
    };
    // callbacks.complete   = function() {}; // TODO

    backAction(callbacks);
}

/** Executed on return of forceModifyPwdFormBack function
 */
function forceModifyPwdFormBackCallback(){

    displayErrorInfo();
    displayStep();
}

/** Enable waiting mode on forceModifyPwdForm
 */
function forceModifyPwdFormWaiting( state ){
    switch ( state ) {
        case true:
            $('#forceModifyPwdForm_back_button').attr("disabled", true);
            $('#forceModifyPwdForm_confirm_button').attr("disabled", true);
            $('body').toggleClass("cursor-wait");
            break;
        case false:
            $('#forceModifyPwdForm_back_button').attr("disabled", false);
            $('#forceModifyPwdForm_confirm_button').attr("disabled", false);
            $('body').toggleClass("cursor-wait");
            break;
    }
}

/** Executed when confirm button is clicked
 */
function forceModifyPwdFormConfirm(){

    var params = new Object();
    // Mandatory parameters
    params.login = $.settings.user.login.value;
    params.password = $('form[name="forceModifyPwdForm"] input[name="old_pwd"]').val();
    params.newPassword = $('form[name="forceModifyPwdForm"] input[name="new_pwd"]').val();
    params.newPasswordConfirm = $('form[name="forceModifyPwdForm"] input[name="confirm_pwd"]').val();

    if ( ($.settings.user != undefined) && ($.settings.user.securePwd != undefined) ) {
        params.securePwd = $.settings.user.securePwd.value;
    }

    var callbacks = new Object();
    callbacks.beforeSend = function (){
        forceModifyPwdFormWaiting(true);
    };
    callbacks.success = function (){
        forceModifyPwdFormConfirmCallback();
    };
    callbacks.complete = function (){
        forceModifyPwdFormWaiting(false);
    };

    forceModifyPwd(callbacks, params);
}

/** Executed on return of forceModifyPwdFormConfirm function
 */
function forceModifyPwdFormConfirmCallback(){

    displayErrorInfo();
    if ( $.settings.error == undefined ) {
        displayStep();
    }
}

/** Display forceModifyPwdFormHelpBlock_display when help link is clicked
 * @param boolean state - Indicate if the block must be displayed or not
 */
function forceModifyPwdForm_HelpBlock_display( state, displayLang ){
    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }
    else if ( $('#forceModifyPwdForm_help_block').is(':hidden') == true ) {
        display = true;
    }

    if ( display == true ) {
        if ( translationsAreLoaded == true ) {
            forceModifyPwdForm_HelpBlock_configure(displayLang);
        }
        $('#forceModifyPwdForm_help_block').show();
    }
    else {
        $('#forceModifyPwdForm_help_block').hide();
    }
}

/** Configure forceModifyPwdForm_help_block
 * @param string displayLang - The language whish to display the content
 */
function forceModifyPwdForm_HelpBlock_configure( displayLang ){
    if ( $.settings != undefined && $.settings.user != undefined && $.settings.user.pwdConstraint != undefined ) {
        if ( $('#forceModifyPwdForm_help_list').children().length > 1 ) {
            $('#forceModifyPwdForm_help_list li').not(":first").remove();
        }
        /* Update the content of the help box to display to the user the password
         * policy in use for his profile */
        //var help_block = $('#forceModifyPwdForm_help_block').clone();
        $("#forceModifyPwdHelpBlock_text").text(getInputTranslation('forceModifyPwdForm_help_text', displayLang));
        var constraintValues = new Array("minLength", "maxLength");
        for ( key in constraintValues ) {
            var val = constraintValues[key];
            var line = $('#forceModifyPwdForm_help_list li:first').clone();
            line.toggle();
            line.text($.sprintf(getInputTranslation("forceModifyPwdForm_help_" + val, displayLang), $.settings.user.pwdConstraint.value[val]));
            $('#forceModifyPwdForm_help_list').append(line);
        }
        for ( key in $.settings.user.pwdConstraint.value.characterSet ) {
            var set = $.settings.user.pwdConstraint.value.characterSet[key];
            if ( set.quota > 0 ) {
                var line = $('#forceModifyPwdForm_help_list li:first').clone();
                line.toggle();
                line.text($.sprintf(getInputTranslation("forceModifyPwdForm_help_character_set_text", displayLang), set.quota, set.set.join("")));
                $('#forceModifyPwdForm_help_list').append(line);
            }
        }
    }
}

/*****************************************************************************/
/****                   Logon Form JavaScript functions                   ****/
/*****************************************************************************/

/** This function is triggered when the page is loaded
 */
$(document).ready(function () {

	/** Input triggers
	 */
	// 	$('form[name=logonForm] input[name=login]').change(function() {
	// 		///
	// 	});
	//
	// 	$('form[name=logonForm] input[name=password]').change(function() {
	// 		///
	// 	});
	//
	// 	$('form[name=logonForm] input[name=policy_accept]').change(function() {
	// 		///
	// 	});

	/** Buttons triggers
	 */
	/*==============================
	  script toggle general condition
	  ===============================*/

	$('#logonForm_standard_authentication_button').click(function () {
		logonForm_toggle_show_authentication_modes(false);
	});

	$('#logonForm_authentication_form_back_button').click(function () {
		logonForm_toggle_show_authentication_modes(true);
	});

	$('#logonForm_shibboleth_authentication_button').click(function () {
		socialNetworkConnect("shibboleth");
	});

	$('#logonForm_privatePolicy_back_button').click(function () {
		logonForm_close_privatePolicy_dialog("logonForm");
	});

	$('#logonForm_privatePolicy_cross_span').click(function () {
		logonForm_close_privatePolicy_dialog("logonForm");
	});
	/** Link triggers
	 */
	$('#facebookLink').click(function () {
		socialNetworkConnect("facebook");
	});
	$('#googleLink').click(function () {
		socialNetworkConnect("google");
	});
	$('#linkedinLink').click(function () {
		socialNetworkConnect("linkedin");
	});
	$('#twitterLink').click(function () {
		socialNetworkConnect("twitter");
	});
	$('#samlLink').click(function() {
		socialNetworkConnect('saml');
	});

	/** Form triggers
	 */
	$('form[name="logonForm"]').submit(function () {
		logonFormConnect();
		return false;
	});
});

/** Configure logonForm depending on settings
 */
function logonForm_configure() {

	// Configure policy display
	if ($.settings.logon != undefined && $.settings.logon.policy != undefined && $.settings.logon.policy.display == true) {
		logonForm_policy_configure();
	} else {
		$('#logonForm_policy_block').remove();
	}

	// configure shibboleth
	if ($.settings.auth_modes && $.settings.auth_modes.shibboleth) {
		logonForm_toggle_show_authentication_modes(true);
		if (!$.settings.auth_modes.standard) {
			$('#logonForm_subscriptionChoice_top_title_block').hide();
			$('#logonForm_subscriptionChoice_block').hide();
			$('#logonForm_standard_authentication_button').hide();
			$('#logonForm_auth_modes_block').show();
		}
	}

	if ($.settings.auth_modes != undefined) {
		// Configure social networks
		if ($.settings.auth_modes.facebook) {
			$('#logonForm_socialNetworkChoice_grid').show();
			$('#facebookLink').show();
			if ($.settings.logon != undefined && $.settings.logon.facebook != undefined && $.settings.logon.facebook.need_like) {
				$('div#facebookLike').show();
				if ($.settings.logon.facebook.url_like != undefined && $.settings.logon.facebook.url_like != '') {
					$('label#logonForm_facebook_like_url').text($.settings.logon.facebook.url_like);
				}
			} else {
				$('div#facebookLike').hide();
			}
		}
		if ($.settings.auth_modes.google) {
			$('#logonForm_socialNetworkChoice_grid').show();
			$('#googleLink').show();
		}
		if ($.settings.auth_modes.linkedin) {
			$('#logonForm_socialNetworkChoice_grid').show();
			$('#linkedinLink').show();
		}
		if ($.settings.auth_modes.twitter) {
			$('#logonForm_socialNetworkChoice_grid').show();
			$('#twitterLink').show();
			if ($.settings.logon != undefined && $.settings.logon.twitter != undefined && $.settings.logon.twitter.need_follow) {
				$('div#twitterFollow').show();
				if ($.settings.logon.twitter.name_follow != undefined && $.settings.logon.twitter.name_follow != '') {
					$('label#logonForm_twitter_follow_auto_screen_name').text('@' + $.settings.logon.twitter.name_follow);
				}
			} else {
				$('div#twitterFollow').hide();
			}
		}

		//OpenID Connect providers
		var authModeOpenidconnectEnabled = false;
		for (key in $.settings.auth_modes) {
			if (key.match(/^openidconnect_[\d]*$/)) {
				$('#logonForm_socialNetworkChoice_openid_grid').append('<div class="openidDiv hoverLink" title="Use your OpenID Connect credentials" onclick="socialNetworkConnect(\'' + key + '\')"><div id="' + key + 'Link" class="openidconnectSmallBox" style="display:none"></div><label class="openidSpan">' + $.settings.auth_modes[key] + '</label></div>');
				$('#logonForm_socialNetworkChoice_openid_grid').show();
				$('#' + key + 'Link').show();

				authModeOpenidconnectEnabled = true;
			}
		}

		// wispr mode
		if ($.settings.auth_modes.wispr) {
			$('#logonForm_wispr_grid').show();
			if ($.settings.wispr && $.settings.wispr.operator_realm) {
				$.each($.settings.wispr.operator_realm, function (operator, realm) {
					$('select#user_wispr_operator').append('<option value="' + operator + '">' + operator + '</option>');
				});
				// link trigger on select list
				$('select#user_wispr_operator').change(function () {
					var current_operator = $(this).val();
					var potential_realm = $.settings.wispr.operator_realm[current_operator];
					var auto_complete_realm = null;
					if ('string' == typeof (potential_realm) && potential_realm.length > 0) {
						// do a little intelligence here to detect different format of realm
						var index_point = potential_realm.indexOf('.');
						// realm contains at least a point, and it is not the last character, then we consider it will be combined by @
						if (0 < index_point && index_point < potential_realm.length - 1) {
							auto_complete_realm = '@' + potential_realm;
						}
						// we will combine the realm by / as default case
						else {
							auto_complete_realm = potential_realm + '/';
						}
					}
					/*
					 * feel free to add customization to force some auto-complete realm here
					 * simple example in one line:
					 *  if (current_operator == 'ipass') { auto_complete_realm = 'IPASS/'; }
					 */
					if (auto_complete_realm) {
						// auto-complete the suggested realm into login
						$('form[name="logonForm"] input[name="login"]').val(auto_complete_realm);
					}
				});
			}
		}

		if ($.settings.auth_modes.saml) {
			$('#logonForm_saml_grid').show();
			if ($.settings.saml && $.settings.saml.name) {
				$('div#logonForm_saml_grid label.samlSpan').text($.settings.saml.name);
			}
		}

		/*
		 * In case authentification by credential is disabled and one of the social network connection is enabled
		 */
		if (!$.settings.auth_modes.standard &&
			($.settings.auth_modes.facebook ||
				$.settings.auth_modes.google ||
				$.settings.auth_modes.linkedin ||
				$.settings.auth_modes.twitter ||
				authModeOpenidconnectEnabled ||
				$.settings.auth_modes.saml)) {
			$('#logonForm_logon_block_credentials').hide();
		}
	}

	// Configure register link
	if ($.settings.subscribe != undefined && $.settings.subscribe.count > 0) {
		$('#logonForm_subscriptionChoice_top_title_block').show();
		$('#logonForm_subscriptionChoice_block').show();
	} else {
		// No subscribe mode
		$('#logonForm_subscriptionChoice_block').hide();
	}
}


/* If more than one authentication mode has been configured, this function
 * displays an additional step where the user can choose his mode.
 * if false is given, this step is hidden
 */
function logonForm_toggle_show_authentication_modes(show) {
	$('#logonForm_auth_modes_block').toggle(show);
	$('#logonForm_logon_block_credentials').toggle(!show);
	$('#logonForm_authentication_form_back_button').toggle(!show);
}

/* If a policy acceptance is required by the portal configuration, this function
 * checks that the corresponding checkbox has been clicked.
 */
function logonForm_policy_is_ok() {
	var need_policy = ($.settings.logon != undefined && $.settings.logon.policy != undefined && $.settings.logon.policy.display == true);
	var policy_checked = ($('form[name="logonForm"] input[name="logonForm_logon_policy_accept"]').is(':checked'));
	return !need_policy || policy_checked;
}

/** Configure logonForm_policy_block
 * @param string lang - The language whish to display the policy
 */
function logonForm_policy_configure(lang) {
	if ($.settings.auth_modes != undefined && !$.settings.auth_modes.standard) {
		$("#logonForm_policy_block").detach().appendTo('#no_logonForm_logon_block_credentials');
	}

	if ($.settings.logon != undefined && $.settings.logon.policy != undefined) {
		var policy = extractPolicyText($.settings.logon, lang);
		var policyResume = extractPolicyResume($.settings.logon, lang);
		$('#logonForm_logon_policy_text').html(policy);
		$('#logonForm_policy_resume').html(policyResume);
	}
}


/** Configure logonForm_privatePolicy_block
 * @param string displayLang - The language whish to display the policy
 * @param string mode - the mode to configure
 */
function logonForm_privatePolicy_configure(displayLang, mode) {

	var policy = null;
	try {
		policy = eval('$.settings.logon.' + mode + '.policy');
	} catch (ex) {
		policy = null;
	}
	if (policy == undefined || policy == null) {
		return;
	}
	var policyWrapper = new Object();
	policyWrapper.policy = policy;
	if (displayLang == undefined || displayLang == null) {
		displayLang = getUserLanguage_default();
	}
	$('#logonForm_socialNetwork_privatePolicy_text').html(extractPolicyText(policyWrapper, displayLang));
	$('#logonForm_socialNetwork_privatePolicy_resume').html(extractPolicyResume(policyWrapper, displayLang));
}


/** Display logonForm depending on settings
 * Can be overwritten by state
 * @param boolean state - Indicate if the form must be displayed or not
 */
function logonForm_display(state) {

	var display = false;
	if ((state == true) || (state == false)) {
		display = state;
	} else if (($.settings.step == "LOGON") && ((typeof informativeWidget_configure != 'function') || ($.settings.informativeWidget == undefined))) {
		display = true;
	}

	// Registration block to be displayed above login block
	if ($.settings.displayRegistrationFirst && ($.settings.subscribe.sms === undefined || $.settings.subscribe.sms.user === undefined)) {
		$('#logonForm_subscriptionChoice_block').insertBefore($("#logonForm_block"));
	}

	if (($.settings.subscribe.sms !== undefined && $.settings.subscribe.sms.user !== undefined)) {
		var usr = $.settings.subscribe.sms.user;
		logonForm_feedback_configure();

		$("#uc-logonForm-login").val(usr.login);
		if (usr.login.length > 0) {
			// Hide Login since user tries to register via sms
			$("#logonForm_login_block").hide();
			// Show phone number information
			$("#logonForm_login_sms_info_block").show();
		}
	}

	if (display == true) {
		$('form[name="logonForm"]').show();
	} else {
		$('form[name="logonForm"]').hide();
		logonForm_empty();
	}
}

function logonForm_feedback_configure(displayLang) {
	var trans = getTextTranslation('logonForm_login_info_text', displayLang);
	var usr = ($.settings.subscribe.sms !== undefined) ? $.settings.subscribe.sms.user:undefined;
	if (usr !== undefined) {
		var information_text = $.sprintf(trans, usr.prefix, usr.phone);
		$("#logonForm_login_info_text").text(information_text);
	}
}

/** Empty logonForm
 */
function logonForm_empty() {

	// Emptying only password input
	$('form[name="logonForm"] input[name="password"]').val('');
}

/** Enable waiting mode on logonForm
 */
function logonFormWaiting(state) {
	switch (state) {
		case true:
			$('body').toggleClass("cursor-wait");
			break;
		case false:
			$('body').toggleClass("cursor-wait");
			break;
	}
}

/** Executed when button is clicked **/
function logonFormConnect() {

	var params = new Object();
	params.login = $('form[name="logonForm"] input[name="login"]').val();
	params.password = $('form[name="logonForm"] input[name="password"]').val();
	params.policyAccept = $('form[name="logonForm"] input[name="logonForm_logon_policy_accept"]').is(':checked');
	params.privatePolicyAccept = $('form[name="logonForm"] input[name="logonForm_logon_privatePolicy_accept"]').is(':checked');
	params.wispr_mode = $('form[name="logonForm"] input[name="wispr_mode"]').is(':checked') ? 'true' : 'false';

	if (($.settings.user != undefined) && ($.settings.user.securePwd != undefined)) {
		params.securePwd = $.settings.user.securePwd.value;
	}

	// send cna id if necessary
	var send_cna_id = $.portal_api('isInAutoConnect');
	var cna_id = $.portal_api('getCnaId');
	if (send_cna_id == true && cna_id != null) {
		params.cna_id = cna_id;
	}

	var callbacks = new Object();
	callbacks.beforeSend = function () {
		logonFormWaiting(true);
	};
	callbacks.success = function () {
		logonFormConnectCallback();
	};
	callbacks.complete = function () {
		logonFormWaiting(false);
	};

	authenticate(callbacks, params);
}

/** Executed on return of logonConnect function **/
function logonFormConnectCallback() {

	displayErrorInfo();
	if ($.settings.error == undefined) {
		if ($.settings.user == undefined) {
			$.settings.user = new Object();
		}
		if ($.settings.user.login == undefined) {
			$.settings.user.login = new Object();
			$.settings.user.login.value = $('form[name="logonForm"] input[name="login"]').val();
		}

		// Refresh will be done by feedback
		displayStep();
		if (isAppleCNA && $.settings.step != undefined && $.settings.step == "FEEDBACK") {
			// try to refresh page to get feedback in normal browser (safari) on newer device of apple
			window.location.reload(true);
			// we arrive into this block only when we are in standalone mode, so it isn't necessary to pass information from CNA to real portal
		}
	}
}

/** Display the multi mode choice page depending on state
 * @param boolean state - Indicate if the page must be displayed or not
 */
function logonFormSubscribeChoice_display(state) {

	var display = false;
	if ((state == true) || (state == false)) {
		display = state;
	}

	if (display == true) {
		$('#subscriptionChoice').show();
	} else {
		$('#subscriptionChoice').hide();
	}
}

/** Executed when back button is clicked
 */
function logonFormSubscriptionLinkBack() {

	displayStep();
}

/** Social networks
 */
function do_socialNetworkConnect(params) {
	var callbacks = new Object();

	// Add user ip in social network walled garden
	//  for saml and shibboleth, we have no walled garden to open (perhaps it's also the case for openid)
	if ( is_in_ucopia_oob() && -1 == $.inArray(params.type, ['saml']) ) {
		$.ajax({
			type: "POST",
			url: $.settings.user.satellite_URL,
			data: {
				action: "social_network_walled_garden",
				type: params.type
			},
			beforeSend: function () {
				logonFormWaiting(true);
			},
			complete: function () {
				logonFormWaiting(false);
			},
			success: function () {
				callbacks.success = function () {
					socialNetworkConnectCallback();
				};
				socialNetworkAuthenticate(callbacks, params);
			},
			error: function () {
				$.settings.error = {
					"code": "error_logon_internal"
				};
				displayErrorInfo();
				return;
			},
			xhrFields: {
				withCredentials: true
			},
			crossDomain: true
		});
	} else {
		callbacks.beforeSend = function () {
			logonFormWaiting(true);
		};
		callbacks.success = function () {
			socialNetworkConnectCallback();
		};
		callbacks.complete = function () {
			logonFormWaiting(false);
		};
		socialNetworkAuthenticate(callbacks, params);
	}
}

function socialNetworkConnect(type) {
	var policy = null;
	var params = new Object();
	var private_policy = null;

	params.type = type;

	if (type == 'twitter') {
		params.userFollow = $('form[name="logonForm"] input[name="twitter_follow"]').is(':checked');
	}
	if (type == 'facebook') {
		params.userLike = $('form[name="logonForm"] input[name="facebook_like"]').is(':checked');
	}
	if (($.settings.user != undefined) && ($.settings.user.securePwd != undefined)) {
		params.securePwd = $.settings.user.securePwd.value;
	}

	try {
		private_policy = eval('$.settings.private_policy');
	} catch (ex) {
		private_policy = null;
	}
	try {
		policy = eval('$.settings.logon.policy');
	} catch (ex) {
		policy = null;
	}

	// Show a dialog window if private policy need to be accepted
	if ((private_policy != null && private_policy.display == true) || (policy != null && policy.display == true)) {
		// Hide private policy connection button in case of mandatory private policy
		if (private_policy.mandatory == true) {
			if ($('#logonForm_socialNetwork_privatePolicy_accept').is(':checked') == false) {
				$('#logonForm_privatePolicy_connect_button').hide();
			}
			$('#logonForm_socialNetwork_privatePolicy_accept').change(function () {
				$('#logonForm_privatePolicy_connect_button').toggle($('#logonForm_socialNetwork_privatePolicy_accept').is(':checked'));
			});
		}

		$('#logonForm_privatePolicy_connect_button').click(function () {

			logonForm_close_privatePolicy_dialog("logonForm");

			params.privatePolicyAccept = $('#logonForm_socialNetwork_privatePolicy_accept').is(':checked');

			if (policy != null && policy.display == true) {
				params.policyAccept = $("#logonForm_socialNetwork_policy_accept").is(':checked');
				if (!logonForm_policy_is_ok()) {
					$.settings.error = {
							"code": "error_logon_bad-policy-accept"
					};
					displayErrorInfo();
					return;
				}
			}

			if (type == "shibboleth") {
				// Proceed to shibboleth connexion
				self.location.href = '/shibauth.php';
			}
			else {
				// Proceed to social network connexion
				do_socialNetworkConnect(params);
			}
		});

		$('#logonForm_socialNetwork_privatePolicy_accept').attr('checked', $('#logonForm_logon_privatePolicy_accept').is(':checked'));
		$('.main_mode_container').slideToggle('easing');
		$("#logonForm_privatePolicy_dialog").show();
	} else {
		// No private policy needed. Proceed to social network connexion
		if (type == "shibboleth") {
			// Proceed to shibboleth connexion
			self.location.href = '/shibauth.php';
		}
		else {
			do_socialNetworkConnect(params);
		}
	}
}

/** Executed on return of logonConnect function
 */
function socialNetworkConnectCallback() {

	displayErrorInfo();
	if ($.settings.error == undefined) {
		if ($.settings.user != undefined && $.settings.user.socialNetwork != undefined && $.settings.user.socialNetwork.redirectURL != undefined) {
			window.location = $.settings.user.socialNetwork.redirectURL;
		}
		displayStep();
	}
}

function logonForm_close_privatePolicy_dialog(prefix) {
	$('#' + prefix + '_privatePolicy_connect_button').unbind('click');
	$('#' + prefix + '_privatePolicy_accept').unbind('change');
	$('#' + prefix + '_privatePolicy_dialog').hide();

	$('.main_mode_container').slideToggle('easing');
}

function showWisprConnect(display) {
	if (display == undefined) {
		display = false;
	}
	if (display) {
		$('.logonForm_classic_elements').hide();
		$('.logonForm_wispr_elements').show();
		$('form[name="logonForm"] input[name="wispr_mode"]').attr('checked', true);
	} else {
		$('.logonForm_classic_elements').show();
		$('.logonForm_wispr_elements').hide();
		$('form[name="logonForm"] input[name="wispr_mode"]').attr('checked', false);
	}
}

/*****************************************************************************/
/****                 Feedback Form JavaScript functions                  ****/
/*****************************************************************************/

/** This function is triggered when the page is loaded
 */
$(document).ready(function (){

    /** Buttons triggers
     */
    $('#feedbackForm_disconnect_button').click(function (){
        feedbackFormDisconnect();
    });

    /** Form triggers
     */
    $('form[name="feedbackForm"]').submit(function (){
        return false;
    });
});

/** Configure feedbackForm depending on settings
 */
function feedbackForm_configure(){
    // Configure display
    if ( $.settings.feedback != undefined ) {

        if ( $.settings.feedback.pms != undefined && $.settings.feedback.pms.customer != undefined && $.settings.feedback.pms.customer.display == true ) {
            $('#feedbackForm_pms_customer_block').show();
        }
        else {
            $('#feedbackForm_pms_customer_block').remove();
        }

        if ( $.settings.feedback.pms != undefined && $.settings.feedback.pms.message != undefined && $.settings.feedback.pms.message.display == true ) {
            $('#feedbackForm_pms_message_block').show();
        }
        else {
            $('#feedbackForm_pms_message_block').remove();
        }

        if ( $.settings.feedback.caution != undefined && $.settings.feedback.caution.display == true ) {
            $('#feedbackForm_caution_block').show();
        }
        else {
            $('#feedbackForm_caution_block').remove();
        }

        if ( $.settings.feedback.requestedURL != undefined && $.settings.feedback.requestedURL.display == true ) {
            $('#feedbackForm_requested_url_block').show();
        }
        else {
            $('#feedbackForm_requested_url_block').remove();
        }

        if ( $.settings.feedback.login != undefined && $.settings.feedback.login.display == true ) {
            $('#feedbackForm_login_block').show();
        }
        else {
            $('#feedbackForm_login_block').remove();
        }

        if ( $.settings.feedback.profile != undefined && $.settings.feedback.profile.display == true ) {
            $('#feedbackForm_profile_block').show();
        }
        else {
            $('#feedbackForm_profile_block').remove();
        }

        if ( $.settings.feedback.services != undefined && $.settings.feedback.services.display == true ) {
            $('#feedbackForm_services_block').show();
        }
        else {
            $('#feedbackForm_services_block').remove();
        }

        if ( $.settings.feedback.ipAddress != undefined && $.settings.feedback.ipAddress.display == true ) {
            $('#feedbackForm_ip_address_block').show();
        }
        else {
            $('#feedbackForm_ip_address_block').remove();
        }

        if ( $.settings.feedback.incomingNetwork != undefined && $.settings.feedback.incomingNetwork.display == true ) {
            $('#feedbackForm_incoming_network_block').show();
        }
        else {
            $('#feedbackForm_incoming_network_block').remove();
        }

        if ( $.settings.feedback.incomingZone != undefined && $.settings.feedback.incomingZone.display == true ) {
            $('#feedbackForm_incoming_zone_block').show();
        }
        else {
            $('#feedbackForm_incoming_zone_block').remove();
        }

        if ( $.settings.feedback.multidevice != undefined && $.settings.feedback.multidevice.display == true ) {
            $('feedbackForm_multidevice_block').hide();
        }
        else {
            $('feedbackForm_multidevice_block').remove();
        }

        if ( $.settings.feedback.validity != undefined && $.settings.feedback.validity.display == true ) {
            $('#feedbackForm_validity_block').show();
        }
        else {
            $('#feedbackForm_validity_block').remove();
        }

        if ( $.settings.feedback.totalTimeCredit != undefined && $.settings.feedback.totalTimeCredit.display == true ) {
            $('#feedbackForm_total_time_credit_block').show();
        }
        else {
            $('#feedbackForm_total_time_credit_block').remove();
        }

        if ( $.settings.feedback.forceDiscTimer != undefined && $.settings.feedback.forceDiscTimer.display == true ) {
            $('#feedbackForm_automatic_disconnection_block').show();
        }
        else {
            $('#feedbackForm_automatic_disconnection_block').remove();
        }

        if ( $.settings.feedback.totalConsumedTimeCredit != undefined && $.settings.feedback.totalConsumedTimeCredit.display == true ) {
            $('#feedbackForm_total_consumed_time_credit_block').show();
        }
        else {
            $('#feedbackForm_total_consumed_time_credit_block').remove();
        }

        if ( $.settings.feedback.timeCredit != undefined && $.settings.feedback.timeCredit.display == true ) {
            $('#feedbackForm_time_credit_block').show();
        }
        else {
            $('#feedbackForm_time_credit_block').remove();
        }
        if ( $.settings.feedback.consumedData != undefined && $.settings.feedback.consumedData.display == true ) {
            $('#feedbackForm_quota_total_consumed_data_block').show();
        }
        else {
            $('#feedbackForm_quota_total_consumed_data_block').remove();
        }
    }
}

/** Display feedbackForm depending on settings
 * Can be overwritten by state
 * @param boolean state - Indicate if the form must be displayed or not
 */
function feedbackForm_display( state ){
    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }
    else if ( $.settings.step == "FEEDBACK" ) {
        display = true;
    }

    if ( display == true ) {

        var userLang = navigator.language || navigator.userLanguage;

        var lang;

        if ( $.settings != undefined && $.settings.user != undefined && $.settings.user.lang != undefined ) {
            lang = $.settings.user.lang;
        }
        else if ( userLang != "" ) {
            lang = userLang.substring(0, 2);
        }
        else {
            lang = "en";
        }

        if ( isAppleCNA ) {
		/*
		 * a click on a real <a> link element will trigger safari when cna detected internet access
		 * we click an anchor link here, we don't profit the domain link that switch language sent to us yet
		 */
            var a = $('#lang_link\\[' + lang + '\\]').get(0);
            var e = document.createEvent('MouseEvents');

            isAppleCNA_fakeclick = true;
            e.initEvent('click', true, true);
            a.dispatchEvent(e);
        }
	else {
		// a fake click will also call switch language function, we should not do it twice
        	lang_block_translate(lang);
        }
        feedbackForm_fillIn();
        feedbackFormRefresh();
        $('form[name="feedbackForm"]').show();
    }
    else {
        $('form[name="feedbackForm"]').hide();
    }
}

/** Fill feedbackForm depending on settings
 */
function feedbackForm_fillIn( displayLang ){
    if ( $.settings.user != undefined ) {
        var userSettings = $.settings.user;

        if ( userSettings.PMS != undefined && userSettings.PMS.customer != undefined ) {
            $('#feedbackForm_pms_customer_value').text(userSettings.PMS.customer.value);
        }
        else {
            $('#feedbackForm_pms_customer_value').text('');
        }

        if ( userSettings.PMS != undefined && userSettings.PMS.message != undefined ) {
            $('#feedbackForm_pms_message_value').text(userSettings.PMS.message.value);
        }
        else {
            $('#feedbackForm_pms_message_value').text('');
        }

        if ( userSettings.autoDisconnect != undefined && userSettings.autoDisconnect.value == false ) {
            $('#feedbackForm_caution_block').show();

			// Display different message in case of standalone or OOB
			if ( userSettings.satellite_URL == undefined ) {
				$('#feedbackForm_caution_text').show();
				$('#feedbackForm_caution_oob_text').hide();
				$('#feedbackForm_caution_block').removeClass('warning');
				$('#feedbackForm_caution_block').addClass('caution');
			}
			else {
				$('#feedbackForm_caution_text').hide();
				$('#feedbackForm_caution_oob_text').show();
				$('#feedbackForm_caution_block').removeClass('caution');
				$('#feedbackForm_caution_block').addClass('warning');
			}
        }
        else {
            $('#feedbackForm_caution_block').hide();
        }

        if ( $.settings.postConnectRedirect != undefined && $.settings.postConnectRedirect.url != undefined ) {
            $('#feedbackForm_requested_url_link').attr("href", $.settings.postConnectRedirect.url);
            $('#feedbackForm_requested_url_block').show();

            if ( userSettings.autoDisconnect != undefined && userSettings.autoDisconnect.value == true && $.settings.postConnectRedirect.delay != undefined ) {
                $('#feedbackForm_postConnectRedirectDelay_block').show();
            }
        }
        else {
            $('#feedbackForm_postConnectRedirectDelay_block').hide();

            if ( userSettings.requestedURL != undefined ) {
                $('#feedbackForm_requested_url_link').attr("href", userSettings.requestedURL.value);
                $('#feedbackForm_requested_url_block').show();
            }
            else {
                $('#feedbackForm_requested_url_link').attr("href", "#");
                $('#feedbackForm_requested_url_block').hide();
            }
        }

        if ( userSettings.login != undefined && userSettings.login.value != undefined ) {
            $('#feedbackForm_login_value').text(userSettings.login.value);
        }
        else {
            $('#feedbackForm_login_value').text('');
        }

        if ( userSettings.profile != undefined && userSettings.profile.value != undefined ) {
            $('#feedbackForm_profile_value').text(userSettings.profile.value);
        }
        else {
            $('#feedbackForm_profile_value').text('');
        }

        feedbackForm_package_display(displayLang);
        if ( userSettings.package != undefined ) {
            $('#feedbackForm_package_block').show();
        }
        else {
            $('#feedbackForm_package_block').hide();
        }

        if ( userSettings.services != undefined && userSettings.services.value != undefined ) {
            $('#feedbackForm_services_value').text(userSettings.services.value);
        }
        else {
            $('#feedbackForm_services_value').text('');
        }

        if ( userSettings.ipAddress != undefined && userSettings.ipAddress.value != undefined ) {
            $('#feedbackForm_ip_address_value').text(userSettings.ipAddress.value);
        }
        else {
            $('#feedbackForm_ip_address_value').text('');
        }

        if ( userSettings.incomingNetwork != undefined && userSettings.incomingNetwork.value != undefined ) {
            $('#feedbackForm_incoming_network_value').text(userSettings.incomingNetwork.value);
        }
        else {
            $('#feedbackForm_incoming_network_value').text('');
        }

        if ( userSettings.incomingZone != undefined && userSettings.incomingZone.value != undefined ) {
            $('#feedbackForm_incoming_zone_value').text(userSettings.incomingZone.value);
        }
        else {
            $('#feedbackForm_incoming_zone_value').text('');
        }

        feedbackForm_multidevice_fillIn();

        if ( userSettings.schedule != undefined && userSettings.schedule.value != undefined ) {
            feedbackForm_schedule_display(displayLang);
        }
        else {
            $('#feedbackForm_schedule_value').text('');
        }

        if ( userSettings.validity != undefined && userSettings.validity.value != 0 ) {
            var timezoneLocalOffset = new Date();
            var validity = new Date(parseInt(userSettings.validity.value) * 1000); // Must give date in milliseconds
            validity = explodeDate(validity);
            var text = $.sprintf(getGenericTranslation('full-date-display', displayLang), validity.year, validity.monthNumber, getGenericTranslation(validity.month, displayLang), validity.dayNumber, getGenericTranslation(validity.day, displayLang), validity.hours[24], validity.minutes, validity.hours[12], validity.hours['ext']);
            $('#feedbackForm_validity_value').text($.sprintf(getGenericTranslation('feedbackForm_validity_valid-until', displayLang), text));
        }
        else {
            $('#feedbackForm_validity_value').text(getGenericTranslation('feedbackForm_validity_always-valid', displayLang));
        }

        if ( userSettings.timeCredit != undefined ) {
            var hours = Math.floor(userSettings.timeCredit.value / 3600);
            var mins = (userSettings.timeCredit.value - (hours * 3600)) / 60;
            var hours_label = getGenericTranslation('hour', displayLang, (hours > 1));
            var mins_label = getGenericTranslation('minute', displayLang, (mins > 1));
            var reneweach = 0;
            if ( userSettings.timeCredit.reneweach != undefined ) {
                reneweach = userSettings.timeCredit.reneweach.value;
                text = getGenericTranslation('feedbackForm_time-credit-renew-each', displayLang, (userSettings.timeCredit.reneweach.value > 1));
            }
            else {
                text = getGenericTranslation('feedbackForm_time-credit', displayLang);
            }
            text = $.sprintf(text, hours, hours_label, mins, mins_label, reneweach);
            $('#feedbackForm_time_credit_value').text(text);
            $('#feedbackForm_time_credit_block').show();
        }
        else {
            $('#feedbackForm_time_credit_value').text('');
            $('#feedbackForm_time_credit_block').hide()
        }

        if ( userSettings.timeCredit != undefined && userSettings.timeCredit.remaining != undefined ) {
            feedbackForm_remainingTimeCredit_timer_start(displayLang);
            $('#feedbackForm_remaining_time_credit_block').show();
        }
        else {
            $('#feedbackForm_remaining_time_credit_value').text('');
            $('#feedbackForm_remaining_time_credit_block').hide();
        }

        if ( userSettings.forceDiscTimer != undefined && userSettings.forceDiscTimer.value != undefined ) {
            feedbackForm_forceDiscTimer_start(displayLang);
            $('#feedbackForm_automatic_disconnection_block').show();
        }
        else {
            $('#feedbackForm_automatic_disconnection_value').text('');
            $('#feedbackForm_automatic_disconnection_block').hide();
        }

        if ( userSettings.consumedData != undefined && userSettings.consumedData.download.value != undefined ) {
			// check whether we have disconnect quota or not
			var text_date, text_used, text_max, vol_max_up, vol_max_down;
			var disconnect_quota = false, sum_quota = false;
			if (userSettings.consumedData.extra != undefined && userSettings.consumedData.extra.value != undefined) {
				$.each(userSettings.consumedData.extra.value, function(key, val) {
					if (val.isDisconnectQuota == true) {
						disconnect_quota = true;
						sum_quota = val.isSumQuota;
						vol_max_up = val.total.upload;
						vol_max_down = val.total.download;
						return false;
					}
				});
			}

			var timezoneLocalOffset = new Date();
			// we show timestamp with timezone of zone here if we have defined one (also with its name)
			if (userSettings.consumedData.renewTimestamp != undefined && userSettings.consumedData.renewTimestamp.value > 0) {

				text_date = getGenericTranslation('feedbackForm_quota_consumedData_with_renew', displayLang);
				var obj_date = new Date((parseInt(userSettings.consumedData.renewTimestamp.value) + parseInt(userSettings.timezoneOffset.value) + parseInt(timezoneLocalOffset.getTimezoneOffset()*60)) * 1000); // Must give date in milliseconds
			}
			else {
				text_date = getGenericTranslation('feedbackForm_quota_consumedData_with_sincnewe', displayLang);
				var obj_date = new Date((parseInt(userSettings.consumedData.timestamp.value) + parseInt(userSettings.timezoneOffset.value) + parseInt(timezoneLocalOffset.getTimezoneOffset()*60)) * 1000); // Must give date in milliseconds
				/* // to show timestamp with user local timezone, please use the following block
				var timezoneLocalOffset = new Date();
				var obj_date = new Date((parseInt(userSettings.consumedData.timestamp.value) + parseInt(userSettings.timezoneOffset.value) + parseInt(timezoneLocalOffset.getTimezoneOffset()*60)) * 1000); // Must give date in milliseconds
				 */
			}
			obj_date = explodeDate(obj_date);
			var date = $.sprintf(getGenericTranslation('full-date-display', displayLang), obj_date.year, obj_date.monthNumber, getGenericTranslation(obj_date.month, displayLang), obj_date.dayNumber, getGenericTranslation(obj_date.day, displayLang), obj_date.hours[24], obj_date.minutes, obj_date.hours[12], obj_date.hours['ext']);
			// to show only the date, please use the following line
//			var date = $.sprintf(getGenericTranslation('calendar-date-display', displayLang), obj_date.year, obj_date.monthNumber, getGenericTranslation(obj_date.month, displayLang), obj_date.dayNumber);
			text_date = $.sprintf(text_date, date);
			// add timezone identifier if we have no timezone in current zone by default
			if (userSettings.consumedData.timezone != undefined && userSettings.consumedData.timezone.value != undefined
					&& userSettings.consumedData.timezone.value.isControllerTimezone === false) {
				text_date += ' (' + userSettings.consumedData.timezone.value.zoneTimezone + ')';
			}
			// max data
			if (disconnect_quota) {
				var data_up = convertReadableQuota(vol_max_up);
				if (sum_quota) {
					if (data_up.val > -1) {
						var data_sum = convertReadableQuota(userSettings.consumedData.upload.value + userSettings.consumedData.download.value);
						text_used = $.sprintf(getGenericTranslation('feedbackForm_quota_consumedData_sum_with_max_sum', displayLang), data_sum.val, data_sum.unit, data_up.val, data_up.unit);
					}
				}
				else {
					var data_down = convertReadableQuota(vol_max_down);
					var data_consumed_up = convertReadableQuota(userSettings.consumedData.upload.value);
					var data_consumed_down = convertReadableQuota(userSettings.consumedData.download.value);

					text_used = "";
					if (data_up.val > -1) {
						// Empty value for down threthhold don't show on feedback
						text_used += $.sprintf(getGenericTranslation('feedbackForm_quota_up_consumedData_with_max_individual', displayLang), data_consumed_up.val, data_consumed_up.unit, data_up.val, data_up.unit);
						text_used += (data_down.val > -1 ? "\n" : '');
					}
					if (data_down.val > -1) {
						// Empty value for up threethhold. Don't show on feedback
						text_used += $.sprintf(getGenericTranslation('feedbackForm_quota_down_consumedData_with_max_individual', displayLang), data_consumed_down.val, data_consumed_down.unit, data_down.val, data_down.unit);
					}
				}
			}
			else {
				text_used = "";
			}

			if (!text_used || text_used == "") {
				// used data
				if (sum_quota) {
					var data_sum = convertReadableQuota(userSettings.consumedData.upload.value + userSettings.consumedData.download.value);
					text_used = $.sprintf(getGenericTranslation('feedbackForm_quota_consumedData_sum', displayLang), data_sum.val, data_sum.unit);
				}
				else {
					var data_up = convertReadableQuota(userSettings.consumedData.upload.value);
					var data_down = convertReadableQuota(userSettings.consumedData.download.value);
					text_used = $.sprintf(getGenericTranslation('feedbackForm_quota_consumedData_individial', displayLang), data_down.val, data_down.unit, data_up.val, data_up.unit);
				}
			}

			// concat text
			text = text_used + (text_date ? ("\n" + text_date) : '');

			$('#feedbackForm_quota_total_consumed_data_value').text(text).css('white-space', 'pre-wrap');
            $('#feedbackForm_quota_total_consumed_data_block').show();
        }
        else {
            $('#feedbackForm_quota_total_consumed_data_value').text('');
            $('#feedbackForm_quota_total_consumed_data_block').hide();
        }

        // Apply CSS style to bypass IE browsers problem
        // Correct CSS pseudo class :first-child IE error on dynamic content
        if ( $.browser.msie ) {
            $('#reserved_block form[name="feedbackForm"] td[colspan!="2"]:first-child').each(function (){
                $(this).attr('style', "text-align: right");
            });
        }

        if ( userSettings.autoDisconnect != undefined && userSettings.autoDisconnect.value == true && $.settings.postConnectRedirect != undefined && $.settings.postConnectRedirect.url != undefined && $.settings.postConnectRedirect.delay != undefined ) {
            if ( $.settings.postConnectRedirect.delay > 0 ) {
                feedbackForm_postConnectRedirectDelay_timer_start(displayLang);
            }
            else {
                feedbackForm_postConnectRedirectDelay_redirect();
            }
        }

        if ( userSettings.disconnectButton != undefined && userSettings.disconnectButton.value == false ) {
            $('#feedbackForm_disconnect_button').hide();
        }
        else {
            $('#feedbackForm_disconnect_button').show();
        }
    }
}

function feedbackFormRefresh(){
    // We must refresh the user connection
    if ( $.settings.user != undefined ) {
        refreshObj.login = $.settings.user.login.value;
        refreshObj.refreshInterval = ($.settings.refreshInterval == undefined) ? 50000 : $.settings.refreshInterval;

        if ( $.settings.user.securePwd != undefined ) {
            refreshObj.securePwd = $.settings.user.securePwd.value;
        }
        startRefresh();
        if ( $.settings.user.isConnected == true ) {
            doRefresh();
        }
    }
}

/** Enable waiting mode on feedbackForm
 */
function feedbackFormWaiting( state ){
    switch ( state ) {
        case true:
            $('#feedbackForm_disconnect_button').attr("disabled", true);
            $('body').toggleClass("cursor-wait");
            break;
        case false:
            $('#feedbackForm_disconnect_button').attr("disabled", false);
            $('body').toggleClass("cursor-wait");
            break;
    }
}

/** Executed when button is clicked
 */
function feedbackFormDisconnect(){

    var params = new Object();
    if ( $.settings.user != undefined ) {
        if ( $.settings.user.login != undefined ) {
            params.login = $.settings.user.login.value;
        }
        if ( $.settings.user.securePwd != undefined ) {
            params.securePwd = $.settings.user.securePwd.value;
        }
    }

    // Stopping refresh
    stopRefresh();
    feedbackForm_forceDiscTimer_stop();// Stop Force Diconnect timer in case it is runing and user clicks on disconnect button
    feedbackForm_remainingTimeCredit_timer_stop();

    var callbacks = new Object();
    callbacks.beforeSend = function (){
        feedbackFormWaiting(true);
    };
    callbacks.success = function (){
        feedbackFormDisconnectCallback();
    };
    callbacks.complete = function (){
        feedbackFormWaiting(false);
    };

    disconnect(callbacks, params);
}

/** Executed on return of feedbackFormDisconnect function
 */
function feedbackFormDisconnectCallback(){
    if ( $.settings.user.logout_URL_params != undefined && $.settings.user.isConnected != undefined && $.settings.user.isConnected == true ) {

        return buildRedirectionURL($.settings.user.logout_URL_params);

    }

    displayErrorInfo();
    displayStep();
    clearUserSettings();
}

function feedbackForm_package_display( displayLang ){
	if (	($.settings.subscribe != undefined && $.settings.subscribe.pms != undefined && $.settings.subscribe.pms.package != undefined)
		|| 	($.settings.subscribe != undefined && $.settings.subscribe.pms != undefined && $.settings.subscribe.pms.option != undefined)) {
        if ( displayLang == undefined ) { // No displayLang given, find user selected language, else default portal language else default package language
            if ( $.settings != undefined && $.settings.user != undefined && $.settings.user.lang != undefined ) {
                displayLang = $.settings.user.lang;
            }
        }
        var describe;
        var describeLanguage;
        if ( $.settings.user != undefined && $.settings.user.package != undefined ) {
            if ( $.settings.user.package[0][displayLang] != undefined ) {
                describe = $.settings.user.package[0][displayLang].text;
                describeLanguage = displayLang;
            }
            else if ( $.settings != undefined && $.settings.lang != undefined && $.settings.lang.defaultLang != undefined && $.settings.user.package[0][$.settings.lang.defaultLang] != undefined ) {
                describe = $.settings.user.package[0][$.settings.lang.defaultLang].text;
                describeLanguage = $.settings.lang.defaultLang;
            }
            else {
                describe = $.settings.user.package[0]["en"].text; // We take an arbitrary language
                describeLanguage = "en";
            }

			if (describe == undefined || describe == null) {
				describe = getTextTranslation('accountRefillForm_no_description');
			}

            if ( $.settings.user.package[0]['currency'] == "free" ) {
                describe += "&nbsp;" + "(" + getGenericTranslation('free_package', describeLanguage) + ")";
            }
            else {
                describe += "&nbsp;" + "(" + $.settings.user.package[0]['price'] + "&nbsp;" + $.settings.user.package[0]['currency'] + ")";
            }

            $('#feedbackForm_package_value').html(describe);
        }
        else {
            $('#feedbackForm_package_value').text('');
        }
    }
    else {
        $('#feedbackForm_package_value').text('');
    }
}

function feedbackForm_schedule_display( displayLang ){
    if ( $.settings.user != undefined && $.settings.user.schedule != undefined ) {
        var text = '<ul style="margin: 0px; padding: 0px; list-style-position: inside; list-style-type: circle">';
        for ( entry_itt = 0; entry_itt < $.settings.user.schedule.value.length; entry_itt++ ) {
            var entry_value_itt = $.settings.user.schedule.value[entry_itt];
            var begin_date = new Date();
            begin_date.setHours(entry_value_itt['begin']['hour']);
            begin_date.setMinutes(entry_value_itt['begin']['min']);
            begin_date = explodeDate(begin_date);

            var end_date = new Date();
            end_date.setHours(entry_value_itt['end']['hour']);
            end_date.setMinutes(entry_value_itt['end']['min']);
            end_date = explodeDate(end_date);
            if ( entry_value_itt['end']['hour'] == 24 ) {
                end_date.hours[24] = 23;
                end_date.hours[12] = 11;
                end_date.minutes = 59;
                end_date.hours['ext'] = "pm";
            }

            if ( $.settings.user.schedule.value.length > 1 ) {
                text += '<li>';
            }
            if ( entry_value_itt['begin']['day'] == entry_value_itt['end']['day'] ) { // Schedule on one day
                if ( begin_date.hours[24] == 0 && end_date.hours[24] == 23 && begin_date.minutes == 0 && end_date.minutes == 59 ) {
                    text += $.sprintf(getGenericTranslation('feedbackForm_schedule_all-day', displayLang), getGenericTranslation(entry_value_itt['begin']['day'], displayLang));
                }
                else {
                    text += $.sprintf(getGenericTranslation('feedbackForm_schedule_1-day', displayLang), getGenericTranslation(entry_value_itt['begin']['day'], displayLang), $.sprintf(getGenericTranslation('short-time-display-without-seconds', displayLang), begin_date.hours[24], begin_date.minutes, begin_date.hours[12], begin_date.hours['ext']), $.sprintf(getGenericTranslation('short-time-display-without-seconds', displayLang), end_date.hours[24], end_date.minutes, end_date.hours[12], end_date.hours['ext']));
                }
            }
            else { // Schedule over days
                if ( (entry_value_itt['begin']['day'] == "monday") && (entry_value_itt['end']['day'] == "sunday") ) { // All week
                    if ( begin_date.hours[24] == 0 && end_date.hours[24] == 23 && begin_date.minutes == 0 && end_date.minutes == 59 ) {
                        text += getGenericTranslation('feedbackForm_schedule_all-week', displayLang);
                        break;
                    }
                }
                text += $.sprintf(getGenericTranslation('feedbackForm_schedule_2-days', displayLang), getGenericTranslation(entry_value_itt['begin']['day'], displayLang), $.sprintf(getGenericTranslation('short-time-display-without-seconds', displayLang), begin_date.hours[24], begin_date.minutes, begin_date.hours[12], begin_date.hours['ext']), getGenericTranslation(entry_value_itt['end']['day'], displayLang), $.sprintf(getGenericTranslation('short-time-display-without-seconds', displayLang), end_date.hours[24], end_date.minutes, end_date.hours[12], end_date.hours['ext']));
            }
            if ( $.settings.user.schedule.value.length > 1 ) {
                text += '</li>';
            }
        }
        text += '</ul>';
        $('#feedbackForm_schedule_value').html(text);
    }
    else {
        $('#feedbackForm_schedule_value').html('');
    }
}

function feedbackForm_remainingTimeCredit_timer_start( displayLang ){
    if ( timerObj.remainingTimeCredit == undefined ) {
        timerObj.remainingTimeCredit = new Array();
        timerObj.remainingTimeCredit.refreshInterval = 1000;
        timerObj.remainingTimeCredit.ressource = window.setInterval(function (){
            feedbackForm_remainingTimeCredit_timer_display(displayLang);
        }, timerObj.remainingTimeCredit.refreshInterval);
    }
}
function feedbackForm_remainingTimeCredit_timer_stop(){
    if ( timerObj.remainingTimeCredit != undefined ) {
        window.clearInterval(timerObj.remainingTimeCredit.ressource);
        delete timerObj.remainingTimeCredit;
    }
}

function feedbackForm_remainingTimeCredit_timer_display( displayLang ){

    if ( timerObj.remainingTimeCredit != undefined && $.settings != undefined && $.settings.user != undefined && $.settings.user.timeCredit != undefined && $.settings.user.timeCredit.remaining != undefined ) {
        $.settings.user.timeCredit.remaining.value--;
        if ( $.settings.user.timeCredit.remaining.value > 0 ) {
            var hours = Math.floor($.settings.user.timeCredit.remaining.value / 3600);
            var mins = Math.floor(($.settings.user.timeCredit.remaining.value - (hours * 3600)) / 60);
            var seconds = $.settings.user.timeCredit.remaining.value - (hours * 3600) - (mins * 60);

            var hours_label = getGenericTranslation('hour', displayLang, (hours > 1));
            var mins_label = getGenericTranslation('minute', displayLang, (mins > 1));
            var seconds_label = getGenericTranslation('second', displayLang, (seconds > 1));

            $('#feedbackForm_remaining_time_credit_value').text($.sprintf(getGenericTranslation('feedbackForm_time-credit-with-seconds'), hours, hours_label, mins, mins_label, seconds, seconds_label));
        }
        else {
            feedbackForm_remainingTimeCredit_timer_stop();
            $('#feedbackForm_remaining_time_credit_value').text('-');
            // No remaining time credit, disconnect user
            //feedbackFormDisconnect();
        }
    }
}

function feedbackForm_forceDiscTimer_start( displayLang ) {
	if ( $('#feedbackForm_automatic_disconnection_block').is(':hidden') ) {
		if ( $.settings.user.forceDiscTimer != undefined && $.settings.user.forceDiscTimer.value != undefined ) {
			if ( timerObj.forceDiscTimer == undefined ) {
		                timerObj.forceDiscTimer = new Array();
				timerObj.forceDiscTimer.refreshInterval = 1000;
				timerObj.forceDiscTimer.value = $.settings.user.forceDiscTimer.value;
				timerObj.forceDiscTimer.resource = window.setInterval(function (){
					feedbackForm_forceDiscTimer_display(displayLang);
				}, timerObj.forceDiscTimer.refreshInterval);
			}
		}
	}
}

function feedbackForm_forceDiscTimer_stop(){
    $('#feedbackForm_automatic_disconnection_value').text('-');
    if ( timerObj.forceDiscTimer != undefined && timerObj.forceDiscTimer.resource != undefined ) {
        window.clearInterval(timerObj.forceDiscTimer.resource);
        delete timerObj.forceDiscTimer;
    }
}

function feedbackForm_forceDiscTimer_display( displayLang ){
	if ( timerObj.forceDiscTimer != undefined && timerObj.forceDiscTimer.value != undefined ) {
		timerObj.forceDiscTimer.value--;
		if ( timerObj.forceDiscTimer.value > 0 ) {
			$('#feedbackForm_automatic_disconnection_value').text(getForcedDisconnectionTimerDisplayText(timerObj.forceDiscTimer.value, displayLang));
		}
		else {
			feedbackForm_forceDiscTimer_stop();
			feedbackFormDisconnect();
		}
	}
}


function feedbackForm_multidevice_fillIn(){

    if ( $.settings.user.multidevice != undefined && $.settings.user.multidevice.value != undefined ) {
        $('#feedbackForm_multidevice_value').text($.settings.user.multidevice.value);
        $('#feedbackForm_multidevice_block').show();
    }
    else {
        $('#feedbackForm_multidevice_block').hide();
        $('#feedbackForm_multidevice_value').text('');
    }
}

// Redirect URL + delay
function feedbackForm_postConnectRedirectDelay_timer_start( displayLang ){
    if ( timerObj.postConnectRedirectDelay == undefined ) {
        timerObj.postConnectRedirectDelay = new Array();
        timerObj.postConnectRedirectDelay.refreshInterval = 1000;
        timerObj.postConnectRedirectDelay.remaining = $.settings.postConnectRedirect.delay;
        timerObj.postConnectRedirectDelay.ressource =
            window.setInterval(function (){
                feedbackForm_postConnectRedirectDelay_timer_display(displayLang);
            }, timerObj.postConnectRedirectDelay.refreshInterval);
    }
}
function feedbackForm_postConnectRedirectDelay_timer_stop(){
    if ( timerObj.postConnectRedirectDelay != undefined ) {
        window.clearInterval(timerObj.postConnectRedirectDelay.ressource);
        delete timerObj.postConnectRedirectDelay;
    }
}

function feedbackForm_postConnectRedirectDelay_timer_display( displayLang ){

    if ( timerObj.postConnectRedirectDelay.remaining ) {
        timerObj.postConnectRedirectDelay.remaining--;
        if ( timerObj.postConnectRedirectDelay.remaining > 0 ) {
            var seconds_label = getGenericTranslation('second', displayLang, (timerObj.postConnectRedirectDelay.remaining > 1));
            $('#feedbackForm_postConnectRedirectDelay_text').text($.sprintf(getTextTranslation('feedbackForm_postConnectRedirectDelay_value'), timerObj.postConnectRedirectDelay.remaining, seconds_label));
        }
        else {
            feedbackForm_postConnectRedirectDelay_timer_stop();
            $('#feedbackForm_postConnectRedirectDelay_block').hide();
            feedbackForm_postConnectRedirectDelay_redirect();
        }
    }
}

function feedbackForm_postConnectRedirectDelay_redirect(){
    window.location = $.settings.postConnectRedirect.url;
}

/*****************************************************************************/
/****              Modify Password Form JavaScript functions              ****/
/*****************************************************************************/

/** This function is triggered when the page is loaded
 */
$(document).ready(function (){

    /** Input triggers
     */
// 	$('form[name=modifyPwdForm] input[name=old_pwd]').change(function() {
// 		///
// 	});
// 	
// 	$('form[name=modifyPwdForm] input[name=new_pwd]').change(function() {
// 		///
// 	});
// 	
// 	$('form[name=modifyPwdForm] input[name=confirm_pwd]').change(function() {
// 		///
// 	});

    /** Buttons triggers
     */
    $('#modifyPwdForm_back_button').click(function (){
        modifyPwdLink_display();
    });

    $('#modifyPwdForm_confirm_button').click(function (){
        modifyPwdFormConfirm();
    });

    /** Form triggers
     */
    $('form[name="modifyPwdForm"]').submit(function (){
        return false;
    });

    /** Link triggers
     */
    $('#modifyPwdLink_link').click(function (){
        modifyPwdLink_display();
    });

    $('#modifyPwdForm_help_link').click(function (){
        modifyPwdForm_HelpBlock_display();
    });
    // CHANGED_BY_HH
    // added to display the help, when the user click on password field
    $('#uc-new_pwd_mod').click(function (){
        modifyPwdForm_HelpBlock_display(true);
    });

});

/** Configure modifyPwdForm depending on settings
 */
function modifyPwdForm_configure(){
    // Moving link to right location
    $('#modifyPwdLink').appendTo('#feedbackForm_settings_link').show();
    // CHANGED_BY_HH
    // I have removed the "td" (#feedbackForm_settings_link td),
    // to append elemtnts to the div, instead to a table
    // OLD: $('#modifyPwdLink').appendTo('#feedbackForm_settings_link td').show();
}

/** Display modifyPwdForm depending on settings
 * @param boolean state - Indicate if the form must be displayed or not
 */
function modifyPwdForm_display( state ){
    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }

    if ( display == true ) {
        $('form[name="modifyPwdForm"]').show();
        if ( $.settings.user.pwdConstraint != undefined ) {
            $('#modifyPwdForm_help_tr').show();
        }
    }
    else {
        $("#modifyPwdForm_help_block").hide();
        $('form[name="modifyPwdForm"]').hide();
        modifyPwdForm_empty();

        if ( $.settings.user && $.settings.user.allowModPwdBySelf == true ) {
            $('#modifyPwdLink_link').show();
        }
        else {
            $('#modifyPwdLink_link').hide();
        }
    }
}

/** Empty modifyPwdForm
 */
function modifyPwdForm_empty(){

    $('form[name="modifyPwdForm"] input').each(function (){
        $(this).val('');
    });
}

/** Enable waiting mode on modifyPwdForm
 */
function modifyPwdFormWaiting( state ){
    switch ( state ) {
        case true:
            $('#modifyPwdForm_back_button').attr("disabled", true);
            $('#modifyPwdForm_confirm_button').attr("disabled", true);
            $('body').toggleClass("cursor-wait");
            break;
        case false:
            $('#modifyPwdForm_back_button').attr("disabled", false);
            $('#modifyPwdForm_confirm_button').attr("disabled", false);
            $('body').toggleClass("cursor-wait");
            break;
    }
}

/** Executed when button is clicked
 */
function modifyPwdFormConfirm(){

    var params = new Object();
    // Mandatory parameters
    params.login = $.settings.user.login.value;
    params.password = $('form[name="modifyPwdForm"] input[name="old_pwd"]').val();
    params.newPassword = $('form[name="modifyPwdForm"] input[name="new_pwd"]').val();
    params.newPasswordConfirm = $('form[name="modifyPwdForm"] input[name="confirm_pwd"]').val();

    if ( ($.settings.user != undefined) && ($.settings.user.securePwd != undefined) ) {
        params.securePwd = $.settings.user.securePwd.value;
    }

    var callbacks = new Object();
    callbacks.beforeSend = function (){
        modifyPwdFormWaiting(true);
    };
    callbacks.success = function (){
        modifyPwdFormConfirmCallback();
    };
    callbacks.complete = function (){
        modifyPwdFormWaiting(false);
    };

    modifyPwd(callbacks, params);
}

/** Executed on return of modifyPwdFormConfirm function
 */
function modifyPwdFormConfirmCallback(){

    displayErrorInfo();
    if ( $.settings.error == undefined ) {
        modifyPwdLink_display(false);
        feedbackForm_display(true);
    }
}

/*****************************************************************************/

/** Display modifyPwdLink_block depending on settings
 * Can be overwritten by state
 * @param boolean state - Indicate if the form must be displayed or not
 */
function modifyPwdLink_display( state ){

    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }
    else if ( ($.settings.user == undefined) || ($.settings.user.modifyPwdForm == undefined) || ($.settings.user.modifyPwdForm.display != true) ) {
        display = true;
    }
    else {
        display = false;
    }

    if ( $.settings.user == undefined ) {
        $.settings.user = new Object();
    }
    if ( $.settings.user.modifyPwdForm == undefined ) {
        $.settings.user.modifyPwdForm = new Object();
    }
    $.settings.user.modifyPwdForm.display = display;
    modifyPwdForm_display(display);
    // We display the opposite the feedback
    feedbackForm_display(!display);
}

/** Display modifyPwdFormHelpBlock_display when help link is clicked
 * @param boolean state - Indicate if the block must be displayed or not
 */
function modifyPwdForm_HelpBlock_display( state, displayLang ){
    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }
    else if ( $('#modifyPwdForm_help_block').is(':hidden') == true ) {
        display = true;
    }

    if ( display == true ) {
        if ( translationsAreLoaded == true ) {
            modifyPwdForm_HelpBlock_configure(displayLang);
        }
        $('#modifyPwdForm_help_block').show();
    }
    else {
        $('#modifyPwdForm_help_block').hide();
    }
}

/** Configure modifyPwdForm_help_block
 * @param string displayLang - The language whish to display the content
 */
function modifyPwdForm_HelpBlock_configure( displayLang ){
    if ( $.settings != undefined && $.settings.user != undefined && $.settings.user.pwdConstraint != undefined ) {
        if ( $('#modifyPwdForm_help_list').children().length > 1 ) {
            $('#modifyPwdForm_help_list li').not(":first").remove();
        }
        /* Update the content of the help box to display to the user the password
         * policy in use for his profile */
        //var help_block = $('#modifyPwdForm_help_block').clone();
        $("#modifyPwdHelpBlock_text").text(getInputTranslation('modifyPwdForm_help_text', displayLang));
        var constraintValues = new Array("minLength", "maxLength");
        for ( key in constraintValues ) {
            var val = constraintValues[key];
            var line = $('#modifyPwdForm_help_list li:first').clone();
            line.toggle();
            line.text($.sprintf(getInputTranslation("modifyPwdForm_help_" + val, displayLang), $.settings.user.pwdConstraint.value[val]));
            $('#modifyPwdForm_help_list').append(line);
        }
        for ( key in $.settings.user.pwdConstraint.value.characterSet ) {
            var set = $.settings.user.pwdConstraint.value.characterSet[key];
            if ( set.quota > 0 ) {
                var line = $('#modifyPwdForm_help_list li:first').clone();
                line.toggle();
                line.text($.sprintf(getInputTranslation("modifyPwdForm_help_character_set_text", displayLang), set.quota, set.set.join("")));
                $('#modifyPwdForm_help_list').append(line);
            }
        }
    }
}

/*****************************************************************************/
/****          Get Purchase Summary Form JavaScript functions           ****/
/*****************************************************************************/

/** This function is triggered when the page is loaded
 */
$(document).ready(function (){

    /** Buttons triggers
     */
    $('#getPurchaseSummaryForm_back_button').click(function (){
        getPurchaseSummaryLink_display(false);
    });

    $('#getPurchaseSummaryForm_download_button').click(function (){
        getPurchaseSummaryFormConfirm();
    });

    /** Form triggers
     */
    $('form[name="getPurchaseSummaryForm"]').submit(function (){
        return false;
    });

    /** Link triggers
     */
    $('#getPurchaseSummaryLink_link').click(function (){
        getPurchaseSummaryFormGenerate();
    });
});

/** Configure getPurchaseSummaryForm depending on settings
 */
function getPurchaseSummaryForm_configure(){
    // Configure display
    if ( $.settings.getPurchaseSummary == true ) {
        // Moving link to right location
        $('#getPurchaseSummaryLink').appendTo('#feedbackForm_settings_link').show();
        // CHANGED_BY_HH
        // I have removed the "td" from (#feedbackForm_settings_link td),
        // to append elemtnts to the div, instead to a table
        // OLD: $('#getPurchaseSummaryLink').appendTo('#feedbackForm_settings_link td').show();
    }
    else {
        $('form[name="getPurchaseSummaryForm"]').remove();
        $('#getPurchaseSummaryLink').remove();
    }
}

/** Display getPurchaseSummaryForm depending on settings
 * @param boolean state - Indicate if the form must be displayed or not
 */
function getPurchaseSummaryForm_display( state ){
    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }
    if ( display == true ) {
        getPurchaseSummaryForm_fillIn();
        $('form[name="getPurchaseSummaryForm"]').show();
    }
    else {
        $('form[name="getPurchaseSummaryForm"]').hide();

        if ( $.settings.user && $.settings.user.getPurchaseSummary != undefined && $.settings.user.getPurchaseSummary.show == true ) {
            $('#getPurchaseSummaryLink_link').show();
        }
        else {
            $('#getPurchaseSummaryLink_link').hide();
        }
    }
}

function getPurchaseSummaryForm_fillIn( displayLang ){
    if ( $.settings.user != undefined && $.settings.user.getPurchaseSummary != undefined ) {
        var getPurchaseSummarySettings = $.settings.user.getPurchaseSummary;

        if ( getPurchaseSummarySettings.amount != undefined ) {
            $('#getPurchaseSummaryForm_amount_value').text(getPurchaseSummarySettings.amount.value);
        }
        else {
            $('#getPurchaseSummaryForm_amount_value').text('');
        }

        if ( getPurchaseSummarySettings.downloadLink != undefined ) {
            $('#getPurchaseSummaryForm_download_link').attr("href", getPurchaseSummarySettings.downloadLink.value);
        }
        else {
            $('#getPurchaseSummaryForm_download_link').attr("href", "#");
        }
    }
}

/** Enable waiting mode on getPurchaseSummaryForm
 */
function getPurchaseSummaryFormWaiting( state ){
    switch ( state ) {
        case true:
            $('body').toggleClass("cursor-wait");
            break;
        case false:
            $('body').toggleClass("cursor-wait");
            break;
    }
}

/** Executed when button is clicked
 */
function getPurchaseSummaryFormGenerate(){

    var params = new Object();
    // Mandatory parameters
    params.login = $.settings.user.login.value;

    if ( ($.settings.user != undefined) && ($.settings.user.securePwd != undefined) ) {
        params.securePwd = $.settings.user.securePwd.value;
    }

    var callbacks = new Object();
    callbacks.beforeSend = function (){
        getPurchaseSummaryFormWaiting(true);
    };
    callbacks.success = function (){
        getPurchaseSummaryFormGenerateCallback();
    };
    callbacks.complete = function (){
        getPurchaseSummaryFormWaiting(false);
    };

    getPurchaseSummary(callbacks, params);
}

/** Executed on return of getPurchaseSummaryFormConfirm function
 */
function getPurchaseSummaryFormGenerateCallback(){

    displayErrorInfo();
    if ( $.settings.error == undefined ) {
        getPurchaseSummaryLink_display();
    }
}

/*****************************************************************************/

/** Display getPurchaseSummaryLink_block depending on settings
 * Can be overwritten by state
 * @param boolean state - Indicate if the form must be displayed or not
 */
function getPurchaseSummaryLink_display( state ){

    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }
    else if ( ($.settings.user == undefined) || ($.settings.user.getPurchaseSummaryForm == undefined) || ($.settings.user.getPurchaseSummaryForm.display != true) ) {
        display = true;
    }
    else {
        display = false;
    }

    if ( $.settings.user == undefined ) {
        $.settings.user = new Object();
    }
    if ( $.settings.user.getPurchaseSummaryForm == undefined ) {
        $.settings.user.getPurchaseSummaryForm = new Object();
    }
    $.settings.user.getPurchaseSummaryForm.display = display;
    getPurchaseSummaryForm_display(display);
    // We display the opposite the feedback
    feedbackForm_display(!display);
}

/*****************************************************************************/
/****          Get Purchase Summary Form JavaScript functions           ****/
/*****************************************************************************/

/** This function is triggered when the page is loaded
 */
$(document).ready(function (){

    /** Input triggers
     */
    $('form[name="upgradeAccountForm"] input[name="multidevice"]').keyup(function (){
        upgradeAccountForm_change();
    });


    /** Buttons triggers
     */

    $('#upgradeAccountFormLinks_back_button').click(function (){
        upgradeAccountFormLink_display(false);
    });
    $('#upgradeAccountFormMultidevice_back_button').click(function (){
        upgradeAccountCheckForm_display(false);
        upgradeAccountOgoneRedirectForm_display(false);
        upgradeAccountFormLink_display(false);
        manageAccountForm_display(true);
    });
    $('#upgradeAccountFormMultidevice_update_button').click(function (){
        upgradeAccountForm_getAmount();
    });
    $('#upgradeAccountCheckForm_back_button').click(function (){
        upgradeAccountCheckForm_display(false);
        upgradeAccountFormLink_display(false);
        manageAccountForm_display(true);
    });
    $('#upgradeAccountCheckForm_check_button').click(function (){
        upgradeAccountCheckForm_check();
    });
    $('#upgradeAccountOgoneRedirectForm_pay_button').click(function (){
        upgradeAccountOgoneRedirectForm_pay();
    });
    $('#upgradeAccountOgoneRedirectForm_back_button').click(function (){
        upgradeAccountCheckForm_display(false);
        upgradeAccountOgoneRedirectForm_display(false);
        upgradeAccountFormLink_display(false);
        manageAccountForm_display(true);
    });

    /** Form triggers
     */
    $('form[name="upgradeAccountForm"]').submit(function (){
        return false;
    });
    $('form[name="upgradeAccountResultForm"]').submit(function (){
        return false;
    });

    /** Link triggers
     */
    $('#upgradeAccountLink_link').click(function (){
        upgradeAccountForm_links_display(true);
        manageAccountForm_display(false);
    });
    $('#upgradeAccountFormLinks_add_simultaneous_connection_link').click(function (){
        manageAccountForm_display(false);
        upgradeAccountFormGenerate();
    });
    $('#upgradeAccountFormLinks_check_payment_link').click(function (){
        upgradeAccountCheckForm_display(true);
        manageAccountForm_display(false);
    });
});

/** Configure upgradeAccountForm depending on settings
 */
function upgradeAccountForm_configure(){
    // Configure display
    if ( !$.settings.upgradeAccount ) {
        $('form[name="upgradeAccountForm"]').remove();
        $('form[name="upgradeAccountResultForm"]').remove();
        $('form[name="upgradeAccountOgoneRedirectForm"]').remove();
        $('#upgradeAccountForm_links_explain_text').remove();
        $('#upgradeAccountFormLinks_add_simultaneous_connection_link').remove();
        $('#upgradeAccountFormLinks_check_payment_link').remove();
        $('#upgradeAccountForm_explain_text').remove();
        $('#upgradeAccountForm_separator').remove();
    }
}

/** Display upgradeAccountForm depending on settings
 * @param boolean state - Indicate if the form must be displayed or not
 */
function upgradeAccountForm_display( state ){
    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }
    if ( display == true ) {
        upgradeAccountForm_fillIn();
        $('form[name="upgradeAccountForm"]').show();
    }
    else {
        $('form[name="upgradeAccountForm"]').hide();

        if ( $.settings.user && $.settings.user.upgradeAccount != undefined && $.settings.user.upgradeAccount.show == true ) {
            upgradeAccountForm_links_in_manage_display(true);
        }
        else {
            upgradeAccountForm_links_in_manage_display(false);
        }
    }
}

function upgradeAccountForm_links_in_manage_display( state ){
    if ( state == true ) {
        $('#upgradeAccountForm_links_explain_text').show();
        $('#upgradeAccountFormLinks_add_simultaneous_connection_link').show();
        $('#upgradeAccountFormLinks_check_payment_link').show();
        $('#upgradeAccountForm_explain_text').show();
        $('#upgradeAccountForm_separator').show();
    }
    else {
        $('#upgradeAccountForm_links_explain_text').hide();
        $('#upgradeAccountFormLinks_add_simultaneous_connection_link').hide();
        $('#upgradeAccountFormLinks_check_payment_link').hide();
        $('#upgradeAccountForm_explain_text').hide();
        $('#upgradeAccountForm_separator').hide();
    }
}

function upgradeAccountForm_links_display( state ){
    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }
    if ( display == true ) {
        upgradeAccountForm_change();
        upgradeAccountCheckForm_display(false);
        upgradeAccountForm_addSimultaneousConnection_display(false);
        upgradeAccountFormLink_display(true);
    }
}

function upgradeAccountForm_addSimultaneousConnection_display( state ){
    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }
    if ( display == true ) {
        // Restore clean state
        upgradeAccountForm_empty();
        upgradeAccountOgoneRedirectForm_empty();
        upgradeAccountOgoneRedirectForm_display(false);
        upgradeAccountForm_links_display(false);
        upgradeAccountCheckForm_display(false);
        $('#upgradeAccountFormMultidevice').show();
        upgradeAccountForm_display(true);
    }
    else {
        $('#upgradeAccountFormMultidevice').hide();
    }
}

function upgradeAccountCheckForm_display( state ){
    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }
    if ( display == true ) {
        upgradeAccountForm_display(false);
        upgradeAccountOgoneRedirectForm_display(false);
        $('form[name="upgradeAccountCheckForm"]').show();
    }
    else {
        $('form[name="upgradeAccountCheckForm"]').hide();
    }
}

function upgradeAccountOgoneRedirectForm_display( state ){
    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }
    if ( display == true ) {
        $('form[name="upgradeAccountOgoneRedirectForm"]').show();
        $('#upgradeAccountFormMultidevice_update_block').hide();
    }
    else {
        $('form[name="upgradeAccountOgoneRedirectForm"]').hide();
        $('#upgradeAccountFormMultidevice_update_block').show();
    }
}

function upgradeAccountForm_fillIn( displayLang ){
    if ( $.settings.user != undefined && $.settings.user.upgradeAccount != undefined && $.settings.user.upgradeAccount.package != undefined ) {
        var upgradeAccountPackage = $.settings.user.upgradeAccount.package;
        $(upgradeAccountPackage).each(function (){
            var package = $(this)[0];
            var text;
            var currencyLanguage;
            if ( package[displayLang] != undefined ) {
                text = package[displayLang].text;
                currencyLanguage = displayLang;
            }
            else if ( $.settings != undefined && $.settings.lang != undefined && $.settings.lang.defaultLang != undefined && package[$.settings.lang.defaultLang] != undefined ) {
                text = package[$.settings.lang.defaultLang].text;
                currencyLanguage = $.settings.lang.defaultLang;
            }
            else {
                text = package[package.defaultLang].text;
                currencyLanguage = package.defaultLang;
            }
            $('#upgradeAccountForm_package_description_value').text(text);

            // Add currency
            $('#upgradeAccountForm_amount_currency').text((package['currency'] == "free") ? getGenericTranslation('free_package', currencyLanguage) : package['currency']);
        });
    }
    else {
        $('#upgradeAccountForm_package_description_value').text('');
    }
}

/** Empty directSubscriptionForm
 */
function upgradeAccountForm_empty(){

    $('form[name="upgradeAccountForm"] input[type="text"]').each(function (){
        $(this).val('');
    });

    $('#upgradeAccountForm_amount_value').text("-");
}

function upgradeAccountForm_change(){

    $('#upgradeAccountForm_amount_value').text("-");
    upgradeAccountOgoneRedirectForm_empty();
    upgradeAccountOgoneRedirectForm_display(false);
}

/** Executed when multidevice input is changed
 */
function upgradeAccountForm_getAmount(){

    var params = new Object();

    // Mandatory parameters
    params.login = $.settings.user.login.value;
    params.multidevice = $('form[name="upgradeAccountForm"] input[name="multidevice"]').val();

    if ( ($.settings.user != undefined) && ($.settings.user.securePwd != undefined) ) {
        params.securePwd = $.settings.user.securePwd.value;
    }

    var callbacks = new Object();
    callbacks.beforeSend = function (){
        upgradeAccountForm_waiting(true);
    };
    callbacks.success = function (){
        upgradeAccountForm_getOrderCallback();
    };
    callbacks.complete = function (){
        upgradeAccountForm_waiting(false);
    };

    getUpgradeOrder(callbacks, params);
}

/** Enable waiting mode on upgradeAccountForm
 */
function upgradeAccountForm_waiting( state ){
    switch ( state ) {
        case true:
            $('body').toggleClass("cursor-wait");
            break;
        case false:
            $('body').toggleClass("cursor-wait");
            break;
    }
}

function upgradeAccountForm_getOrderCallback(){
    displayErrorInfo();
    if ( $.settings.error == undefined ) {
        if ( $.settings.user != undefined && $.settings.user.upgradeAccount != undefined && $.settings.user.upgradeAccount.amount != undefined ) {
            $('#upgradeAccountForm_amount_value').text($.settings.user.upgradeAccount.amount.value);
            upgradeAccountOgoneRedirectForm_fillIn();
            upgradeAccountOgoneRedirectForm_display(true);
        }
    }
}

function upgradeAccountOgoneRedirectForm_fillIn(){
    if ( $.settings.user != undefined && $.settings.user.upgradeAccount != undefined && $.settings.user.upgradeAccount.payment != undefined ) {
        $('form[name="upgradeAccountOgoneRedirectForm"] input[name="encrypted"]').val($.settings.user.upgradeAccount.payment.packageEncr);
        $('form[name="upgradeAccountOgoneRedirectForm"]').attr('action', $.settings.user.upgradeAccount.payment.ogoneUrlPost);
        $('form[name="upgradeAccountOgoneRedirectForm"] input[name="PSPID"]').val($.settings.user.upgradeAccount.payment.pspid);
        $('form[name="upgradeAccountOgoneRedirectForm"] input[name="USERID"]').val($.settings.user.upgradeAccount.payment.userid);
        $('form[name="upgradeAccountOgoneRedirectForm"] input[name="PSWD"]').val($.settings.user.upgradeAccount.payment.userpassword);
        $('form[name="upgradeAccountOgoneRedirectForm"] input[name="ORDERID"]').val($.settings.user.upgradeAccount.payment.orderid);
        $('form[name="upgradeAccountOgoneRedirectForm"] input[name="AMOUNT"]').val($.settings.user.upgradeAccount.payment.amount);
        $('form[name="upgradeAccountOgoneRedirectForm"] input[name="CURRENCY"]').val($.settings.user.upgradeAccount.payment.currency);
        $('form[name="upgradeAccountOgoneRedirectForm"] input[name="LANGUAGE"]').val($.settings.user.upgradeAccount.payment.language);
        $('form[name="upgradeAccountOgoneRedirectForm"] input[name="SHASIGN"]').val($.settings.user.upgradeAccount.payment.shasign);
    }
}

function upgradeAccountOgoneRedirectForm_empty(){
    $('form[name="upgradeAccountOgoneRedirectForm"] input[type="hidden"]').each(function (){
        $(this).val('');
    });
    $('form[name="upgradeAccountOgoneRedirectForm"]').removeAttr('action');
}

function upgradeAccountOgoneRedirectForm_pay(){
    var params = new Object();
    params.login = $.settings.user.login.value;
    params.orderId = $.settings.user.upgradeAccount.payment.orderid;

    if ( ($.settings.user != undefined) && ($.settings.user.securePwd != undefined) ) {
        params.securePwd = $.settings.user.securePwd.value;
    }

    var callbacks = new Object();
    callbacks.beforeSend = function (){
        ogonePaymentFormWaiting(true);
    };
    callbacks.success = function (){
        upgradeAccountOgoneRedirectForm_payCallback();
    };
    callbacks.complete = function (){
        ogonePaymentFormWaiting(false);
    };

    updateUpgradeOrder(callbacks, params);
}

/** Executed on return of upgradeAccountOgoneRedirectForm_pay function
 */
function upgradeAccountOgoneRedirectForm_payCallback(){

    displayErrorInfo();
    if ( $.settings.error == undefined ) {
        upgradeAccountCheckForm_display(true);
    }
}

function upgradeAccountCheckForm_check(){
    var params = new Object();
    params.login = $.settings.user.login.value;

    if ( ($.settings.user != undefined) && ($.settings.user.securePwd != undefined) ) {
        params.securePwd = $.settings.user.securePwd.value;
    }

    var callbacks = new Object();
    callbacks.beforeSend = function (){
        ogonePaymentFormWaiting(true);
    };
    callbacks.success = function (){
        upgradeAccountCheckForm_checkCallback();
    };
    callbacks.complete = function (){
        ogonePaymentFormWaiting(false);
    };

    checkUpgradeOrder(callbacks, params);
}

/** Executed on return of upgradeAccountCheckForm_check function
 */
function upgradeAccountCheckForm_checkCallback(){

    displayErrorInfo();
    if ( $.settings.error == undefined ) {
        upgradeAccountFormLink_display(false);
        upgradeAccountCheckForm_display(false);
    }
}

/** Executed when link is clicked
 */
function upgradeAccountFormGenerate(){

    var params = new Object();
    // Mandatory parameters
    params.login = $.settings.user.login.value;

    if ( ($.settings.user != undefined) && ($.settings.user.securePwd != undefined) ) {
        params.securePwd = $.settings.user.securePwd.value;
    }

    var callbacks = new Object();
    callbacks.beforeSend = function (){
        upgradeAccountForm_waiting(true);
    };
    callbacks.success = function (){
        upgradeAccountFormGenerateCallback();
    };
    callbacks.complete = function (){
        upgradeAccountForm_waiting(false);
    };

    getCurrentPackage(callbacks, params);
}

/** Executed on return of getPurchaseSummaryFormConfirm function
 */
function upgradeAccountFormGenerateCallback(){

    displayErrorInfo();
    if ( $.settings.error == undefined ) {
        upgradeAccountForm_fillIn();
        upgradeAccountForm_addSimultaneousConnection_display(true);
    }
}

/*****************************************************************************/

/** Display upgradeAccountForm depending on settings
 * Can be overwritten by state
 * @param boolean state - Indicate if the form must be displayed or not
 */
function upgradeAccountFormLink_display( state ){

    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }
    else if ( ($.settings.user == undefined) || ($.settings.user.upgradeAccountForm == undefined) || ($.settings.user.upgradeAccountForm.display != true) ) {
        display = true;
    }
    else {
        display = false;
    }

    if ( $.settings.user == undefined ) {
        $.settings.user = new Object();
    }
    if ( $.settings.user.upgradeAccountForm == undefined ) {
        $.settings.user.upgradeAccountForm = new Object();
    }
    $.settings.user.upgradeAccountForm.display = display;
    upgradeAccountForm_display(display);
    // We display the opposite the feedback
    feedbackForm_display(!display);
}


/*****************************************************************************/
/****           Password Recovery Form JavaScript functions               ****/
/*****************************************************************************/

/** Listen to modified element
 */
var pwdRecoveryForm_changed = new Object();

/** This function is triggered when the page is loaded
 */
$(document).ready(function() {

	/** Inputs triggers
	 */
	$('form[name="pwdRecoveryForm"] input[name="prefix"]').focus(function() {
		pwdRecoveryForm_modifyEvent('focus', $(this));
		pwdRecoveryForm_phoneHelpBlock_display(true);
	});

	$('form[name="pwdRecoveryForm"] input[name="prefix"]').blur(function() {
		pwdRecoveryForm_modifyEvent('blur', $(this));
	});

	$('form[name="pwdRecoveryForm"] input[name="phone"]').focus(function() {
		pwdRecoveryForm_modifyEvent('focus', $(this));
		pwdRecoveryForm_phoneHelpBlock_display(true);
	});

	$('form[name="pwdRecoveryForm"] input[name="phone"]').blur(function() {
		pwdRecoveryForm_modifyEvent('blur', $(this));
	});

	/** Form triggers
	 */
	$('form[name="pwdRecoverySetForm"]').submit(function (){
		return false;
	});

	$('form[name="pwdRecoveryForm"]').submit(function() {
		return false;
	});

	$('form[name="pwdRecoveryResendForm"]').submit(function() {
		return false;
	});

	$('form[name="pwdRecoveryResendResultForm"]').submit(function() {
		return false;
	});

	/** Link triggers
	 */
	$('#logonForm_forgotPasswordLink_link').click(function() {
		pwdRecoveryForm_display(true);
		logonForm_display(false);
	});

	$('#pwdRecoveryForm_phone_help_link').click(function() {
		pwdRecoveryForm_phoneHelpBlock_display();
	});

	$('#pwdRecoveryResendForm_sms_link').click(function() {
		pwdRecoveryResendForm_sendBySms();
	});

	$('#pwdRecoveryResendForm_email_link').click(function() {
		pwdRecoveryResendForm_sendByEmail();
	});

	$('#pwdRecoveryResendForm_questions_link').click(function() {
		pwdRecoveryResendForm_questions_block_display(true);
		$('#pwdRecoveryResendForm_links_block').hide();
	});

	$('#pwdRecoverySetLink_link').click(function() {
		pwdRecoverySetForm_display(true);
		manageAccountForm_display(false);
	});

	/** Buttons triggers
	 */
	$('#pwdRecoveryForm_back_button').click(function() {
		logonForm_display(true);
		pwdRecoveryForm_display(false);
	});

	$('#pwdRecoveryForm_confirm_button').click(function() {
		pwdRecoveryForm_confirm();
	});

	$('#pwdRecoveryResendForm_questions_back_button').click(function() {
		pwdRecoveryResendForm_questions_block_display(false);
		if ( $.settings.user.pwdRecovery.modes.sms == true || $.settings.user.pwdRecovery.modes.email == true ) {
			pwdRecoveryResendForm_display(true);
			pwdRecoveryResendForm_questions_block_display(false);
		}
		else {
			pwdRecoveryResendForm_display(false);
			pwdRecoveryForm_display(true);
			pwdRecoveryResendForm_questions_block_display(false);
		}
	});

	$('#pwdRecoveryResendForm_questions_update_button').click(function() {
		pwdRecoveryResendForm_sendByQuestions();
	});

	$('#pwdRecoveryResendForm_back_button').click(function() {
		pwdRecoveryResendForm_display(false);
		pwdRecoveryForm_display(true);
	});

	$('#pwdRecoverySetForm_back_button').click(function() {
		pwdRecoverySetForm_display(false);
		manageAccountForm_display(true);
	});

	$('#pwdRecoverySetForm_update_button').click(function() {
		pwdRecoverySetForm_update();
	});

	$('#pwdRecoveryResendResultForm_back_button').click(function() {
		logonForm_display(true);
		pwdRecoveryResendResultForm_display(false);
	});

});

// Live event bindings
$(document).delegate('form[name="pwdRecoverySetForm"] select', "change", pwdRecoverySetForm_updateQuestionChoices);

/** Configure pwdRecoveryForm depending on settings
 */
function pwdRecoveryForm_configure() {

	// Configure display
	if ( $.settings.pwdRecovery == true ) {
		$('#logonForm_forgotPasswordLink').show();
		// Configure help block
		pwdRecoveryForm_phoneHelpBlock_configure();
	}
	else {
		$('form[name="pwdRecoveryForm"]').remove();
	}
}

/** Display pwdRecoveryForm depending on settings
 * Can be overwritten by state
 * @param boolean state - Indicate if the form must be displayed or not
 */
function pwdRecoveryForm_display(state) {

	var display = false;
	if ( (state == true) || (state == false) ) {
		display = state;
	}

	if ( display == true ) {
		$('form[name="pwdRecoveryForm"]').show();
	}
	else {
		$('form[name="pwdRecoveryForm"]').hide();
// 		$('form[name="pwdRecoveryForm"] tr[id$="_block"]').hide();
		pwdRecoveryForm_empty();
	}
	pwdRecoveryForm_phoneHelpBlock_display(false);
}

/** Empty pwdRecoveryForm
 */
function pwdRecoveryForm_empty() {

	$('form[name="pwdRecoveryForm"] input').each(function() {
		$(this).val('');
	});

	// Adding examples values
	pwdRecoveryForm_phoneHelpBlock_configure();

	pwdRecoveryForm_changed['prefix'] = false;
	pwdRecoveryForm_changed['phone'] = false;
}

/** Configure directSubscriptionForm_phone_block
 * @param string displayLang - The language whish to display the content
 */
function pwdRecoveryForm_phoneHelpBlock_configure(displayLang) {
	if ( pwdRecoveryForm_changed['prefix'] != true ) {
		$('#pwdRecoveryForm_phone_prefix_value').val(getInputTranslation("pwdRecoveryForm_phone_prefix_value", displayLang));
	}
	if ( pwdRecoveryForm_changed['phone'] != true ) {
		$('#pwdRecoveryForm_phone_phone_value').val(getInputTranslation("pwdRecoveryForm_phone_phone_value", displayLang));
	}
	$('#pwdRecoveryForm_phone_help_prefix_example_value').val(getInputTranslation("pwdRecoveryForm_phone_help_prefix_example_value", displayLang));
	$('#pwdRecoveryForm_phone_help_phone_example_value').val(getInputTranslation("pwdRecoveryForm_phone_help_phone_example_value", displayLang));
}

/** Manage the modification of inputs and the help texts present on them
 * @param string type - The type on the event (focus | blur )
 * @param element element - The DOM element afected by the modification
 */
function pwdRecoveryForm_modifyEvent(type, element) {
	switch ( type ) {
		case 'focus':
			if ( pwdRecoveryForm_changed[element.attr("name")] != true ) {
				element.val("");
			}
			break;

		case 'blur':
			if ( element.val() == "" ) {
				element.val(getInputTranslation(element.attr("id")));
				pwdRecoveryForm_changed[element.attr("name")] = false;
			}
			else {
				pwdRecoveryForm_changed[element.attr("name")] = true;
			}
			break;
	}
}

/** Display pwdRecoveryForm_phone_help_block when help link is clicked
 * @param boolean state - Indicate if the block must be displayed or not
 */
function pwdRecoveryForm_phoneHelpBlock_display( state ) {

	var display = false;
	if ( (state == true) || (state == false) ) {
		display = state;
	}
	else if ( $('#pwdRecoveryForm_phone_help_block').is(':hidden') == true ) {
		display = true;
	}

	if ( display == true ) {
		$('#pwdRecoveryForm_phone_help_block').show();
	}
	else {
		$('#pwdRecoveryForm_phone_help_block').hide();
	}
}

function pwdRecoveryForm_confirm() {
	var params = new Object();

	params.login = $('form[name="pwdRecoveryForm"] input[name="login"]').val();
	params.emailAddress = $('form[name="pwdRecoveryForm"] input[name="email"]').val();
	params.prefix = (pwdRecoveryForm_changed['prefix'] == true) ? $('form[name="pwdRecoveryForm"] input[name="prefix"]').val() : "";
	params.phone = (pwdRecoveryForm_changed['phone'] == true) ? $('form[name="pwdRecoveryForm"] input[name="phone"]').val() : "";

	if ( ($.settings.user != undefined) && ($.settings.user.securePwd != undefined) ) {
		params.securePwd = $.settings.user.securePwd.value;
	}

	//Re-init settings to get up to date infos, caused by $.extend use, merging returned ajax data
	$.settings.user.pwdRecovery = undefined;

	var callbacks = new Object();
	callbacks.beforeSend = function() { pwdRecoveryFormWaiting(true); };
	callbacks.success    = function() { pwdRecoveryForm_confirmCallback(); };
	callbacks.complete   = function() { pwdRecoveryFormWaiting(false); };

	getPwdRecoveryOptionsFromUser(callbacks, params);
}

/** Executed on return of pwdRecoveryForm_update function
 */
function pwdRecoveryForm_confirmCallback() {

	displayErrorInfo();
	if ( $.settings.error == undefined ) {
		pwdRecoveryResendForm_display(true);
		pwdRecoveryForm_display(false);
		pwdRecoveryResendForm_questions_block_display(false);
	}
}

/** Enable waiting mode on pwdRecoverySetForm
 */
function pwdRecoveryFormWaiting(state) {
	switch ( state ) {
		case true:
			$('form[name="pwdRecoveryForm"] button').attr("disabled", true);
			$('body').toggleClass("cursor-wait");
			break;
		case false:
			$('form[name="pwdRecoveryForm"] button').attr("disabled", false);
			$('body').toggleClass("cursor-wait");
			break;
	}
}

function pwdRecoveryResendForm_display( state ){
    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }

    if ( display == true ) {
        $('form[name="pwdRecoveryResendForm"]').show();

        if ( $.settings.user != undefined && $.settings.user.pwdRecovery != undefined && $.settings.user.pwdRecovery.modes != undefined ) {
            // Display modes
            if ( $.settings.user.pwdRecovery.modes.questions == true ) {
                $('#pwdRecoveryResendForm_questions_link_block').show();
            }
            else {
                $('#pwdRecoveryResendForm_questions_link_block').hide();
            }
            if ( $.settings.user.pwdRecovery.modes.sms == true ) {
                $('#pwdRecoveryResendForm_sms_link_block').show();
            }
            else {
                $('#pwdRecoveryResendForm_sms_link_block').hide();
            }
            if ( $.settings.user.pwdRecovery.modes.email == true ) {
                $('#pwdRecoveryResendForm_email_link_block').show();
            }
            else {
                $('#pwdRecoveryResendForm_email_link_block').hide();
            }
            if ( $.settings.user.pwdRecovery.modes.sms == true || $.settings.user.pwdRecovery.modes.email == true || $.settings.user.pwdRecovery.modes.questions == true ) {
                $('#pwdRecoveryResendForm_links_block').show();
            }
            pwdRecoveryResendForm_questions_block_display($.settings.user.pwdRecovery.modes.questions);
        }
    }
    else {
        $('form[name="pwdRecoveryResendForm"]').hide();
        pwdRecoveryResendForm_empty();
        displayStep();
    }
}

function pwdRecoveryResendForm_questions_block_display( state ){
    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }

    if ( display == true ) {
        pwdRecoveryResendForm_fillInQuestions();
        $('#pwdRecoveryResendForm_questions_block').show();
    }
    else {
        $('#pwdRecoveryResendForm_questions_block').hide();
        pwdRecoveryResendForm_empty();
    }
}

function pwdRecoveryResendForm_empty(){
    $('form[name="pwdRecoveryResendForm"] div[id^="pwdRecoveryResendForm_question_"][id$="_block"][id!="pwdRecoveryResendForm_question_base_block"]').remove();
// 	$('form[name="pwdRecoveryResendForm"] input').each(function() {
// 		$(this).val('');
// 	});
}

function pwdRecoveryResendForm_fillInQuestions( displayLang ){
    if ( $.settings != undefined && $.settings.user != undefined && $.settings.user.pwdRecovery != undefined && $.settings.user.pwdRecovery.questions != undefined ) {
        var questions = $.settings.user.pwdRecovery.questions;
        var availableQuestions = $.settings.user.pwdRecovery.availableQuestions;

        $.each(questions, function ( questionIndex, questionValue ){
            var clone = $('#pwdRecoveryResendForm_question_base_block').clone().show();
            $(clone).attr("id", $(clone).attr("id").replace("_base", "_" + questionIndex));
            $(clone).find('span').each(function (){
                $(this).attr("id", $(this).attr("id").replace("_base", "_" + questionIndex));
                if ( getGenericTranslation('pwdRecoverySecretQuestion_' + questionValue, displayLang) != "" ) {
                    $(this).text(getGenericTranslation('pwdRecoverySecretQuestion_' + questionValue, displayLang));
                }
            });
            $(clone).find('input').each(function (){
                $(this).attr("name", $(this).attr("name").replace("_base", "_" + questionIndex));
            });
            $(clone).insertBefore($('#pwdRecoveryResendForm_question_base_block'));
        });
    }
}

function pwdRecoveryResendForm_questionsTranslate( displayLang ){
    if ( displayLang == undefined ) {
        if ( $.settings != undefined && $.settings.user != undefined && $.settings.user.lang != null ) {
            displayLang = $.settings.user.lang;
        }
        else {
            displayLang = $.settings.lang.defaultLang;
        }
    }
    pwdRecoveryResendForm_empty();
    pwdRecoveryResendForm_fillInQuestions(displayLang);
}

function pwdRecoveryResendForm_sendBySms(){
    var params = new Object();

    if ( ($.settings.user != undefined) && ($.settings.user.securePwd != undefined) ) {
        params.securePwd = $.settings.user.securePwd.value;
    }

    var callbacks = new Object();
    callbacks.beforeSend = function (){
        pwdRecoveryResendFormWaiting(true);
    };
    callbacks.success = function (){
        pwdRecoveryResendForm_sendCallback();
    };
    callbacks.complete = function (){
        pwdRecoveryResendFormWaiting(false);
    };

    regenPwdWithSmsResend(callbacks, params);
}

function pwdRecoveryResendForm_sendByEmail(){
    var params = new Object();

    if ( ($.settings.user != undefined) && ($.settings.user.securePwd != undefined) ) {
        params.securePwd = $.settings.user.securePwd.value;
    }

    var callbacks = new Object();
    callbacks.beforeSend = function (){
        pwdRecoveryResendFormWaiting(true);
    };
    callbacks.success = function (){
        pwdRecoveryResendForm_sendCallback();
    };
    callbacks.complete = function (){
        pwdRecoveryResendFormWaiting(false);
    };

    regenPwdWithEmailResend(callbacks, params);
}

function pwdRecoveryResendForm_sendCallback(){

    displayErrorInfo();
    if ( $.settings.error == undefined ) {
        logonForm_display(true);
        pwdRecoveryResendForm_display(false);
    }
}

function pwdRecoveryResendForm_sendByQuestions(){
    var params = new Object();

    $('form[name="pwdRecoveryResendForm"] input[name^="answer_"]').each(function (){
        params[$(this).attr("name")] = $.trim($(this).val());
    });

    if ( ($.settings.user != undefined) && ($.settings.user.securePwd != undefined) ) {
        params.securePwd = $.settings.user.securePwd.value;
    }

    var callbacks = new Object();
    callbacks.beforeSend = function (){
        pwdRecoveryResendFormWaiting(true);
    };
    callbacks.success = function (){
        pwdRecoveryResendForm_sendByQuestionsCallback();
    };
    callbacks.complete = function (){
        pwdRecoveryResendFormWaiting(false);
    };

    regenPwdWithSecretQuestions(callbacks, params);
}

function pwdRecoveryResendForm_sendByQuestionsCallback(){

    displayErrorInfo();
    if ( $.settings.error == undefined ) {
        pwdRecoveryResendResultForm_fillIn($.settings.info.pwdRecovery.password);
        pwdRecoveryResendResultForm_display(true);
        pwdRecoveryResendForm_display(false);
    }
}

function pwdRecoveryResendFormWaiting( state ){
    switch ( state ) {
        case true:
            $('form[name="pwdRecoveryResendForm"] button').attr("disabled", true);
            $('body').toggleClass("cursor-wait");
            break;
        case false:
            $('form[name="pwdRecoveryResendForm"] button').attr("disabled", false);
            $('body').toggleClass("cursor-wait");
            break;
    }
}

function pwdRecoverySetForm_configure(){
    // Moving link to right location
    $('#pwdRecoverySetLink').appendTo('#manageAccountForm_links_block');
    // CHANGED_BY_HH
    // Removed "td" and changed appending from #manageAccountForm_links_others_links_block to #manageAccountForm_links_block
    // to make the grid working without to know how many links will be append
    // OLD: $('#pwdRecoverySetLink').appendTo('#manageAccountForm_links_others_links_block td');
}

function pwdRecoverySetForm_display( state ){
    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }

    if ( $.settings != undefined && $.settings.user != undefined && $.settings.user.pwdRecovery != undefined ) {
        $('#pwdRecoverySetLink').show();
    }
    else {
        $('#pwdRecoverySetLink').hide();
    }

    if ( display == true ) {
        pwdRecoverySetForm_fillInQuestions();
        $('form[name="pwdRecoverySetForm"]').show();
        manageAccountForm_links_display(false);
    }
    else {
        $('form[name="pwdRecoverySetForm"]').hide();
        pwdRecoverySetForm_empty();
    }
}

function pwdRecoverySetForm_fillInQuestions(){


    if ( $.settings != undefined && $.settings.user != undefined && $.settings.user.pwdRecovery != undefined ) {
        for ( var itt = 0; itt < $.settings.user.pwdRecovery.maxQuestions; itt++ ) {
            var questions = $.settings.user.pwdRecovery.availableQuestions;

            var clone = $('#pwdRecoverySetForm_question_base_block').clone().show();
            $(clone).attr("id", $(clone).attr("id").replace("_base", "_" + itt));
            $(clone).find('pwdRecoverySetForm_question_base_default_option').each(function (){
                $(this).id("id", $(this).attr("id").replace("_base", "_" + itt));
            });
            $(clone).find('select').each(function (){
                var select = $(this).attr("name", $(this).attr("name").replace("_base", "_" + itt));

                $.each(questions, function ( questionIndex, questionValue ){
                    $(select).append('<option value="' + questionValue + '">' + questionValue + '</option>');
                });
            });
            $(clone).find('input').each(function (){
                $(this).attr("name", $(this).attr("name").replace("_base", "_" + itt));
            });

            // Set users values
            if ( $.settings.user.pwdRecovery.questions != undefined && $.settings.user.pwdRecovery.questions[itt] != undefined && $.settings.user.pwdRecovery.answers[itt] ) {
                $(clone).find('select').each(function (){
                    $(this).val($.settings.user.pwdRecovery.questions[itt]);
                });

                $(clone).find('input').each(function (){
                    $(this).val($.settings.user.pwdRecovery.answers[itt]);
                });
            }

            $(clone).insertBefore($('#pwdRecoverySetForm_question_base_block'));
        }
    }
    pwdRecoverySetForm_questionsTranslate();
    pwdRecoverySetForm_updateQuestionChoices();
}

function pwdRecoverySetForm_empty() {
	$('form[name="pwdRecoverySetForm"] div[id^="pwdRecoverySetForm_question_"][id$="_block"][id!="pwdRecoverySetForm_question_base_block"]').remove();
}

function pwdRecoverySetForm_questionsTranslate( displayLang ){
    $('form[name="pwdRecoverySetForm"] select option').each(function (){
        if ( getGenericTranslation('pwdRecoverySecretQuestion_' + $(this).val(), displayLang) != "" ) {
            $(this).text(getGenericTranslation('pwdRecoverySecretQuestion_' + $(this).val(), displayLang));
        }
    });
}

function pwdRecoverySetForm_updateQuestionChoices(){
    var selectedQuestions = new Array();
    // Gather selected questions
    $('form[name="pwdRecoverySetForm"] select').each(function (){
        if ( $(this).val() != "" ) {
            selectedQuestions.push($(this).val());
        }
    });

    // Disable this options in others select list
    $('form[name="pwdRecoverySetForm"] select').each(function (){
        var selectValue = $(this).val();

        $(this).find('option').each(function (){
            $(this).attr('disabled', false).show();
            if ( ($.inArray($(this).val(), selectedQuestions) != -1) && (selectValue != $(this).val()) ) {
                $(this).attr('disabled', true).hide();
            }
        });
    });
}

/** Enable waiting mode on pwdRecoverySetForm
 */
function pwdRecoverySetFormWaiting( state ){
    switch ( state ) {
        case true:
            $('form[name="pwdRecoverySetForm"] button').attr("disabled", true);
            $('body').toggleClass("cursor-wait");
            break;
        case false:
            $('form[name="pwdRecoverySetForm"] button').attr("disabled", false);
            $('body').toggleClass("cursor-wait");
            break;
    }
}

function pwdRecoverySetForm_update(){

    var params = new Object();

    $('form[name="pwdRecoverySetForm"] select[name^="question_"]').each(function (){
        params[$(this).attr("name")] = $(this).val();
    });

    $('form[name="pwdRecoverySetForm"] input[name^="answer_"]').each(function (){
        params[$(this).attr("name")] = $.trim($(this).val());
    });

    if ( ($.settings.user != undefined) && ($.settings.user.securePwd != undefined) ) {
        params.securePwd = $.settings.user.securePwd.value;
    }

    var callbacks = new Object();
    callbacks.beforeSend = function (){
        pwdRecoverySetFormWaiting(true);
    };
    callbacks.success = function (){
        pwdRecoverySetForm_updateCallback();
    };
    callbacks.complete = function (){
        pwdRecoverySetFormWaiting(false);
    };

    updatePwdRecoverySecretQuestions(callbacks, params);
}

/** Executed on return of pwdRecoverySetForm_update function
 */
function pwdRecoverySetForm_updateCallback(){

    displayErrorInfo();
    if ( $.settings.error == undefined ) {
        manageAccountForm_display(true);
        pwdRecoverySetForm_display(false);
    }
}

function pwdRecoveryResendResultForm_display( state ){
    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }

    if ( display == true ) {
        $('form[name="pwdRecoveryResendResultForm"]').show();
    }
    else {
        $('form[name="pwdRecoveryResendResultForm"]').hide();
        pwdRecoveryResendResultForm_empty();
    }
}

function pwdRecoveryResendResultForm_fillIn( newPassword ){
    $('form[name="pwdRecoveryResendResultForm"] #pwdRecoveryResendResultForm_password_value').text(newPassword);
}

function pwdRecoveryResendResultForm_empty(){
    $('form[name="pwdRecoveryResendResultForm"] #pwdRecoveryResendResultForm_password_value').text('');
}

/*****************************************************************************/
/****          Manage Account Form JavaScript functions                   ****/
/*****************************************************************************/

/** Listen to modified element
 */
var manageAccountForm_personal_settings_changed = new Object();

/** This function is triggered when the page is loaded
 */
$(document).ready(function (){

    /** Input triggers
     */
    $('form[name="manageAccountForm"] input[name="prefix"]').focus(function (){
        manageAccountForm_personal_settings_modifyEvent('focus', $(this));
        manageAccountForm_personal_settings_phoneHelpBlock_display(true);
    });

    $('form[name="manageAccountForm"] input[name="prefix"]').blur(function (){
        manageAccountForm_personal_settings_modifyEvent('blur', $(this));
    });

    $('form[name="manageAccountForm"] input[name="phone"]').focus(function (){
        manageAccountForm_personal_settings_modifyEvent('focus', $(this));
        manageAccountForm_personal_settings_phoneHelpBlock_display(true);
    });

    $('form[name="manageAccountForm"] input[name="phone"]').blur(function (){
        manageAccountForm_personal_settings_modifyEvent('blur', $(this));
    });

    /** Buttons triggers
     */
    $('#manageAccountForm_links_back_button').click(function (){
        displayStep();
    });
    $('#manageAccountForm_personal_settings_back_button').click(function (){
        manageAccountForm_display(true);
    });
    $('#manageAccountForm_personal_settings_update_button').click(function (){
        manageAccountForm_personal_settings_update();
    });
    $('#manageAccountForm_devices_back_button').click(function (){
        manageAccountForm_display(true);
    });
    $('#manageAccountForm_devices_update_button').click(function (){
        manageAccountForm_devices_update();
    });

    /** Form triggers
     */
    $('form[name="manageAccountForm"]').submit(function (){
        return false;
    });

    /** Link triggers
     */
    $('#manageAccountLink_link').click(function (){
        manageAccountForm_display(true);
    });
    $('#manageAccountForm_links_personal_settings_link').click(function (){
        manageAccountForm_personal_settings_display(true);
        manageAccountForm_devices_display(false);
        manageAccountForm_personal_settings_phoneHelpBlock_display(false);
    });

    $('#manageAccountForm_links_devices_link').click(function (){
        manageAccountForm_devices_display(true);
        manageAccountForm_personal_settings_display(false);
    });

    $('#manageAccountForm_links_account_refill_link').click(function (){
        accountRefillForm_display(true);
        manageAccountForm_display(false);
    });

    $('#manageAccountForm_personal_settings_phone_help_link').click(function (){
        manageAccountForm_personal_settings_phoneHelpBlock_display();
    });
    $('#manageAccountForm_links_modify_my_package_link').click(function (){
        modifyPackageForm_package_update();
    });
});

// Live event bindings
$(document).delegate('#manageAccountForm_devices_block div.trashButton', "click", manageAccountForm_devices_delete);

/** Configure manageAccountForm depending on settings
 */
function manageAccountForm_configure(){
    // Moving link to right location
    $('#manageAccountLink').appendTo('#feedbackForm_settings_link');
    // CHANGED_BY_HH
    // I have removed the "td" (#feedbackForm_settings_link td),
    // to append elemtnts to the div, instead to a table
    // OLD: $('#manageAccountLink').appendTo('#feedbackForm_settings_link td');
}

/** Display manageAccountForm depending on settings
 * @param boolean state - Indicate if the form must be displayed or not
 */
function manageAccountForm_display( state ){
    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }

    if ( $.settings.user.manageAccount == true ) {
        $('#manageAccountLink').show();
    }
    else {
        $('#manageAccountLink').hide();
    }
    manageAccountForm_links_display(true);
    manageAccountForm_devices_display(false);
    manageAccountForm_personal_settings_display(false);

    if ( display == true ) {
        $('form[name="manageAccountForm"]').show();
        feedbackForm_display(false);
    }
    else {
        $('form[name="manageAccountForm"]').hide();
    }
}

function manageAccountForm_links_display( state ){
    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }

    if ( $.settings.user.managePersonalSettings == true ) {
        $('#manageAccountForm_links_personal_settings_link_block').show();
    }
    else {
        $('#manageAccountForm_links_personal_settings_link_block').hide();
    }

    // Display devices management link
    if ( $.settings.user.manageDevices == true ) {
        $('#manageAccountForm_links_devices_link_block').show();
    }
    else {
        $('#manageAccountForm_links_devices_link_block').hide();
    }

    // Display change package link
    if ( $.settings.user.allowmodifypackage == true ) {
        $('#manageAccountForm_links_modify_my_package_block').show();
    }
    else {
        $('#manageAccountForm_links_modify_my_package_block').hide();
    }

    // Display account refill link
    if ( $.settings.accountRefill == true ) {
        $('#manageAccountForm_links_account_refill_link_block').show();
    }
    else {
        $('#manageAccountForm_links_account_refill_link_block').hide();
    }

    if ( display == true ) {
        $('#manageAccountForm_links_block').show();
    }
    else {
        $('#manageAccountForm_links_block').hide();
    }
}

function manageAccountForm_personal_settings_display( state ){
    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }

    if ( display == true ) {
        manageAccountForm_personal_settings_fillIn();
        $('#manageAccountForm_personal_settings_block').show();
        manageAccountForm_links_display(false);
    }
    else {
        $('#manageAccountForm_personal_settings_block').hide();
        manageAccountForm_personal_settings_empty();
    }
}

function manageAccountForm_devices_display( state ){
    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }
    if ( display == true ) {
        manageAccountForm_devices_fillIn();
        $('#manageAccountForm_devices_block').show();
        manageAccountForm_links_display(false);
    }
    else {
        $('#manageAccountForm_devices_block').hide();
        manageAccountForm_devices_empty();
    }
}

function manageAccountForm_personal_settings_fillIn(){
    if ( $.settings != undefined && $.settings.user != undefined ) {
        displayLang = $.settings.user.lang;
    }

    if ( $.settings.user != undefined ) {
        var userSettings = $.settings.user;
        var creationModeRegExp = new RegExp("^portal-([a-zA-Z_-]+)$");
        var creationModeMatches = creationModeRegExp.exec($.settings.user.creationMode.value);
        var defaultBehavior = false;
        if ( creationModeMatches != undefined ) {
            var creationMode = creationModeMatches[1];
            var creationModeSettings = $.settings.subscribe[creationMode];
        }
        else {
            // All field except custom fields are displayed and are optional (default behavior, if user was created by admin or deleg)
            defaultBehavior = true;
        }

        // Init fields
        $('tr[id^="manageAccountForm_personal_settings_"][id$="_block"]').show();
        $('span[id^="manageAccountForm_personal_settings_"][id$="_state"]').css("visibility", "");
        $('#manageAccountForm_personal_settings_postal_postoffice_box_state').css("visibility", "hidden");
        $('#manageAccountForm_personal_settings_postal_state_or_province_name_state').css("visibility", "hidden");

        // Configure lastName
        if ( defaultBehavior == true || (creationModeSettings.lastName != undefined && creationModeSettings.lastName.display == true) || (userSettings.lastName != undefined && userSettings.lastName.value != "") ) {
            if ( defaultBehavior == true || creationModeSettings.lastName == undefined || creationModeSettings.lastName.mandatory != true ) {
                $('#manageAccountForm_personal_settings_last_name_state').css("visibility", "hidden");
            }
            if ( userSettings.lastName != undefined && userSettings.lastName.value != undefined ) {
                $('form[name="manageAccountForm"] input[name="last_name"]').val(userSettings.lastName.value);
            }
        }
        else {
            $('#manageAccountForm_personal_settings_last_name_block').hide();
        }

        // Configure firstName
        if ( defaultBehavior == true || (creationModeSettings.firstName != undefined && creationModeSettings.firstName.display == true) || (userSettings.firstName != undefined && userSettings.firstName.value != "") ) {
            if ( defaultBehavior == true || creationModeSettings.firstName == undefined || creationModeSettings.firstName.mandatory != true ) {
                $('#manageAccountForm_personal_settings_first_name_state').css("visibility", "hidden");
            }
            if ( userSettings.firstName != undefined && userSettings.firstName.value != undefined ) {
                $('form[name="manageAccountForm"] input[name="first_name"]').val(userSettings.firstName.value);
            }
        }
        else {
            $('#manageAccountForm_personal_settings_first_name_block').hide();
        }

        // Configure email
        if ( defaultBehavior == true || (creationModeSettings.email != undefined && creationModeSettings.email.display == true) || (userSettings.email != undefined && userSettings.email.value != "") ) {
            if ( defaultBehavior == true || creationModeSettings.email == undefined || creationModeSettings.email.mandatory != true ) {
                $('#manageAccountForm_personal_settings_email_state').css("visibility", "hidden");
            }
            if ( userSettings.email != undefined && userSettings.email.value != undefined ) {
                $('form[name="manageAccountForm"] input[name="email"]').val(userSettings.email.value);
            }
        }
        else {
            $('#manageAccountForm_personal_settings_email_block').hide();
        }

        // Configure phoneNumber
        if ( defaultBehavior == true || (creationModeSettings.phone != undefined && creationModeSettings.phone.display == true) || (userSettings.phoneNumber != undefined && userSettings.phoneNumber.value != "") ) {
            if ( defaultBehavior == true || creationModeSettings.phone == undefined || creationModeSettings.phone.mandatory != true ) {
                $('#manageAccountForm_personal_settings_phone_state').css("visibility", "hidden");
            }
            if ( userSettings.phoneNumber != undefined && userSettings.phoneNumber.value != undefined ) {
                if ( userSettings.phoneNumber.value == "" ) {
                    $('form[name="manageAccountForm"] input[name="prefix"]').show();
                    $('#manageAccountForm_personal_settings_phone_help_link').show();
                }
                else {
                    $('form[name="manageAccountForm"] input[name="phone"]').val(userSettings.phoneNumber.value);
                    $('form[name="manageAccountForm"] input[name="prefix"]').hide();
                    $('#manageAccountForm_personal_settings_phone_help_link').hide();
                    manageAccountForm_personal_settings_changed['phone'] = true;
                }
            }
            else {
                // Display prefix field if there was no phone registered
                $('form[name="manageAccountForm"] input[name="prefix"]').show();
                $('#manageAccountForm_personal_settings_phone_help_link').show();
            }
        }
        else {
            $('#manageAccountForm_personal_settings_phone_block').hide();
        }

        // Configure organizationalUnitName
        if ( defaultBehavior == true || (creationModeSettings.organizationalUnitName != undefined && creationModeSettings.organizationalUnitName.display == true) || (userSettings.organizationalUnitName != undefined && userSettings.organizationalUnitName.value != "") ) {
            if ( defaultBehavior == true || creationModeSettings.organizationalUnitName == undefined || creationModeSettings.organizationalUnitName.mandatory != true ) {
                $('#manageAccountForm_personal_settings_organizational_unit_name_state').css("visibility", "hidden");
            }
            if ( userSettings.organizationalUnitName != undefined && userSettings.organizationalUnitName.value != undefined ) {
                $('form[name="manageAccountForm"] input[name="organizational_unit_name"]').val(userSettings.organizationalUnitName.value);
            }
        }
        else {
            $('#manageAccountForm_personal_settings_organizational_unit_name_block').hide();
        }

        // Configure postal fields
        if ( defaultBehavior == true || (creationModeSettings.postalAddress != undefined && creationModeSettings.postalAddress.display == true) || (userSettings.postalAddress != undefined && userSettings.postalAddress.value != "") ) {
            // Configure countryName
            if ( defaultBehavior == true || creationModeSettings.postalAddress == undefined || creationModeSettings.postalAddress.mandatory != true ) {
                $('#manageAccountForm_personal_settings_postal_country_name_state').css("visibility", "hidden");
            }
            if ( userSettings.countryName != undefined && userSettings.countryName.value != undefined ) {
                $('form[name="manageAccountForm"] input[name="postal_country_name"]').val(userSettings.countryName.value);
            }

            // Configure localityName
            if ( defaultBehavior == true || creationModeSettings.postalAddress == undefined || creationModeSettings.postalAddress.mandatory != true ) {
                $('#manageAccountForm_personal_settings_postal_locality_name_state').css("visibility", "hidden");
            }
            if ( userSettings.localityName != undefined && userSettings.localityName.value != undefined ) {
                $('form[name="manageAccountForm"] input[name="postal_locality_name"]').val(userSettings.localityName.value);
            }

            // Configure postalCode
            if ( defaultBehavior == true || creationModeSettings.postalAddress == undefined || creationModeSettings.postalAddress.mandatory != true ) {
                $('#manageAccountForm_personal_settings_postal_code_state').css("visibility", "hidden");
            }
            if ( userSettings.postalCode != undefined && userSettings.postalCode.value != undefined ) {
                $('form[name="manageAccountForm"] input[name="postal_code"]').val(userSettings.postalCode.value);
            }

            // Configure postalAddress
            if ( defaultBehavior == true || creationModeSettings.postalAddress == undefined || creationModeSettings.postalAddress.mandatory != true ) {
                $('#manageAccountForm_personal_settings_postal_address_state').css("visibility", "hidden");
            }
            if ( userSettings.postalAddress != undefined && userSettings.postalAddress.value != undefined ) {
                $('form[name="manageAccountForm"] input[name="postal_address"]').val(userSettings.postalAddress.value);
            }

            // Configure stateOrProvinceName
            if ( userSettings.stateOrProvinceName != undefined && userSettings.stateOrProvinceName.value != undefined ) {
                $('form[name="manageAccountForm"] input[name="postal_state_or_province_name"]').val(userSettings.stateOrProvinceName.value);
            }

            // Configure postOfficeBox
            if ( userSettings.postOfficeBox != undefined && userSettings.postOfficeBox.value != undefined ) {
                $('form[name="manageAccountForm"] input[name="postal_postoffice_box"]').val(userSettings.postOfficeBox.value);
            }
        }
        else {
            $('#manageAccountForm_personal_settings_postal_address_block').hide();
        }

        // Configure personal fields
        var userCustomFields = new Array();
        if ( userSettings.customFields != undefined ) {
            $.each(userSettings.customFields, function ( index, params ){
                userCustomFields[params.fieldid] = params.value;
            });
        }
        for ( var itt = 1; itt <= 3; itt++ ) {
            if ( defaultBehavior == false && ((creationModeSettings['personalField_' + itt] != undefined && creationModeSettings['personalField_' + itt].display == true)
                || (userCustomFields.length > 0 && userCustomFields[itt] != undefined && userCustomFields[itt] != "")) ) {
                if ( creationModeSettings['personalField_' + itt] == undefined || creationModeSettings['personalField_' + itt].mandatory != true ) {
                    $('#manageAccountForm_personal_settings_personal_field_' + itt + '_state').css("visibility", "hidden");
                }
                manageAccountForm_personal_settings_customFields_configure(displayLang);

                if ( userCustomFields[itt] != undefined ) {
                    $('form[name="manageAccountForm"] input[name="personal_field_' + itt + '"]').val(userCustomFields[itt]);
                }
            }
            else {
                $('#manageAccountForm_personal_settings_personal_field_' + itt + '_block').hide();
            }
        }

        // Configure OptIn
        if ( userSettings.privatePolicy != undefined && userSettings.privatePolicy.value != undefined ) {
            $('#manageAccountForm_privatePolicy_block').show();
            $('form[name="manageAccountForm"] input[name="manageAccountForm_privatePolicy_accept"]').attr("checked", (String(userSettings.privatePolicy.value) == "true"));
        }
        else {
            $('#manageAccountForm_privatePolicy_block').hide();
        }

    }
}

function manageAccountForm_personal_settings_empty(){
    $('#manageAccountForm_personal_settings_block input[type="text"]').val('');
    $('#manageAccountForm_personal_settings_block span[id^="manageAccountForm_personal_settings_personal_field_"][id$="_text"]').text("");

    manageAccountForm_personal_settings_phoneHelpBlock_configure();
    manageAccountForm_personal_settings_changed['prefix'] = false;
    manageAccountForm_personal_settings_changed['phone'] = false;
}

/** Manage the modification of inputs and the help texts present on them
 * @param string type - The type on the event (focus | blur )
 * @param element element - The DOM element afected by the modification
 */
function manageAccountForm_personal_settings_modifyEvent( type, element ){
    switch ( type ) {
        case 'focus':
            if ( manageAccountForm_personal_settings_changed[element.attr("name")] != true ) {
                element.val("");
            }
            break;

        case 'blur':
            if ( element.val() == "" ) {
                element.val(getInputTranslation(element.attr("id")));
                manageAccountForm_personal_settings_changed[element.attr("name")] = false;
            }
            else {
                manageAccountForm_personal_settings_changed[element.attr("name")] = true;
            }
            break;
    }
}

/** Display manageAccountForm_phone_help_block when help link is clicked
 * @param boolean state - Indicate if the block must be displayed or not
 */
function manageAccountForm_personal_settings_phoneHelpBlock_display( state ){

    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }
    else if ( $('#manageAccountForm_personal_settings_phone_help_block').is(':hidden') == true ) {
        display = true;
    }
    // Do not display phone help if the icon is hidden
    if ( $('#manageAccountForm_personal_settings_phone_help_link').is(':hidden') == true ) {
        display = false;
    }

    if ( display == true ) {
        $('#manageAccountForm_personal_settings_phone_help_block').show();
    }
    else {
        $('#manageAccountForm_personal_settings_phone_help_block').hide();
    }
}

/** Configure manageAccountForm_phone_block
 * @param string displayLang - The language whish to display the content
 */
function manageAccountForm_personal_settings_phoneHelpBlock_configure( displayLang ){
    if ( manageAccountForm_personal_settings_changed['prefix'] != true ) {
        $('#manageAccountForm_personal_settings_phone_prefix_value').val(getInputTranslation("manageAccountForm_personal_settings_phone_prefix_value", displayLang));
    }
    if ( manageAccountForm_personal_settings_changed['phone'] != true ) {
        $('#manageAccountForm_personal_settings_phone_phone_value').val(getInputTranslation("manageAccountForm_personal_settings_phone_phone_value", displayLang));
    }
    $('#manageAccountForm_personal_settings_phone_help_prefix_example_value').val(getInputTranslation("manageAccountForm_personal_settings_phone_help_prefix_example_value", displayLang));
    $('#manageAccountForm_personal_settings_phone_help_phone_example_value').val(getInputTranslation("manageAccountForm_personal_settings_phone_help_phone_example_value", displayLang));
}

function manageAccountForm_personal_settings_customFields_configure( displayLang ){

    var field_names = new Array("personalField_1", "personalField_2", "personalField_3");
    var itt = 1;
    var creationModeSettings = undefined;
    var userSettings = $.settings.user;

    if ( $.settings.user.creationMode != undefined ) {
        var creationModeRegExp = new RegExp("^portal-([a-zA-Z_-]+)$");
        var creationModeMatches = creationModeRegExp.exec($.settings.user.creationMode.value);
        if ( creationModeMatches != undefined ) {
            var creationMode = creationModeMatches[1];
            creationModeSettings = $.settings.subscribe[creationMode];
        }
    }

    var userCustomFields = new Array();
    if ( userSettings.customFields != undefined ) {
        $.each(userSettings.customFields, function ( index, params ){
            userCustomFields[params.fieldid] = params;
        });
    }

    if ( creationModeSettings != undefined ) {
        for ( key in field_names ) {
            var field_name = field_names[key];
            var labels = undefined;
            if ( creationModeSettings[field_name] != undefined ) {
                labels = creationModeSettings[field_name].labels;
            }
            else if ( userCustomFields[itt] != undefined ) {
                labels = userCustomFields[itt].label;
            }
            if ( labels != undefined ) {
                if ( labels[displayLang] != undefined ) {
                    $("#manageAccountForm_personal_settings_personal_field_" + itt + "_text").html(labels[displayLang]);
                }
                else if ( labels[$.settings.lang.defaultLang] != undefined ) {
                    $("#manageAccountForm_personal_settings_personal_field_" + itt + "_text").html(labels[$.settings.lang.defaultLang]);
                }
                else {
                    $("#manageAccountForm_personal_settings_personal_field_" + itt + "_text").html(labels[$.settings.lang.customFieldsDefaultLang]);
                }
            }
            itt++;
        }
    }
}


function manageAccountForm_devices_fillIn(){
    $('#manageAccountForm_devices_no_device_block').show();
    if ( $.settings.user != undefined && $.settings.user.devices != undefined && $.settings.user.manageDevices == true ) {
        var userDevices = $.settings.user.devices;
        if ( userDevices.length != 0 ) {
            $('#manageAccountForm_devices_no_device_block').hide();
            $.each(userDevices, function ( deviceIndex, deviceValues ){
                if ( deviceValues.address != undefined ) {
                    var clone = $('#manageAccountForm_devices_base_block').clone().show();
                    $(clone).attr("id", $(clone).attr("id").replace("_base", "_" + deviceIndex));
                    $(clone).find('span').each(function (){
                        $(this).attr("id", $(this).attr("id").replace("_base", "_" + deviceIndex));
                        $(this).text(deviceValues.address);
                    });
                    $(clone).find('input').each(function (){
                        $(this).attr("name", $(this).attr("name").replace("_base", "_" + deviceIndex));
                        $(this).val(deviceValues.comment);
                        if ( deviceValues.locked == true ) {
                            $(this).attr('disabled', 'disabled');
                        }
                    });
                    if ( deviceValues.current == true ) {
                        $(clone).addClass('currentDevice');
                    }
                    if ( deviceValues.locked == true ) {
                        $(clone).find('div.trashButton').remove();
                    }
                    $(clone).insertBefore($('#manageAccountForm_devices_base_block'));
                }
            });
        }
    }
}

function manageAccountForm_devices_empty(){
    $('#manageAccountForm_devices_no_device_block').show();
    $('#manageAccountForm_devices_block tr[id^="manageAccountForm_devices_"][id$="_block"][id!="manageAccountForm_devices_base_block"][id!="manageAccountForm_devices_no_device_block"]').remove();
}

function manageAccountForm_devices_delete(){
    $(this).parents('tr[id^="manageAccountForm_devices_"][id$="_block"]').remove();
}

/** Enable waiting mode on manageAccountForm
 */
function manageAccountFormWaiting( state ){
    switch ( state ) {
        case true:
            $('form[name="manageAccountForm"] button').attr("disabled", true);
            $('body').toggleClass("cursor-wait");
            break;
        case false:
            $('form[name="manageAccountForm"] button').attr("disabled", false);
            $('body').toggleClass("cursor-wait");
            break;
    }
}

/** Executed when manageAccountForm_personal_settings_update_button button is clicked
 */
function manageAccountForm_personal_settings_update(){

    var params = new Object();
    params.lastName = $('form[name="manageAccountForm"] input[name="last_name"]').val();
    params.firstName = $('form[name="manageAccountForm"] input[name="first_name"]').val();
    params.emailAddress = $('form[name="manageAccountForm"] input[name="email"]').val();

    params.organizationalUnitName = $('form[name="manageAccountForm"] input[name="organizational_unit_name"]').val();

    params.postalAddress = $('form[name="manageAccountForm"] input[name="postal_address"]').val();
    params.postalCode = $('form[name="manageAccountForm"] input[name="postal_code"]').val();
    params.postalLocalityName = $('form[name="manageAccountForm"] input[name="postal_locality_name"]').val();
    params.postalPostofficeBox = $('form[name="manageAccountForm"] input[name="postal_postoffice_box"]').val();
    params.postalStateOrProvinceName = $('form[name="manageAccountForm"] input[name="postal_state_or_province_name"]').val();
    params.postalCountryName = $('form[name="manageAccountForm"] input[name="postal_country_name"]').val();

    params.prefix = (manageAccountForm_personal_settings_changed['prefix'] == true) ? $('form[name="manageAccountForm"] input[name="prefix"]').val() : "";
    params.phone = (manageAccountForm_personal_settings_changed['phone'] == true) ? $('form[name="manageAccountForm"] input[name="phone"]').val() : "";

    // Custom fields
    params.personalField_1 = $('form[name="manageAccountForm"] input[name="personal_field_1"]').val();
    params.personalField_2 = $('form[name="manageAccountForm"] input[name="personal_field_2"]').val();
    params.personalField_3 = $('form[name="manageAccountForm"] input[name="personal_field_3"]').val();

    if ( ($.settings.user != undefined) && ($.settings.user.securePwd != undefined) ) {
        params.securePwd = $.settings.user.securePwd.value;
    }

    params.privatePolicyAccept = $('#manageAccountForm_privatePolicy_accept').is(':checked');

    var callbacks = new Object();
    callbacks.beforeSend = function (){
        manageAccountFormWaiting(true);
    };
    callbacks.success = function (){
        manageAccountForm_personal_settings_updateCallback();
    };
    callbacks.complete = function (){
        manageAccountFormWaiting(false);
    };

    updatePersonalSettings(callbacks, params);
}

/** Executed on return of manageAccountForm_personal_settings_update function
 */
function manageAccountForm_personal_settings_updateCallback(){

    displayErrorInfo();
    if ( $.settings.error == undefined ) {
        manageAccountForm_display(true);
    }
}

function manageAccountForm_devices_update(){
    var params = new Object();

    $('form[name="manageAccountForm"] input[name^="device_"]').each(function (){
        params[$(this).attr("name")] = $(this).val();
    });

    if ( ($.settings.user != undefined) && ($.settings.user.securePwd != undefined) ) {
        params.securePwd = $.settings.user.securePwd.value;
    }

    var callbacks = new Object();
    callbacks.beforeSend = function (){
        manageAccountFormWaiting(true);
    };
    callbacks.success = function (){
        manageAccountForm_personal_settings_updateCallback();
    };
    callbacks.complete = function (){
        manageAccountFormWaiting(false);
    };

    updateDevicesSettings(callbacks, params);
}

/** Executed on return of manageAccountForm_devices_update function
 */
function manageAccountForm_personal_settings_updateCallback(){

    displayErrorInfo();
    if ( $.settings.error == undefined ) {
        manageAccountForm_display(true);
    }
}


/*****************************************************************************/
/****          Modify package Form JavaScript functions                   ****/
/*****************************************************************************/


/** Enable waiting mode
 */
function modifyPackageForm_cancel_button_show_hide( state ){
    switch ( state ) {
        case true:
            $('form[name="modifyPackageForm"] button').hide();
            $('body').toggleClass("cursor-wait");
            break;
        case false:
            $('form[name="modifyPackageForm"] button').show();
            $('body').toggleClass("cursor-wait");
            break;
    }
}


function modifyPackageForm_package_update(){
    var params = new Object();


    if ( ($.settings.user != undefined) && ($.settings.user.securePwd != undefined) ) {
        params.securePwd = $.settings.user.securePwd.value;
    }

    var callbacks = new Object();
    callbacks.beforeSend = function (){
        modifyPackageForm_cancel_button_show_hide(true);
    };
    callbacks.success = function (){
        modifyPackageFormCallback();
    };
    callbacks.complete = function (){
        modifyPackageForm_cancel_button_show_hide(false);
    };

    $.settings.step = "PAYMENT";
    $.settings.type = "PMS";
    switch_package = true;
    pmsPaymentForm_display(true);
    manageAccountForm_display(false);

}

/** Executed on return of modifyPackageForm function
 */
function modifyPackageFormCallback(){
    switch_package = false;
    displayErrorInfo();
    if ( $.settings.error == undefined ) {
        modifyPackageForm_display(true);
    }
}


/*****************************************************************************/
/****           Account refill Form JavaScript functions                  ****/
/*****************************************************************************/

/** Listen to modified element
 */
var accountRefillForm_changed = new Object();

/** This function is triggered when the page is loaded
 */
$(document).ready(function() {

	/** Inputs triggers
	 */
	$('form[name="accountRefillForm"] select[name="select_package"]').change(function() {
		accountRefillForm_options_describe();
		accountRefillFormPay();
	});
	$('form[name="accountRefillForm"] select[name="select_package"]').keyup(function() {
		accountRefillForm_options_describe();
		accountRefillFormPay();
	});

	/** Form triggers
	 */
	$('form[name="accountRefillForm"]').submit(function() {
		return false;
	});

	/** Link triggers
	 */
	$('#logonForm_accountRefillLink_link').click(function() {
		accountRefillForm_options_configure();
		accountRefillForm_display(true);
		logonForm_display(false);
	});

	$('#paypalRefillLink').click(function() {
		accountRefillPaymentSubscribe('paypal');
	});

	$('#ogoneRefillLink').click(function() {
		accountRefillPaymentSubscribe('ogone');
	});

	/** Buttons triggers
	 */
	$('#accountRefillForm_back_button').click(function() {
		if ( $.settings.user != undefined && $.settings.user.login != undefined ) {
			manageAccountForm_display(true);
		}
		else {
			logonForm_display(true);
		}
		accountRefillForm_display(false);
		resetPaymentProcess();
	});

	$('#accountRefillForm_pay_button').click(function() {
		accountRefillFormPay();
	});

	$('#accountRefillForm_confirm_button').click(function() {
		if ($.settings.payment != undefined && $.settings.payment.type != undefined && $.settings.payment.type != 'free') {
			// Payed option
			accountRefillForm_confirm();
		}
		else {
			// Free option 2 possibilities
			if ($('form[name="accountRefillForm"] select[name="select_package"]').val() == "") {
				// manual written of code in dedicated field
				accountRefillForm_confirm();
			}
			else {
				// Automatic refill with the selected option in portal
				accountRefillForm_get_free_refill_code();
			}
		}
	});
});


function resetPaymentProcess() {

	var callbacks = new Object();
	callbacks.beforeSend = function() { accountRefillFormWaiting(true); };
	callbacks.success    = function() { accountRefillFormResetPayment_confirmCallback(this); };
	callbacks.complete   = function() { accountRefillFormWaiting(false); };

	backAction(callbacks);
}

function accountRefillFormResetPayment_confirmCallback() {
	displayErrorInfo();
}

function accountRefillForm_paymentValidate() {

	// Configure display
	if ($.settings.payment != undefined && $.settings.payment.login != undefined && $.settings.payment.code != undefined) {

		$('form[name="accountRefillForm"] input[name="login"]').val($.settings.payment.login);
		$('form[name="accountRefillForm"] input[name="refillcode"]').val($.settings.payment.code);
		if ($.settings.accountRefill == true) {
			$('form[name="accountRefillForm"]').show();
			$('#accountRefillForm_confirm_button').show();
			$('#accountRefillForm_table').hide();
			$('#accountRefillForm_explain').hide();
		}
	}
}

/** Configure accountRefillForm depending on settings
 */

function accountRefillForm_configure() {

	// Configure display
	if ($.settings.accountRefill == true) {
		$('#logonForm_accountRefillLink').show();
		accountRefillForm_options_configure();
	}
	else {
		$('form[name="accountRefillForm"]').remove();
	}
}

function accountRefillForm_options_configure(displayLang) {

	if ($.settings.refill_process != undefined && $.settings.refill_process.options != undefined) {
		var optionsInfos = null;
		var defaultOptionText;

		if ($.settings.refill_process.options.refill != undefined) {
			var optionsInfos = $.settings.refill_process.options.refill;
			defaultOptionText = getTextTranslation('paypalOptionPaymentForm_default_package_option');
			$('#accountRefillForm_select_option_text').text(getTextTranslation('accountRefillForm_select_option_text'));
			$('#accountRefillForm_title_text').text(getTextTranslation('accountRefillForm_title_text'));
			$('#accountRefillForm_explain_text').text(getTextTranslation('accountRefillForm_explain_text'));
			$('#accountRefillForm_option_description_explain').text(getTextTranslation('accountRefillForm_option_description_explain'));
			$('#accountRefillForm_option_description_text').text(getTextTranslation('accountRefillForm_option_description_text'));
		}
		else {
			return;
		}

		if (displayLang == undefined) { // No displayLang given, find user selected language, else default portal language else default package language
			if ($.settings != undefined && $.settings.user != undefined && $.settings.user.lang != undefined) {
				displayLang = $.settings.user.lang;
			}
		}

		// Empty the select list
		$('form[name="accountRefillForm"] select[name="select_package"]').empty();
		$('form[name="accountRefillForm"] select[name="select_package"]').append('<option id="accountRefillForm_default_option" selected value="">' + defaultOptionText + '</option>');
		// Populate list
		$(optionsInfos).each(function () {
			var package = $(this)[0];
			var text;
			var currencyLanguage;
			if (package[displayLang] != undefined) {
				text = package[displayLang].text;
				currencyLanguage = displayLang;
			}
			else if ($.settings != undefined && $.settings.lang != undefined && $.settings.lang.defaultLang != undefined && package[$.settings.lang.defaultLang] != undefined) {
				text = package[$.settings.lang.defaultLang].text;
				currencyLanguage = $.settings.lang.defaultLang;
			}
			else if (package[package.defaultLang] != undefined) {
				text = package[package.defaultLang].text;
				currencyLanguage = package.defaultLang;
			}
			else {
				text = "";
				currencyLanguage = package.defaultLang;
			}

			// Add price
			if (package['currency'] == "free") {
				text += "&nbsp;" + "(" + getGenericTranslation('free_package', currencyLanguage) + ")";
			}
			else {
				text += "&nbsp;" + "(" + package['price'] + "&nbsp;" + package['currency'] + ")";
			}

			var disabled = ' ';

			$('form[name="accountRefillForm"] select[name="select_package"]').append('<option value="' + package.name + '"' + disabled + '>' + text + '</option>');
		});
	}
}

/** Display accountRefillForm depending on settings
 * Can be overwritten by state
 * @param boolean state - Indicate if the form must be displayed or not
 */
function accountRefillForm_display(state) {

	var display = false;
	if ( (state == true) || (state == false) ) {
		display = state;
	}

	if (display == true) {
		// Fill in logon fields
		if ( $.settings.user != undefined && $.settings.user.login != undefined ) {
			$('form[name="accountRefillForm"] input[name="login"]').val($.settings.user.login.value);
		}

		$('form[name="accountRefillForm"]').show();
		$('#accountRefillForm_table').show();
		if ($.settings.refill_process != undefined && $.settings.refill_process.options != undefined && $.settings.refill_process.options.refill != undefined) {
			$('#accountRefillForm_option_user_explain').show();
			$('#accountRefillForm_table').show();
		}
		else {
			$('#accountRefillForm_option_user_explain').hide();
			$('#accountRefillForm_table').hide();
		}
	}
	else {
		$('form[name="accountRefillForm"]').hide();
		$('#paypalRefillLink').hide();
		$('#ogoneRefillLink').hide();
	}
}

function accountRefillPaymentSubscribe(type) {
	var params = new Object();

	params.login    = $('form[name = "accountRefillForm"] input[name = "login"]').val();
	params.type     = type;
	params.password = $('form[name = "accountRefillForm"] input[name = "password"]').val();
	params.package  = $('form[name = "accountRefillForm"] select[name = "select_package"]').val();

	var callbacks = new Object();
	callbacks.beforeSend = function() { accountRefillFormWaiting(true); };
	callbacks.success    = function() { accountRefillFormPaymentSubscribe_confirmCallback(this); };
	callbacks.complete   = function() { accountRefillFormWaiting(false); };

	refillAccountPaymentSubscribe(callbacks, params);
}

function accountRefillForm_confirm() {
	var params = new Object();

	params.login      = $('form[name = "accountRefillForm"] input[name = "login"]').val();
	params.refillCode = $('form[name = "accountRefillForm"] input[name = "refillcode"]').val();
	params.password   = $('form[name = "accountRefillForm"] input[name = "password"]').val();

	if ($.settings.payment && $.settings.payment.process) {
		params.process = $.settings.payment.process;

		// Particular case of free refill, code value is retrieved in settings parameters.
		if ($.settings.payment.process == "refill" && $.settings.payment.type == "free") {
			params.refillCode = $.settings.payment.code;
		}

		params.type = $.settings.payment.type;
	}
	//Re-init settings to get up to date infos, caused by $.extend use, merging returned ajax data
	clearUserSettings();

	// Re-init payment settings to be able to restart from a virgin  state
	clearPaymentSettings();

	var callbacks = new Object();
	callbacks.beforeSend = function() { accountRefillFormWaiting(true); };
	callbacks.success    = function() { accountRefillForm_confirmCallback(); };
	callbacks.complete   = function() { accountRefillFormWaiting(false); };

	refillAccount(callbacks, params);
}

function accountRefillForm_get_free_refill_code() {
	var params = new Object();

	params.login    = $('form[name = "accountRefillForm"] input[name  = "login"]').val();
	params.package  = $('form[name = "accountRefillForm"] select[name = "select_package"]').val();
	params.password = $('form[name = "accountRefillForm"] input[name  = "password"]').val();

	var callbacks = new Object();
	callbacks.beforeSend = function() { accountRefillFormWaiting(true); };
	callbacks.success    = function() { accountRefillForm_confirm(); };
	callbacks.complete   = function() { accountRefillFormWaiting(false); };

	getFreeRefillCode(callbacks, params);
}

function accountRefillFormPaymentSubscribe_confirmCallback() {

	if ($.settings.error == undefined) {
		if ( $.settings.user != undefined && $.settings.user.login != undefined ) {
			manageAccountForm_display(false);

			if ($.settings.type == 'PAYPAL') {
				paypalPaymentForm_options_describe();
				paypalPaymentForm_display(true);
			}
			else if ($.settings.type == 'OGONE') {
				ogonePaymentForm_options_describe();
				ogonePaymentForm_display(true);
			}
		}
		else {
			logonForm_display(true);
		}

		resetErrorInfo();

		accountRefillForm_display(false);
	}
	else {
		displayErrorInfo();
	}
}

/** Executed on return of accountRefillForm_update function
 */
function accountRefillForm_confirmCallback() {

	displayErrorInfo();
	if ($.settings.error == undefined) {
		if ( $.settings.user != undefined && $.settings.user.login != undefined ) {
			manageAccountForm_display(false);
			accountRefillForm_display(false);
			feedbackForm_display(true);
		}
		else {
			initPortal();
		}
	}
}

/** Enable waiting mode on accountRefillSetForm
 */
function accountRefillFormWaiting(state) {
	switch (state) {
		case true:
			$('form[name="accountRefillForm"] button').attr("disabled", true);
			$('body').toggleClass("cursor-wait");
			break;
		case false:
			$('form[name="accountRefillForm"] button').attr("disabled", false);
			$('body').toggleClass("cursor-wait");
			break;
	}
}

/** Executed when pay button is clicked
 */
function accountRefillFormPay() {

	var optionInfos = null;

	if ($.settings.refill_process != undefined && $.settings.refill_process.options != undefined) {

		if ($.settings.refill_process.options.refill != undefined) {
			for (var i = 0; i < $.settings.refill_process.options.refill.length; i++) {
				if ($.settings.refill_process.options.refill[i].name == $('form[name="accountRefillForm"] select[name="select_package"]').val()) {
					optionInfos = $.settings.refill_process.options.refill[i];
					break;
				}
			}

			if (optionInfos !== null && optionInfos.price != 0) {
				if ($.settings.subscribe.paypal && $.settings.subscribe.paypal.refill) {
					$('#paypalRefillLink').appendTo('#refillForm_subscriptionChoice_grid').show();
				}

				if ($.settings.subscribe.ogone && $.settings.subscribe.ogone.refill) {
					$('#ogoneRefillLink').appendTo('#refillForm_subscriptionChoice_grid').show();
				}

				$('#accountRefillForm_confirm_button').hide();
			}
			else {
				$('#paypalRefillLink').hide();
				$('#ogoneRefillLink').hide();

				$('#accountRefillForm_confirm_button').show();
			}
		}

		// accountRefillForm_free_refill_line must be always displayed to allow user to enter voucher manually
		// $('#accountRefillForm_free_refill_line').hide();
		$('#accountRefillForm_behavior_explain').show();
		$('form[name = "accountRefillForm"] input[name  = "refillcode"]').attr("disabled", !$('form[name="accountRefillForm"] select[name="select_package"] #accountRefillForm_default_option').is(":selected"));
	}
	else {
		// $('#accountRefillForm_free_refill_line').show();
		$('#accountRefillForm_behavior_explain').hide();
		$('form[name = "accountRefillForm"] input[name  = "refillcode"]').attr("disabled", false);
		$('#accountRefillForm_confirm_button').show();
	}
}

function accountRefillForm_options_describe(displayLang) {
	if ($.settings.refill_process != undefined && $.settings.refill_process.options != undefined) {

		var optionsInfos = null;
		if ($.settings.refill_process.options.refill != undefined) {
			var optionsInfos = $.settings.refill_process.options.refill;
		}
		else {
			return;
		}

		if (displayLang == undefined) { // No displayLang given, find user selected language, else default portal language else default package language
			if ($.settings != undefined && $.settings.user != undefined && $.settings.user.lang != undefined) {
				displayLang = $.settings.user.lang;
			}
		}
		// Update describe block
		if ($('form[name="accountRefillForm"] select[name="select_package"]').val() == "") {
			$('#accountRefillForm_option_description_explain').show();
			$('#accountRefillForm_option_description_value').html("");
		}
		else {
			$(optionsInfos).each(function () {
				var package = $(this)[0];
				if (package.name == $('form[name="accountRefillForm"] select[name="select_package"]').val()) {
					var describe;
					if (package[displayLang] != undefined) {
						describe = package[displayLang].description;
					}
					else if ($.settings != undefined && $.settings.lang != undefined && $.settings.lang.defaultLang != undefined && package[$.settings.lang.defaultLang] != undefined) {
						describe = package[$.settings.lang.defaultLang].description;
					}
					else if (package[package.defaultLang] != undefined) {
						describe = package[package.defaultLang].description;
					}

					if (describe == undefined) {
						describe = getTextTranslation('accountRefillForm_no_description');
					}

					$('#accountRefillForm_option_description_explain').hide();
					$('#accountRefillForm_option_description_value').html(describe);
				}
			});
		}
	}
}


/*****************************************************************************/
/****                    Auto Form JavaScript functions                   ****/
/*****************************************************************************/

/** This function is triggered when the page is loaded
 */
$(document).ready(function() {
	
	/** Buttons triggers
	 */
	$('#autoLogonForm_connect_button').click(function() {
		autoLogonFormConnect();
	});
	
	/** Form triggers
	 */
	$('form[name="autoLogonForm"]').submit(function() {
		return false;
	});
});

/**
 * Configure autoLogonForm depending on settings
 */
function autoLogonForm_configure() {

	// Configure display
	if ($.settings.subscribe != undefined && $.settings.subscribe.auto != undefined) {
	
		// Configure policy display
		if ($.settings.logon != undefined && $.settings.logon.policy != undefined && $.settings.logon.policy.display == true) {
			autoLogonForm_policy_configure();
		}
		else {
			// Modify event on securePwdForm 
			$('form[name="securePwdForm"]').unbind();
			$('form[name="securePwdForm"]').submit(function() {
				autoLogonWithSecurePasswordConnect(); return false;
			});
			
			$('#autoLogonForm_policy_block').remove();
		}
	}
	else {
		$('form[name="autoLogonForm"]').remove();
	}
}

/** Configure autoLogonForm_policy_block
 * @param string lang - The language whish to display the policy
 */
function autoLogonForm_policy_configure(lang) {
	
	if ($.settings.logon != undefined && $.settings.logon.policy != undefined) {
		var policy = extractPolicyText($.settings.logon, lang);
		$('#autoLogonForm_policy_text').html(policy);
	}
}

/** Display autoLogonForm depending on settings
 * Can be overwritten by state
 * @param boolean state - Indicate if the form must be displayed or not
 */
function autoLogonForm_display(state) {

	var display = false;
	if ( (state == true) || (state == false) ) {
		display = state;
	}
	else if ( ($.settings.step != undefined && $.settings.step == "SUBSCRIBE") && ($.settings.type != undefined && $.settings.type == "AUTO") ) {
		display = true;
	}
	
	if (display == true) {
		$('form[name="autoLogonForm"]').show();
	}
	else {
		$('form[name="autoLogonForm"]').hide();
	}
}

/** Enable waiting mode on autoLogonForm
 */
function autoLogonFormWaiting(state) {
	switch (state) {
		case true:
			$('#autoLogonForm_connect_button').attr("disabled", true);
			$('body').toggleClass("cursor-wait");
			break;
		case false:
			$('#autoLogonForm_connect_button').attr("disabled", false);
			$('body').toggleClass("cursor-wait");
			break;
	}
}

/** Executed when connect button is clicked
 */
function autoLogonFormConnect() {

	var params = new Object();
	params.policyAccept = $('form[name="autoLogonForm"] input[name="policy_accept"]').is(':checked');
	
	if ( ($.settings.user != undefined) && ($.settings.user.securePwd != undefined) ) {
		params.securePwd = $.settings.user.securePwd.value;
	}
	
	var callbacks = new Object();
	callbacks.beforeSend = function() { autoLogonFormWaiting(true); };
	callbacks.success    = function() { autoLogonFormConnectCallback(); };
	callbacks.complete   = function() { autoLogonFormWaiting(false); };
		
	autoAuthenticate(callbacks, params);
}

/** Executed on return of autoLogonFormConnect function
 */
function autoLogonFormConnectCallback() {

	if ($.settings.error == undefined) {
		// Redirect user to forced web page or requested web page
		window.location = $.settings.info.subscribe.autoUrl;
	}
	else {
		displayErrorInfo();
		displayStep();
	}
}

/** Executed on click on securePwdForm_access_button when secure password is required and no policy
 * Is from copy of securePwdFormAccess function
 */
function autoLogonWithSecurePasswordConnect() {

	var params = new Object();
	// Mandatory parameters
	params.securePwd = $('form[name="securePwdForm"] input[name="secure_pwd"]').val();
	
	var callbacks = new Object();
	callbacks.beforeSend = function() { autoLogonFormWaiting(true); };
	callbacks.success    = function() { autoLogonWithSecurePasswordConnectCallback(); };
	callbacks.complete   = function() { autoLogonFormWaiting(false); };
	
	securePwd(callbacks, params);
}

/** Executed on return of autoLogonWithSecurePasswordConnect function
 * Is from copy of securePwdFormAccessCallback function
 */
function autoLogonWithSecurePasswordConnectCallback() {
	displayErrorInfo();
	if ($.settings.error == undefined) {
		if ($.settings.user == undefined) {
			$.settings.user = new Object();
		}
		if ($.settings.user.securePwd == undefined) {
			$.settings.user.securePwd = new Object();
		}
		$.settings.user.securePwd.value = $('form[name="securePwdForm"] input[name="secure_pwd"]').val();
		autoLogonFormConnect();
	}
}

/*****************************************************************************/
/****            One Subscription Form JavaScript functions            ****/
/*****************************************************************************/

/** This function is triggered when the page is loaded
 */
$(document).ready(function (){
    /** Buttons triggers
     */
    var other_choices = null;
    if ( $('#oneSubscriptionForm_other_choices_button').length == 1 ) {

        other_choices = $('#oneSubscriptionForm_other_choices_button');
    }
    else {
        other_choices = $('#oneSubscriptionForm_other_choices_link');
    }
    if ( other_choices != null ) {
        other_choices.click(function (){
            oneSubscriptionFormOtherChoices();
        });
    }

    $('#oneSubscriptionForm_connect_button').click(function (){
        oneSubscriptionFormConnect();
    });

    /** Form triggers
     */
    $('form[name="oneSubscriptionForm"]').submit(function (){
        return false;
    });

    /** Link triggers
     */
    $('#oneSubscriptionLink').click(function (){
        oneSubscriptionLinkEnable();
    });

    //NSPE
    /** Link triggers
     */
    $('#one_facebookLink').click(function (){
        socialNetworkConnectOne("facebook");
    });
    $('#one_googleLink').click(function (){
        socialNetworkConnectOne("google");
    });
    $('#one_linkedinLink').click(function (){
        socialNetworkConnectOne("linkedin");
    });
    $('#one_twitterLink').click(function (){
        socialNetworkConnectOne("twitter");
    });


    $('.custom_checkbox').click(function (){
        toggle_checkbox($(this).attr('id'));
    });
    $('.custom_checkbox_1').click(function (){
        toggle_text($(this).attr('id'));
    });
//\NSPE

});

/** Configure oneSubscriptionForm depending on settings
 */
function oneSubscriptionForm_configure(){

    // Configure display
    if ( $.settings.subscribe != undefined && $.settings.subscribe.one != undefined ) {
        // Moving link to right location
        if ( $('#logonForm_subscriptionChoice_grid').length == 1 ) {
            $('#oneSubscriptionLink').appendTo('#logonForm_subscriptionChoice_grid').show();
        }
        else {
            if ( $.settings.subscribe.count > 1 ) {
                $('#oneSubscriptionLink').appendTo('#subscriptionChoiceInsert').show();
            }
            else if ( $.settings.subscribe.count == 1 ) {
                $('#logonFormSubscriptionLink_link').click(function (){
                    oneSubscriptionLinkEnable();
                });
            }
        }

        if(Object.keys($.settings.subscribe.one).length > 1){
            $('#directSubscriptionForm_explain_text').show();
        }else{
            $('#directSubscriptionForm_explain_text').remove();
        }        

        // Configure connect policy
        if ( $.settings.logon != undefined && $.settings.logon.policy != undefined && $.settings.logon.policy.display == true ) {
            oneSubscriptionForm_connect_policy_configure();
        }
        else {
            $('#oneSubscriptionForm_connect_policy_block').remove();
        }

        // Configure other choices link
        //alert(Object.keys($.settings.auth_modes).length);
        //console.log($.settings.auth_modes.length);
        //console.log($.settings.auth_modes.standard);
        //if ($.settings.auth_modes == undefined || $.settings.auth_modes.standard == false) {

        subscriptionForm_configure('one');
    }
    else {
        $('form[name="oneSubscriptionForm"]').remove();
        $('#oneSubscriptionLink').remove();
    }

	//NSPE
	// Configure social networks
	if ( $.settings.auth_modes != undefined && $.settings.auth_modes.facebook ) {
		var clonefbLike = $('div#facebookLike').clone().attr("id", "onefacebookLike");
		clonefbLike.find("#facebookInput").attr("id","onefacebookInput");
		clonefbLike.find("#logonForm_facebook_like_text").attr("for","onefacebookInput");
		clonefbLike.find("#logonForm_facebook_like_text").attr("id","oneSubscriptionForm_facebook_like_text");
		clonefbLike.find("#logonForm_facebook_like_url").attr("id","oneSubscriptionForm_facebook_like_url");
		$('#oneSubscriptionForm_socialNetworkChoice_grid').append(clonefbLike);
		$('#oneSubscriptionForm_socialNetworkChoice_grid').show();
		$('#one_facebookLink').show();
		if ($.settings.logon != undefined && $.settings.logon.facebook != undefined && $.settings.logon.facebook.need_like) {
			$('div#onefacebookLike').show();
			if ($.settings.logon.facebook.url_like != undefined && $.settings.logon.facebook.url_like != '') {
				$('label#logonForm_facebook_like_url').text($.settings.logon.facebook.url_like);
			}
		}
		else{
			$('div#onefacebookLike').hide();
		}
	}
    if ( $.settings.auth_modes != undefined && $.settings.auth_modes.google ) {
        $('#oneSubscriptionForm_socialNetworkChoice_grid').show();
        $('#one_googleLink').show();
    }
    if ( $.settings.auth_modes != undefined && $.settings.auth_modes.linkedin ) {
        $('#oneSubscriptionForm_socialNetworkChoice_grid').show();
        $('#one_linkedinLink').show();
    }
	if ( $.settings.auth_modes != undefined && $.settings.auth_modes.twitter ) {
		var cloneTwiterFollow = $('div#twitterFollow').clone().attr("id", "onetwitterFollow");
		cloneTwiterFollow.find("#twitterInput").attr("id","onetwitterInput");
		cloneTwiterFollow.find("#logonForm_twitter_follow_text").attr("for","onetwitterInput");
		cloneTwiterFollow.find("#logonForm_twitter_follow_text").attr("id","oneSubscriptionForm_twitter_follow_text");
		cloneTwiterFollow.find("#logonForm_twitter_follow_auto_screen_name").attr("id","oneSubscriptionForm_twitter_follow_auto_screen_name");
		$('#oneSubscriptionForm_socialNetworkChoice_grid').append(cloneTwiterFollow);
		$('#oneSubscriptionForm_socialNetworkChoice_grid').show();
		$('#one_twitterLink').show();
		if ($.settings.logon != undefined && $.settings.logon.twitter != undefined && $.settings.logon.twitter.need_follow) {
			$('div#onetwitterFollow').show();
			if ($.settings.logon.twitter.name_follow != undefined && $.settings.logon.twitter.name_follow != '') {
				$('label#oneSubscriptionForm_twitter_follow_auto_screen_name').text('@' + $.settings.logon.twitter.name_follow);
			}
		}else{
			$('div#onetwitterFollow').hide();
		}
	}

    if($.settings.auth_modes != undefined ){
        var modes = Object.keys($.settings.auth_modes);
        if((modes.indexOf("standard") > -1 || modes.indexOf("shibboleth") > -1) && modes.length > 0){
            $('#oneSubscriptionForm_other_choices_block').show();
        }else{
            $('#oneSubscriptionForm_other_choices_block').remove();
        }
    }
//\NSPE
}

/** Configure oneSubscriptionForm_connect_policy_block
 * @param string displayLang - The language whish to display the policy
 */
function oneSubscriptionForm_connect_policy_configure( displayLang ){

    if ( $.settings.logon != undefined && $.settings.logon.policy != undefined ) {
        var policy = extractPolicyText($.settings.logon, displayLang);
        $('#oneSubscriptionForm_connect_policy_text').html(policy);
        $('#oneSubscriptionForm_policy_resume').html(extractPolicyResume($.settings.logon, displayLang));
    }
}

/** Display oneSubscriptionForm depending on settings
 * Can be overwritten by state
 * @param boolean state - Indicate if the form must be displayed or not
 */
function oneSubscriptionForm_display( state ){

    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }
    else if ( ($.settings.step != undefined && $.settings.step == "SUBSCRIBE" && $.settings.type == "ONE") && ( (typeof informativeWidget_configure != 'function') || ($.settings.informativeWidget == undefined) ) ) {
        display = true;
    }
    if ( display == true ) {
        subscriptionForm_commonFields_display('one');
        $('form[name="oneSubscriptionForm"]').show();
        if ($('#subscriptionForm_fields_state_block')[0].style.display === 'block') {
            $('#subscriptionForm_fields_state_block').css("display", "none");
            $('#subscriptionForm_div_state').css("display", "none");
            $('#oneSubscriptionForm_fields_state_block').css("display", "block");
        }
    }
    else {
        $('form[name="oneSubscriptionForm"]').hide();
        subscriptionForm_empty('one');
        if ($('#subscriptionForm_div_state')[0].style.display === 'none') {
            $('#subscriptionForm_fields_state_block').css("display", "block");
            $('#subscriptionForm_div_state').css("display", "block");
        }
    }
    subscriptionForm_phoneHelpBlock_display(false);
    subscriptionForm_passwordHelpBlock_display(false);
}

/** Executed when other choices link is clicked
 */
function oneSubscriptionFormOtherChoices(){
    var callbacks = new Object();
    // callbacks.beforeSend = function() {}; // TODO
    callbacks.success = function (){
        displayStep();
    };
    // callbacks.complete   = function() {}; // TODO
    backAction(callbacks);
}

/** Enable waiting mode on oneSubscriptionForm
 */
function oneSubscriptionFormWaiting( state ){
    switch ( state ) {
        case true:
            $('#oneSubscriptionForm_other_choices_button').attr("disabled", true);
            $('#oneSubscriptionForm_connect_button').attr("disabled", true);
            $('body').toggleClass("cursor-wait");
            break;
        case false:
            $('#oneSubscriptionForm_other_choices_button').attr("disabled", false);
            $('#oneSubscriptionForm_connect_button').attr("disabled", false);
            $('body').toggleClass("cursor-wait");
            break;
    }
}

/** Executed when connect button is clicked **/
function oneSubscriptionFormConnect(){
    var params = subscriptionFormSubscribe('one');
    // Connect policy
    params.connectPolicyAccept = $('form[name="oneSubscriptionForm"] input[name="oneSubscriptionForm_connect_policy_accept"]').is(':checked');
    var callbacks = new Object();
    callbacks.beforeSend = function (){
        oneSubscriptionFormWaiting(true);
    };
    callbacks.success = function (){
        oneSubscriptionFormConnectCallback();
    };
    callbacks.complete = function (){
        oneSubscriptionFormWaiting(false);
    };
    subscribe(callbacks, params);
}

/** Executed on return of oneSubscriptionFormConnect function **/
function oneSubscriptionFormConnectCallback(){

    if ( $.settings.error == undefined ) {
        // Remember form values before trying to connect, to avoid multiple creation of a same account
        $('form[name="logonForm"] input[name="login"]').val($.settings.info.subscribe.login);
        $('form[name="logonForm"] input[name="password"]').val($.settings.info.subscribe.password);
        $('form[name="logonForm"] input[name="logonForm_logon_policy_accept"]').attr('checked', $('form[name="oneSubscriptionForm"] input[name="oneSubscriptionForm_connect_policy_accept"]').is(':checked'));
        $('form[name="logonForm"] input[name="logonForm_logon_privatePolicy_accept"]').attr('checked', $('form[name="oneSubscriptionForm"] input[name="subscriptionForm_privatePolicy_accept"]').is(':checked'));
        logonFormConnect();
    }
    else {
        displayErrorInfo();
    }
}


/** Social networks **/
function socialNetworkConnectOne( type ){
	var params = new Object();

	params.type = type;

	if (type == 'twitter') {
		params.userFollow = $('form[name="oneSubscriptionForm"] input[name="twitter_follow"]').is(':checked');
	}

	if (type == 'facebook' ) {
		params.userLike = $('form[name="oneSubscriptionForm"] input[name="facebook_like"]').is(':checked');
	}

	if ( ($.settings.user != undefined) && ($.settings.user.securePwd != undefined) ) {
		params.securePwd = $.settings.user.securePwd.value;
	}

	var private_policy = null;
	var policy = null;

	try {
		private_policy = eval('$.settings.logon.' + type + '.policy');
	}
	catch(ex) {
		private_policy = null;
	}

	try {
		policy = eval('$.settings.logon.policy');
	} catch (ex) {
		policy = null;
	}

	// Show a dialog window if private policy need to be accepted
	if ((private_policy != null && private_policy.display == true) || (policy != null && policy.display == true)) {

		// Hide private policy connection button in case of mandatory private policy (Twitter and Facebook)
		if (private_policy != null && private_policy !== undefined && private_policy.mandatory == true) {
			if ($('#logonForm_socialNetwork_privatePolicy_accept').is(':checked') == false) {
				$('#logonForm_privatePolicy_connect_button').hide();
			}
			$('#logonForm_socialNetwork_privatePolicy_accept').change(function () {
				$('#logonForm_privatePolicy_connect_button').toggle($('#logonForm_socialNetwork_privatePolicy_accept').is(':checked'));
			});
		}

		$('#logonForm_privatePolicy_connect_button').click(function () {

			logonForm_close_privatePolicy_dialog("logonForm");

			params.privatePolicyAccept = $('#logonForm_socialNetwork_privatePolicy_accept').is(':checked');

			if (policy.display == true) {
                params.policyAccept = $("#logonForm_socialNetwork_policy_accept").is(':checked');
//                $('#logonForm_logon_policy_accept').attr('checked', $('#logonForm_socialNetwork_policy_accept').is(':checked'));
                if (!logonForm_policy_is_ok()) {
                    $.settings.error = {
                        "code": "error_logon_bad-policy-accept"
                    };
                    displayErrorInfo();
                    return;
                }
			}
			// Proceed to social network connexion
			do_socialNetworkConnect(params);
        });

        $('.main_mode_container').slideToggle('easing');
		$("#logonForm_privatePolicy_dialog").show();
	}
	else {
		// No private policy needed. Proceed to social network connexion
		// do_socialNetworkConnect declared in portal_logon.js
		do_socialNetworkConnect(params);
	}
}

/*****************************************************************************/

/** Executed when link is clicked
 */
function oneSubscriptionLinkEnable(){

    var callbacks = new Object();
    // callbacks.beforeSend = function() {}; // TODO
    callbacks.success = function (){
        displayStep();
    };
    // callbacks.complete   = function() {}; // TODO

    backAction(callbacks);
}

/*****************************************************************************/
/*****************************************************************************/
/****            Direct Subscription Form JavaScript functions            ****/
/*****************************************************************************/

/** This function is triggered when the page is loaded
 */
$(document).ready(function (){

    /** Buttons triggers
     */
    $('#directSubscriptionForm_back_button').click(function (){
        directSubscriptionFormBack();
    });

    $('#directSubscriptionForm_subscribe_button').click(function (){
        directSubscriptionFormSubscribe();
    });

    $('#directSubscriptionResultForm_back_button').click(function (){
        displayStep();
    });

    /** Form triggers
     */
    $('form[name="directSubscriptionForm"]').submit(function (){
        return false;
    });

    $('form[name="directSubscriptionResultForm"]').submit(function (){
        return false;
    });

    /** Link triggers
     */
    $('#directSubscriptionLink').click(function (){
        directSubscriptionLinkEnable();
    });
});

/** Configure subscriptionForm depending on settings
 */
function directSubscriptionForm_configure(){

    // Configure display
    if ( $.settings.subscribe != undefined && $.settings.subscribe.direct != undefined ) {
        // Moving link to right location
        if ( $('#logonForm_subscriptionChoice_grid').length == 1 ) {
            $('#directSubscriptionLink').appendTo('#logonForm_subscriptionChoice_grid').show();
        }
        else {
            if ( $.settings.subscribe.count > 1 ) {
                $('#directSubscriptionLink').appendTo('#subscriptionChoiceInsert').show();
            }
            else if ( $.settings.subscribe.count == 1 ) {
                $('#logonFormSubscriptionLink_link').click(function (){
                    directSubscriptionLinkEnable();
                });
            }
        }

        if(Object.keys($.settings.subscribe.direct).length > 1){
            $('#directSubscriptionForm_explain_text').show();
        }else{
            $('#directSubscriptionForm_explain_text').remove();
        }         

        subscriptionForm_configure('direct');
    }
    else {
        $('form[name="directSubscriptionForm"]').remove();
        $('#directSubscriptionLink').remove();
    }

    // Configure directSubscriptionResultForm
    directSubscriptionResultForm_configure();
}

/** Display subscriptionForm depending on settings
 * Can be overwritten by state
 * @param boolean state - Indicate if the form must be displayed or not
 */
function directSubscriptionForm_display( state ){

    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }
    if ( display == true ) {
        subscriptionForm_commonFields_display('direct');
        $('form[name="directSubscriptionForm"]').show();
        $('form[name="directSubscriptionResultForm"]').hide();
    }
    else {
        $('form[name="directSubscriptionForm"]').hide();
        $('form[name="directSubscriptionResultForm"]').hide();
        subscriptionForm_empty('direct');
    }
    subscriptionForm_phoneHelpBlock_display(false);
    subscriptionForm_passwordHelpBlock_display(false);
}

/** Executed when back button is clicked
 */
function directSubscriptionFormBack(){
    displayStep();
}

/** Enable waiting mode on subscriptionForm
 */
function directSubscriptionFormWaiting( state ){
    switch ( state ) {
        case true:
            $('#directSubscriptionForm_back_button').attr("disabled", true);
            $('#directSubscriptionForm_subscribe_button').attr("disabled", true);
            $('body').toggleClass("cursor-wait");
            break;
        case false:
            $('#directSubscriptionForm_back_button').attr("disabled", false);
            $('#directSubscriptionForm_subscribe_button').attr("disabled", false);
            $('body').toggleClass("cursor-wait");
            break;
    }
}

/** Executed when subscribe button is clicked
 */
function directSubscriptionFormSubscribe(){
    var params = subscriptionFormSubscribe('direct');
    var callbacks = new Object();
    callbacks.beforeSend = function (){
        directSubscriptionFormWaiting(true);
    };
    callbacks.success = function (){
        directSubscriptionFormSubscribeCallback();
    };
    callbacks.complete = function (){
        directSubscriptionFormWaiting(false);
    };
    subscribe(callbacks, params);
}

/** Executed on return of subscriptionFormSubscribe function
 */
function directSubscriptionFormSubscribeCallback(){
    displayErrorInfo();
    if ( $.settings.error == undefined ) {
        directSubscriptionResultForm_display(true);
    }
}

/** Configure directSubscriptionResultForm depending on settings
 */
function directSubscriptionResultForm_configure(){

    if ( $.settings.subscribe != undefined && $.settings.subscribe.direct != undefined ) {
        if ( $.settings.subscribe.direct.dpsk != undefined && $.settings.subscribe.direct.dpsk.available == true ) {
            if ( $.settings.subscribe.direct.dpsk.wlan == undefined || $.settings.subscribe.direct.dpsk.wlan.display != true ) {
                $('#directSubscriptionResultForm_dpsk_wlan_block').remove();
            }
            if ( $.settings.subscribe.direct.dpsk.passphrase == undefined || $.settings.subscribe.direct.dpsk.passphrase.display != true ) {
                $('#directSubscriptionResultForm_dpsk_passphrase_block').remove();
                $('#directSubscriptionResultForm_dpsk_explain_text').remove();
            }
            if ( $.settings.subscribe.direct.dpsk.downloadLink == undefined || $.settings.subscribe.direct.dpsk.downloadLink.display != true ) {
                $('#directSubscriptionResultForm_dpsk_download_link_block').remove();
                $('#directSubscriptionResultForm_dpsk_download_explain_text').remove();
            }
        }
        else {
            $('#directSubscriptionResultForm_dpsk_title_block').remove();
            $('#directSubscriptionResultForm_dpsk_explain_block').remove();
            $('#directSubscriptionResultForm_dpsk_wlan_block').remove();
            $('#directSubscriptionResultForm_dpsk_passphrase_block').remove();
            $('#directSubscriptionResultForm_dpsk_download_link_block').remove();
        }
    }
    else {
        $('form[name="directSubscriptionResultForm"]').remove();
    }
}

/** Display directSubscriptionResultForm (Usualy Triggered when subscribtion succeed)
 * @param boolean state - Indicate if the results must be displayed or not
 */
function directSubscriptionResultForm_display( state ){

    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }

    if ( $.settings.info != undefined && $.settings.info.subscribe != undefined ) {
        if ( $.settings.info.subscribe.login != undefined ) {
            $('#directSubscriptionResultForm_login_value').html($.settings.info.subscribe.login);
        }
        if ( $.settings.info.subscribe.password != undefined ) {
		var tmp_input_params = subscriptionFormSubscribe('direct');
		if ( $.settings.subscribe != undefined && $.settings.subscribe.direct != undefined
				&& $.settings.subscribe.direct.userPassword != undefined && $.settings.subscribe.direct.userPassword.display == true
				&& tmp_input_params.password != '' ) {
                // We hide the given password
                $('#directSubscriptionResultForm_password_value').html('********');
            }
            else {
                $('#directSubscriptionResultForm_password_value').html($.settings.info.subscribe.password);
            }
        }
        // Fill in logon fields
        if ( $.settings.subscribe.direct.hidePortalCredentials == undefined || $.settings.subscribe.direct.hidePortalCredentials == false ) {
            $('form[name="logonForm"] input[name="login"]').val($.settings.info.subscribe.login);
            $('form[name="logonForm"] input[name="password"]').val($.settings.info.subscribe.password);
        }

        if ( $.settings.info.subscribe.dpsk != undefined ) {
            $('#directSubscriptionResultForm_dpsk_wlan_value').html($.settings.info.subscribe.dpsk.wlan);
            if ( $.settings.info.subscribe.dpsk.passphrase != undefined ) {
                $('#directSubscriptionResultForm_dpsk_passphrase_value').html($.settings.info.subscribe.dpsk.passphrase);
            }
            if ( $.settings.info.subscribe.dpsk.downloadURL != undefined ) {
                $('#directSubscription_dpsk_download_link').attr("href", $.settings.info.subscribe.dpsk.downloadURL);
            }
        }
    }

    if ( $.settings.subscribe.direct.hidePortalCredentials == undefined || $.settings.subscribe.direct.hidePortalCredentials == false ) {
        if ( display == true ) {
            $('form[name="directSubscriptionResultForm"]').show();
            $('form[name="directSubscriptionForm"]').hide();
        }
        else {
            $('form[name="directSubscriptionForm"]').show();
            $('form[name="directSubscriptionResultForm"]').hide();
            directSubscriptionResultForm_empty();
        }
    } else {
        displayStep();
    }
}

/** Empty directSubscriptionResultForm
 */
function directSubscriptionResultForm_empty(){
    $('#directSubscriptionResultForm_login_value').html('');
    $('#directSubscriptionResultForm_password_value').html('');
    $('#directSubscriptionResultForm_dpsk_wlan_value').html('');
    $('#directSubscriptionResultForm_dpsk_passphrase_value').html('');
    $('#directSubscription_dpsk_download_link').attr("href", "#");
}
/*****************************************************************************/

/** Executed when link is clicked
 */
function directSubscriptionLinkEnable(){

    logonForm_display(false);
    logonFormSubscribeChoice_display(false);
    directSubscriptionForm_display(true);
}

/*****************************************************************************/
/*****************************************************************************/
/****            Print Subscription Form JavaScript functions            ****/
/*****************************************************************************/

/** This function is triggered when the page is loaded
 */
$(document).ready(function (){

    /** Buttons triggers
     */
    $('#printSubscriptionForm_back_button').click(function (){
        printSubscriptionFormBack();
    });

    $('#printSubscriptionForm_subscribe_button').click(function (){
        printSubscriptionFormSubscribe();
    });

    $('#printSubscriptionResultForm_back_button').click(function (){
        displayStep();
    });

    /** Form triggers
     */
    $('form[name="printSubscriptionForm"]').submit(function (){
        return false;
    });

    $('form[name="printSubscriptionResultForm"]').submit(function (){
        return false;
    });

    /** Link triggers
     */
    $('#printSubscriptionLink').click(function (){
        printSubscriptionLinkEnable();
    });
});

/** Configure printSubscriptionForm depending on settings
 */
function printSubscriptionForm_configure(){

    // Configure display
    if ( $.settings.subscribe != undefined && $.settings.subscribe.print != undefined ) {
        // Moving link to right location
        if ( $('#logonForm_subscriptionChoice_grid').length == 1 ) {
            $('#printSubscriptionLink').appendTo('#logonForm_subscriptionChoice_grid').show();
        }
        else {
            if ( $.settings.subscribe.count > 1 ) {
                $('#printSubscriptionLink').appendTo('#subscriptionChoiceInsert').show();
            }
            else if ( $.settings.subscribe.count == 1 ) {
                $('#logonFormSubscriptionLink_link').click(function (){
                    printSubscriptionLinkEnable();
                });
            }
        }
        subscriptionForm_configure('print');
    }
    else {
        $('form[name="printSubscriptionForm"]').remove();
        $('form[name="printSubscriptionResultForm"]').remove();
        $('#printSubscriptionLink').remove();
    }
}

/** Display printSubscriptionForm depending on settings
 * Can be overwritten by state
 * @param boolean state - Indicate if the form must be displayed or not
 */
function printSubscriptionForm_display( state ){

    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }
    if ( display == true ) {
        subscriptionForm_commonFields_display('print');
        $('form[name="printSubscriptionForm"]').show();
        $('form[name="printSubscriptionResultForm"]').hide();
    }
    else {
        $('form[name="printSubscriptionForm"]').hide();
        $('form[name="printSubscriptionResultForm"]').hide();
        subscriptionForm_empty('print');
    }
    subscriptionForm_phoneHelpBlock_display(false);
    subscriptionForm_passwordHelpBlock_display(false);
}

/** Executed when back button is clicked
 */
function printSubscriptionFormBack(){
    displayStep();
}

/** Enable waiting mode on printSubscriptionForm
 */
function printSubscriptionFormWaiting( state ){
    switch ( state ) {
        case true:
            $('#printSubscriptionForm_back_button').attr("disabled", true);
            $('#printSubscriptionForm_subscribe_button').attr("disabled", true);
            $('body').toggleClass("cursor-wait");
            break;
        case false:
            $('#printSubscriptionForm_back_button').attr("disabled", false);
            $('#printSubscriptionForm_subscribe_button').attr("disabled", false);
            $('body').toggleClass("cursor-wait");
            break;
    }
}

/** Executed when subscribe button is clicked
 */
function printSubscriptionFormSubscribe(){
    var params = subscriptionFormSubscribe('print');
    var callbacks = new Object();
    callbacks.beforeSend = function (){
        printSubscriptionFormWaiting(true);
    };
    callbacks.success = function (){
        printSubscriptionFormSubscribeCallback();
    };
    callbacks.complete = function (){
        printSubscriptionFormWaiting(false);
    };
    subscribe(callbacks, params);
}

/** Executed on return of printSubscriptionFormSubscribe function
 */
function printSubscriptionFormSubscribeCallback(){
    displayErrorInfo();
    if ( $.settings.error == undefined ) {
        printSubscriptionResultForm_display(true);
    }
}

/** Display printSubscriptionResultForm (Usualy Triggered when subscribtion succeed)
 * @param boolean state - Indicate if the results must be displayed or not
 */
function printSubscriptionResultForm_display( state ){

    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }

    if ( display == true ) {
        $('form[name="printSubscriptionResultForm"]').show();
        $('form[name="printSubscriptionForm"]').hide();
    }
    else {
        $('form[name="printSubscriptionForm"]').show();
        $('form[name="printSubscriptionResultForm"]').hide();
    }
}

/*****************************************************************************/

/** Executed when link is clicked
 */
function printSubscriptionLinkEnable(){

    logonForm_display(false);
    logonFormSubscribeChoice_display(false);
    printSubscriptionForm_display(true);

}

/*****************************************************************************/
/*****************************************************************************/
/****              SMS Subscription Form JavaScript functions             ****/
/*****************************************************************************/

/** This function is triggered when the page is loaded
 */
$(document).ready(function (){

    /** Buttons triggers
     */
    $('#smsSubscriptionForm_back_button').click(function (){
        smsSubscriptionFormBack();
    });

    $('#smsSubscriptionForm_subscribe_button').click(function (){
        smsSubscriptionFormSubscribe();
    });

    /** Form triggers
     */
    $('form[name="smsSubscriptionForm"]').submit(function (){
        return false;
    });

    /** Link triggers
     */
    $('#smsSubscriptionLink').click(function (){
        smsSubscriptionLinkEnable();
    });
});

/** Configure smsSubscriptionForm depending on settings
 */
function smsSubscriptionForm_configure(){

    // Configure display
    if ( $.settings.subscribe != undefined && $.settings.subscribe.sms != undefined ) {
        // Moving link to right location
        if ( $('#logonForm_subscriptionChoice_grid').length == 1 ) {
            $('#smsSubscriptionLink').appendTo('#logonForm_subscriptionChoice_grid').show();
        }
        else {
            if ( $.settings.subscribe.count > 1 ) {
                $('#smsSubscriptionLink').appendTo('#subscriptionChoiceInsert').show();
            }
            else if ( $.settings.subscribe.count == 1 ) {
                $('#logonFormSubscriptionLink_link').click(function (){
                    smsSubscriptionLinkEnable();
                });
            }
        }
        subscriptionForm_configure('sms');
    }
    else {
        $('form[name="smsSubscriptionForm"]').remove();
        $('#smsSubscriptionLink').remove();
    }
}

/** Display smsSubscriptionForm depending on settings
 * Can be overwritten by state
 * @param boolean state - Indicate if the form must be displayed or not
 */
function smsSubscriptionForm_display( state ){

    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }
    if ( display == true ) {
        subscriptionForm_commonFields_display('sms');
        $('form[name="smsSubscriptionForm"]').show();
    }
    else {
        $('form[name="smsSubscriptionForm"]').hide();
        subscriptionForm_empty('sms');
    }
    subscriptionForm_phoneHelpBlock_display(false);
}

/** Executed when back button is clicked
 */
function smsSubscriptionFormBack(){
    displayStep();
}

/** Enable waiting mode on smsSubscriptionForm
 */
function smsSubscriptionFormWaiting( state ){
    switch ( state ) {
        case true:
            $('#smsSubscriptionForm_back_button').attr("disabled", true);
            $('#smsSubscriptionForm_subscribe_button').attr("disabled", true);
            $('body').toggleClass("cursor-wait");
            break;
        case false:
            $('#smsSubscriptionForm_back_button').attr("disabled", false);
            $('#smsSubscriptionForm_subscribe_button').attr("disabled", false);
            $('body').toggleClass("cursor-wait");
            break;
    }
}

/** Executed when subscribe button is clicked
 */
function smsSubscriptionFormSubscribe(){
    var params = subscriptionFormSubscribe('sms');
    var callbacks = new Object();
    callbacks.beforeSend = function (){
        smsSubscriptionFormWaiting(true);
    };
    callbacks.success = function (){
        smsSubscriptionFormSubscribeCallback();
    };
    callbacks.complete = function (){
        smsSubscriptionFormWaiting(false);
    };
    subscribe(callbacks, params);
}

/** Executed on return of smsSubscriptionFormSubscribe function
 */
function smsSubscriptionFormSubscribeCallback(){
    displayErrorInfo();
    if ( $.settings.error == undefined ) {
        displayStep();
    }
}

/*****************************************************************************/

/** Executed when link is clicked
 */
function smsSubscriptionLinkEnable(){

    logonForm_display(false);
    logonFormSubscribeChoice_display(false);
    smsSubscriptionForm_display(true);
}

/*****************************************************************************/

/*****************************************************************************/
/****              Mail Subscription Form JavaScript functions            ****/
/*****************************************************************************/

/** This function is triggered when the page is loaded
 */
$(document).ready(function (){

    /** Buttons triggers
     */
    $('#mailSubscriptionForm_back_button').click(function (){
        mailSubscriptionFormBack();
    });

    $('#mailSubscriptionForm_subscribe_button').click(function (){
        mailSubscriptionFormSubscribe();
    });

    /** Form triggers
     */
    $('form[name="mailSubscriptionForm"]').submit(function (){
        return false;
    });

    /** Link triggers
     */
    $('#mailSubscriptionLink').click(function (){
        mailSubscriptionLinkEnable();
    });
});


/** Configure mailSubscriptionForm depending on settings
 */
function mailSubscriptionForm_configure(){

    // Configure display
    if ( $.settings.subscribe != undefined && $.settings.subscribe.mail != undefined ) {
        // Moving link to right location
        if ( $('#logonForm_subscriptionChoice_grid').length == 1 ) {
            $('#mailSubscriptionLink').appendTo('#logonForm_subscriptionChoice_grid').show();
        }
        else {
            if ( $.settings.subscribe.count > 1 ) {
                $('#mailSubscriptionLink').appendTo('#subscriptionChoiceInsert').show();
            }
            else if ( $.settings.subscribe.count == 1 ) {
                $('#logonFormSubscriptionLink_link').click(function (){
                    mailSubscriptionLinkEnable();
                });
            }
        }

        // Configure autofill/autoconnect
        if ( $.settings.subscribe.mail.autofill != undefined ) {
            $('form[name="logonForm"] input[name="login"]').val($.settings.subscribe.mail.autofill.login);
            $('form[name="logonForm"] input[name="password"]').val($.settings.subscribe.mail.autofill.password);
        }

        subscriptionForm_configure('mail');
    }
    else {
        $('form[name="mailSubscriptionForm"]').remove();
        $('#mailSubscriptionLink').remove();
    }
}

/** Display mailSubscriptionForm depending on settings
 * Can be overwritten by state
 * @param boolean state - Indicate if the form must be displayed or not
 */
function mailSubscriptionForm_display( state ){

    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }
    if ( display == true ) {
        subscriptionForm_commonFields_display('mail');
        $('form[name="mailSubscriptionForm"]').show();
    }
    else {
        $('form[name="mailSubscriptionForm"]').hide();
        subscriptionForm_empty('mail');
    }
    subscriptionForm_phoneHelpBlock_display(false);
}

/** Executed when back button is clicked
 */
function mailSubscriptionFormBack(){
    displayStep();
}

/** Enable waiting mode on mailSubscriptionForm
 */
function mailSubscriptionFormWaiting( state ){
    switch ( state ) {
        case true:
            $('#mailSubscriptionForm_back_button').attr("disabled", true);
            $('#mailSubscriptionForm_subscribe_button').attr("disabled", true);
            $('body').toggleClass("cursor-wait");
            break;
        case false:
            $('#mailSubscriptionForm_back_button').attr("disabled", false);
            $('#mailSubscriptionForm_subscribe_button').attr("disabled", false);
            $('body').toggleClass("cursor-wait");
            break;
    }
}

/** Executed when subscribe button is clicked
 */
function mailSubscriptionFormSubscribe(){
    var params = subscriptionFormSubscribe('mail');
    var callbacks = new Object();
    callbacks.beforeSend = function (){
        mailSubscriptionFormWaiting(true);
    };
    callbacks.success = function (){
        mailSubscriptionFormSubscribeCallback();
    };
    callbacks.complete = function (){
        mailSubscriptionFormWaiting(false);
    };
    subscribe(callbacks, params);
}

/** Executed on return of mailSubscriptionFormSubscribe function
 */
function mailSubscriptionFormSubscribeCallback(){
    displayErrorInfo();
    if ( $.settings.error == undefined ) {
        displayStep();
    }
}

/*****************************************************************************/

/** Executed when link is clicked
 */
function mailSubscriptionLinkEnable(){

    logonForm_display(false);
    logonFormSubscribeChoice_display(false);
    mailSubscriptionForm_display(true);
}


/*****************************************************************************/
/****             Paypal Subscription Form JavaScript functions           ****/
/*****************************************************************************/

/** Listen to modified element
 */

var paypalSubscriptionResultForm_changed = new Object();

/** This function is triggered when the page is loaded
 */
$(document).ready(function() {

	/** Inputs triggers
	 */

	$('form[name="paypalSubscriptionResultForm"] input[name="send_sms"]').change(function() {
		paypalSubscriptionResultFormSend_display($(this).is(':checked'), "sms");
	});

	$('form[name="paypalSubscriptionResultForm"] input[name="send_mail"]').change(function() {
		paypalSubscriptionResultFormSend_display($(this).is(':checked'), "mail");
	});

	$('form[name="paypalSubscriptionResultForm"] input[name="email"]').focus(function() {
		paypalSubscriptionResultForm_modifyEvent('focus', $(this));
		paypalSubscriptionResultForm_phoneHelpBlock_display(false);
	});

	$('form[name="paypalSubscriptionResultForm"] input[name="email"]').blur(function() {
		paypalSubscriptionResultForm_modifyEvent('blur', $(this));
	});

	$('form[name="paypalSubscriptionResultForm"] input[name="email"]').change(function() {
		paypalSubscriptionResultForm_modifyEvent('blur', $(this));
	});

	$('form[name="paypalSubscriptionResultForm"] input[name="prefix"]').focus(function() {
		paypalSubscriptionResultForm_modifyEvent('focus', $(this));
		paypalSubscriptionResultForm_phoneHelpBlock_display(true);
	});

	$('form[name="paypalSubscriptionResultForm"] input[name="prefix"]').blur(function() {
		paypalSubscriptionResultForm_modifyEvent('blur', $(this));
	});

	$('form[name="paypalSubscriptionResultForm"] input[name="prefix"]').change(function() {
		paypalSubscriptionResultForm_modifyEvent('blur', $(this));
	});

	$('form[name="paypalSubscriptionResultForm"] input[name="phone"]').focus(function() {
		paypalSubscriptionResultForm_modifyEvent('focus', $(this));
		paypalSubscriptionResultForm_phoneHelpBlock_display(true);
	});

	$('form[name="paypalSubscriptionResultForm"] input[name="phone"]').blur(function() {
		paypalSubscriptionResultForm_modifyEvent('blur', $(this));
	});

	$('form[name="paypalSubscriptionResultForm"] input[name="phone"]').change(function() {
		paypalSubscriptionResultForm_modifyEvent('blur', $(this));
	});

	/** Buttons triggers
	 */
	$('#paypalSubscriptionForm_back_button').click(function() {
		paypalSubscriptionFormBack();
	});

	$('#paypalSubscriptionForm_subscribe_button').click(function() {
		paypalSubscriptionFormSubscribe();
	});

	$('#paypalSubscriptionResultForm_back_button').click(function() {
		displayStep();
	});

	$('#paypalSubscriptionResultForm_send_button').click(function() {
		paypalSubscriptionResultFormSendCredential();
	});

	/** Form triggers
	 */
	$('form[name="paypalSubscriptionForm"]').submit(function() {
		return false;
	});

	$('form[name="paypalSubscriptionResultForm"]').submit(function() {
		return false;
	});

	/** Link triggers
	 */
	$('#paypalSubscriptionLink').click(function() {
		paypalSubscriptionLinkEnable();
	});

	$('#paypalSubscriptionResultForm_send_sms_phone_help_link').click(function() {
		paypalSubscriptionResultForm_phoneHelpBlock_display();
	});
});

/** Configure paypalSubscriptionForm depending on settings
 */
function paypalSubscriptionForm_configure() {
	var showSendSms = true, showSendMail = true;
	// Configure display
	if ($.settings.subscribe != undefined && $.settings.subscribe.paypal != undefined) {

		if ($.settings.subscribe.paypal.option != undefined) {
			$('#paypalSubscriptionForm_explain_text').text(getTextTranslation('paypalOptionSubscriptionForm_explain_text'));
		}

		if (($.settings.subscribe.paypal.option != undefined) || ($.settings.subscribe.paypal.package != undefined)) {
		// Moving link to right location
			if($('#logonForm_subscriptionChoice_grid').length == 1) {
				$('#paypalSubscriptionLink').appendTo('#logonForm_subscriptionChoice_grid').show();
			}
			else {
				if ($.settings.subscribe.count > 1) {
					$('#paypalSubscriptionLink').appendTo('#subscriptionChoiceInsert').show();
				}
				else if ($.settings.subscribe.count == 1) {
					$('#logonFormSubscriptionLink_link').click(function() {
						paypalSubscriptionLinkEnable();
					});
				}
			}
		}

		// Configure paypalSubscriptionResultForm
		if ($.settings.subscribe.paypal.sendSms != undefined && $.settings.subscribe.paypal.sendSms.display == true) {
			$('#paypalSubscriptionResultForm_send_sms_block').show();
			$('#paypalSubscriptionResultForm_send_sms_phone_block').hide();
			// Configure help block
			paypalSubscriptionResultForm_phoneHelpBlock_configure();
		}
		else {
			$('#paypalSubscriptionResultForm_send_sms_block').remove();
			$('#paypalSubscriptionResultForm_send_sms_phone_block').remove();
			showSendSms = false;
		}

		if ($.settings.subscribe.paypal.sendMail != undefined && $.settings.subscribe.paypal.sendMail.display == true) {
			$('#paypalSubscriptionResultForm_send_mail_block').show();
			$('#paypalSubscriptionResultForm_send_email_address_block').hide();
		}
		else {
			$('#paypalSubscriptionResultForm_send_mail_block').remove();
			$('#paypalSubscriptionResultForm_send_email_address_block').remove();
			showSendMail = false;
		}

		if (showSendMail == false && showSendSms == false) {
			// Remove send button if Mail and Sms paypal subscription mode not activated
			$('#paypalSubscriptionResultForm_send_button').remove();
		}
		// autofill/autoconnect
		if ( $.settings.subscribe.paypal.autofill != undefined ) {
			$('form[name="logonForm"] input[name="login"]').val($.settings.subscribe.paypal.autofill.login);
			$('form[name="logonForm"] input[name="password"]').val($.settings.subscribe.paypal.autofill.password);
		}

		subscriptionForm_configure('paypal');
	}
	else {
		$('form[name="paypalSubscriptionForm"]').remove();
		$('form[name="paypalSubscriptionResultForm"]').remove();
		$('form[name="paypalRedirectForm"]').remove();
		$('#paypalSubscriptionLink').remove();
	}
}

/** Display paypalSubscriptionForm depending on settings
 * Can be overwritten by state
 * @param boolean state - Indicate if the form must be displayed or not
 */
function paypalSubscriptionForm_display(state) {

	var display = false;
	if ( (state == true) || (state == false) ) {
		display = state;
	}
	if (display == true) {
		subscriptionForm_commonFields_display('paypal');
		$('form[name="paypalSubscriptionForm"]').show();

		if ($.settings.subscribe.paypal.option != undefined) {
			$('#paypalSubscriptionForm_explain_text').text(getTextTranslation('paypalOptionSubscriptionForm_explain_text'));
		}
	}
	else {
		$('form[name="paypalSubscriptionForm"]').hide();
		subscriptionForm_empty('paypal');
	}

	$('form[name="paypalSubscriptionResultForm"]').hide();

	subscriptionForm_phoneHelpBlock_display(false);
	subscriptionForm_passwordHelpBlock_display(false);
}

/** Executed when back button is clicked
 */
function paypalSubscriptionFormBack() {
    displayStep();
}

/** Enable waiting mode on paypalSubscriptionForm
 */
function paypalSubscriptionFormWaiting(state) {
	switch (state) {
		case true:
			$('#paypalSubscriptionForm_back_button').attr("disabled", true);
			$('#paypalSubscriptionForm_subscribe_button').attr("disabled", true);
			$('body').toggleClass("cursor-wait");
			break;
		case false:
			$('#paypalSubscriptionForm_back_button').attr("disabled", false);
			$('#paypalSubscriptionForm_subscribe_button').attr("disabled", false);
			$('body').toggleClass("cursor-wait");
			break;
	}
}

/** Executed when subscribe button is clicked
 */
function paypalSubscriptionFormSubscribe() {
    var params = subscriptionFormSubscribe('paypal');
    var callbacks = new Object();
    callbacks.beforeSend = function() { paypalSubscriptionFormWaiting(true); };
    callbacks.success    = function() { paypalSubscriptionFormSubscribeCallback(); };
    callbacks.complete   = function() { paypalSubscriptionFormWaiting(false); };
    subscribe(callbacks, params);
}

/** Executed on return of paypalSubscriptionFormSubscribe function
 */
function paypalSubscriptionFormSubscribeCallback() {
    displayErrorInfo();
    if ($.settings.error == undefined) {
		paypalPaymentForm_packages_configure();
		paypalSubscriptionResultForm_display(true);
    }
}

/** Display paypalSubscriptionResultForm (Usualy Triggered when subscribtion succeed)
 * @param boolean state - Indicate if the results must be displayed or not
 */
function paypalSubscriptionResultForm_display(state) {

	var display = false;
	if ( (state == true) || (state == false) ) {
		display = state;
	}

	if ($.settings.info != undefined && $.settings.info.subscribe != undefined) {
		if ($.settings.info.subscribe.login != undefined) {
			$('#paypalSubscriptionResultForm_login_value').html($.settings.info.subscribe.login);
		}
		if ($.settings.info.subscribe.password != undefined) {
			var tmp_input_params = subscriptionFormSubscribe('paypal');
			if ($.settings.subscribe != undefined && $.settings.subscribe.paypal != undefined
					&& $.settings.subscribe.paypal.userPassword != undefined && $.settings.subscribe.paypal.userPassword.display == true
					&& tmp_input_params.password != '') {
				// We hide the given password
				$('#paypalSubscriptionResultForm_password_value').html('********');
			}
			else {
				$('#paypalSubscriptionResultForm_password_value').html($.settings.info.subscribe.password);
			}
		}
		$('form[name="paypalSubscriptionResultForm"] input[name="end_sms"]').attr("checked", false);

		if (subscriptionForm_changed['email'] == true) {
			paypalSubscriptionResultForm_changed['email'] = true;
			$('form[name="paypalSubscriptionResultForm"] input[name="email"]').val($('form[name="paypalSubscriptionForm"] input[name="email"]').val());
		}
		if (subscriptionForm_changed['prefix'] == true) {
			paypalSubscriptionResultForm_changed['prefix'] = true;
			$('form[name="paypalSubscriptionResultForm"] input[name="prefix"]').val($('form[name="paypalSubscriptionForm"] input[name="prefix"]').val());
		}
		if (subscriptionForm_changed['phone'] == true) {
			paypalSubscriptionResultForm_changed['phone'] = true;
			$('form[name="paypalSubscriptionResultForm"] input[name="phone"]').val($('form[name="paypalSubscriptionForm"] input[name="phone"]').val());
		}

		// Fill in logon fields
		$('form[name="logonForm"] input[name="login"]').val($.settings.info.subscribe.login);
		$('form[name="logonForm"] input[name="password"]').val($.settings.info.subscribe.password);
	}

	if (display == true) {
		$('form[name="paypalSubscriptionResultForm"]').show();
		$('form[name="paypalSubscriptionForm"]').hide();
	}
	else {
		$('form[name="paypalSubscriptionForm"]').show();

		if ($.settings.subscribe.paypal.option != undefined) {
			$('#paypalSubscriptionForm_explain_text').text(getTextTranslation('paypalOptionSubscriptionForm_explain_text'));
		}

		$('form[name="paypalSubscriptionResultForm"]').hide();
		paypalSubscriptionResultForm_empty();
	}
	paypalSubscriptionResultForm_phoneHelpBlock_display(false);

	if ($.settings.subscribe.paypal.option != undefined) {
		$('#paypalSubscriptionResultForm_back_button').text(getTextTranslation('paypalOptionSubscriptionResultForm_back_button'));
	}
}

/** Empty paypalSubscriptionResultForm
 */
function paypalSubscriptionResultForm_empty() {

	$('form[name="paypalSubscriptionResultForm"] input[type="text"]').each(function() {
		$(this).val('');
	});
	$('form[name="paypalSubscriptionResultForm"] input[type="checkbox"]').each(function() {
		$(this).attr("checked", false);
	});
	$('#paypalSubscriptionResultForm_result_login_value').html('');
	$('#paypalSubscriptionResultForm_result_password_value').html('');

	// Adding examples values
	paypalSubscriptionResultForm_phoneHelpBlock_configure();

	paypalSubscriptionResultForm_changed['prefix'] = false;
	paypalSubscriptionResultForm_changed['phone'] = false;
	paypalSubscriptionResultForm_changed['email'] = false;
}

/** Display paypalSubscriptionResultForm_send_sms_phone_help_block when help link is clicked
 * @param boolean state - Indicate if the block must be displayed or not
 */
function paypalSubscriptionResultForm_phoneHelpBlock_display(state) {

	var display = false;
	if ( (state == true) || (state == false) ) {
		display = state;
	}
	else if ($('#paypalSubscriptionResultForm_send_sms_phone_help_block').is(':hidden') == true) {
		display = true;
	}

	if (display == true) {
		$('#paypalSubscriptionResultForm_send_sms_phone_help_block').show();
	}
	else {
		$('#paypalSubscriptionResultForm_send_sms_phone_help_block').hide();
	}
}

/** Configure paypalSubscriptionResultForm_send_sms_phone_help_block
 * @param string displayLang - The language whish to display the content
 */
function paypalSubscriptionResultForm_phoneHelpBlock_configure(displayLang) {

	if (paypalSubscriptionResultForm_changed['prefix'] != true) {
		$('#paypalSubscriptionResultForm_send_sms_phone_prefix_value').val(getInputTranslation("paypalSubscriptionResultForm_send_sms_phone_prefix_value", displayLang));
	}
	if (paypalSubscriptionResultForm_changed['phone'] != true) {
		$('#paypalSubscriptionResultForm_send_sms_phone_phone_value').val(getInputTranslation("paypalSubscriptionResultForm_send_sms_phone_phone_value", displayLang));
	}
	$('#paypalSubscriptionResultForm_send_sms_phone_help_prefix_example_value').val(getInputTranslation("paypalSubscriptionResultForm_send_sms_phone_help_prefix_example_value", displayLang));
	$('#paypalSubscriptionResultForm_send_sms_phone_help_phone_example_value').val(getInputTranslation("paypalSubscriptionResultForm_send_sms_phone_help_phone_example_value", displayLang));
}

function paypalSubscriptionResultFormSend_display(state, mode) {

	var display = false;
	if ( (state == true) || (state == false) ) {
		display = state;
	}

	if (display == true) {
		if (mode == "sms") {
			$('#paypalSubscriptionResultForm_send_sms_phone_block').show();
		}
		if (mode == "mail") {
			$('#paypalSubscriptionResultForm_send_email_address_block').show();
		}
		if ($('#paypalSubscriptionResultForm_send_email_address_block').is(':visible') || $('#paypalSubscriptionResultForm_send_sms_phone_block').is(':visible')) {
			$('#paypalSubscriptionResultForm_send_button').show();
		}
	}
	else {
		if (mode == "sms") {
			$('#paypalSubscriptionResultForm_send_sms_phone_block').hide();
			if ($('#paypalSubscriptionResultForm_send_email_address_block').length == 0) {
				// Hide if SMS mode only visible on portal
				$('#paypalSubscriptionResultForm_send_button').hide();
			}
		}
		if (mode == "mail") {
			$('#paypalSubscriptionResultForm_send_email_address_block').hide();
			if ($('#paypalSubscriptionResultForm_send_sms_phone_block').length == 0) {
				// Hide if Mail mode only visible on portal
				$('#paypalSubscriptionResultForm_send_button').hide();
			}
		}
		if ($('#paypalSubscriptionResultForm_send_email_address_block').is(':hidden') && $('#paypalSubscriptionResultForm_send_sms_phone_block').is(':hidden')) {
			$('#paypalSubscriptionResultForm_send_button').hide();
		}
	}
	paypalSubscriptionResultForm_phoneHelpBlock_display(false);
}

/** Enable waiting mode on paypalSubscriptionResultForm
 */
function paypalSubscriptionResultFormWaiting(state) {
	switch (state) {
		case true:
			$('#paypalSubscriptionResultForm_back_button').attr("disabled", true);
			$('#paypalSubscriptionResultForm_send_button').attr("disabled", true);
			$('body').toggleClass("cursor-wait");
			break;
		case false:
			$('#paypalSubscriptionResultForm_back_button').attr("disabled", false);
			$('#paypalSubscriptionResultForm_send_button').attr("disabled", false);
			$('body').toggleClass("cursor-wait");
			break;
	}
}

function paypalSubscriptionResultFormSendCredential() {

	var params = new Object();
	var sendMailOption = $('form[name="paypalSubscriptionResultForm"] input[name="send_mail"]').is(":checked");
	var sendSmsOption = $('form[name="paypalSubscriptionResultForm"] input[name="send_sms"]').is(":checked");

	params.login = $('form[name="logonForm"] input[name="login"]').val();
	params.password = $('form[name="logonForm"] input[name="password"]').val();

	params.email = (paypalSubscriptionResultForm_changed['email'] == true) ? $('form[name="paypalSubscriptionResultForm"] input[name="email"]').val() : "";
	params.prefix = (paypalSubscriptionResultForm_changed['prefix'] == true) ? $('form[name="paypalSubscriptionResultForm"] input[name="prefix"]').val() : "";
	params.phone = (paypalSubscriptionResultForm_changed['phone'] == true) ? $('form[name="paypalSubscriptionResultForm"] input[name="phone"]').val() : "";

	if ( ($.settings.user != undefined) && ($.settings.user.securePwd != undefined) ) {
		params.securePwd = $.settings.user.securePwd.value;
	}

	var callbacks = new Object();
	callbacks.beforeSend = function() { paypalSubscriptionResultFormWaiting(true); };
	callbacks.success    = function() { paypalSubscriptionResultFormSendCredentialCallback(); };
	callbacks.complete   = function() { paypalSubscriptionResultFormWaiting(false); };

	if ($.settings.subscribe.paypal.sendMail != undefined && $.settings.subscribe.paypal.sendMail.display == true && sendMailOption) {
		params.action = "paypal_send_mail";
		subscriptionSendCredential(callbacks, params);
	}
	if ($.settings.subscribe.paypal.sendSms != undefined && $.settings.subscribe.paypal.sendSms.display == true && sendSmsOption) {
		params.action = "paypal_send_sms";
		subscriptionSendCredential(callbacks, params);
	}
}

function paypalSubscriptionResultFormSendCredentialCallback() {

	displayErrorInfo();
	if ($.settings.error == undefined) {
		displayStep();
	}
}

/*****************************************************************************/

/** Executed when link is clicked
 */
function paypalSubscriptionLinkEnable() {

	logonForm_display(false);
	logonFormSubscribeChoice_display(false);
	paypalSubscriptionForm_display(true);
}

/*****************************************************************************/

/** Manage the modification of inputs and the help texts present on them
 * @param string type - The type on the event (focus | blur )
 * @param element element - The DOM element afected by the modification
 */
function paypalSubscriptionResultForm_modifyEvent(type, element) {
	switch (type) {
		case 'focus':
			if (paypalSubscriptionResultForm_changed[element.attr("name")] != true) {
				element.val("");
			}
			break;

		case 'blur':
			if (element.val() == "") {
				element.val(getInputTranslation(element.attr("id")));
				paypalSubscriptionResultForm_changed[element.attr("name")] = false;
			}
			else {
				paypalSubscriptionResultForm_changed[element.attr("name")] = true;
			}
			break;
	}
}


/*****************************************************************************/
/****                Paypal Payment Form JavaScript functions             ****/
/*****************************************************************************/

/** This function is triggered when the page is loaded
 */
$(document).ready(function() {

	/** Inputs triggers
	 */
	$('form[name="paypalPaymentForm"] select[name="select_package"]').change(function() {
		paypalPaymentForm_packages_describe();
		paypalPaymentFormPay();
	});
	$('form[name="paypalPaymentForm"] select[name="select_package"]').keyup(function() {
		paypalPaymentForm_packages_describe();
		paypalPaymentFormPay();
	});

	/** Buttons triggers
	 */
	$('#paypalPaymentForm_back_button').click(function() {
		paypalPaymentFormRefillBack();
	});
	$('#paypalPaymentForm_disconnect_button').click(function() {
		paypalPaymentFormBack();
	});
	$('#paypalPaymentForm_pay_button').click(function() {
		paypalPaymentFormPay();
	});
	$('#paypalPaymentResultForm_disconnect_button').click(function() {
		paypalPaymentResultForm_disconnect();
	});
	$('#paypalPaymentResultForm_connect_button').click(function() {
		paypalPaymentResultForm_connect();
	});
	/** Form triggers
	 */
	$('form[name="paypalPaymentForm"]').submit(function() {
		return false;
	});
	$('form[name="paypalPaymentResultForm"]').click(function() {
		return false;
	});
	// CHANGED_BY_HH
	// Modified, to display the paypal PAY button (#payPalSendButton_Fake) right near the DISCONNECT button at one line!
	// In the past, the PAY button was in a seperate seperate form element
	// Which was display downwards to the DISCONNECT button
	// The original payment form is now hidden the whole time!
	//
	// Please see also: portal_paypal_payment.tmpl.html (line 36)
	//
	// OLD: $('#paypalRedirectionForm_pay_button').click(function (){
	$('#payPalSendButton_Fake').click(function (){
		// Update order status through API
		paypalRedirectFormPay();
	});
});


function paypalRedirectFormPay()
{
	var params = new Object();
	params.login = $.settings.payment.login;
	if ( ($.settings.user != undefined) && ($.settings.user.securePwd != undefined) ) {
		params.securePwd = $.settings.user.securePwd.value;
	}
	var callbacks = new Object();
	callbacks.beforeSend = function() { paypalPaymentFormWaiting(true); };
	callbacks.success    = function() { paypalRedirectFormPayCallback(); };
	callbacks.complete   = function() { paypalPaymentFormWaiting(false); };
	paypalSubmitPayment(callbacks, params);
}

function paypalRedirectFormPayCallback() {
	if ($.settings.error == undefined) {
		paypalPaymentForm_display(false);
		displayStep();

	}
	displayErrorInfo();
}


/** send and submit paypal payment information */

function paypalSendPaymentForm()
{
	$('form[name="paypalRedirectForm"] input[name="encrypted"]').val($.settings.payment.packageEncr);
	$('form[name="paypalRedirectForm"]').attr('action', $.settings.payment.paypalUrlPost);
	var url = $.settings.payment.paypalUrlPost + "?cmd=_express-checkout&useraction=commit&token=" + $.settings.payment.token;
	$.settings.payment.token="";
	displayWaitingIcon(true);
	window.location = url;
}



/** Configure paypalPaymentForm depending on settings
 */
function paypalPaymentForm_configure() {

	// Configure display
	if ($.settings.subscribe != undefined && $.settings.subscribe.paypal != undefined) {
		// Add packages
		paypalPaymentForm_packages_configure();
	}
	else {
		$('form[name="paypalPaymentForm"]').remove();
		$('form[name="paypalPaymentResultForm"]').remove();
	}
}

function paypalPaymentForm_packages_configure(displayLang) {

	if ($.settings.subscribe != undefined && $.settings.subscribe.paypal != undefined) {
		var paypalInfos = null;
		var defaultOptionText;

		if ($.settings.subscribe.paypal.package != undefined && ($.settings.payment && $.settings.payment.process == "create")) {
			var paypalInfos = $.settings.subscribe.paypal.package;
			// Keep default option
			defaultOptionText = $('#paypalPaymentForm_default_package_option').text();
		}
		else if ($.settings.subscribe.paypal.option != undefined && ($.settings.payment && $.settings.payment.process == "create")) {
			var paypalInfos = $.settings.subscribe.paypal.option;
			defaultOptionText = getTextTranslation('paypalOptionPaymentForm_default_package_option');
			$('#paypalPaymentForm_select_package_text').text(getTextTranslation('paypalOptionPaymentForm_select_package_text'));
			$('#paypalPaymentForm_title_text').text(getTextTranslation('paypalOptionPaymentForm_title_text'));
			$('#paypalPaymentForm_explain_text').text(getTextTranslation('paypalOptionPaymentForm_explain_text'));
			$('#paypalPaymentForm_package_description_explain').text(getTextTranslation('paypalOptionPaymentForm_package_description_explain'));
			$('#paypalPaymentForm_package_description_text').text(getTextTranslation('paypalOptionPaymentForm_package_description_text'));
		}
		else {
			return;
		}

		if (displayLang == undefined) { // No displayLang given, find user selected language, else default portal language else default package language
			if ($.settings != undefined && $.settings.user != undefined && $.settings.user.lang != undefined) {
				displayLang = $.settings.user.lang;
			}
		}

		// update forced disconnectin timer info
		if ( $.settings.subscribe.paypal.connectionProfile != undefined && $.settings.subscribe.paypal.connectionProfile.timeout > 0 ) {
			$('form[name="paypalPaymentForm"] small#paypalPaymentForm_payment_timer_text').show();
			$('form[name="paypalPaymentForm"] small#paypalPaymentForm_payment_timer_value').text(getForcedDisconnectionTimerDisplayText($.settings.subscribe.paypal.connectionProfile.timeout));
		}
		else {
			$('form[name="paypalPaymentForm"] small#paypalPaymentForm_payment_timer_text').hide();
			$('form[name="paypalPaymentForm"] small#paypalPaymentForm_payment_timer_value').text(' ');
		}

		// Empty the select list
		$('form[name="paypalPaymentForm"] select[name="select_package"]').empty();
		$('form[name="paypalPaymentForm"] select[name="select_package"]').append('<option id="paypalPaymentForm_default_package_option" disabled selected value="">' + defaultOptionText + '</option>');
		// Populate list
		$(paypalInfos).each(function () {
			var package = $(this)[0];
			var text;
			var currencyLanguage;
			if (package[displayLang] != undefined) {
				text = package[displayLang].text;
				currencyLanguage = displayLang;
			}
			else if ($.settings != undefined && $.settings.lang != undefined && $.settings.lang.defaultLang != undefined && package[$.settings.lang.defaultLang] != undefined) {
				text = package[$.settings.lang.defaultLang].text;
				currencyLanguage = $.settings.lang.defaultLang;
			}
			else if (package[package.defaultLang] != undefined) {
				text = package[package.defaultLang].text;
				currencyLanguage = package.defaultLang;
			}
			else {
				text = "";
				currencyLanguage = package.defaultLang;
			}

			// Add price
			if (package['currency'] == "free") {
				text += "&nbsp;" + "(" + getGenericTranslation('free_package', currencyLanguage) + ")";
			}
			else {
				text += "&nbsp;" + "(" + package['price'] + "&nbsp;" + package['currency'] + ")";
			}

			$('form[name="paypalPaymentForm"] select[name="select_package"]').append('<option value="' + package.name + '"' + '>' + text + '</option>');
		});
	}
}

/** Display paypalPaymentForm depending on settings
 * Can be overwritten by state
 * @param boolean state - Indicate if the form must be displayed or not
 */
function paypalPaymentForm_display(state) {

	var display = false;
	if ( (state == true) || (state == false) ) {
		display = state;
	}
	else if ( ($.settings.step != undefined && $.settings.step == "PAYMENT") && ($.settings.type != undefined && $.settings.type == "PAYPAL") ) {
		display = true;
	}
	if (display == true) {
		// waiting for payment, display result form
		if( $.settings.payment.status=="waiting_paypal" || $.settings.payment.status=="verifying"  )
		{
			paypalPaymentForm_display(false);
			if($.settings.payment.status=="verifying")paypalPaymentResultForm_verify();
			if($.settings.payment.status=="waiting_paypal")paypalSendPaymentForm();
		}
		// otherwise, select package form
		else
		{
			// deal with users already exists otherwise, select package form
			if ($.settings.payment && $.settings.payment.process == 'create' && $.settings.payment.status == 'init' && $.settings.payment.user_exists != undefined && $.settings.payment.user_exists == true) {
				paypalPaymentForm_packages_configure();
				paypalPaymentForm_packages_describe();
			}

			$('form[name="paypalPaymentForm"]').show();

			if ($.settings.payment && $.settings.payment.process == 'refill') {
				$('#paypalPaymentForm_back_button').show();
				$('#paypalPaymentForm_disconnect_button').hide();
			}
			else {
				$('#paypalPaymentForm_disconnect_button').show();
				$('#paypalPaymentForm_back_button').hide();
			}
		}
	}
	else {
		$('form[name="paypalPaymentForm"]').hide();
		$('#paypalPaymentForm_package_description_explain').show();
		$('#paypalPaymentForm_package_description_value').html('');
		paypalPaymentForm_packages_configure();
		paypalPaymentForm_packages_describe();
		// CHANGED_BY_HH
		// Please see also: portal_paypal_payment.tmpl.html (line: 36)
		// This change hide the new "fake" button, instead of the pay Button in the form: paypalRedirectForm
		// $('form[name="paypalRedirectForm"]').hide();
		$('#payPalSendButton_Fake').hide();
	}
}

/** Executed when back button is clicked
 */
function paypalPaymentFormBack() {
	var callbacks = new Object();
	// callbacks.beforeSend = function() {}; // TODO
	callbacks.success    = function() { paypalPaymentFormBackCallback(); };
	// callbacks.complete   = function() {}; // TODO
	backAction(callbacks);
}

/** Executed on return of paypalPaymentFormBack function
 */
function paypalPaymentFormBackCallback() {

	if ($.settings != undefined && $.settings.payment != undefined) {
		delete $.settings.payment;
		$.settings.payment = new Object();
	}

	displayErrorInfo();
	displayStep();
}

function paypalPaymentFormRefillBack() {
	var callbacks = new Object();
	// callbacks.beforeSend = function() {}; // TODO
	callbacks.success    = function() { paypalPaymentFormRefillBackCallback(); };
	// callbacks.complete   = function() {}; // TODO
	backAction(callbacks);
}

function paypalPaymentFormRefillBackCallback() {

	if ($.settings != undefined && $.settings.payment != undefined) {
		delete $.settings.payment;
		$.settings.payment = new Object();
	}

	paypalPaymentForm_display(false);
	accountRefillForm_display(true);
	accountRefillForm_options_configure();
	accountRefillForm_options_describe();
}

/** Enable waiting mode on paypalPaymentForm
 */
function paypalPaymentFormWaiting(state) {
	switch (state) {
		case true:
			$('#paypalPaymentForm_back_button').attr("disabled", true);
			$('#paypalPaymentForm_disconnect_button').attr("disabled", true);
			$('#paypalPaymentForm_pay_button').attr("disabled", true);
			$('#paypalPaymentResultForm_disconnect_button').attr("disabled", true);
			$('#paypalPaymentResultForm_connect_button').attr("disabled", true);
			$('body').toggleClass("cursor-wait");
			break;
		case false:
			$('#paypalPaymentForm_back_button').attr("disabled", false);
			$('#paypalPaymentForm_disconnect_button').attr("disabled", false);
			$('#paypalPaymentForm_pay_button').attr("disabled", false);
			$('#paypalPaymentResultForm_disconnect_button').attr("disabled", false);
			$('#paypalPaymentResultForm_connect_button').attr("disabled", false);
			$('body').toggleClass("cursor-wait");
			break;
	}
}

/** Executed when pay button is clicked
 */
function paypalPaymentFormPay() {

	var params = new Object();

	params.package = $('form[name="paypalPaymentForm"] select[name="select_package"]').val();

	if (($.settings.user != undefined) && ($.settings.user.securePwd != undefined)) {
		params.securePwd = $.settings.user.securePwd.value;
	}
	params.login = $.settings.payment.login;
	var callbacks = new Object();
	callbacks.beforeSend = function() { paypalPaymentFormWaiting(true); };
	callbacks.success    = function() { paypalPaymentFormPayCallback(); };
	callbacks.complete   = function() { paypalPaymentFormWaiting(false); };
	selectPaypalPackage(callbacks, params);
}

/** Executed on return of paypalPaymentFormPay function
 */
function paypalPaymentFormPayCallback() {

	displayErrorInfo();
	if($.settings.error == undefined)
	{
		// CHANGED_BY_HH
		// Please see also line: 46 and 195 in this file
		//
		// OLD: $('form[name="paypalRedirectForm"]').show();
		$('#payPalSendButton_Fake').show();
	}
	else
	{
		// CHANGED_BY_HH
		// Please see also line: 46 and 195 in this file
		//
		// OLD: $('form[name="paypalRedirectForm"]').hide();
		$('#payPalSendButton_Fake').hide();
	}
}

function paypalPaymentForm_packages_describe(displayLang) {
	if ($.settings.subscribe != undefined && $.settings.subscribe.paypal != undefined) {

		var paypalInfos = null;
		if ($.settings.subscribe.paypal.package != undefined && ($.settings.payment && $.settings.payment.process == "create")) {
			var paypalInfos = $.settings.subscribe.paypal.package;
		}
		else if ($.settings.subscribe.paypal.option != undefined && ($.settings.payment && $.settings.payment.process == "create")) {
			var paypalInfos = $.settings.subscribe.paypal.option;
		}
		else {
			return;
		}

		if (displayLang == undefined) { // No displayLang given, find user selected language, else default portal language else default package language
			if ($.settings != undefined && $.settings.user != undefined && $.settings.user.lang != undefined) {
				displayLang = $.settings.user.lang;
			}
		}
		// Update describe block
		if ($('form[name="paypalPaymentForm"] select[name="select_package"]').val() == "") {
			$('#paypalPaymentForm_package_description_explain').show();
			$('#paypalPaymentForm_package_description_value').html("");
		}
		else {
			$(paypalInfos).each(function () {
				var package = $(this)[0];
				if (package.name == $('form[name="paypalPaymentForm"] select[name="select_package"]').val()) {
					var describe;
					if (package[displayLang] != undefined) {
						describe = package[displayLang].description;
					}
					else if ($.settings != undefined && $.settings.lang != undefined && $.settings.lang.defaultLang != undefined && package[$.settings.lang.defaultLang] != undefined) {
						describe = package[$.settings.lang.defaultLang].description;
					}
					else if (package[package.defaultLang] != undefined) {
						describe = package[package.defaultLang].description;
					}

					if (describe == undefined) {
						describe = getTextTranslation('accountRefillForm_no_description');
					}

					$('#paypalPaymentForm_package_description_explain').hide();
					$('#paypalPaymentForm_package_description_value').html(describe);
				}
			});
		}
	}
}

function paypalPaymentForm_options_describe() {

	var displayLang = $.settings.user.lang;
	var paypalInfos = $.settings.subscribe.paypal.refill;
	var package = null;
	var describe;
	var text;
	var currencyLanguage;
	$('#paypalPaymentForm_select_package_text').text(getTextTranslation('accountRefillForm_option_buyed_text'));
	$('#paypalPaymentForm_title_text').text(getTextTranslation('paypalOptionPaymentForm_title_text'));
	$('#paypalPaymentForm_explain_text').text(getTextTranslation('paypalOptionPaymentForm_refill_text'));
	$('#paypalPaymentForm_package_description_explain').text(getTextTranslation('paypalOptionPaymentForm_package_description_explain'));
	$('#paypalPaymentForm_package_description_text').text(getTextTranslation('paypalOptionPaymentForm_package_description_text'));

	$(paypalInfos).each(function () {
		var package = $(this)[0];

		if (package.name == $.settings.payment.package) {

			if (package[displayLang] != undefined) {
				text             = package[displayLang].text;
				currencyLanguage = displayLang;
				describe         = package[displayLang].description;
			}
			else if ($.settings != undefined && $.settings.lang != undefined && $.settings.lang.defaultLang != undefined && package[$.settings.lang.defaultLang] != undefined) {
				text             = package[$.settings.lang.defaultLang].text;
				currencyLanguage = $.settings.lang.defaultLang;
				describe         = package[$.settings.lang.defaultLang].description;
			}
			else if (package[package.defaultLang] != undefined) {
				text             = package[package.defaultLang].text;
				currencyLanguage = package.defaultLang;
				describe         = package[package.defaultLang].description;
			}
			else {
				text             = "";
				currencyLanguage = package.defaultLang;
			}

			if (describe == undefined) {
				describe = getTextTranslation('accountRefillForm_no_description');
			}

			// Add price
			if (package['currency'] == "free") {
				text += "&nbsp;" + "(" + getGenericTranslation('free_package', currencyLanguage) + ")";
			}
			else {
				text += "&nbsp;" + "(" + package['price'] + "&nbsp;" + package['currency'] + ")";
			}
			$('#paypalPaymentForm_package_description_explain').hide();
			$('#paypal_select_list').hide();
			$('#paypalPaymentForm_package_description_value').html(describe);
			$('#paypalPaymentForm_payment_detail_value').html(text);
		}
	});

	if($.settings.error == undefined)
	{
		$('form[name="paypalRedirectForm"]').show();
		$('#payPalSendButton_Fake').show();
	}
}

/** Display paypalPaymentResultForm (Usualy Triggered when pay button clicked)
 * @param boolean state - Indicate if the results must be displayed or not
 */
function paypalPaymentResultForm_display(state) {

	var display = false;
	if ( (state == true) || (state == false) ) {
		display = state;
	}
	if (display == true) {
		displayWaitingIcon(false);
		$('form[name="paypalPaymentResultForm"]').show();
		if($.settings.payment.status=="completed")
		{
			if ($.settings.user.verifyTimer != undefined) {
				paypalPaymentVerify_payment_timer_stop();
				delete $.settings.user.verifyTimer;
			}

			displayErrorInfo();
			$("#paypalPaymentResultForm_payment_timer_text").hide();
			if ($.settings.payment.process == "create") {
				$("#paypalPaymentResultForm_connect_button").show();
			}
			else if ($.settings.payment.process == "refill") {
				$('form[name="paypalPaymentForm"]').remove();
				$('form[name="paypalPaymentResultForm"]').remove();
				accountRefillForm_paymentValidate();
			}
		}
		else if ($.settings != undefined && $.settings.error != undefined && $.settings.error.code == "error_logon_waiting-paypal-payment-validation") {
			if ($.settings.user.verifyTimer == undefined) {
				paypalPaymentVerify_payment_timer_start();
			}
		}
		else {
			displayErrorInfo();
			$("#paypalPaymentResultForm_connect_button").hide();
			if ($.settings.user.paymentTimer != undefined && $.settings.user.paymentTimer.value != undefined) {
				$("#paypalPaymentResultForm_payment_timer_text").show();
				$.settings.user.paymentTimer.value = 10;
				paypalPaymentResultForm_payment_timer_start();
			}
			else {
				$("#paypalPaymentResultForm_payment_timer_text").hide();
			}
		}
	}
	else {
		$('form[name="paypalPaymentResultForm"]').hide();
	}

	if (($.settings.subscribe.paypal.option != undefined) || ($.settings.subscribe.paypal.refill != undefined)){
		$('#paypalSubscriptionResultForm_back_button').text(getTextTranslation('paypalOptionSubscriptionResultForm_back_button'));
	}
}



/** Executed when connect comming back from Paypal payment site
 */
function paypalPaymentResultForm_verify() {
	if ($.settings.payment != undefined) {
		var params = new Object();
		var callbacks = new Object();
		params.login = $.settings.payment.login;
		params.policyAccept = $.settings.payment.policyAccept;
		callbacks.beforeSend = function() { paypalPaymentFormWaiting(true); };
		callbacks.success    = function() { paypalPaymentResultForm_display(true); };
		callbacks.complete   = function() { paypalPaymentFormWaiting(false); };
		displayWaitingIcon(true);
		verifyPayment(callbacks,params);
	}
	else {
		displayStep();
	}

}

function paypalPaymentVerify_payment_timer_start() {
    if ($.settings.user.verifyTimer == undefined) {
		$("#paypalPaymentResultForm_explain_text").hide();
		$("#paypalPaymentResultForm_payment_timer_text").hide();
		$("#paypalPaymentResultForm_connect_button").hide();
		$('form[name="paypalPaymentWaitingForm"]').show();
		$('#paypalPaymentWaitingForm_payment_timer_text').text(getTextTranslation('paypalPaymentWaitingForm_payment_timer_text'));
		$('#paypalPaymentWaitingForm_payment_timer_text').show();

		$.settings.user.verifyTimer = 10;
		if (timerObj.paymentTimer == undefined) {
			timerObj.paymentTimer = new Array();
			timerObj.paymentTimer.refreshInterval = 10000;
			timerObj.paymentTimer.value = $.settings.user.verifyTimer;
			timerObj.paymentTimer.resource = window.setInterval(function () { paypalPaymentResultForm_verify(); }, timerObj.paymentTimer.refreshInterval);
		}
	}
}

function paypalPaymentVerify_payment_timer_stop() {
	$("#paypalPaymentResultForm_explain_text").show();
	$("#paypalPaymentResultForm_payment_timer_text").hide();
	$("#paypalPaymentResultForm_connect_button").show();
	$('form[name="paypalPaymentWaitingForm"]').hide();
	if (timerObj.paymentTimer != undefined && timerObj.paymentTimer.resource != undefined) {
		window.clearInterval(timerObj.paymentTimer.resource);
		delete timerObj.paymentTimer;
	}
}

/** Executed on return of verification of Paypal payment
 */
function paypalPaymentResultForm_connect() {
	if($.settings.error == undefined)
	{
		// user payed, follow auto connect link
		paypalPaymentResultForm_payment_timer_stop();
		delete $.settings.user.paymentTimer;
		if($.settings.payment.status=="completed")
		{
			paypalPaymentResultForm_display(false);
			window.location = $.settings.payment.a_connect_link;
		}
		else {
			paypalPaymentResultForm_disconnect();
		}
	}
	else
	{
		paypalPaymentResultForm_disconnect();
		displayErrorInfo();
	}
}


/** Executed when disconnect button is clicked
 */
function paypalPaymentResultForm_disconnect() {
	paypalPaymentResultForm_payment_timer_stop();
	paypalPaymentResultForm_display(false);
	delete $.settings.user.paymentTimer;
	if($.settings.user.isConnected)
		feedbackFormDisconnect();
	else
		paypalPaymentFormBack();
}

function paypalPaymentResultForm_payment_timer_start() {
	if($.settings.user.paymentTimer != undefined && $.settings.user.paymentTimer.value != undefined) {
			if (timerObj.paymentTimer == undefined) {
				timerObj.paymentTimer = new Array();
				timerObj.paymentTimer.refreshInterval = 1000;
				timerObj.paymentTimer.value = $.settings.user.paymentTimer.value;
				timerObj.paymentTimer.resource = window.setInterval(function() { paypalPaymentResultForm_payment_timer_display();}, timerObj.paymentTimer.refreshInterval);

			}
	}
}


function paypalPaymentResultForm_payment_timer_stop() {
	$('#paypalPaymentResultForm_payment_timer').text('-');
	if (timerObj.paymentTimer != undefined && timerObj.paymentTimer.resource != undefined) {
		window.clearInterval(timerObj.paymentTimer.resource);
		delete timerObj.paymentTimer;
	}
}

function paypalPaymentResultForm_payment_timer_display() {
	if (timerObj.paymentTimer != undefined && timerObj.paymentTimer.value != undefined) {
		timerObj.paymentTimer.value--;
		if (timerObj.paymentTimer.value > 0) {
			var hours = Math.floor(timerObj.paymentTimer.value / 3600);
			var mins = Math.floor((timerObj.paymentTimer.value - (hours * 3600)) / 60);
			var seconds = timerObj.paymentTimer.value - (hours * 3600) - (mins * 60);

			var hours_label = getGenericTranslation('hour', null, (hours > 1));
			var mins_label = getGenericTranslation('minute', null, (mins > 1));
			var seconds_label = getGenericTranslation('second', null, (seconds > 1));

			$('#paypalPaymentResultForm_payment_timer_text').text(getTextTranslation('feedbackForm_automatic_disconnection_text'));

			if( hours > 0 )
			{
				$('#paypalPaymentResultForm_payment_timer_value').text($.sprintf(getGenericTranslation('feedbackForm_time-credit-with-seconds'), hours, hours_label, mins, mins_label,
												seconds, seconds_label));
			}
			else
			{
				$('#paypalPaymentResultForm_payment_timer_value').text($.sprintf(getGenericTranslation('feedbackForm_time-credit-without-hours'), mins, mins_label, seconds, seconds_label));
			}
		}
		else {
			paypalPaymentResultForm_disconnect();
		}
	}
}


/*****************************************************************************/
/****             Ogone Subscription Form JavaScript functions           ****/
/*****************************************************************************/

/** Listen to modified element
 */
var ogoneSubscriptionResultForm_changed = new Object();

/** This function is triggered when the page is loaded
 */
$(document).ready(function() {

	/** Inputs triggers
	 */
	$('form[name="ogoneSubscriptionResultForm"] input[name="send_sms"]').change(function() {
		ogoneSubscriptionResultFormSend_display($(this).is(':checked'), "sms");
	});
	$('form[name="ogoneSubscriptionResultForm"] input[name="send_mail"]').change(function() {
		ogoneSubscriptionResultFormSend_display($(this).is(':checked'), "mail");
	});

	$('form[name="ogoneSubscriptionResultForm"] input[name="email"]').focus(function() {
		ogoneSubscriptionResultForm_modifyEvent('focus', $(this));
		ogoneSubscriptionResultForm_phoneHelpBlock_display(false);
	});

	$('form[name="ogoneSubscriptionResultForm"] input[name="email"]').blur(function() {
		ogoneSubscriptionResultForm_modifyEvent('blur', $(this));
	});

	$('form[name="ogoneSubscriptionResultForm"] input[name="email"]').change(function() {
		ogoneSubscriptionResultForm_modifyEvent('blur', $(this));
	});

	$('form[name="ogoneSubscriptionResultForm"] input[name="prefix"]').focus(function() {
		ogoneSubscriptionResultForm_modifyEvent('focus', $(this));
		ogoneSubscriptionResultForm_phoneHelpBlock_display(true);
	});
	$('form[name="ogoneSubscriptionResultForm"] input[name="prefix"]').blur(function() {
		ogoneSubscriptionResultForm_modifyEvent('blur', $(this));
	});
	$('form[name="ogoneSubscriptionResultForm"] input[name="prefix"]').change(function() {
		ogoneSubscriptionResultForm_modifyEvent('blur', $(this));
	});
	$('form[name="ogoneSubscriptionResultForm"] input[name="phone"]').focus(function() {
		ogoneSubscriptionResultForm_modifyEvent('focus', $(this));
		ogoneSubscriptionResultForm_phoneHelpBlock_display(true);
	});
	$('form[name="ogoneSubscriptionResultForm"] input[name="phone"]').blur(function() {
		ogoneSubscriptionResultForm_modifyEvent('blur', $(this));
	});
	$('form[name="ogoneSubscriptionResultForm"] input[name="phone"]').change(function() {
		ogoneSubscriptionResultForm_modifyEvent('blur', $(this));
	});
	/** Buttons triggers
	 */
	$('#ogoneSubscriptionForm_back_button').click(function() {
		ogoneSubscriptionFormBack();
	});
	$('#ogoneSubscriptionForm_subscribe_button').click(function() {
		ogoneSubscriptionFormSubscribe();
	});
	$('#ogoneSubscriptionResultForm_back_button').click(function() {
		displayStep();
	});
	$('#ogoneSubscriptionResultForm_send_button').click(function() {
		ogoneSubscriptionResultFormSendCredential();
	});
	/** Form triggers
	 */
	$('form[name="ogoneSubscriptionForm"]').submit(function() {
		return false;
	});
	$('form[name="ogoneSubscriptionResultForm"]').submit(function() {
		return false;
	});
	/** Link triggers
	 */
	$('#ogoneSubscriptionLink').click(function() {
		ogoneSubscriptionLinkEnable();
	});
	$('#ogoneSubscriptionResultForm_send_sms_phone_help_link').click(function() {
		ogoneSubscriptionResultForm_phoneHelpBlock_display();
	});
});

/** Configure ogoneSubscriptionForm depending on settings
 */
function ogoneSubscriptionForm_configure() {
	var showSendSms = true, showSendMail = true;
	// Configure display
	if ($.settings.subscribe != undefined && $.settings.subscribe.ogone != undefined) {

		if ($.settings.subscribe.ogone.option != undefined) {
			$('#ogoneSubscriptionForm_explain_text').text(getTextTranslation('ogoneOptionSubscriptionForm_explain_text'));
		}

		if (($.settings.subscribe.ogone.option != undefined) || ($.settings.subscribe.ogone.package != undefined)) {
			// Moving link to right location
			if($('#logonForm_subscriptionChoice_grid').length == 1) {
				$('#ogoneSubscriptionLink').appendTo('#logonForm_subscriptionChoice_grid').show();
			}
			else {
				if ($.settings.subscribe.count > 1) {
					$('#ogoneSubscriptionLink').appendTo('#subscriptionChoiceInsert').show();
				}
				else if ($.settings.subscribe.count == 1) {
					$('#logonFormSubscriptionLink_link').click(function() {
						ogoneSubscriptionLinkEnable();
					});
				}
			}
		}
		// Configure ogoneSubscriptionResultForm
		if ($.settings.subscribe.ogone.sendSms != undefined && $.settings.subscribe.ogone.sendSms.display == true) {
			$('#ogoneSubscriptionResultForm_send_sms_block').show();
			$('#ogoneSubscriptionResultForm_send_sms_phone_block').hide();
			// Configure help block
			ogoneSubscriptionResultForm_phoneHelpBlock_configure();
		}
		else {
			$('#ogoneSubscriptionResultForm_send_sms_block').remove();
			$('#ogoneSubscriptionResultForm_send_sms_phone_block').remove();
			showSendSms = false;
		}

		if ($.settings.subscribe.ogone.sendMail != undefined && $.settings.subscribe.ogone.sendMail.display == true) {
			$('#ogoneSubscriptionResultForm_send_mail_block').show();
			$('#ogoneSubscriptionResultForm_send_email_address_block').hide();
		}
		else {
			$('#ogoneSubscriptionResultForm_send_mail_block').remove();
			$('#ogoneSubscriptionResultForm_send_email_address_block').remove();
			showSendMail = false;
		}

		if (showSendMail == false && showSendSms == false) {
			// Remove send button if Mail and Sms ogone subscription mode not activated
			$('#ogoneSubscriptionResultForm_send_button').remove();
		}

		// autofill/autoconnect link
		if ( $.settings.subscribe.ogone.autofill != undefined ) {
			$('form[name="logonForm"] input[name="login"]').val($.settings.subscribe.ogone.autofill.login);
			$('form[name="logonForm"] input[name="password"]').val($.settings.subscribe.ogone.autofill.password);
		}

		subscriptionForm_configure('ogone');
	}
	else {
		$('form[name="ogoneSubscriptionForm"]').remove();
		$('form[name="ogoneSubscriptionResultForm"]').remove();
		$('form[name="ogoneRedirectForm"]').remove();
		$('#ogoneSubscriptionLink').remove();
	}
}

/** Display ogoneSubscriptionForm depending on settings
 * Can be overwritten by state
 * @param boolean state - Indicate if the form must be displayed or not
 */
function ogoneSubscriptionForm_display(state) {

	var display = false;
	if ( (state == true) || (state == false) ) {
		display = state;
	}
	if (display == true) {
		subscriptionForm_commonFields_display('ogone');
		$('form[name="ogoneSubscriptionForm"]').show();

		if ($.settings.subscribe.ogone.option != undefined) {
			$('#ogoneSubscriptionForm_explain_text').text(getTextTranslation('ogoneOptionSubscriptionForm_explain_text'));
		}

	}
	else {
		$('form[name="ogoneSubscriptionForm"]').hide();
		subscriptionForm_empty('ogone');
	}

	$('form[name="ogoneSubscriptionResultForm"]').hide();

	subscriptionForm_phoneHelpBlock_display(false);
	subscriptionForm_passwordHelpBlock_display(false);
}

/** Executed when back button is clicked
 */
function ogoneSubscriptionFormBack() {
    displayStep();
}

/** Enable waiting mode on ogoneSubscriptionForm
 */
function ogoneSubscriptionFormWaiting(state) {
	switch (state) {
		case true:
			$('#ogoneSubscriptionForm_back_button').attr("disabled", true);
			$('#ogoneSubscriptionForm_subscribe_button').attr("disabled", true);
			$('body').toggleClass("cursor-wait");
			break;
		case false:
			$('#ogoneSubscriptionForm_back_button').attr("disabled", false);
			$('#ogoneSubscriptionForm_subscribe_button').attr("disabled", false);
			$('body').toggleClass("cursor-wait");
			break;
	}
}

/** Executed when subscribe button is clicked
 */
function ogoneSubscriptionFormSubscribe() {
    var params = subscriptionFormSubscribe('ogone');
    var callbacks = new Object();
    callbacks.beforeSend = function() { ogoneSubscriptionFormWaiting(true); };
    callbacks.success    = function() { ogoneSubscriptionFormSubscribeCallback(); };
    callbacks.complete   = function() { ogoneSubscriptionFormWaiting(false); };
    subscribe(callbacks, params);
}

/** Executed on return of ogoneSubscriptionFormSubscribe function
 */
function ogoneSubscriptionFormSubscribeCallback() {
    displayErrorInfo();
    if ($.settings.error == undefined) {
		ogonePaymentForm_packages_configure();
		ogoneSubscriptionResultForm_display(true);
    }
}

/** Display ogoneSubscriptionResultForm (Usualy Triggered when subscribtion succeed)
 * @param boolean state - Indicate if the results must be displayed or not
 */
function ogoneSubscriptionResultForm_display(state) {

	var display = false;
	if ( (state == true) || (state == false) ) {
		display = state;
	}
	if ($.settings.info != undefined && $.settings.info.subscribe != undefined) {
		if ($.settings.info.subscribe.login != undefined) {
			$('#ogoneSubscriptionResultForm_login_value').html($.settings.info.subscribe.login);
		}
		if ($.settings.info.subscribe.password != undefined) {
			var tmp_input_params = subscriptionFormSubscribe('ogone');
			if ($.settings.subscribe != undefined && $.settings.subscribe.ogone != undefined
					&& $.settings.subscribe.ogone.userPassword != undefined && $.settings.subscribe.ogone.userPassword.display == true
					&& tmp_input_params.password != '') {
				// We hide the given password
				$('#ogoneSubscriptionResultForm_password_value').html('********');
			}
			else {
				$('#ogoneSubscriptionResultForm_password_value').html($.settings.info.subscribe.password);
			}
		}
		$('form[name="ogoneSubscriptionResultForm"] input[name="end_sms"]').attr("checked", false);
		if (subscriptionForm_changed['prefix'] == true) {
			ogoneSubscriptionResultForm_changed['prefix'] = true;
			$('form[name="ogoneSubscriptionResultForm"] input[name="prefix"]').val($('form[name="ogoneSubscriptionForm"] input[name="prefix"]').val());
		}
		if (subscriptionForm_changed['phone'] == true) {
			ogoneSubscriptionResultForm_changed['phone'] = true;
			$('form[name="ogoneSubscriptionResultForm"] input[name="phone"]').val($('form[name="ogoneSubscriptionForm"] input[name="phone"]').val());
		}
		if (subscriptionForm_changed['email'] == true) {
			ogoneSubscriptionResultForm_changed['email'] = true;
			$('form[name="ogoneSubscriptionResultForm"] input[name="email"]').val($('form[name="ogoneSubscriptionForm"] input[name="email"]').val());
		}
		// Fill in logon fields
		$('form[name="logonForm"] input[name="login"]').val($.settings.info.subscribe.login);
		$('form[name="logonForm"] input[name="password"]').val($.settings.info.subscribe.password);
	}

	if (display == true) {
		$('form[name="ogoneSubscriptionResultForm"]').show();
		$('form[name="ogoneSubscriptionForm"]').hide();
	}
	else {
		$('form[name="ogoneSubscriptionForm"]').show();

		if ($.settings.subscribe.ogone.option != undefined) {
			$('#ogoneSubscriptionForm_explain_text').text(getTextTranslation('ogoneOptionSubscriptionForm_explain_text'));
		}

		$('form[name="ogoneSubscriptionResultForm"]').hide();
		ogoneSubscriptionResultForm_empty();
	}
	ogoneSubscriptionResultForm_phoneHelpBlock_display(false);

	if ($.settings.subscribe.ogone.option != undefined) {
		$('#ogoneSubscriptionResultForm_back_button').text(getTextTranslation('ogoneOptionSubscriptionResultForm_back_button'));
	}
}

/** Empty ogoneSubscriptionResultForm
 */
function ogoneSubscriptionResultForm_empty() {
	$('form[name="ogoneSubscriptionResultForm"] input[type="text"]').each(function() {
		$(this).val('');
	});
	$('form[name="ogoneSubscriptionResultForm"] input[type="checkbox"]').each(function() {
		$(this).attr("checked", false);
	});
	$('#ogoneSubscriptionResultForm_result_login_value').html('');
	$('#ogoneSubscriptionResultForm_result_password_value').html('');
	// Adding examples values
	ogoneSubscriptionResultForm_phoneHelpBlock_configure();
	ogoneSubscriptionResultForm_changed['prefix'] = false;
	ogoneSubscriptionResultForm_changed['phone'] = false;
	ogoneSubscriptionResultForm_changed['email'] = false;
}

/** Display ogoneSubscriptionResultForm_send_sms_phone_help_block when help link is clicked
 * @param boolean state - Indicate if the block must be displayed or not
 */
function ogoneSubscriptionResultForm_phoneHelpBlock_display(state) {

	var display = false;
	if ( (state == true) || (state == false) ) {
		display = state;
	}
	else if ($('#ogoneSubscriptionResultForm_send_sms_phone_help_block').is(':hidden') == true) {
		display = true;
	}
	if (display == true) {
		$('#ogoneSubscriptionResultForm_send_sms_phone_help_block').show();
	}
	else {
		$('#ogoneSubscriptionResultForm_send_sms_phone_help_block').hide();
	}
}

/** Configure ogoneSubscriptionResultForm_send_sms_phone_help_block
 * @param string displayLang - The language whish to display the content
 */
function ogoneSubscriptionResultForm_phoneHelpBlock_configure(displayLang) {
	if (ogoneSubscriptionResultForm_changed['prefix'] != true) {
		$('#ogoneSubscriptionResultForm_send_sms_phone_prefix_value').val(getInputTranslation("ogoneSubscriptionResultForm_send_sms_phone_prefix_value", displayLang));
	}
	if (ogoneSubscriptionResultForm_changed['phone'] != true) {
		$('#ogoneSubscriptionResultForm_send_sms_phone_phone_value').val(getInputTranslation("ogoneSubscriptionResultForm_send_sms_phone_phone_value", displayLang));
	}
	$('#ogoneSubscriptionResultForm_send_sms_phone_help_prefix_example_value').val(getInputTranslation("ogoneSubscriptionResultForm_send_sms_phone_help_prefix_example_value", displayLang));
	$('#ogoneSubscriptionResultForm_send_sms_phone_help_phone_example_value').val(getInputTranslation("ogoneSubscriptionResultForm_send_sms_phone_help_phone_example_value", displayLang));
}

function ogoneSubscriptionResultFormSend_display(state, mode) {
	var display = false;
	if ( (state == true) || (state == false) ) {
		display = state;
	}
	if (display == true) {
		if (mode == "sms") {
			$('#ogoneSubscriptionResultForm_send_sms_phone_block').show();
		}
		if (mode == "mail") {
			$('#ogoneSubscriptionResultForm_send_email_address_block').show();
		}
		if ($('#ogoneSubscriptionResultForm_send_email_address_block').is(':visible') || $('#ogoneSubscriptionResultForm_send_sms_phone_block').is(':visible')) {
			$('#ogoneSubscriptionResultForm_send_button').show();
		}
	}
	else {
		if (mode == "sms") {
			$('#ogoneSubscriptionResultForm_send_sms_phone_block').hide();
			if ($('#ogoneSubscriptionResultForm_send_email_address_block').length == 0) {
				// Hide if SMS mode only visible on portal
				$('#ogoneSubscriptionResultForm_send_button').hide();
			}
		}
		if (mode == "mail") {
			$('#ogoneSubscriptionResultForm_send_email_address_block').hide();
			if ($('#ogoneSubscriptionResultForm_send_sms_phone_block').length == 0) {
				// Hide if Mail mode only visible on portal
				$('#ogoneSubscriptionResultForm_send_button').hide();
			}
		}
		if ($('#ogoneSubscriptionResultForm_send_email_address_block').is(':hidden') && $('#ogoneSubscriptionResultForm_send_sms_phone_block').is(':hidden')) {
			$('#ogoneSubscriptionResultForm_send_button').hide();
		}
	}
	ogoneSubscriptionResultForm_phoneHelpBlock_display(false);
}

/** Enable waiting mode on ogoneSubscriptionResultForm
 */
function ogoneSubscriptionResultFormWaiting(state) {
	switch (state) {
		case true:
			$('#ogoneSubscriptionResultForm_back_button').attr("disabled", true);
			$('#ogoneSubscriptionResultForm_send_button').attr("disabled", true);
			$('body').toggleClass("cursor-wait");
			break;
		case false:
			$('#ogoneSubscriptionResultForm_back_button').attr("disabled", false);
			$('#ogoneSubscriptionResultForm_send_button').attr("disabled", false);
			$('body').toggleClass("cursor-wait");
			break;
	}
}

function ogoneSubscriptionResultFormSendCredential() {

	var params = new Object();
	var sendMailOption = $('form[name="ogoneSubscriptionResultForm"] input[name="send_mail"]').is(":checked");
	var sendSmsOption = $('form[name="ogoneSubscriptionResultForm"] input[name="send_sms"]').is(":checked");

	params.login = $('form[name="logonForm"] input[name="login"]').val();
	params.password = $('form[name="logonForm"] input[name="password"]').val();

	params.prefix = (ogoneSubscriptionResultForm_changed['prefix'] == true) ? $('form[name="ogoneSubscriptionResultForm"] input[name="prefix"]').val() : "";
	params.phone = (ogoneSubscriptionResultForm_changed['phone'] == true) ? $('form[name="ogoneSubscriptionResultForm"] input[name="phone"]').val() : "";
	params.email = (ogoneSubscriptionResultForm_changed['email'] == true) ? $('form[name="ogoneSubscriptionResultForm"] input[name="email"]').val() : "";

	if ( ($.settings.user != undefined) && ($.settings.user.securePwd != undefined) ) {
		params.securePwd = $.settings.user.securePwd.value;
	}

	var callbacks = new Object();
	callbacks.beforeSend = function() { ogoneSubscriptionResultFormWaiting(true); };
	callbacks.success    = function() { ogoneSubscriptionResultFormSendCredentialCallback(); };
	callbacks.complete   = function() { ogoneSubscriptionResultFormWaiting(false); };

	if ($.settings.subscribe.ogone.sendMail != undefined && $.settings.subscribe.ogone.sendMail.display == true && sendMailOption) {
		params.action = "ogone_send_mail";
		subscriptionSendCredential(callbacks, params);
	}
	if ($.settings.subscribe.ogone.sendSms != undefined && $.settings.subscribe.ogone.sendSms.display == true && sendSmsOption) {
		params.action = "ogone_send_sms";
		subscriptionSendCredential(callbacks, params);
	}
}

function ogoneSubscriptionResultFormSendCredentialCallback() {

	displayErrorInfo();
	if ($.settings.error == undefined) {
		displayStep();
	}
}

/*****************************************************************************/

/** Executed when link is clicked
 */
function ogoneSubscriptionLinkEnable() {

	logonForm_display(false);
	logonFormSubscribeChoice_display(false);
	ogoneSubscriptionForm_display(true);
}

/*****************************************************************************/

/** Manage the modification of inputs and the help texts present on them
 * @param string type - The type on the event (focus | blur )
 * @param element element - The DOM element afected by the modification
 */
function ogoneSubscriptionResultForm_modifyEvent(type, element) {
	switch (type) {
		case 'focus':
			if (ogoneSubscriptionResultForm_changed[element.attr("name")] != true) {
				element.val("");
			}
			break;

		case 'blur':
			if (element.val() == "") {
				element.val(getInputTranslation(element.attr("id")));
				ogoneSubscriptionResultForm_changed[element.attr("name")] = false;
			}
			else {
				ogoneSubscriptionResultForm_changed[element.attr("name")] = true;
			}
			break;
	}
}


/*****************************************************************************/
/****                ogone Payment Form JavaScript functions             ****/
/*****************************************************************************/

/** This function is triggered when the page is loaded
 */
$(document).ready(function() {

	/** Inputs triggers
	 */
	$('form[name="ogonePaymentForm"] select[name="select_package"]').change(function() {
		ogonePaymentForm_packages_describe();
		ogonePaymentFormPay();
	});
	$('form[name="ogonePaymentForm"] select[name="select_package"]').keyup(function() {
		ogonePaymentForm_packages_describe();
		ogonePaymentFormPay();
	});

	/** Buttons triggers
	 */
	$('#ogonePaymentForm_back_button').click(function() {
		ogonePaymentFormRefillBack();
	});
	$('#ogonePaymentForm_disconnect_button').click(function() {
		ogonePaymentFormBack();
	});
	$('#ogonePaymentForm_pay_button').click(function() {
		ogonePaymentFormPay();
	});
	$('#ogonePaymentResultForm_disconnect_button').click(function() {
		ogonePaymentResultForm_disconnect();
	});
	$('#ogonePaymentResultForm_connect_button').click(function() {
		ogonePaymentResultForm_connect();
	});
	/** Form triggers
	 */
	$('form[name="ogonePaymentForm"]').submit(function() {
		return false;
	});
	$('form[name="ogonePaymentResultForm"]').click(function() {
		return false;
	});

	// CHANGED_BY_HH
	// Modified, to display the ogone PAY button (#ogoneSendButton_Fake) right near the DISCONNECT button at one line!
	// In the past, the PAY button was in a seperate seperate form element
	// Which was display downwards the DISCONNECT button
	// The original payment form is now hidden the whole time!
	//
	// Please see also: portal_ogone_payment.tmpl.html (line 37)
	//
	// OLD: $('#ogoneRedirectionForm_pay_button').click(function (){
	$('#ogoneSendButton_Fake').click(function (){
		// Update order status through API
		ogoneRedirectFormPay();
	});
});

/** Configure ogonePaymentForm depending on settings
 */
function ogonePaymentForm_configure() {

	// Configure display
	if ($.settings.subscribe != undefined && $.settings.subscribe.ogone != undefined) {
		// Add packages
		ogonePaymentForm_packages_configure();
	}
	else {
		$('form[name="ogonePaymentForm"]').remove();
		$('form[name="ogonePaymentResultForm"]').remove();
	}
}

function ogonePaymentForm_packages_configure(displayLang) {

	if ($.settings.subscribe != undefined && $.settings.subscribe.ogone != undefined) {
		var ogoneInfos = null;
		var defaultOptionText;
		if ($.settings.subscribe.ogone.package != undefined && ($.settings.payment && $.settings.payment.process == "create")) {
			var ogoneInfos = $.settings.subscribe.ogone.package;
			// Keep default option
			defaultOptionText = $('#ogonePaymentForm_default_package_option').text();
		}
		else if ($.settings.subscribe.ogone.option != undefined && ($.settings.payment && $.settings.payment.process == "create")) {
			var ogoneInfos = $.settings.subscribe.ogone.option;
			defaultOptionText = getTextTranslation('ogoneOptionPaymentForm_default_package_option');
			$('#ogonePaymentForm_select_package_text').text(getTextTranslation('ogoneOptionPaymentForm_select_package_text'));
			$('#ogonePaymentForm_title_text').text(getTextTranslation('ogoneOptionPaymentForm_title_text'));
			$('#ogonePaymentForm_explain_text').text(getTextTranslation('ogoneOptionPaymentForm_explain_text'));
			$('#ogonePaymentForm_package_description_explain').text(getTextTranslation('ogoneOptionPaymentForm_package_description_explain'));
			$('#ogonePaymentForm_package_description_text').text(getTextTranslation('ogoneOptionPaymentForm_package_description_text'));
		}
		else {
			return;
		}

		if (displayLang == undefined) { // No displayLang given, find user selected language, else default portal language else default package language
			if ($.settings != undefined && $.settings.user != undefined && $.settings.user.lang != undefined) {
				displayLang = $.settings.user.lang;
			}
		}

		// update forced disconnectin timer info
		if ( $.settings.subscribe.ogone.connectionProfile != undefined && $.settings.subscribe.ogone.connectionProfile.timeout > 0 ) {
			$('form[name="ogonePaymentForm"] small#ogonePaymentForm_payment_timer_text').show();
			$('form[name="ogonePaymentForm"] small#ogonePaymentForm_payment_timer_value').text(getForcedDisconnectionTimerDisplayText($.settings.subscribe.ogone.connectionProfile.timeout));
		}
		else {
			$('form[name="ogonePaymentForm"] small#ogonePaymentForm_payment_timer_text').hide();
			$('form[name="ogonePaymentForm"] small#ogonePaymentForm_payment_timer_value').text(' ');
		}

		// Empty the select list
		$('form[name="ogonePaymentForm"] select[name="select_package"]').empty();
		$('form[name="ogonePaymentForm"] select[name="select_package"]').append('<option id="ogonePaymentForm_default_package_option" disabled selected value="">' + defaultOptionText + '</option>');
		// Populate list
		$(ogoneInfos).each(function () {
			var package = $(this)[0];
			var text;
			var currencyLanguage;
			if (package[displayLang] != undefined) {
				text = package[displayLang].text;
				currencyLanguage = displayLang;
			}
			else if ($.settings != undefined && $.settings.lang != undefined && $.settings.lang.defaultLang != undefined && package[$.settings.lang.defaultLang] != undefined) {
				text = package[$.settings.lang.defaultLang].text;
				currencyLanguage = $.settings.lang.defaultLang;
			}
			else if (package[package.defaultLang] != undefined) {
				text = package[package.defaultLang].text;
				currencyLanguage = package.defaultLang;
			}
			else {
				text = "";
				currencyLanguage = package.defaultLang;
			}
			// Add price
			if (package['currency'] == "free") {
				text += "&nbsp;" + "(" + getGenericTranslation('free_package', currencyLanguage) + ")";
			}
			else {
				text += "&nbsp;" + "(" + package['price'] + "&nbsp;" + package['currency'] + ")";
			}

			$('form[name="ogonePaymentForm"] select[name="select_package"]').append('<option value="' + package.name + '"' + '>' + text + '</option>');
		});
	}
}

/** Display ogonePaymentForm depending on settings
 * Can be overwritten by state
 * @param boolean state - Indicate if the form must be displayed or not
 */
function ogonePaymentForm_display(state) {

	var display = false;
	if ( (state == true) || (state == false) ) {
		display = state;
	}
	else if ( ($.settings.step != undefined && $.settings.step == "PAYMENT") && ($.settings.type != undefined && $.settings.type == "OGONE") ) {
		display = true;
	}
	if (display == true) {
		if( $.settings.payment.status=="waiting_ogone" || $.settings.payment.status=="verifying"  )
		{
			ogonePaymentForm_display(false);
			if($.settings.payment.status=="verifying")ogonePaymentResultForm_verify();
			if($.settings.payment.status=="waiting_ogone")ogoneSendPaymentForm();
		}
		// otherwise, select package form
		else
		{
			// deal with users already exists otherwise, select package form
			if ($.settings.payment && $.settings.payment.process == 'create' && $.settings.payment.status == 'init' && $.settings.payment.user_exists != undefined && $.settings.payment.user_exists == true) {
				ogonePaymentForm_packages_configure();
				ogonePaymentForm_packages_describe();
			}

			$('form[name="ogonePaymentForm"]').show();

			if ($.settings.payment && $.settings.payment.process == 'refill') {
				$('#ogonePaymentForm_back_button').show();
				$('#ogonePaymentForm_disconnect_button').hide();
			}
			else {
				$('#ogonePaymentForm_disconnect_button').show();
				$('#ogonePaymentForm_back_button').hide();
			}
		}
	}
	else {
		$('form[name="ogonePaymentForm"]').hide();
		$('#ogonePaymentForm_package_description_explain').show();
		$('#ogonePaymentForm_package_description_value').html('');
		ogonePaymentForm_packages_configure();
		ogonePaymentForm_packages_describe();
		// CHANGED_HH
		// hide the "fake" button, instead of the real form
		// $('form[name="ogoneRedirectForm"]').hide();
		$('#ogoneSendButton_Fake').hide();
	}
}

/** Executed when back button is clicked
 */
function ogonePaymentFormBack() {
	var callbacks = new Object();
	// callbacks.beforeSend = function() {}; // TODO
	callbacks.success    = function() { ogonePaymentFormBackCallback(); };
	// callbacks.complete   = function() {}; // TODO
	backAction(callbacks);
}

/** Executed on return of ogonePaymentFormBack function
 */
function ogonePaymentFormBackCallback() {

	if ($.settings != undefined && $.settings.payment != undefined) {
		delete $.settings.payment;
		$.settings.payment = new Object();
	}

	displayErrorInfo();
	displayStep();
}

function ogonePaymentFormRefillBack() {
	var callbacks = new Object();
	// callbacks.beforeSend = function() {}; // TODO
	callbacks.success    = function() { ogonePaymentFormRefillBackCallback(); };
	// callbacks.complete   = function() {}; // TODO
	backAction(callbacks);
}

function ogonePaymentFormRefillBackCallback() {

	if ($.settings != undefined && $.settings.payment != undefined) {
		delete $.settings.payment;
		$.settings.payment = new Object();
	}

	ogonePaymentForm_display(false);
	accountRefillForm_display(true);
	accountRefillForm_options_configure();
	accountRefillForm_options_describe();
}

/** Enable waiting mode on ogonePaymentForm
 */
function ogonePaymentFormWaiting(state) {
	switch (state) {
		case true:
			$('#ogonePaymentForm_back_button').attr("disabled", true);
			$('#ogonePaymentForm_disconnect_button').attr("disabled", true);
			$('#ogonePaymentForm_pay_button').attr("disabled", true);
			$('#ogonePaymentResultForm_disconnect_button').attr("disabled", true);
			$('#ogonePaymentResultForm_connect_button').attr("disabled", true);
			$('body').toggleClass("cursor-wait");
			break;
		case false:
			$('#ogonePaymentForm_back_button').attr("disabled", false);
			$('#ogonePaymentForm_disconnect_button').attr("disabled", false);
			$('#ogonePaymentForm_pay_button').attr("disabled", false);
			$('#ogonePaymentResultForm_disconnect_button').attr("disabled", false);
			$('#ogonePaymentResultForm_connect_button').attr("disabled", false);
			$('body').toggleClass("cursor-wait");
			break;
	}
}

/** Executed when pay button is clicked
 */
function ogonePaymentFormPay() {

	var params = new Object();

	params.package = $('form[name="ogonePaymentForm"] select[name="select_package"]').val();

	params.login = $.settings.payment.login;
	if (($.settings.user != undefined) && ($.settings.user.securePwd != undefined)) {
		params.securePwd = $.settings.user.securePwd.value;
	}
	var callbacks = new Object();
	callbacks.beforeSend = function() { ogonePaymentFormWaiting(true); };
	callbacks.success    = function() { ogonePaymentFormPayCallback(); };
	callbacks.complete   = function() { ogonePaymentFormWaiting(false); };
	selectOgonePackage(callbacks, params);
}

/** Executed on return of ogonePaymentFormPay function
 */
function ogonePaymentFormPayCallback() {
	displayErrorInfo();
	if($.settings.error == undefined)
	{
		// CHANGED_HH
		// show the "fake" button, instead of the real form
		// $('form[name="ogoneRedirectForm"]').show();
		$('#ogoneSendButton_Fake').show();
	}
	else
	{
		// CHANGED_HH
		// hide the "fake" button, instead of the real form
		// $('form[name="ogoneRedirectForm"]').hide();
		$('#ogoneSendButton_Fake').hide();
	}
}

/* Fill and send Ogone payment infos */

function ogoneSendPaymentForm()
{
	displayWaitingIcon(true);
	$('form[name="ogoneRedirectForm"]').attr('action', $.settings.payment.ogoneUrlPost);
	$('form[name="ogoneRedirectForm"] input[name="PSPID"]').val($.settings.payment.pspid);
	$('form[name="ogoneRedirectForm"] input[name="USERID"]').val($.settings.payment.userid);
	$('form[name="ogoneRedirectForm"] input[name="PSWD"]').val($.settings.payment.userpassword);
	$('form[name="ogoneRedirectForm"] input[name="ORDERID"]').val($.settings.payment.orderid);
	$('form[name="ogoneRedirectForm"] input[name="AMOUNT"]').val($.settings.payment.amount);
	$('form[name="ogoneRedirectForm"] input[name="CURRENCY"]').val($.settings.payment.currency);
	$('form[name="ogoneRedirectForm"] input[name="LANGUAGE"]').val($.settings.payment.language);
	$('form[name="ogoneRedirectForm"] input[name="SHASIGN"]').val($.settings.payment.shasign);
	$('form[name="ogoneRedirectForm"] input[name="ACCEPTURL"]').val($.settings.payment.portal_url);
	$('form[name="ogoneRedirectForm"] input[name="DECLINEURL"]').val($.settings.payment.portal_url);
	$('form[name="ogoneRedirectForm"] input[name="EXCEPTIONURL"]').val($.settings.payment.portal_url);
	$('form[name="ogoneRedirectForm"] input[name="CANCELURL"]').val($.settings.payment.portal_url);
	$('form[name="ogoneRedirectForm"]').submit();
}


/** Executed on return of ogonePaymentFormPay function
 */
function ogoneRedirectFormPayCallback() {

	if ($.settings.error == undefined) {
		ogonePaymentForm_display(false);
		displayStep();
	}
	displayErrorInfo();

}

/** Executed on return of ogonePaymentFormPay function
 */
function ogoneRedirectFormPay()
{
	var params = new Object();
	params.orderid = $('form[name="ogoneRedirectForm"] input[name="ORDERID"]').val();
	params.login = $.settings.payment.login;
	if ( ($.settings.user != undefined) && ($.settings.user.securePwd != undefined) ) {
		params.securePwd = $.settings.user.securePwd.value;
	}
	var callbacks = new Object();
	callbacks.beforeSend = function() { ogonePaymentFormWaiting(true); };
	callbacks.success    = function() { ogoneRedirectFormPayCallback(); };
	callbacks.complete = function (){
		// CHANGED_BY_HH
		// added a little timeout (2sec.)
		// This is done, to show the fullscreen waiting overlay a bit longer
		// So we get a uninterrupted animation, till the ogone website is displayed
		setTimeout(function (){
		    ogonePaymentFormWaiting(false);
		}, 2000);
	    };

	ogoneSubmitPayment(callbacks, params);
}


function ogonePaymentForm_packages_describe(displayLang) {

	if ($.settings.subscribe != undefined && $.settings.subscribe.ogone != undefined) {
		 var ogoneInfos = null;
		 if ($.settings.subscribe.ogone.package != undefined && ($.settings.payment && $.settings.payment.process == "create")) {
			 var ogoneInfos = $.settings.subscribe.ogone.package;
		 }
		 else if ($.settings.subscribe.ogone.option != undefined && ($.settings.payment && $.settings.payment.process == "create")) {
			 var ogoneInfos = $.settings.subscribe.ogone.option;
		 }
		 else {
			 return;
		 }

		if (displayLang == undefined) { // No displayLang given, find user selected language, else default portal language else default package language
			if ($.settings != undefined && $.settings.user != undefined && $.settings.user.lang != undefined) {
				displayLang = $.settings.user.lang;
			}
		}
		// Update describe block
		if ($('form[name="ogonePaymentForm"] select[name="select_package"]').val() == "") {
			$('#ogonePaymentForm_package_description_explain').show();
			$('#ogonePaymentForm_package_description_value').html("");
		}
		else {
			$(ogoneInfos).each(function () {
				var package = $(this)[0];
				if (package.name == $('form[name="ogonePaymentForm"] select[name="select_package"]').val()) {
					var describe;
					if (package[displayLang] != undefined) {
						describe = package[displayLang].description;
					}
					else if ($.settings != undefined && $.settings.lang != undefined && $.settings.lang.defaultLang != undefined && package[$.settings.lang.defaultLang] != undefined) {
						describe = package[$.settings.lang.defaultLang].description;
					}
					else if (package[package.defaultLang] != undefined) {
						describe = package[package.defaultLang].description;
					}

					if (describe == undefined) {
						describe = getTextTranslation('accountRefillForm_no_description');
					}

					$('#ogonePaymentForm_package_description_explain').hide();
					$('#ogonePaymentForm_package_description_value').html(describe);
				}
			});
		}
	}
}

function ogonePaymentForm_options_describe() {

	var displayLang = $.settings.user.lang;
	var ogoneInfos = $.settings.subscribe.ogone.refill;
	var package = null;
	var describe;
	var text;
	var currencyLanguage;
	$('#ogonePaymentForm_select_package_text').text(getTextTranslation('accountRefillForm_option_buyed_text'));
	$('#ogonePaymentForm_title_text').text(getTextTranslation('ogoneOptionPaymentForm_title_text'));
	$('#ogonePaymentForm_explain_text').text(getTextTranslation('ogoneOptionPaymentForm_refill_text'));
	$('#ogonePaymentForm_package_description_explain').text(getTextTranslation('ogoneOptionPaymentForm_package_description_explain'));
	$('#ogonePaymentForm_package_description_text').text(getTextTranslation('ogoneOptionPaymentForm_package_description_text'));

	$(ogoneInfos).each(function () {
		var package = $(this)[0];

		// if (package.name == $('form[name="ogonePaymentForm"] select[name="select_package"]').val()) {
		if (package.name == $.settings.payment.package) {

			if (package[displayLang] != undefined) {
				text             = package[displayLang].text;
				currencyLanguage = displayLang;
				describe         = package[displayLang].description;
			}
			else if ($.settings != undefined && $.settings.lang != undefined && $.settings.lang.defaultLang != undefined && package[$.settings.lang.defaultLang] != undefined) {
				text             = package[$.settings.lang.defaultLang].text;
				currencyLanguage = $.settings.lang.defaultLang;
				describe         = package[$.settings.lang.defaultLang].description;
			}
			else if (package[package.defaultLang] != undefined) {
				text             = package[package.defaultLang].text;
				currencyLanguage = package.defaultLang;
				describe         = package[package.defaultLang].description;
			}
			else {
				text             = "";
				currencyLanguage = package.defaultLang;
			}

			if (describe == undefined) {
				describe = getTextTranslation('accountRefillForm_no_description');
			}

			// Add price
			if (package['currency'] == "free") {
				text += "&nbsp;" + "(" + getGenericTranslation('free_package', currencyLanguage) + ")";
			}
			else {
				text += "&nbsp;" + "(" + package['price'] + "&nbsp;" + package['currency'] + ")";
			}
			$('#ogonePaymentForm_package_description_explain').hide();
			$('#ogone_select_list').hide();
			$('#ogonePaymentForm_package_description_value').html(describe);
			$('#ogonePaymentForm_payment_detail_value').html(text);
		}
	});

	if($.settings.error == undefined)
	{
		$('form[name="ogoneRedirectForm"]').show();
		$('#ogoneSendButton_Fake').show();
	}
}

/** Display ogonePaymentResultForm (Usualy Triggered when pay button clicked)
 * @param boolean state - Indicate if the results must be displayed or not
 */
function ogonePaymentResultForm_display(state) {

	var display = false;
	if ( (state == true) || (state == false) ) {
		display = state;
	}
	if (display == true) {
		$('form[name="ogonePaymentResultForm"]').show();
		displayWaitingIcon(false);
		if($.settings.payment.status=="completed")
		{
			displayErrorInfo();
			$("#ogonePaymentResultForm_payment_timer_text").hide();
			if ($.settings.payment.process == "create") {
				$("#ogonePaymentResultForm_connect_button").show();
			}
			else if ($.settings.payment.process == "refill") {
				$('form[name="ogonePaymentForm"]').remove();
				$('form[name="ogonePaymentResultForm"]').remove();
				accountRefillForm_paymentValidate();
			}
			else {
				displayErrorInfo();
				$("#ogonePaymentResultForm_connect_button").hide();
				if ($.settings.user.paymentTimer != undefined && $.settings.user.paymentTimer.value != undefined) {
					$("#ogonePaymentResultForm_payment_timer_text").show();
					$.settings.user.paymentTimer.value = 10;
					ogonePaymentResultForm_payment_timer_start();
				}
			}
		}
	}
	else {
		$('form[name="ogonePaymentResultForm"]').hide();
	}

	if (($.settings.subscribe.ogone.option != undefined) || ($.settings.subscribe.ogone.refill != undefined)){
		$('#ogoneSubscriptionResultForm_back_button').text(getTextTranslation('ogoneOptionSubscriptionResultForm_back_button'));
	}
}

/** Executed when comming back from Ogone paymen website
 */
function ogonePaymentResultForm_verify() {
	if ($.settings.payment != undefined) {
		var params = new Object();
		var callbacks = new Object();
		params.login = $.settings.payment.login;
		params.policyAccept = $.settings.payment.policyAccept;

		callbacks.beforeSend = function() { ogonePaymentFormWaiting(true); };
		callbacks.success    = function() { ogonePaymentResultForm_display(true); };
		callbacks.complete   = function() { ogonePaymentFormWaiting(false); };
		displayWaitingIcon(true);
		verifyPayment(callbacks,params);
	}
	else {

		displayStep();
	}
}


/** Executed when connect button is clicked
 */
function ogonePaymentResultForm_connect() {
	if($.settings.error == undefined)
	{
		// user payed, follow auto connect link
		ogonePaymentResultForm_payment_timer_stop();
		delete $.settings.user.paymentTimer;
		if($.settings.payment.status=="completed")
		{
			ogonePaymentResultForm_display(false);
			window.location = $.settings.payment.a_connect_link;
		}
		else {
			ogonePaymentResultForm_disconnect();
		}
	}
	else
	{
		ogonePaymentResultForm_disconnect();
		displayErrorInfo();
	}
}

/** Executed on return of authenticate shortcut for ogone package choice
 */
function ogonePaymentResultFormConnectCallback() {
	if($.settings.error == undefined)
	{
		// user payed, autoconnect
		ogonePaymentResultForm_payment_timer_stop();
		delete $.settings.user.paymentTimer;
		window.location = $.settings.payment.a_connect_link;
	}
	else
	{
		displayErrorInfo();
	}
}

/** Executed when disconnect button is clicked
 */
function ogonePaymentResultForm_disconnect() {
	ogonePaymentResultForm_payment_timer_stop();
	ogonePaymentResultForm_display(false);
	delete $.settings.user.paymentTimer;
	if($.settings.user.isConnected)
		feedbackFormDisconnect();
	else
		ogonePaymentFormBack();

}


function ogonePaymentResultForm_payment_timer_start() {
	if($.settings.user.paymentTimer != undefined && $.settings.user.paymentTimer.value != undefined) {
			if (timerObj.paymentTimer == undefined) {
				timerObj.paymentTimer = new Array();
				timerObj.paymentTimer.refreshInterval = 1000;
				timerObj.paymentTimer.value = $.settings.user.paymentTimer.value;
				timerObj.paymentTimer.resource = window.setInterval(function() { ogonePaymentResultForm_payment_timer_display();}, timerObj.paymentTimer.refreshInterval);

			}
	}
}


function ogonePaymentResultForm_payment_timer_stop() {
	$('#ogonePaymentResultForm_payment_timer').text('-');
	if (timerObj.paymentTimer != undefined && timerObj.paymentTimer.resource != undefined) {
		window.clearInterval(timerObj.paymentTimer.resource);
		delete timerObj.paymentTimer;
	}
}

function ogonePaymentResultForm_payment_timer_display() {
	if (timerObj.paymentTimer != undefined && timerObj.paymentTimer.value != undefined) {
		timerObj.paymentTimer.value--;
		if (timerObj.paymentTimer.value > 0) {
			var hours = Math.floor(timerObj.paymentTimer.value / 3600);
			var mins = Math.floor((timerObj.paymentTimer.value - (hours * 3600)) / 60);
			var seconds = timerObj.paymentTimer.value - (hours * 3600) - (mins * 60);

			var hours_label = getGenericTranslation('hour', null, (hours > 1));
			var mins_label = getGenericTranslation('minute', null, (mins > 1));
			var seconds_label = getGenericTranslation('second', null, (seconds > 1));

			if( hours > 0 )
			{
				$('#ogonePaymentResultForm_payment_timer_value').text($.sprintf(getGenericTranslation('feedbackForm_time-credit-with-seconds'), hours, hours_label, mins, mins_label,
												seconds, seconds_label));
			}
			else
			{
				$('#ogonePaymentResultForm_payment_timer_value').text($.sprintf(getGenericTranslation('feedbackForm_time-credit-without-hours'), mins, mins_label, seconds, seconds_label));
			}
		}
		else {
			ogonePaymentResultForm_disconnect();
		}
	}
}

/*****************************************************************************/
/****                 PMS Payment Form JavaScript functions               ****/
/*****************************************************************************/

/** This function is triggered when the page is loaded
 */
$(document).ready(function (){

    /** Inputs triggers
     */
    $('form[name="pmsPaymentForm"] select[name="select_package"]').change(function (){
        pmsPaymentForm_packages_describe();
    });
    $('form[name="pmsPaymentForm"] select[name="select_package"]').keyup(function (){
        pmsPaymentForm_packages_describe();
    });

    /** Buttons triggers
     */
    $('#pmsPaymentForm_cancel_button').click(function (){
        pmsPaymentForm_display(false);
        $.settings.step = "FEEDBACK";
        manageAccountForm_display(true);
    });

    $('#pmsPaymentForm_disconnect_button').click(function (){
        pmsPaymentFormBack();
    });

    $('#pmsPaymentForm_pay_button').click(function (){
        pmsPaymentFormPay();
    });

    /** Form triggers
     */
    $('form[name="pmsPaymentForm"]').submit(function (){
        return false;
    });
});

/** Configure pmsPaymentForm depending on settings
 */
function pmsPaymentForm_configure(){

    // Configure display
    if ( $.settings.subscribe != undefined && $.settings.subscribe.pms != undefined ) {
        // Add packages
        pmsPaymentForm_packages_configure();
    }
    else {
        $('form[name="pmsPaymentForm"]').remove();
    }
}


function pmsPaymentForm_packages_configure( displayLang ){
	if ($.settings.subscribe != undefined && $.settings.subscribe.pms != undefined) {

		var pmsInfos = null;
		var defaultOptionText;

		// Depending on portal configuration, select package or option => works for both 5.1 and 5.2 versions
		if ($.settings.subscribe.pms.package != undefined) {
			if ($.settings.subscribe.pms.package != undefined) {
				pmsInfos = $.settings.subscribe.pms.package;
				// Keep default option
				defaultOptionText = $('#pmsPaymentForm_default_package_option').text();
			}
		}
		else if ($.settings.subscribe.pms.option != undefined) {
			pmsInfos = $.settings.subscribe.pms.option;
			defaultOptionText = getTextTranslation('pmsOptionPaymentForm_default_package_option');
			$('#pmsPaymentForm_select_package_text').text(getTextTranslation('pmsOptionPaymentForm_select_package_text'));
			$('#pmsPaymentForm_title_text').text(getTextTranslation('pmsOptionPaymentForm_title_text'));
			$('#pmsPaymentForm_explain_text').text(getTextTranslation('pmsOptionPaymentForm_explain_text'));
			$('#pmsPaymentForm_package_description_explain').text(getTextTranslation('pmsOptionPaymentForm_package_description_explain'));
			$('#pmsPaymentForm_package_description_text').text(getTextTranslation('pmsOptionPaymentForm_package_description_text'));
		}
		else {
			return;
		}

		if (displayLang == undefined) { // No displayLang given, find user selected language, else default portal language else default package language
			if ($.settings != undefined && $.settings.user != undefined && $.settings.user.lang != undefined) {
				displayLang = $.settings.user.lang;
			}
		}

		// Empty the select list
		$('form[name="pmsPaymentForm"] select[name="select_package"]').empty();
		$('form[name="pmsPaymentForm"] select[name="select_package"]').append('<option id="pmsPaymentForm_default_package_option" disabled selected value="">' + defaultOptionText + '</option>');
		// Populate list
		$(pmsInfos).each(function () {
			var package = $(this)[0];
			var text;
			var currencyLanguage;
			if (package[displayLang] != undefined) {
				text = package[displayLang].text;
				currencyLanguage = displayLang;
			}
			else if ($.settings != undefined && $.settings.lang != undefined && $.settings.lang.defaultLang != undefined && package[$.settings.lang.defaultLang] != undefined) {
				text = package[$.settings.lang.defaultLang].text;
				currencyLanguage = $.settings.lang.defaultLang;
			}
			else if (package[package.defaultLang] != undefined) {
				text = package[package.defaultLang].text;
				currencyLanguage = package.defaultLang;
			}
			else {
				text = "";
				currencyLanguage = package.defaultLang;
			}

			// Add price
			if (package['currency'] == "free") {
				text += "&nbsp;" + "(" + getGenericTranslation('free_package', currencyLanguage) + ")";
			}
			else {
				text += "&nbsp;" + "(" + package['price'] + "&nbsp;" + package['currency'] + ")";
			}
			$('form[name="pmsPaymentForm"] select[name="select_package"]').append('<option value="' + package.name + '">' + text + '</option>');
		});
	}
}

/** Display pmsPaymentForm depending on settings
 * Can be overwritten by state
 * @param boolean state - Indicate if the form must be displayed or not
 */
function pmsPaymentForm_display( state ){

    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }
    else if ( ($.settings.step != undefined && $.settings.step == "PAYMENT") && ($.settings.type != undefined && $.settings.type == "PMS") ) {
        display = true;
    }

    if ( display == true ) {
        $('form[name="pmsPaymentForm"]').show();
        if ( ($.settings.user.allowmodifypackage == true ) && (switch_package == true) ) {
            pmsPaymentForm_cancel_button_show_hide(true);

        } else {
            pmsPaymentForm_cancel_button_show_hide(false);
        }

		if ( ($.settings.user.PMS != undefined) && ($.settings.user.PMS.session_has_expired != undefined) && ($.settings.user.PMS.session_has_expired == true ) ) {
            $('#pmsPaymentForm_missingInfo_block').show();

		} else {
            $('#pmsPaymentForm_missingInfo_block').hide();
		}
    }
    else {
        $('form[name="pmsPaymentForm"]').hide();
        pmsPaymentForm_packages_configure();
        pmsPaymentForm_packages_describe();
    }
}

/** Executed when back button is clicked
 */
function pmsPaymentFormBack(){

    var callbacks = new Object();
    // callbacks.beforeSend = function() {}; // TODO
    callbacks.success = function (){
        pmsPaymentFormBackCallback();
    };
    // callbacks.complete   = function() {}; // TODO

    backAction(callbacks);
}

/** Executed on return of pmsPaymentFormBack function
 */
function pmsPaymentFormBackCallback(){

    displayErrorInfo();
    displayStep();
}

function pmsPaymentForm_cancel_button_show_hide( state ){
    switch ( state ) {
        case true:
            $('#pmsPaymentForm_cancel_button').show();
            $('#pmsPaymentForm_disconnect_button').hide();
            $('#pmsPaymentForm_caution_block').show();
            break;
        case false:
            $('#pmsPaymentForm_cancel_button').hide();
            $('#pmsPaymentForm_disconnect_button').show();
            $('#pmsPaymentForm_caution_block').hide();
            break;
    }
}

/** Enable waiting mode on pmsPaymentForm
 */
function pmsPaymentFormWaiting( state ){
    switch ( state ) {
        case true:
            $('#pmsPaymentForm_disconnect_button').attr("disabled", true);
            $('#pmsPaymentForm_pay_button').attr("disabled", true);
            $('body').toggleClass("cursor-wait");
            break;
        case false:
            $('#pmsPaymentForm_disconnect_button').attr("disabled", false);
            $('#pmsPaymentForm_pay_button').attr("disabled", false);
            $('body').toggleClass("cursor-wait");
            break;
    }
}


/** Executed when pay button is clicked
 */
function pmsPaymentFormPay(){

    var params = new Object();
    params.package = $('form[name="pmsPaymentForm"] select[name="select_package"]').val();

    if ( ($.settings.user != undefined) && ($.settings.user.securePwd != undefined) ) {
        params.securePwd = $.settings.user.securePwd.value;
    }

	if ( ($.settings.user != undefined) && ($.settings.user.password == undefined) ) {
		params.password   = $('form[name = "pmsPaymentForm"] input[name = "password"]').val();
	}

    var callbacks = new Object();
    callbacks.beforeSend = function (){
        pmsPaymentFormWaiting(true);
    };
    callbacks.success = function (){
        pmsPaymentFormPayCallback();
    };
    callbacks.complete = function (){
        pmsPaymentFormWaiting(false);
    };

    selectPmsPackage(callbacks, params);
}

/** Executed on return of pmsPaymentFormPay function
 */
function pmsPaymentFormPayCallback(){

    displayErrorInfo();
    if ( $.settings.error == undefined ) {
        if ( $.settings.payment != undefined ) {
            var params = new Object();
            params.login = $.settings.payment.login;
			params.policyAccept = $.settings.payment.policyAccept;
			params.privatePolicyAccept = $.settings.payment.privatePolicyAccept;

			if ($.settings.payment.option != undefined) {
				params.option = $.settings.payment.option;
			}

            if ( ($.settings.user.allowmodifypackage != undefined) && ($.settings.user.allowmodifypackage == true) && (switch_package == true) ) {
                params.lastProfile = $.settings.payment.lastProfile;
                params.switchPackage = switch_package;
            }

            if ( ($.settings.user != undefined) && ($.settings.user.securePwd != undefined) ) {
                params.securePwd = $.settings.user.securePwd.value;
            }

            var callbacks = new Object();
            callbacks.beforeSend = function (){
                pmsPaymentFormWaiting(true);
            };
            callbacks.success = function (){
                pmsPaymentFormConnectCallback();
            };
            callbacks.complete = function (){
                pmsPaymentFormWaiting(false);
            };
            authenticate(callbacks, params)
        }
        else {
            displayStep();
        }
    }
}

/** Executed on return of authenticate shortcut for PMS package choice
 */
function pmsPaymentFormConnectCallback(){
    switch_package = false;
    if ( $.settings.error == undefined ) {
        logonFormConnectCallback();
    }
    else {
        $.settings.step = "LOGON";
        displayErrorInfo();
        displayStep();
    }
}

function pmsPaymentForm_packages_describe( displayLang ){
	if ($.settings.subscribe != undefined && $.settings.subscribe.pms != undefined) {

		var pmsInfos = null;

		// Depending on portal configuration, select package or option => works for both 5.1 and 5.2 versions
		if ($.settings.subscribe.pms.package != undefined) {
			 var pmsInfos = $.settings.subscribe.pms.package;
		}
		else if ($.settings.subscribe.pms.option != undefined) {
			 var pmsInfos = $.settings.subscribe.pms.option;
		}
		else {
			return;
		}

		if (displayLang == undefined) { // No displayLang given, find user selected language, else default portal language else default package language
			if ($.settings != undefined && $.settings.user != undefined && $.settings.user.lang != undefined) {
				displayLang = $.settings.user.lang;
			}
		}
		// Update describe block
		if ($('form[name="pmsPaymentForm"] select[name="select_package"]').val() == "") {
			$('#pmsPaymentForm_explain_text').show();
			$('#pmsPaymentForm_package_description_explain').show();
			$('#pmsPaymentForm_package_description_value').html("");
		}
		else {
			$(pmsInfos).each(function () {
				var package = $(this)[0];
				if (package.name == $('form[name="pmsPaymentForm"] select[name="select_package"]').val()) {
					var describe;
					if (package[displayLang] != undefined) {
						describe = package[displayLang].description;
					}
					else if ($.settings != undefined && $.settings.lang != undefined && $.settings.lang.defaultLang != undefined && package[$.settings.lang.defaultLang] != undefined) {
						describe = package[$.settings.lang.defaultLang].description;
					}
					else if (package[package.defaultLang] != undefined) {
						describe = package[package.defaultLang].description;
					}
					else {
						describe = getTextTranslation('accountRefillForm_no_description');
					}

					if (describe == undefined || describe == null) {
						describe = getTextTranslation('accountRefillForm_no_description');
					}

					$('#pmsPaymentForm_explain_text').hide();
					$('#pmsPaymentForm_package_description_explain').hide();
					$('#pmsPaymentForm_package_description_value').html(describe);
				}
			});
		}
	}
}

function pmsPaymentForm_options_describe() {

	var displayLang = $.settings.user.lang;
	var pmsInfos = $.settings.subscribe.pms.refill;
	var package = null;
	var describe;
	var text;
	var currencyLanguage;
	$('#pmsPaymentForm_select_package_text').text(getTextTranslation('accountRefillForm_option_buyed_text'));
	$('#pmsPaymentForm_title_text').text(getTextTranslation('pmsOptionPaymentForm_title_text'));
	$('#pmsPaymentForm_explain_text').text(getTextTranslation('pmsOptionPaymentForm_refill_text'));
	$('#pmsPaymentForm_package_description_explain').text(getTextTranslation('pmsOptionPaymentForm_package_description_explain'));
	$('#pmsPaymentForm_package_description_text').text(getTextTranslation('pmsOptionPaymentForm_package_description_text'));

	$(pmsInfos).each(function () {
		var package = $(this)[0];

		// if (package.name == $('form[name="pmsPaymentForm"] select[name="select_package"]').val()) {
		if (package.name == $.settings.payment.package) {

			if (package[displayLang] != undefined) {
				text             = package[displayLang].text;
				currencyLanguage = displayLang;
				describe         = package[displayLang].description;
			}
			else if ($.settings != undefined && $.settings.lang != undefined && $.settings.lang.defaultLang != undefined && package[$.settings.lang.defaultLang] != undefined) {
				text             = package[$.settings.lang.defaultLang].text;
				currencyLanguage = $.settings.lang.defaultLang;
				describe         = package[$.settings.lang.defaultLang].description;
			}
			else if (package[package.defaultLang] != undefined) {
				text             = package[package.defaultLang].text;
				currencyLanguage = package.defaultLang;
				describe         = package[package.defaultLang].description;
			}
			else {
				text             = "";
				currencyLanguage = package.defaultLang;
			}

			if (describe == undefined || describe == null) {
				describe = getTextTranslation('accountRefillForm_no_description');
			}

			// Add price
			if (package['currency'] == "free") {
				text += "&nbsp;" + "(" + getGenericTranslation('free_package', currencyLanguage) + ")";
			}
			else {
				text += "&nbsp;" + "(" + package['price'] + "&nbsp;" + package['currency'] + ")";
			}
			$('#pmsPaymentForm_explain_text').hide();
			$('#pmsPaymentForm_package_description_explain').hide();
			$('#pms_select_list').hide();
			$('#pmsPaymentForm_package_description_value').html(describe);
			$('#pmsPaymentForm_payment_detail_value').html(text);
		}
	});

	if($.settings.error == undefined)
	{
		$('form[name="pmsRedirectForm"]').show();
	}
}

/*****************************************************************************/
/****              PPS Subscription Form JavaScript functions             ****/
/*****************************************************************************/

/** This function is triggered when the page is loaded
 */
$(document).ready(function (){

    /** Inputs triggers
     */
// 	$('form[name=ppsSubscriptionForm] input[name=scratch_code]').change(function() {
// 		///
// 	});
// 	
// 	$('form[name=ppsSubscriptionForm] input[name=captcha_code]').change(function() {
// 		///
// 	});
// 	
// 	$('form[name=ppsSubscriptionForm] input[name=policy_accept]').change(function() {
// 		///
// 	});

    /** Buttons triggers
     */
    $('#ppsSubscriptionForm_connect_button').click(function (){
        ppsSubscriptionFormSubscribe();
    });

    /** Form triggers
     */
    $('form[name="ppsSubscriptionForm"]').submit(function (){
        return false;
    });
});


/** Configure ppsSubscriptionForm depending on settings
 */
function ppsSubscriptionForm_configure(){

    // Configure display
    if ( $.settings.subscribe != undefined && $.settings.subscribe.pps != undefined ) {
        // Add captcha source to avoid generating this if PPS mode not enable
        $('#ppsSubscriptionForm_captcha_code_img').attr("src", "/_INC/gen_random_img.php?#");
        $('#ppsSubscriptionForm_captcha_code_img').fadeIn();

        if ( $.settings.subscribe.pps.policy != undefined && $.settings.subscribe.pps.policy.display == true ) {
            ppsSubscriptionForm_policy_configure();
        }
        else {
            $('#ppsSubscriptionForm_policy_block').remove();
        }
    }
    else {
        $('form[name="ppsSubscriptionForm"]').remove();
    }
}

/** Configure ppsSubscriptionForm_policy_block
 * @param string lang - The language whish to display the policy
 */
function ppsSubscriptionForm_policy_configure( displayLang ){

    if ( $.settings.subscribe != undefined && $.settings.subscribe.pps != undefined && $.settings.subscribe.pps.policy != undefined ) {
        var policy = extractPolicyText($.settings.subscribe.pps, displayLang);
        $('#ppsSubscriptionForm_policy_text').html(policy);
    }
    /* TODO configure back_action portal_api call and add GUI in template html if we need support other portals when PPS is set */
}

/** Display ppsSubscriptionForm depending on settings
 * Can be overwritten by state
 * @param boolean state - Indicate if the form must be displayed or not
 */
function ppsSubscriptionForm_display( state ){

    var display = false;
    if ( (state == true) || (state == false) ) {
        display = state;
    }
    else if ( ($.settings.step != undefined && $.settings.step == "SUBSCRIBE") && ($.settings.type != undefined && $.settings.type == "PPS") ) {
        display = true;
    }

    if ( display == true ) {
        $('form[name="ppsSubscriptionForm"]').show();
    }
    else {
        $('form[name="ppsSubscriptionForm"]').hide();
        ppsSubscriptionForm_empty();
    }
}

/** Empty ppsSubscriptionForm
 */
function ppsSubscriptionForm_empty(){
    $('form[name="ppsSubscriptionForm"] input[type="text"]').each(function (){
        $(this).val('');
    });
    $('form[name="ppsSubscriptionForm"] input[type="checkbox"]').each(function (){
        $(this).attr("checked", false);
    });
}

/** Enable waiting mode on ppsSubscriptionForm
 */
function ppsSubscriptionFormWaiting( state ){
    switch ( state ) {
        case true:
            $('#ppsSubscriptionForm_connect_button').attr("disabled", true);
            $('body').toggleClass("cursor-wait");
            break;
        case false:
            $('#ppsSubscriptionForm_connect_button').attr("disabled", false);
            $('body').toggleClass("cursor-wait");
            break;
    }
}

/** Executed when button is clicked
 */
function ppsSubscriptionFormSubscribe(){

    var params = new Object();
    // Mandatory parameters
    params.type = "pps";
    params.scratchCode = $('form[name="ppsSubscriptionForm"] input[name="scratch_code"]').val();
    params.captchaCode = $('form[name="ppsSubscriptionForm"] input[name="captcha_code"]').val();
    params.policyAccept = $('#ppsSubscriptionForm_policy_accept').is(':checked');

    if ( ($.settings.user != undefined) && ($.settings.user.securePwd != undefined) ) {
        params.securePwd = $.settings.user.securePwd.value;
    }

    var callbacks = new Object();
    callbacks.beforeSend = function (){
        ppsSubscriptionFormWaiting(true);
    };
    callbacks.success = function (){
        ppsSubscriptionFormSubscribeCallback();
    };
    callbacks.complete = function (){
        ppsSubscriptionFormWaiting(false);
    };

    subscribe(callbacks, params);
}

/** Executed on return of ppsSubscriptionFormSubscribe function
 */
function ppsSubscriptionFormSubscribeCallback(){

    displayErrorInfo();
    if ( $.settings.error == undefined ) {
        var params = new Object();
        params.login = $.settings.user.login;
        params.password = $.settings.user.password;
        params.policyAccept = $('#ppsSubscriptionForm_policy_accept').is(':checked');

        if ( ($.settings.user != undefined) && ($.settings.user.securePwd != undefined) ) {
            params.securePwd = $.settings.user.securePwd.value;
        }

        // We authenticate the user
        var callbacks = new Object();
        callbacks.beforeSend = function (){
            ppsSubscriptionFormWaiting(true);
        };
        callbacks.success = function (){
            ppsSubscriptionFormConnectCallback();
        };
        callbacks.complete = function (){
            ppsSubscriptionFormWaiting(false);
        };

        authenticate(callbacks, params);
    }
}

/** Executed on ppsSubscriptionFormSubscribeCallback function
 */
function ppsSubscriptionFormConnectCallback(){

    displayErrorInfo();
    if ( $.settings.error == undefined ) {
        displayStep();

        if ( $.settings.step == "FEEDBACK" ) {
            // We must refresh the user connection
            refreshObj.login = $.settings.user.login.value;
            refreshObj.refreshInterval = ($.settings.refreshInterval == undefined) ? 50000 : $.settings.refreshInterval;

            if ( ($.settings.user != undefined) && ($.settings.user.securePwd != undefined) ) {
                refreshObj.securePwd = $.settings.user.securePwd.value;
            }
            startRefresh();
        }
    }
}

/*****************************************************************************/
/****            Subscription Form JavaScript functions            ****/
/*****************************************************************************/

/** Listen to modified element
 */
var subscriptionForm_changed = new Object();

/** This function is triggered when the page is loaded
 */
$(document).ready(function () {
	$('#common_subscription_fields').prependTo('#reserved_block');
	$('#common_subscription_fields').hide();

	$('#subscriptionForm_phone_prefix_value').focus(function () {
		subscriptionForm_modifyEvent('focus', $(this));
		subscriptionForm_phoneHelpBlock_display(true);
	});

	$('#subscriptionForm_phone_prefix_value').blur(function () {
		subscriptionForm_modifyEvent('blur', $(this));
	});

	$('#subscriptionForm_phone_phone_value').focus(function () {
		subscriptionForm_modifyEvent('focus', $(this));
		subscriptionForm_phoneHelpBlock_display(true);
	});

	$('#subscriptionForm_phone_phone_value').blur(function () {
		subscriptionForm_modifyEvent('blur', $(this));
	});

	$('#subscriptionForm_phone_help_link').click(function () {
		subscriptionForm_phoneHelpBlock_display();
	});
});

/** Configure subscriptionForm common fields depending on settings
 */
function subscriptionForm_configure(mode) {
	var subscription_mode = null;
	var mandatory_bool = false;
	var policyNew = ($.settings.private_policy != undefined) ? $.settings.private_policy[0] : undefined;
	try {
		subscription_mode = eval('$.settings.subscribe.' + mode);
	} catch (ex) {
		subscription_mode = null;
	}

	if (subscription_mode == undefined || subscription_mode == null) {
		return;
	}
	// Configure login
	if (subscription_mode.userLogin != undefined && subscription_mode.userLogin.display == true) {
		if (subscription_mode.userLogin.mandatory) {
			mandatory_bool = true;
			$('#subscriptionForm_user_login_state').css("visibility", "visible");
		}
	} else {
		$('#subscriptionForm_user_login_block').hide();
	}

	// Configure password
	if (subscription_mode.userPassword != undefined && subscription_mode.userPassword.display == true) {
		if (subscription_mode.userPassword.mandatory) {
			mandatory_bool = true;
			$('#subscriptionForm_user_password_state').css("visibility", "visible");
		}
	} else {
		$('#subscriptionForm_user_password_block').hide();
		$('#subscriptionForm_user_password_confirm_block').hide();
	}

	// Configure last name
	if (subscription_mode.lastName != undefined && subscription_mode.lastName.display == true) {
		if (subscription_mode.lastName.mandatory) {
			mandatory_bool = true;
			$('#subscriptionForm_last_name_state').css("visibility", "visible");
		}
	} else {
		$('#subscriptionForm_last_name_block').remove();
	}

	// Configure first name
	if (subscription_mode.firstName != undefined && subscription_mode.firstName.display == true) {
		if (subscription_mode.firstName.mandatory) {
			mandatory_bool = true;
			$('#subscriptionForm_first_name_state').css("visibility", "visible");
		}
	} else {
		$('#subscriptionForm_first_name_block').remove();
	}

	// Configure gender
	if (subscription_mode.gender != undefined && subscription_mode.gender.display == true) {
		if (subscription_mode.gender.mandatory) {
			mandatory_bool = true;
			$('#subscriptionForm_gender_state').css("visibility", "visible");
		}
	} else {
		$('#subscriptionForm_gender_block').remove();
	}

	// Configure birth date
	if (subscription_mode.birthDate != undefined && subscription_mode.birthDate.display == true) {
		if (subscription_mode.birthDate.mandatory) {
			mandatory_bool = true;
			$('#subscriptionForm_birth_date_state').css("visibility", "visible");
		}
	} else {
		$('#subscriptionForm_birth_date_block').remove();
	}

	// Configure user languages
	if (subscription_mode.userLanguage != undefined && subscription_mode.userLanguage.display == true) {
		if (subscription_mode.userLanguage.mandatory) {
			mandatory_bool = true;
			$('#subscriptionForm_user_language_state').css("visibility", "visible");
		}
	} else {
		$('#subscriptionForm_user_language_block').remove();
	}

	// Configure interests
	if (subscription_mode.interests != undefined && subscription_mode.interests.display == true) {
		if (subscription_mode.interests.mandatory) {
			mandatory_bool = true;
			$('#subscriptionForm_interests_state').css("visibility", "visible");
		}
	} else {
		$('#subscriptionForm_interests_block').remove();
	}

	// Configure email
	if (subscription_mode.email != undefined && subscription_mode.email.display == true) {
		if (subscription_mode.email.mandatory) {
			mandatory_bool = true;
			$('#subscriptionForm_email_state').css("visibility", "visible");
		}
	} else {
		$('#subscriptionForm_email_block').hide();
	}

	// Configure phone
	if (subscription_mode.phone != undefined && subscription_mode.phone.display == true) {
		if (subscription_mode.phone.mandatory) {
			mandatory_bool = true;
			$('#subscriptionForm_phone_state').css("visibility", "visible");
		}
		// Configure help block
		subscriptionForm_phoneHelpBlock_configure();
	} else {
		$('#subscriptionForm_phone_block').hide();
		$('#subscriptionForm_phone_help_block').hide();
	}

	// Configure Organizational unit name "Company name"
	if (subscription_mode.organizationalUnitName != undefined && subscription_mode.organizationalUnitName.display == true) {
		if (subscription_mode.organizationalUnitName.mandatory) {
			mandatory_bool = true;
			$('#subscriptionForm_organizational_unit_name_state').css("visibility", "visible");
		}
	} else {
		$('#subscriptionForm_organizational_unit_name_block').remove();
	}

	// Configure Postal address
	if (subscription_mode.postalAddress != undefined && subscription_mode.postalAddress.display == true) {
		if (subscription_mode.postalAddress.mandatory) {
			mandatory_bool = true;
			$('#subscriptionForm_postal_address_state').css("visibility", "visible");
			$('#subscriptionForm_postal_code_state').css("visibility", "visible");
			$('#subscriptionForm_postal_locality_name_state').css("visibility", "visible");
			$('#subscriptionForm_postal_postoffice_box_state').css("visibility", "visible");
			$('#subscriptionForm_postal_state_or_province_name_state').css("visibility", "visible");
			$('#subscriptionForm_postal_country_name_state').css("visibility", "visible");
		}
	} else {
		$('#subscriptionForm_postal_address_block').remove();
	}

	// Configure personal fields
	if (subscription_mode.personalField_1 != undefined && subscription_mode.personalField_1.display == true) {
		if (subscription_mode.personalField_1.mandatory) {
			mandatory_bool = true;
			$('#subscriptionForm_personal_field_1_state').css("visibility", "visible");
		}
	} else {
		$('#subscriptionForm_personal_field_1_block').remove();
	}
	if (subscription_mode.personalField_2 != undefined && subscription_mode.personalField_2.display == true) {
		if (subscription_mode.personalField_2.mandatory) {
			mandatory_bool = true;
			$('#subscriptionForm_personal_field_2_state').css("visibility", "visible");
		}
	} else {
		$('#subscriptionForm_personal_field_2_block').remove();
	}
	if (subscription_mode.personalField_3 != undefined && subscription_mode.personalField_3.display == true) {
		if (subscription_mode.personalField_3.mandatory) {
			mandatory_bool = true;
			$('#subscriptionForm_personal_field_3_state').css("visibility", "visible");
		}
	} else {
		$('#subscriptionForm_personal_field_3_block').remove();
	}

	// Configure sponsoring
	if (subscription_mode.sponsoringEnabled == undefined || subscription_mode.sponsoringEnabled != true) {
		$('#subscriptionForm_sponsor_email_block').hide();
		$('#' + mode + 'SubscriptionForm_explain_sponsoring_text').hide();
	}
	else {
		// when sponsoring is enabled, this field is always mandatory
		$('#subscriptionForm_sponsor_email_state').css("visibility", "visible");
	}
	// Configure optin
	if ($.settings.private_policy.display == true && policyNew.mandatory == true) {
		mandatory_bool = true;
	}

	// Configure bool for the general condition
	if (mandatory_bool == true) {
		$('#subscriptionForm_fields_state_block').css("display", "block");
	}
}

function subscriptionForm_customFields_configure(displayLang, mode) {
	var subscription_mode = null;
	try {
		subscription_mode = eval('$.settings.subscribe.' + mode);
	}
	catch (ex) {
		subscription_mode = null;
	}
	if (subscription_mode == undefined || subscription_mode == null) {
		return;
	}
	var field_names = new Array("personalField_1", "personalField_2", "personalField_3");
	var itt = 1;
	if (displayLang == undefined || displayLang == null) {
		displayLang = getUserLanguage_default();
	}
	for (key in field_names) {
		var field_name = field_names[key];
		if (subscription_mode[field_name] != undefined && subscription_mode[field_name].display == true) {
			if (subscription_mode[field_name].labels[displayLang] != undefined) {
				$("#subscriptionForm_personal_field_" + itt + "_text").html(subscription_mode[field_name].labels[displayLang]);
			}
			else if (subscription_mode[field_name].labels[$.settings.lang.defaultLang] != undefined) {
				$("#subscriptionForm_personal_field_" + itt + "_text").html(subscription_mode[field_name].labels[$.settings.lang.defaultLang]);
			}
			else {
				$("#subscriptionForm_personal_field_" + itt + "_text").html(subscription_mode[field_name].labels[$.settings.lang.customFieldsDefaultLang]);
			}
		}
		itt++;
	}
}

/** Empty subscriptionForm
 */
function subscriptionForm_empty(mode) {
	if (mode == undefined || mode == null) {
		return;
	}

	$('form[name="' + mode + 'SubscriptionForm"] input[type="text"]').each(function () {
		$(this).val('');
	});
	$('form[name="' + mode + 'SubscriptionForm"] input[type="password"]').each(function () {
		$(this).val('');
	});
	$('form[name="' + mode + 'SubscriptionForm"] input[type="checkbox"]').each(function () {
		$(this).attr("checked", false);
	});
	$('form[name="' + mode + 'SubscriptionForm"] input[type="radio"]').each(function () {
		$(this).attr("checked", false);
	});
	$('form[name="' + mode + 'SubscriptionForm"] select > option').each(function () {
		$(this).attr("selected", false);
	});
	// Adding examples values
	subscriptionForm_phoneHelpBlock_configure();

	subscriptionForm_changed['prefix'] = false;
	subscriptionForm_changed['phone'] = false;
	subscriptionForm_changed['email'] = false;
}

/** Display subscriptionForm_phone_help_block when help link is clicked
 * @param boolean state - Indicate if the block must be displayed or not
 */
function subscriptionForm_phoneHelpBlock_display(state) {

	var display = false;
	if ((state == true) || (state == false)) {
		display = state;
	} else if ($('#subscriptionForm_phone_help_block').is(':hidden') == true) {
		display = true;
	}

	if (display == true) {
		$('#subscriptionForm_phone_help_block').show();
	} else {
		$('#subscriptionForm_phone_help_block').hide();
	}
}

/*****************************************************************************/

/** Manage the modification of inputs and the help texts present on them
 * @param string type - The type on the event (focus | blur )
 * @param element element - The DOM element afected by the modification
 */
function subscriptionForm_modifyEvent(type, element) {
	switch (type) {
		case 'focus':
			if (subscriptionForm_changed[element.attr("name")] != true) {
				element.val("");
			}
			break;

		case 'blur':
			if (element.val() == "") {
				element.val(getInputTranslation(element.attr("id")));
				subscriptionForm_changed[element.attr("name")] = false;
			} else {
				subscriptionForm_changed[element.attr("name")] = true;
			}
			break;
	}
}

/** Display subscriptionForm_passwordHelpBlock_display when help link is clicked
 * @param boolean state - Indicate if the block must be displayed or not
 */
function subscriptionForm_passwordHelpBlock_display(state, displayLang, mode) {
	var display = false;
	if ((state == true) || (state == false)) {
		display = state;
	} else if ($('#subscriptionForm_password_help_block').is(':hidden') == true) {
		display = true;
	}

	if (display == true) {
		if (translationsAreLoaded == true) {
			subscriptionForm_passwordHelpBlock_configure(displayLang, mode);
		}
		$('#subscriptionForm_password_help_block').show();
	} else {
		$('#subscriptionForm_password_help_block').hide();
	}
}

/** Configure subscriptionForm_password_help_block
 * @param string displayLang - The language whish to display the content
 */
function subscriptionForm_passwordHelpBlock_configure(displayLang, mode) {
	var pwdConstraint = null;
	try {
		pwdConstraint = eval('$.settings.subscribe.' + mode + '.pwdConstraint');
	} catch (ex) {
		pwdConstraint = null;
	}
	if (pwdConstraint != undefined && pwdConstraint != null) {
		if ($('#subscriptionForm_password_help_list').children().length > 1) {
			$('#subscriptionForm_password_help_list li').not(":first").remove();
		}
		/* Update the content of the help box to display to the user the password policy in use for his profile */
		if (displayLang == undefined || displayLang == null) {
			displayLang = getUserLanguage_default();
		}
		var constraintValues = new Array("minLength", "maxLength");
		for (key in constraintValues) {
			var val = constraintValues[key];
			var line = $('#subscriptionForm_password_help_list li:first').clone();
			line.toggle();
			line.text($.sprintf(getInputTranslation("subscriptionForm_password_help_" + val, displayLang), pwdConstraint.value[val]));
			$('#subscriptionForm_password_help_list').append(line);
		}
		for (key in pwdConstraint.value.characterSet) {
			var set = pwdConstraint.value.characterSet[key];
			if (set.quota > 0) {
				var line = $('#subscriptionForm_password_help_list li:first').clone();
				line.toggle();
				line.text($.sprintf(getInputTranslation("subscriptionForm_password_help_character_set_text", displayLang), set.quota, set.set.join("")));
				$('#subscriptionForm_password_help_list').append(line);
			}
		}
	}
}

function subscriptionForm_commonFields_display(mode) {
	if (mode == undefined || mode == null || mode == '') {
		return;
	}
	// Global
	$('#common_subscription_fields').prependTo('#' + mode + '_common_subscription_fields');
	$('#common_subscription_fields').show();

	// Login in case of sms mode or mail mode
	var login = null;
	try {
		login = eval('$.settings.subscribe.' + mode + '.userLogin');
	} catch (ex) {
		login = null;
	}
	if (mode == 'sms' || mode == 'mail' || login == null || !login.display) {
		$('#subscriptionForm_user_login_block').hide();
	} else {
		$('#subscriptionForm_user_login_block').show();
		$('#subscriptionForm_user_login_state').css("visibility", login.mandatory ? "visible" : "hidden");
	}

	// Password
	var pwd = null;
	try {
		pwd = eval('$.settings.subscribe.' + mode + '.userPassword');
	} catch (ex) {
		pwd = null;
	}
	if (mode != 'mail' && mode != 'sms' && mode != 'print' && pwd != null && pwd.display == true) {
		$('#subscriptionForm_user_password_block').show();
		$('#subscriptionForm_user_password_confirm_block').show();
		$('#subscriptionForm_user_password_state').css("visibility", pwd.mandatory ? "visible" : "hidden");
		$('#subscriptionForm_user_password_confirm_state').css("visibility", pwd.mandatory ? "visible" : "hidden");
	} else {
		$('#subscriptionForm_user_password_block').hide();
		$('#subscriptionForm_user_password_confirm_block').hide();
	}

	// Password help link
	var pwdConstraint = null;
	try {
		pwdConstraint = eval('$.settings.subscribe.' + mode + '.pwdConstraint');
	} catch (ex) {
		pwdConstraint = null;
	}
	if (pwdConstraint == undefined || pwdConstraint == null) {
		$('#subscriptionForm_password_help_link').hide();
	} else {
		$('#subscriptionForm_password_help_link').show();
		$('#subscriptionForm_password_help_link').unbind('click').click(function () {
			subscriptionForm_passwordHelpBlock_display(undefined, undefined, mode);
		});
	}

	// Email in case of mail mode
	var email = null;
	try {
		email = eval('$.settings.subscribe.' + mode + '.email');
	} catch (ex) {
		email = null;
	}
	if (mode == 'mail') {
		$('#subscriptionForm_email_block').show();
		$('#subscriptionForm_email_state').css("visibility", "visible");
	} else if (email != null && email.display == true) {
		$('#subscriptionForm_email_block').show();
		$('#subscriptionForm_email_state').css("visibility", email.mandatory ? "visible" : "hidden");
	} else {
		$('#subscriptionForm_email_block').hide();
	}

	// Phone in case of sms mode
	var phone = null;
	try {
		phone = eval('$.settings.subscribe.' + mode + '.phone');
	} catch (ex) {
		phone = null;
	}
	if (mode == 'sms') {
		$('#subscriptionForm_phone_block').show();
		$('#subscriptionForm_phone_help_block').show();
		$('#subscriptionForm_phone_state').css("visibility", "visible");
	} else if (phone != null && phone.display == true) {
		$('#subscriptionForm_phone_block').show();
		$('#subscriptionForm_phone_help_block').show();
		$('#subscriptionForm_phone_state').css("visibility", phone.mandatory ? "visible" : "hidden");
	} else {
		$('#subscriptionForm_phone_block').hide();
		$('#subscriptionForm_phone_help_block').hide();
	}

	// Custom fields
	subscriptionForm_customFields_configure(undefined, mode);

	// Policy
	var policy = eval('$.settings.private_policy');
	if (policy == undefined || policy == null || !policy.display) {
		$('#subscriptionForm_policy_block').remove();
	} else {
		subscriptionForm_policy_configure(undefined, mode);
	}

	// Sponsoring
	var sponsoringEnabled = null;
	try {
		sponsoringEnabled = eval('$.settings.subscribe.' + mode + '.sponsoringEnabled');
	} catch (ex) {
		sponsoringEnabled = null;
	}
	if (sponsoringEnabled == undefined || sponsoringEnabled == null || !sponsoringEnabled) {
		$('#subscriptionForm_sponsor_email_block').hide();
		$('#' + mode + 'SubscriptionForm_explain_sponsoring_text').hide();
	} else {
		$('#subscriptionForm_sponsor_email_block').show();
		$('#' + mode + 'SubscriptionForm_explain_sponsoring_text').show();
	}
}

function subscriptionForm_policy_configure(displayLang, mode) {

	var policy = null;
	try {
		policy = eval('$.settings.private_Policy');
	}
	catch (ex) {
		policy = null;
	}
	if (policy == undefined || policy == null) {
		return;
	}
	var policyWrapper = new Object();
	policyWrapper.policy = policy;
	if (displayLang == undefined || displayLang == null) {
		displayLang = getUserLanguage_default();
	}
	$('#subscriptionForm_policy_text').html(extractPolicyText(policyWrapper, displayLang));
	$('#subscriptionForm_policy_resume').html(extractPolicyResume(policyWrapper, displayLang));
}

/** Manage the modification of inputs and the help texts present on them
 * @param string type - The type on the event (focus | blur )
 * @param element element - The DOM element afected by the modification
 */
function subscriptionForm_modifyEvent(type, element) {
	switch (type) {
		case 'focus':
			if (subscriptionForm_changed[element.attr("name")] != true) {
				element.val("");
			}
			break;

		case 'blur':
			if (element.val() == "") {
				element.val(getInputTranslation(element.attr("id")));
				subscriptionForm_changed[element.attr("name")] = false;
			} else {
				subscriptionForm_changed[element.attr("name")] = true;
			}
			break;
	}
}

/** Configure subscriptionForm_phone_block
 * @param string displayLang - The language whish to display the content
 */
function subscriptionForm_phoneHelpBlock_configure(displayLang) {
	if (subscriptionForm_changed['prefix'] != true) {
		$('#subscriptionForm_phone_prefix_value').val(getInputTranslation("subscriptionForm_phone_prefix_value", displayLang));
	}
	if (subscriptionForm_changed['phone'] != true) {
		$('#subscriptionForm_phone_phone_value').val(getInputTranslation("subscriptionForm_phone_phone_value", displayLang));
	}
	$('#subscriptionForm_phone_help_prefix_example_value').val(getInputTranslation("subscriptionForm_phone_help_prefix_example_value", displayLang));
	$('#subscriptionForm_phone_help_phone_example_value').val(getInputTranslation("subscriptionForm_phone_help_phone_example_value", displayLang));
}

function subscriptionFormSubscribe(mode) {
	var params = new Object();
	if (mode == undefined || mode == null) {
		return params;
	}
	// Mandatory parameters
	params.type = mode;
	params.login = $('#subscriptionForm_user_login').val();
	params.password = $('#subscriptionForm_user_password').val();
	params.passwordConfirm = $('#subscriptionForm_user_password_confirm').val();
	params.lastName = $('#subscriptionForm_last_name').val();
	params.firstName = $('#subscriptionForm_first_name').val();
	params.emailAddress = $('#subscriptionForm_email').val();
	params.prefix = (subscriptionForm_changed['prefix'] == true) ? $('#subscriptionForm_phone_prefix_value').val() : "";
	params.phone = (subscriptionForm_changed['phone'] == true) ? $('#subscriptionForm_phone_phone_value').val() : "";
	params.organizationalUnitName = $('#subscriptionForm_organizational_unit_name').val();
	params.postalAddress = $('#subscriptionForm_postal_address').val();
	params.postalCode = $('#subscriptionForm_postal_code').val();
	params.postalLocalityName = $('#subscriptionForm_postal_locality_name').val();
	params.postalPostofficeBox = $('#subscriptionForm_postal_postoffice_box').val();
	params.postalStateOrProvinceName = $('#subscriptionForm_postal_state_or_province_name').val();
	params.postalCountryName = $('#subscriptionForm_postal_country_name').val();
	params.gender = $('#subscriptionForm_gender_m').is(':checked') ? $('#subscriptionForm_gender_m').val() : $('#subscriptionForm_gender_f').is(':checked') ? $('#subscriptionForm_gender_f').val() : "";
	params.birthDate = $('#subscriptionForm_birth_date').val();
	params.userLanguage = $('#subscriptionForm_user_language').val();
	params.interests = ($('#subscriptionForm_interests').val() != null) ? $('#subscriptionForm_interests').val() : "";

	//Custom fields
	params.personalField_1 = ($('#subscriptionForm_personal_field_1').val() != "") ? $('#subscriptionForm_personal_field_1').val() : undefined;
	params.personalField_2 = ($('#subscriptionForm_personal_field_2').val() != "") ? $('#subscriptionForm_personal_field_2').val() : undefined;
	params.personalField_3 = ($('#subscriptionForm_personal_field_3').val() != "") ? $('#subscriptionForm_personal_field_3').val() : undefined;

	// Sponsoring
	params.sponsorEmail = ($('#subscriptionForm_sponsor_email').val() != "") ? $('#subscriptionForm_sponsor_email').val() : undefined;

	params.privatePolicyAccept = $('#subscriptionForm_privatePolicy_accept').is(':checked');
	if (($.settings.user != undefined) && ($.settings.user.securePwd != undefined)) {
		params.securePwd = $.settings.user.securePwd.value;
	}
	return params;
}

function getUserLanguage_default() {
	var userLang = eval('$.settings.user.lang');
	if (userLang != null && userLang != undefined) {
		return userLang;
	}
	var defaultLang = eval('$.settings.lang.defaultLang');
	if (defaultLang != null && defaultLang != undefined) {
		return defaultLang;
	}
}

/*****************************************************************************/
/****                   Pre portal JavaScript functions                   ****/
/*****************************************************************************/

$(document).ready(function () {
	$('#pre_portal_close_cna_link').click(function () {
		pre_portal_close_cna();
	});
	$('#pre_portal_step1_pass_link').click(function () {
		pre_portal_switch_step(1, 4);
	});
});

function pre_portal_wait() {
	if (!$('body').hasClass('cursor-wait')) {
		$('body').toggleClass('cursor-wait');
	}
}

function pre_portal_fake_click() {
	// we don't care about the current anchor status, we just want to simulate a url change, even in anchor part
	window.location.href += '#fake_anchor_change1';
	setTimeout(function() {
		window.location.href += '#fake_anchor_change2';
		// still wait a moment, then display a "try again" message
		setTimeout(function() {
			if ($('body').hasClass('cursor-wait')) {
				$('body').toggleClass('cursor-wait');
			}
			$.settings.error = {
					code: 'error_pre_portal_try_again_android8',
			};
			displayErrorInfo();
		}, 3000);
	}, 3000);
}

function pre_portal_add_success_trigger(struct_ajax) {
	// only simulate fake click at the first time
	if (!$('body').hasClass('cursor-wait')) {
		struct_ajax.success = pre_portal_fake_click;
	}
}

function pre_portal_configure() {
	// use the domain sent from controller
	if ($.settings.pre_portal && $.settings.pre_portal.domain) {
		$('span#pre_portal_domain').text($.settings.pre_portal.domain);
	}
	$('span#pre_portal_domain').click(function() {
		var copy_textarea = document.createElement('textarea');
		$(copy_textarea).text($('span#pre_portal_domain').text())
				.attr('readonly', 'readonly')
				.css('position', 'absolute')
				.css('left', '-9999px');
		document.body.appendChild(copy_textarea);
		copy_textarea.select();
		document.execCommand('copy');
		document.body.removeChild(copy_textarea);
		$('span#pre_portal_domain_copied').fadeIn();
	});
}

function pre_portal_display(state) {
	var display = false;
	if ((state == true) || (state == false)) {
		display = state;
	}
	else if ($.settings.step == 'PRE_PORTAL') {
		display = true;
	}

	var pre_portal_div = $('div#pre_portal_block');
	if (display) {
		pre_portal_div.show();
	} else {
		pre_portal_div.hide();
	}
}

function pre_portal_switch_step(old_step, new_step) {
	var step_block_prefix = 'pre_portal_step';
	$('#' + step_block_prefix + old_step).hide();
	$('#' + step_block_prefix + new_step).show();
	var step_indicator_prefix = 'pre_portal_indicator_step';
	$('#' + step_indicator_prefix + old_step).removeClass('active');
	$('#' + step_indicator_prefix + new_step).addClass('active');
	$('span#pre_portal_domain_copied').hide();
}

function pre_portal_go_next_step(current_step) {
	pre_portal_switch_step(current_step, current_step + 1);
}

function pre_portal_go_back_step(current_step) {
	pre_portal_switch_step(current_step, current_step - 1);
}

function pre_portal_close_cna() {
	if (is_in_ucopia_oob()) {
		var pre_portal_oob_ajax = {
				type: 'POST',
				url: $.settings.user.satellite_URL,
				data: {
					action: 'pre_portal_start',
				},
				beforeSend: pre_portal_wait,
				error: function () {
					$.settings.error = {
						code: 'error_pre_portal_internal',
					};
					displayErrorInfo();
					return;
				}
		};
		pre_portal_add_success_trigger(pre_portal_oob_ajax);
		$.ajax(pre_portal_oob_ajax);
	}
	else {
		var request = new Object();
		request.action = 'pre_portal_start';
		var callbacks = new Object();
		callbacks.beforeSend = pre_portal_wait;
		pre_portal_add_success_trigger(callbacks);
		$.portal_api('action', request, callbacks);
	}
}

/*****************************************************************************/
/***** Javascript functions used by informative widget                   *****/
/***** ***** ***** ***** ***** ***** ***** ***** ***** ***** ***** ***** *****/


/** This function is triggered when the page is loaded
 */
$(document).ready(function() {
	$('#informativeWidget_connect_button').click(function() {
		informativeWidgetConnect();
	});
});

/** Replace keywords by user content
 * If text is empty the whole keyword section delimited by section delimiters is removed
 * - section delimiters look like this %<keyword>_B% and %<keyword>_E%
 * @param keyword - The keyword to be replaced (ex: firstname)      [REQUIRED]
 * @param content - The html content where keyword must be replaced [REQUIRED]
 * @param text    - The text used instead of the keyword            [REQUIRED]
 */
function informativeWidget_replace(keyword, content, text)
{
	var return_content = content;
	var regexp;
	if (text != "") // Replace keyword by text and remove keyword section delimiters
	{
		regexp = new RegExp("%" + keyword + "%", "g");
		return_content = return_content.replace(regexp, text);
		regexp = new RegExp("%" + keyword + "_B%", "g");
		return_content = return_content.replace(regexp, "");
		regexp = new RegExp("%" + keyword + "_E%", "g");
		return_content = return_content.replace(regexp, "");
	}
	else // Remove the whole keyword section
	{
		regexp = new RegExp("%" + keyword + "_B%.*%" + keyword + "_E%", "g");
		return_content = return_content.replace(regexp, "");
	}
	
	return return_content;
}

function informativeWidget_configure()
{
	// Modifying keywork content
	if ($.settings != undefined && $.settings.informativeWidget != undefined)
	{
		var html_content = "";
		var text = "";
		var validity;
		var hours, mins, seconds;
		var hours_label, mins_label, seconds_label;
		var reneweach;
		var timezoneLocalOffset = new Date();
		var informativeWidgetSettings = $.settings.informativeWidget;
		
		if ($.settings != undefined && $.settings.lang != undefined && $.settings.lang.displayLang != undefined)
		{
			for (lang_itt = 0; lang_itt < $.settings.lang.displayLang.length; lang_itt++)
			{
				var lang_value_itt = $.settings.lang.displayLang[lang_itt];
				html_content = $('#widget_informative_' + lang_value_itt).html();
				if (html_content === undefined || html_content == null) {
					html_content = ""; // Set default to empty string in case of empty DOM
				}
				// Replace %lastname%
				text = "";
				if (informativeWidgetSettings.lastName != undefined)
				{
					text = informativeWidgetSettings.lastName.value;
				}
				html_content = informativeWidget_replace("lastname", html_content, text);
				
				// Replace %firstname%
				text = "";
				if (informativeWidgetSettings.firstName != undefined)
				{
					text = informativeWidgetSettings.firstName.value;
				}
				html_content = informativeWidget_replace("firstname", html_content, text);
				
				// Replace %validity_stardate%
				text = "";
				if (informativeWidgetSettings.validity != undefined && informativeWidgetSettings.validity.startDate != undefined)
				{
					validity = new Date((parseInt(informativeWidgetSettings.validity.startDate.value) + parseInt(informativeWidgetSettings.timezoneOffset.value) + parseInt(timezoneLocalOffset.getTimezoneOffset()*60)) * 1000); // Must give date in milliseconds
					validity = explodeDate(validity);
					text = $.sprintf(getGenericTranslation('full-date-display', lang_value_itt), validity.year, validity.monthNumber, getGenericTranslation(validity.month, lang_value_itt), validity.dayNumber, getGenericTranslation(validity.day, lang_value_itt), validity.hours[24], validity.minutes, validity.hours[12], validity.hours['ext']);
				}
				html_content = informativeWidget_replace("validity_startdate", html_content, text);
				
				// Replace %validity_enddate%
				text = "";
				if (informativeWidgetSettings.validity != undefined && informativeWidgetSettings.validity.endDate != undefined)
				{
					validity = new Date((parseInt(informativeWidgetSettings.validity.endDate.value) + parseInt(informativeWidgetSettings.timezoneOffset.value) + parseInt(timezoneLocalOffset.getTimezoneOffset()*60)) * 1000); // Must give date in milliseconds
					validity = explodeDate(validity);
					text = $.sprintf(getGenericTranslation('full-date-display', lang_value_itt), validity.year, validity.monthNumber, getGenericTranslation(validity.month, lang_value_itt), validity.dayNumber, getGenericTranslation(validity.day, lang_value_itt), validity.hours[24], validity.minutes, validity.hours[12], validity.hours['ext']);
				}
				html_content = informativeWidget_replace("validity_enddate", html_content, text);
				
				text = "";
				if (informativeWidgetSettings.timeCredit != undefined)
				{
					hours = Math.floor(informativeWidgetSettings.timeCredit.value / 3600);
					mins = (informativeWidgetSettings.timeCredit.value - (hours * 3600)) / 60;
					hours_label = getGenericTranslation('hour', lang_value_itt, (hours > 1));
					mins_label = getGenericTranslation('minute', lang_value_itt, (mins > 1));
					reneweach = 0;
					if (informativeWidgetSettings.timeCredit.reneweach != undefined)
					{
						reneweach = informativeWidgetSettings.timeCredit.reneweach.value;
						text = getGenericTranslation('feedbackForm_time-credit-renew-each', lang_value_itt, (reneweach > 1));
					}
					else
					{
						text = getGenericTranslation('feedbackForm_time-credit', lang_value_itt);
					}
					text = $.sprintf(text, hours, hours_label, mins, mins_label, reneweach);
				}
				html_content = informativeWidget_replace("timecredit_available", html_content, text);
				
				text = "";
				if (informativeWidgetSettings.timeCredit != undefined && informativeWidgetSettings.timeCredit.remaining != undefined && informativeWidgetSettings.timeCredit.remaining.value > 0)
				{
					hours = Math.floor(informativeWidgetSettings.timeCredit.remaining.value / 3600);
					mins = Math.floor((informativeWidgetSettings.timeCredit.remaining.value - (hours * 3600)) / 60);
					seconds = informativeWidgetSettings.timeCredit.remaining.value - (hours * 3600) - (mins * 60);
					
					hours_label = getGenericTranslation('hour', lang_value_itt, (hours > 1));
					mins_label = getGenericTranslation('minute', lang_value_itt, (mins > 1));
					seconds_label = getGenericTranslation('second', lang_value_itt, (seconds > 1));
					
					text = $.sprintf(getGenericTranslation('feedbackForm_time-credit-with-seconds', lang_value_itt), hours, hours_label, mins, mins_label, seconds, seconds_label);
				}
				html_content = informativeWidget_replace("timecredit_remaining", html_content, text);
				
				$('#widget_informative_' + lang_value_itt).html(html_content);
			}
		}
	}
}

function informativeWidget_display(state) {
	
	var display = false;
	if ( (state == true) || (state == false) ) {
		display = state;
	}
	else if ($.settings.informativeWidget != undefined && ($.settings.step == "LOGON" || ($.settings.step != undefined && $.settings.step == "SUBSCRIBE" && $.settings.type == "ONE") ) ) {
		display = true;
	}
	
	if (display == true) {
		if (translationsAreLoaded == true)
		{
			informativeWidget_configure();
		}
		$('#welcomeHeadline').hide();
		$('#reserved_block').hide();
		$('#widget_informative').fadeIn('slow');
	}
	else {
		$('#widget_informative').hide();
		$('#welcomeHeadline').fadeIn('slow');
		$('#reserved_block').fadeIn('slow');
	}
}

function informativeWidgetConnect()
{
	var callbacks = new Object();
	callbacks.beforeSend = function() { };
	callbacks.success    = function() { informativeWidgetConnectCallback(); };
	callbacks.complete   = function() { };
	
	informativeWidgetAuthenticate(callbacks /*, params */);
}

function informativeWidgetConnectCallback()
{
	if ($.settings.error != undefined)
	{
		$('#reserved_block').fadeIn('slow')
	}
	
	logonFormConnectCallback();
}
  z      r
      refreshObj     [      timerObj   ($      translationsAreLoaded      AR      switch_package     M#
      isAppleCNA     +	      navigator      	      userAgent      n(      iPhone|iPad|iPod   I?	      mozilla\/	      j      applewebkit\/
      d      mobile\/   C      safari     ds      isAppleCNA_fakeclick   O      document   
      ready      t      informativeWidget_configure    &a      #widget_informative    v}      hide   T
      portal_api     u`      init   !Y
      initPortal     V      handle_force_disconnect    K      settings         user   u{      force_feedback_disconnect      o      displayWaitingIcon     |      feedbackFormDisconnect     w|\      handle_autoconnect     D	      subscribe      J      autoconnect    6nn      step         LOGON       `[*      form[name="logonForm"] input[name="login"]!     &      val"    Uf      login#      (-      form[name="logonForm"] input[name="password"]$            password%   &[B      form[name="logonForm"] input[name="logonForm_logon_policy_accept"]&     A      attr'   :0      checked(    9U      policy_accepted)    z      :checked*   c      logon+            policy,     e}      display-    '\G      setInAutoConnect.   |S      logonFormConnect/   i4J      follow_cloud_redirect0      E(      #waiting_icon_block1    HK      show2   {      #reserved_block3    6(      data4   F      redirect5   2      window6     0+QA      location7         portal_format8      qb      path_tokens9    4O      pathname:   s      toUpperCase;    E      indexOf<    "      PORTAL=     3N6      portal>     
#S      getTranslations?    uU~1	      translate@      +~,      langA   e      lang_block_configureB   bP      replaceAllFreeURLsC     q6      configureDOMD   Xg      private_policyE     N[
      auth_modesF     P=?      securePwdForm_configureG    z      autoLogonForm_configureH    SlQ      logonForm_configureI          forceModifyPwdForm_configureJ   O      feedbackForm_configureK     >^      modifyPwdForm_configureL    l       getPurchaseSummaryForm_configureM   |      upgradeAccountForm_configureN   *)"      manageAccountForm_configureO    h4L      smsSubscriptionForm_configureP      ns      mailSubscriptionForm_configureQ     t{      oneSubscriptionForm_configureR      PI       directSubscriptionForm_configureS   /      printSubscriptionForm_configureT    =5       paypalSubscriptionForm_configureU   5\      ogoneSubscriptionForm_configureV    KD      ppsSubscriptionForm_configureW      Ger      paypalPaymentForm_configureX    e)      ogonePaymentForm_configureY     <jum      pmsPaymentForm_configureZ   4P"      pwdRecoveryForm_configure[      2C      pwdRecoverySetForm_configure\   7      accountRefillForm_configure]    n ]      shibAuthenticated^      |      pre_portal_configure_   -~z      displayStep`    ag      handleCentralPortalRedirectiona     [sv      securePwdForm_displayb      </      autoLogonForm_displayc      .1      logonForm_displayd      ]]d      forceModifyPwdForm_displaye     n      feedbackForm_displayf   >t      modifyPwdForm_displayg      A      getPurchaseSummaryForm_displayh     |#b      upgradeAccountForm_displayi     KQ      manageAccountForm_displayj      J      smsSubscriptionForm_displayk    P      mailSubscriptionForm_displayl   7      oneSubscriptionForm_displaym    xC      directSubscriptionForm_displayn     fc      printSubscriptionForm_displayo      F=      paypalSubscriptionForm_displayp           ogoneSubscriptionForm_displayq      ZA      ppsSubscriptionForm_displayr    2      paypalPaymentForm_displays            ogonePaymentForm_displayt         pmsPaymentForm_displayu     \      pwdRecoveryForm_displayv    )      pwdRecoverySetForm_displayw     )       logonFormSubscribeChoice_displayx   E      pre_portal_displayy     .hT      informativeWidget_displayz      U"      fadeIn{     b{su      slow|   <
      login_URL_params}   +      isConnected~    3R      buildRedirectionURL    6t
      url_params     |
      target_URL     >R      port   &      443    s4      protocol   +      https      	(r      host   K      uri    N      ://    #9y      send_cna_id    LV      isInAutoConnect    J|      cna_id     +#      getCnaId   n/      form[name="logonForm"] input[name="wispr_mode"]    %
      wispr_mode     :      POST   *g      form   DC      createElement      	      action     pwm      method     B-      append     5n      <input name="      umG	      " value="      +      ">     h;      body   $~      appendChild    d      submit     K      removeChild    
      get_params     6f      substr     b      displayErrorInfo   1\      displayLang    o      translations   tuW      error      hc)      code   G      error_redirect-to-index    #      #error_info_value      3      text   +      removeClass          info   B|      addClass   eA      msgid      @      trans      xq      defaultLang    q$      subscription_modes     S,      direct     <      mail         sms    f      paypal     .W      ogone      .      print      z      custom_field_error     M      creationMode   m      error_personal-settings    4i      creationModeRegExp     vz[      ^portal-([a-zA-Z]+)$         creationModeMatches    B;      key    U      subscription_mode      D      error_     d      -subscribe_no-custom-field     fi      no-custom-field          error_subscribe_no-custom-field    O\      labels     -i      sprintf    K}      customFieldsDefaultLang    <      -subscribe_invalid-custom-field          invalid-custom-field   e$      error_subscribe_invalid-custom-field         error_block    PTss      -subscribe_invalid-password    E)      #SubscriptionErrorBlock    4      clone      #{      #SubscriptionErrorBlock_text   W!      error_modify-pwd_invalid-password      &3'      error_force-modify-pwd_invalid-password    
      #forceModifyPwdErrorBlock      '      #forceModifyPwdErrorBlock_text     1g3      #modifyPwdErrorBlock   U	.	      #modifyPwdErrorBlock_text      E      translation    1#      getErrorTranslation          small      w!
      error_line     o      li:first         ul:first   rG=      big    `r      missing-occurance      uw      classes    kS
      char_class     #K$      quota      X      html   L'      error_logon_volume-quota-reached-detail    k      renewTimeStamp     }V
      zoneOffset     lm
      data_renew           explodeDate    PF
      date_renew      /      getGenericTranslation            full-date-display            monthNumber    	      dayNumber      G      hours      LPO      minutes    b      ext    1      isControllerTimezone   $      zoneTimezone   $       (     P
      error_text            error_logon_volume-quota-reached   3At
      setTimeout     >s      resetErrorInfo     I      &nbsp;     
      error info     kPA      authenticate   	      callbacks      &<      params     l(      request          switchPackage      ! t
      timeCredit     4'      PAYMENT           PMS    O
      secure_pwd     uN	      securePwd      [P      policy_accept      Ax![      policyAccept   [++      private_policy_accept      ._      privatePolicyAccept    uO'	      from_ajax      k8      lastProfile   w      last_profile  |`      option    Ku?      autoAuthenticate  Hi      automatic_authenticate    !      informativeWidgetAuthenticate     c      informativeWidget_authenticate    d      socialNetworkAuthenticate     "      social_network_authenticate	   5j1      twitter
   }      user_follow   3
      userFollow    DvD      facebook  
'	      user_like     !      userLike  
      disconnect          refresh   E      currentDate   %]      time  u.      getTime   C      CONNECT   ~      REFRESH   P      autoDisconnect    S		      modifyPwd     H
      modify_pwd    %S      newPassword   &      newPasswordConfirm    M      new_password  8      new_password_confirm        forceModifyPwd    \[?@      force_modify_pwd  j
      backAction     ,      back_action!   	      last_name"      [9      lastName#  ~@f
      first_name$    	      firstName%     zG      email_address&     sO      emailAddress'  2      prefix(    D      phone)     E      organizational_unit_name*  i      organizationalUnitName+    Nz(      postal_address,    =	      postalAddress-     E!      postal_code.   
      postalCode/    ^      postal_locality_name0  F8      postalLocalityName1    6}      postal_postoffice_box2     qB      postalPostofficeBox3   qm      postal_state_or_province_name4           postalStateOrProvinceName5     $Bf      postal_country_name6   U`      postalCountryName7     XZ      personal_field_18  m      personalField_19         personal_field_2:  H      personalField_2;   M      personal_field_3<  8s1      personalField_3=   	{      sponsor_email>     8      sponsorEmail?  M0      gender@    q
      birth_dateA    	      birthDateB     4      user_languageC     Tu      userLanguageD  	      interestsE     91>[      connect_policy_acceptF     pL\      connectPolicyAcceptG   {
      user_loginH    nB]      user_passwordI     ?wF      user_password_confirmJ     (      passwordConfirmK   eh      ppsL   p      scratch_codeM  7      scratchCodeN   "      captcha_codeO  uC      captchaCodeP   M      selectPmsPackageQ  !v      select_pms_packageR    mI      paymentS   }K      selectPaypalPackageT   b0      select_paypal_packageU     8J      processV   1N      selectOgonePackageW    Di      select_ogone_packageX  ]p      subscriptionSendCredentialY    <      emailZ     Q      paypalSendSms[     E)      paypal_send_sms\   KG
      ogoneSendSms]  +      ogone_send_sms^    )rT      verifyPayment_     f|      verify_payment`    S0      ogoneSubmitPaymenta    43      ogone_submit_paymentb  @c      orderidc   EEXw      paypalSubmitPaymentd         paypal_submit_paymente     .r      getPurchaseSummaryf    PY      get_purchase_summaryg  aq      getCurrentPackageh     w      get_current_packagei   !      getUpgradeOrderj   2      get_upgrade_orderk     :r      multidevicel   -;      updateUpgradeOrderm    I      update_upgrade_ordern  .      order_ido        orderIdp   Y      checkUpgradeOrderq     2      check_upgrade_orderr   7P,      switchLanguages    d@      switch_languaget   3G      updatePersonalSettingsu          personal_settings_updatev  E(      privatePolicyw           updateDevicesSettingsx     rT      devices_settings_updatey          updatePwdRecoverySecretQuestionsz  ($      pwd_recovery_secret_questions_update{  
Gj      getPwdRecoveryOptionsFromUser|     "      get_pwd_recovery_options_from_user}    \U      regenPwdWithSmsResend~           regen_pwd_with_sms_resend     [      regenPwdWithEmailResend   x      regen_pwd_with_email_resend         regenPwdWithSecretQuestions   mC      regen_pwd_with_secret_questions   Vc      freeUrls  4
      freeUrlKey    `X      href  `       isAuthenticatedThroughShibboleth  *      shibuser  4iF,      shibpwd   
      beforeSend    sP      logonFormWaiting  \9      success         logonFormConnectCallback  D      complete        refillAccountPaymentSubscribe           refill_payment_subscribe  m      refillAccount     G      refill_account    87
      refillCode    o.      getFreeRefillCode     !xv      get_free_refill_code  SP      title:eq(0)   E      title     U~      button    B      needTranslate           contents  >	      filter    'J(      nodeType  G	      attribute     z)      subscriptionForm_phoneHelpBlock_configure     t5      paypalSubscriptionResultForm_phoneHelpBlock_configure      n/4      ogoneSubscriptionResultForm_phoneHelpBlock_configure  7\(      pwdRecoveryForm_phoneHelpBlock_configure  cqc <      manageAccountForm_personal_settings_phoneHelpBlock_configure  m      logonForm_policy_configure    &      autoLogonForm_policy_configure    /W!      subscriptionForm_policy_configure     `,      oneSubscriptionForm_connect_policy_configure  Ka!      logonForm_privatePolicy_configure           linkedin  G      google    P3'      subscriptionForm_customFields_configure   JH:      manageAccountForm_personal_settings_customFields_configure    !      pmsPaymentForm_packages_configure     \?$      paypalPaymentForm_packages_configure  &#      paypalPaymentForm_packages_describe   \>#      ogonePaymentForm_packages_configure   ?"      ogonePaymentForm_packages_describe    #      accountRefillForm_options_configure   )*%"      accountRefillForm_options_describe    I       pmsPaymentForm_packages_describe        upgradeAccountForm_fillIn     5cp      feedbackForm_fillIn   f%      pwdRecoverySetForm_questionsTranslate     &;5(      pwdRecoveryResendForm_questionsTranslate  &      forceModifyPwdForm_HelpBlock_configure    c1!      modifyPwdForm_HelpBlock_configure     k,      subscriptionForm_passwordHelpBlock_configure  7/      logonForm_feedback_configure  ~]      #body div[lang][id]   6y      #body div[lang="  ]p      "][id]    a      dir   lg      rtl   S      ltr   
      plural    v      generic   {      trans_label   Nd	      plural >            >     2	      msg_found     *o@      trans_id  E      getInputTranslation   c<~      getTextTranslation    In      extractPolicyText     N#9      obj   I      link  r      <a target="_blank" href="           </a>  !D      extractPolicyResume   @o      resume          startRefresh  Z	      ressource            setInterval   lt	      doRefresh     !r      refreshInterval         stopRefresh   bPk      clearInterval     "      refreshCallback   y&F      clearUserSettings           pmsoptionalfields     p6      clearPaymentSettings  Tl	      completed     RJ      date  %k5      getFullYear   "      getMonth  8B      months    V      january         february  ,      march     t6      april           may   n6      june  K%      july  Bu(      august    U!	      september     M_       october   Xr      november        december        getDate   &      days        sunday    4      monday    Kem      tuesday   ]*	      wednesday     0      thursday  w`s      friday          saturday  =<jD      getDay    }:C      getHours  *?
      getMinutes    O  j      seconds   
      getSeconds    qt^      convertReadableQuota        vol_byte  :0      res   )b&      getForcedDisconnectionTimerDisplayText    `-      floor      9      mins  m}      hours_label   E
      mins_label    gxB      seconds_label     KB)      forced-disconnection-display-with-seconds     M      addPolicyText     x      eltId           policy_text   M      policy_resume	     S      _text
     ~9      _resume   >      css   ,      none  1L      _style    Px      active    k      _button   2      parent    J      width     ?y      100%  "      condition_general_policy_configure    O      src_elementid     )      dst_elementid     3	      policyNew     V      appendTo  h
      _container    g,      _block    *m2      regexp    m      (condition_general_policy_)(.+)   1<      select    "	      mandatory     !      _state    1 
      visibility     W      hidden!    `-      .fields_state_block"   ?Iq      visible#   Tn      inline$    @Yq      condition_general_policy_block%          a_target_id&   '      logonForm_logon_policy'    a@9~      logonForm_socialNetwork_policy(    "      oneSubscriptionForm_connect_policy)    &4      ppsSubscriptionForm_policy*    VTB      subscriptionForm_privatePolicy+    <{!      logonForm_logon_privatePolicy,     x      manageAccountForm_privatePolicy-   dY8%      logonForm_socialNetwork_privatePolicy.     Vg      :empty/          spread_general_policy_value0   6%      informativeWidget1     =      optin_value2   R%      #logonForm_logon_privatePolicy_accept3     Xl'      #manageAccountForm_privatePolicy_accept4   qs      elt_clicked5         $all_element6  9S=      _accept7   X      click8     5      is_in_ucopia_oob9        satellite_URL:     Ll      nas_constructor;   Gd      ucopia<    c      #lang_link\[fr\]=  CK      lang_block_translate>  V6      #lang_link\[de\]?  S      #lang_link\[en\]@  ^      #lang_link\[es\]A  #%      #lang_link\[it\]B  s*      #lang_link\[nl\]C  \      #lang_link\[pt\]D  "      #lang_link\[pl\]E  Xx]      #lang_link\[zh_CN\]F   <      zh_CNG     7      #lang_link\[zh_TW\]H   ?      zh_TWI     `-I      #lang_link\[ar_LB\]J   `4      #lang_link\[ko\]K        #lang_link\[ja\]L  !      #lang_link\[th\]M  e      #lang_link\[ru\]N  e      #lang_link\[id\]O  l9      #lang_blockP   v      lang_ittQ  @s      #lang_link\[R         \]S          FEEDBACKT  6~a      firstTimeArrivalFromRedirectionU   MT      reloadV    G.      #securePwdForm_access_buttonW        form[name="securePwdForm"]X          securePwdFormAccessY   *N      removeZ    _,
      SECURE_PWD[    (G      securePwdForm_empty\   jsf       form[name="securePwdForm"] input]        securePwdFormWaiting^  (I      toggleClass_   <      cursor-wait`   +3      form[name="securePwdForm"] input[name="secure_pwd"]a   T3      securePwdFormAccessCallbackb   J      #forceModifyPwdForm_back_buttonc   96      forceModifyPwdFormBackd    p"      #forceModifyPwdForm_confirm_buttone    ^      forceModifyPwdFormConfirmf           form[name="forceModifyPwdForm"]g         #forceModifyPwdForm_help_linkh     l{$      forceModifyPwdForm_HelpBlock_displayi        #uc-new_pwd_mod_forcej     7      FORCE_MODIFY_PWDk  _      pwdConstraintl     w^J      #forceModifyPwdForm_help_trm   FL|      #forceModifyPwdForm_help_blockn    D}2      forceModifyPwdForm_emptyo  L %      form[name="forceModifyPwdForm"] inputp     9n      forceModifyPwdFormBackCallbackq    ;      forceModifyPwdFormWaitingr     zw      disableds  y5      form[name="forceModifyPwdForm"] input[name="old_pwd"]t     {5      form[name="forceModifyPwdForm"] input[name="new_pwd"]u     i9      form[name="forceModifyPwdForm"] input[name="confirm_pwd"]v     !      forceModifyPwdFormConfirmCallbackw     2      :hiddenx   '      #forceModifyPwdForm_help_listy     
}N      childrenz  X=ZC       #forceModifyPwdForm_help_list li{  q      not|   6|      :first}    x      #forceModifyPwdHelpBlock_text~     
      forceModifyPwdForm_help_text  !      constraintValues  s^	      minLength     -8	      maxLength     d
&      #forceModifyPwdForm_help_list li:first    Og      toggle    `>      forceModifyPwdForm_help_  ~"6      characterSet  mY8*      forceModifyPwdForm_help_character_set_text    !)      #logonForm_standard_authentication_button     -*      logonForm_toggle_show_authentication_modes    f,w*      #logonForm_authentication_form_back_button    +      #logonForm_shibboleth_authentication_button   KGx      socialNetworkConnect  
      shibboleth    xV$      #logonForm_privatePolicy_back_button  $      logonForm_close_privatePolicy_dialog   #	      logonForm     $y
#      #logonForm_privatePolicy_cross_span   ^      #facebookLink     .      #googleLink   F+      #linkedinLink     2      #twitterLink  gv	      #samlLink     ITF      saml  j      form[name="logonForm"]    ?      #logonForm_policy_block   $$"      standard  ho-      #logonForm_subscriptionChoice_top_title_block     <#      #logonForm_subscriptionChoice_block   zU      #logonForm_auth_modes_block   .#      #logonForm_socialNetworkChoice_grid   "	      need_like     >)      div#facebookLike  r      url_like  mY!      label#logonForm_facebook_like_url     8      need_follow   p/      div#twitterFollow     7D      name_follow   /      label#logonForm_twitter_follow_auto_screen_name   5.      authModeOpenidconnectEnabled  H      ^openidconnect_[\d]*$     A:*      #logonForm_socialNetworkChoice_openid_grid    Ql      <div class="openidDiv hoverLink" title="Use your OpenID Connect credentials" onclick="socialNetworkConnect('  o      ')"><div id="     Y      Link" class="openidconnectSmallBox" style="display:none"></div><label class="openidSpan">     $      </label></div>    <V      Link  %      wispr           #logonForm_wispr_grid     &      operator_realm    A5	      operator        realm     $      select#user_wispr_operator    P      <option value="   	      </option>           change    Qi(      current_operator  M      potential_realm   ~      auto_complete_realm   #hI      index_point   "Q      #logonForm_saml_grid  V&      div#logonForm_saml_grid label.samlSpan     a"      #logonForm_logon_block_credentials    W0      logonForm_policy_is_ok          need_policy   x}m      policy_checked    vY      detach    -K%      #no_logonForm_logon_block_credentials           policyResume  |4      #logonForm_logon_policy_text  O=L      #logonForm_policy_resume        $.settings.logon.     T      .policy   z      policyWrapper     Z      getUserLanguage_default   ,$+      #logonForm_socialNetwork_privatePolicy_text   :-      #logonForm_socialNetwork_privatePolicy_resume     U      displayRegistrationFirst  L2      insertBefore  ,      #logonForm_block  i      usr   :tUm      #uc-logonForm-login   /}      #logonForm_login_block          #logonForm_login_sms_info_block   	      logonForm_empty   b}      logonForm_login_info_text           information_text        #logonForm_login_info_text    VI      form[name="logonForm"] input[name="logonForm_logon_privatePolicy_accept"]     :k      #subscriptionChoice   Mn      logonFormSubscriptionLinkBack     &      do_socialNetworkConnect   G      inArray   d      ajax  z      social_network_walled_garden  Sa      socialNetworkConnectCallback  ,
      error_logon_internal  }co	      xhrFields     s      withCredentials   a)      crossDomain   3      form[name="logonForm"] input[name="twitter_follow"]   2      form[name="logonForm"] input[name="facebook_like"]    Ff2      $.settings.private_policy     J      $.settings.logon.policy   NY-      #logonForm_socialNetwork_privatePolicy_accept     5'      #logonForm_privatePolicy_connect_button   :o&      #logonForm_socialNetwork_policy_accept    JJ      error_logon_bad-policy-accept     \l      self  
      /shibauth.php     	A      .main_mode_container  ;      slideToggle   f`      easing    PT      #logonForm_privatePolicy_dialog   
       socialNetwork     j      redirectURL   L      _privatePolicy_connect_button           unbind    :      _privatePolicy_accept     n      _privatePolicy_dialog     odd      showWisprConnect  &      .logonForm_classic_elements          .logonForm_wispr_elements     >L      #feedbackForm_disconnect_button   d      form[name="feedbackForm"]     3      feedback  vL      pms   e      customer  P       #feedbackForm_pms_customer_block   B      #feedbackForm_pms_message_block   f      caution   l"S      #feedbackForm_caution_block   n      requestedURL  $v!      #feedbackForm_requested_url_block           #feedbackForm_login_block     f      profile   uD      #feedbackForm_profile_block   t      services	  `      #feedbackForm_services_block
  	      ipAddress     x      #feedbackForm_ip_address_block    >J      incomingNetwork   z$      #feedbackForm_incoming_network_block  DV(      incomingZone  l!      #feedbackForm_incoming_zone_block     v3      feedbackForm_multidevice_block    j      validity  ,      #feedbackForm_validity_block  ^;      totalTimeCredit   %%      #feedbackForm_total_time_credit_block     8v$      forceDiscTimer    Y+      #feedbackForm_automatic_disconnection_block   i      totalConsumedTimeCredit   .      #feedbackForm_total_consumed_time_credit_block    k6      #feedbackForm_time_credit_block   k      consumedData  j-      #feedbackForm_quota_total_consumed_data_block           userLang  Y	      substring     }oJ      createEvent         MouseEvents    :Uh	      initEvent!     a'      dispatchEvent"     $^      feedbackFormRefresh#   4      userSettings$  q       #feedbackForm_pms_customer_value%  R      #feedbackForm_pms_message_value&   W@      #feedbackForm_caution_text'    u0      #feedbackForm_caution_oob_text(    K       warning)   X      postConnectRedirect*          #feedbackForm_requested_url_link+  C      delay,     ~,      #feedbackForm_postConnectRedirectDelay_block-  gv      #feedbackForm_login_value.     =      #feedbackForm_profile_value/   :      feedbackForm_package_display0        #feedbackForm_package_block1   B      #feedbackForm_services_value2        #feedbackForm_ip_address_value3    $      #feedbackForm_incoming_network_value4  \!      #feedbackForm_incoming_zone_value5     K      feedbackForm_multidevice_fillIn6   GV      schedule7  {      feedbackForm_schedule_display8     O      #feedbackForm_schedule_value9        timezoneLocalOffset:   !$      #feedbackForm_validity_value;  v!      feedbackForm_validity_valid-until<     K\"      feedbackForm_validity_always-valid=    x	      reneweach>     #      feedbackForm_time-credit-renew-each?   J      feedbackForm_time-credit@  s|      #feedbackForm_time_credit_valueA   @F	      remainingB     ],      feedbackForm_remainingTimeCredit_timer_startC  w)      #feedbackForm_remaining_time_credit_blockD     )      #feedbackForm_remaining_time_credit_valueE     M.!      feedbackForm_forceDiscTimer_startF     |+      #feedbackForm_automatic_disconnection_valueG         downloadH  ${	      text_dateI     E)	      text_usedJ     '      text_maxK  <D
      vol_max_upL    _,      vol_max_downM  "      disconnect_quotaN  	      sum_quotaO     	      extraP     }dW      isDisconnectQuotaQ     y
      isSumQuotaR    TW      totalS     o      uploadT    
      renewTimestampU    Z?*      feedbackForm_quota_consumedData_with_renewV    7      obj_dateW  `'      timezoneOffsetX    ud{#      getTimezoneOffsetY     ?|-      feedbackForm_quota_consumedData_with_sincneweZ     i      timezone[  	k7      data_up\         data_sum]  0      feedbackForm_quota_consumedData_sum_with_max_sum^   -	      data_down_     W      data_consumed_up`        data_consumed_downa    x!
6      feedbackForm_quota_up_consumedData_with_max_individualb    lz8      feedbackForm_quota_down_consumedData_with_max_individualc  c=#      feedbackForm_quota_consumedData_sumd   Ju*      feedbackForm_quota_consumedData_individiale    Z
-      #feedbackForm_quota_total_consumed_data_valuef     G      white-spaceg   B
      pre-wraph  f      browseri   5      msiej  a2F      #reserved_block form[name="feedbackForm"] td[colspan!="2"]:first-childk    #      text-align: rightl     *831      feedbackForm_postConnectRedirectDelay_timer_startm     ./.      feedbackForm_postConnectRedirectDelay_redirectn    *e      disconnectButtono  {      feedbackFormWaitingp   u       feedbackForm_forceDiscTimer_stopq  r+      feedbackForm_remainingTimeCredit_timer_stopr   B      feedbackFormDisconnectCallbacks    \O*      logout_URL_paramst     Aa      describeu  z8z      describeLanguagev  #       accountRefillForm_no_descriptionw  `      freex  b{      free_packagey  r      pricez     #"      #feedbackForm_package_value{   G\      <ul style="margin: 0px; padding: 0px; list-style-position: inside; list-style-type: circle">|  bS	      entry_itt}     lMj      entry_value_itt~   )%o
      begin_date    Fu      setHours  MY4      begin     mK<
      setMinutes    U       min   _8[      end_date  .+      end   "'      <li>  /~      feedbackForm_schedule_all-day     D9"      feedbackForm_schedule_1-day   2"      short-time-display-without-seconds    5^      feedbackForm_schedule_all-week    %2]      feedbackForm_schedule_2-days        </li>     ]X      </ul>     >E      remainingTimeCredit   L.      feedbackForm_remainingTimeCredit_timer_display    %      feedbackForm_time-credit-with-seconds     75      resource  n.#      feedbackForm_forceDiscTimer_display   q      #feedbackForm_multidevice_value   kD      #feedbackForm_multidevice_block   &      postConnectRedirectDelay  U3      feedbackForm_postConnectRedirectDelay_timer_display   :]&0      feedbackForm_postConnectRedirectDelay_timer_stop  <m+      #feedbackForm_postConnectRedirectDelay_text   [H4+      feedbackForm_postConnectRedirectDelay_value   ef      #modifyPwdForm_back_button    s      modifyPwdLink_display     |      #modifyPwdForm_confirm_button     *      modifyPwdFormConfirm  9      form[name="modifyPwdForm"]    f      #modifyPwdLink_link   f]      #modifyPwdForm_help_link  m8      modifyPwdForm_HelpBlock_display   e>      #uc-new_pwd_mod   EbP      #modifyPwdLink          #feedbackForm_settings_link   ;P      #modifyPwdForm_help_tr    K
      #modifyPwdForm_help_block           modifyPwdForm_empty   cR      allowModPwdBySelf     G{       form[name="modifyPwdForm"] input  0}      modifyPwdFormWaiting  f00      form[name="modifyPwdForm"] input[name="old_pwd"]  Y0      form[name="modifyPwdForm"] input[name="new_pwd"]  dP4      form[name="modifyPwdForm"] input[name="confirm_pwd"]  N      modifyPwdFormConfirmCallback  e.      modifyPwdForm     P      #modifyPwdForm_help_list  `      #modifyPwdForm_help_list li   Kxh      #modifyPwdHelpBlock_text  9      modifyPwdForm_help_text   ?!      #modifyPwdForm_help_list li:first     (      modifyPwdForm_help_   l%      modifyPwdForm_help_character_set_text     m-#      #getPurchaseSummaryForm_back_button   "6b      getPurchaseSummaryLink_display    80d'      #getPurchaseSummaryForm_download_button   9B$      getPurchaseSummaryFormConfirm     X#      form[name="getPurchaseSummaryForm"]   N[      #getPurchaseSummaryLink_link  l<      getPurchaseSummaryFormGenerate    /      #getPurchaseSummaryLink   0v      getPurchaseSummaryForm_fillIn     p/      getPurchaseSummarySettings    w      amount    lV$      #getPurchaseSummaryForm_amount_value  Yx      downloadLink  %=%      #getPurchaseSummaryForm_download_link     x*D      getPurchaseSummaryFormWaiting     WuJ&      getPurchaseSummaryFormGenerateCallback    ^GNv      getPurchaseSummaryForm    9      form[name="upgradeAccountForm"] input[name="multidevice"]     KH`      keyup           upgradeAccountForm_change     M$      #upgradeAccountFormLinks_back_button  D~Y      upgradeAccountFormLink_display    6}*      #upgradeAccountFormMultidevice_back_button    k      upgradeAccountCheckForm_display   Li6'      upgradeAccountOgoneRedirectForm_display   5u,,      #upgradeAccountFormMultidevice_update_button  *      upgradeAccountForm_getAmount  $      #upgradeAccountCheckForm_back_button  T%      #upgradeAccountCheckForm_check_button           upgradeAccountCheckForm_check     l(.+      #upgradeAccountOgoneRedirectForm_pay_button   yh
#      upgradeAccountOgoneRedirectForm_pay   8,      #upgradeAccountOgoneRedirectForm_back_button  (      form[name="upgradeAccountForm"]   N%      form[name="upgradeAccountResultForm"]     W      #upgradeAccountLink_link  $z       upgradeAccountForm_links_display  %9      #upgradeAccountFormLinks_add_simultaneous_connection_link     ;uU      upgradeAccountFormGenerate    :+      #upgradeAccountFormLinks_check_payment_link   x      upgradeAccount    ,      form[name="upgradeAccountOgoneRedirectForm"]  Xu&      #upgradeAccountForm_links_explain_text    b aZ       #upgradeAccountForm_explain_text  2x      #upgradeAccountForm_separator     RO*      upgradeAccountForm_links_in_manage_display    T4      upgradeAccountForm_addSimultaneousConnection_display  f8      upgradeAccountForm_empty  `@%      upgradeAccountOgoneRedirectForm_empty     C      #upgradeAccountFormMultidevice    $      form[name="upgradeAccountCheckForm"]  {+      #upgradeAccountFormMultidevice_update_block   bz}      upgradeAccountPackage           currencyLanguage  J&-      #upgradeAccountForm_package_description_value     l#      #upgradeAccountForm_amount_currency    t2      form[name="upgradeAccountForm"] input[type="text"]    0       #upgradeAccountForm_amount_value  ,      upgradeAccountForm_waiting    #      upgradeAccountForm_getOrderCallback   q&      upgradeAccountOgoneRedirectForm_fillIn    !s\D      form[name="upgradeAccountOgoneRedirectForm"] input[name="encrypted"]  h      packageEncr   k      ogoneUrlPost  @      form[name="upgradeAccountOgoneRedirectForm"] input[name="PSPID"]  B      pspid     \A      form[name="upgradeAccountOgoneRedirectForm"] input[name="USERID"]     YB      userid    T?      form[name="upgradeAccountOgoneRedirectForm"] input[name="PSWD"]   '      userpassword  >B      form[name="upgradeAccountOgoneRedirectForm"] input[name="ORDERID"]    Aq5A      form[name="upgradeAccountOgoneRedirectForm"] input[name="AMOUNT"]     C      form[name="upgradeAccountOgoneRedirectForm"] input[name="CURRENCY"]   dbC      form[name="upgradeAccountOgoneRedirectForm"] input[name="LANGUAGE"]    -8]B      form[name="upgradeAccountOgoneRedirectForm"] input[name="SHASIGN"]    4.(      shasign   ,uA      form[name="upgradeAccountOgoneRedirectForm"] input[type="hidden"]     
      removeAttr    xF      ogonePaymentFormWaiting   yH+      upgradeAccountOgoneRedirectForm_payCallback   "G%      upgradeAccountCheckForm_checkCallback     "      upgradeAccountFormGenerateCallback          upgradeAccountForm	    U	      pwdRecoveryForm_changed
   c1      form[name="pwdRecoveryForm"] input[name="prefix"]     K      focus     s"      pwdRecoveryForm_modifyEvent   -&      pwdRecoveryForm_phoneHelpBlock_display    %      blur  ^Q<a0      form[name="pwdRecoveryForm"] input[name="phone"]  R      form[name="pwdRecoverySetForm"]   r      form[name="pwdRecoveryForm"]  'm"      form[name="pwdRecoveryResendForm"]    &e(      form[name="pwdRecoveryResendResultForm"]  =z"      #logonForm_forgotPasswordLink_link    s       #pwdRecoveryForm_phone_help_link  u%      #pwdRecoveryResendForm_sms_link   `      pwdRecoveryResendForm_sendBySms   2@!      #pwdRecoveryResendForm_email_link     /u!      pwdRecoveryResendForm_sendByEmail     %      #pwdRecoveryResendForm_questions_link     xH-      pwdRecoveryResendForm_questions_block_display     <g"      #pwdRecoveryResendForm_links_block    T&      #pwdRecoverySetLink_link  ):      #pwdRecoveryForm_back_button  "Q      #pwdRecoveryForm_confirm_button    k      pwdRecoveryForm_confirm!   ",      #pwdRecoveryResendForm_questions_back_button"  8B(Q      pwdRecovery#   /      modes$     ?]      pwdRecoveryResendForm_display%     Wu.      #pwdRecoveryResendForm_questions_update_button&    S%      pwdRecoveryResendForm_sendByQuestions'     ]"      #pwdRecoveryResendForm_back_button(    X;      #pwdRecoverySetForm_back_button)   R!      #pwdRecoverySetForm_update_button*           pwdRecoverySetForm_update+     P(      #pwdRecoveryResendResultForm_back_button,  #      pwdRecoveryResendResultForm_display-   dAb      delegate.  &      form[name="pwdRecoverySetForm"] select/    (      pwdRecoverySetForm_updateQuestionChoices0        #logonForm_forgotPasswordLink1     u      pwdRecoveryForm_empty2     V4	"      form[name="pwdRecoveryForm"] input3    b#      #pwdRecoveryForm_phone_prefix_value4   5M"      pwdRecoveryForm_phone_prefix_value5    7w_"      #pwdRecoveryForm_phone_phone_value6    VP'!      pwdRecoveryForm_phone_phone_value7     u#0      #pwdRecoveryForm_phone_help_prefix_example_value8  E/      pwdRecoveryForm_phone_help_prefix_example_value9   U/      #pwdRecoveryForm_phone_help_phone_example_value:   h.      pwdRecoveryForm_phone_help_phone_example_value;    PVj!      #pwdRecoveryForm_phone_help_block<     0      form[name="pwdRecoveryForm"] input[name="login"]=  =i0      form[name="pwdRecoveryForm"] input[name="email"]>  F!      pwdRecoveryFormWaiting?    o      pwdRecoveryForm_confirmCallback@   $F#      form[name="pwdRecoveryForm"] buttonA   (	      questionsB     pr+      #pwdRecoveryResendForm_questions_link_blockC   a%      #pwdRecoveryResendForm_sms_link_blockD     G6'      #pwdRecoveryResendForm_email_link_blockE   #      pwdRecoveryResendForm_emptyF   )P%      pwdRecoveryResendForm_fillInQuestionsG     M+&      #pwdRecoveryResendForm_questions_blockH    Wi      form[name="pwdRecoveryResendForm"] div[id^="pwdRecoveryResendForm_question_"][id$="_block"][id!="pwdRecoveryResendForm_question_base_block"]I  X3      availableQuestionsJ    EG      questionIndexK     AW      questionValueL     Z`*      #pwdRecoveryResendForm_question_base_blockM          _baseN     4PB      spanO  A*]      pwdRecoverySecretQuestion_P    2      pwdRecoveryResendFormWaitingQ  I:"      pwdRecoveryResendForm_sendCallbackR    R9      form[name="pwdRecoveryResendForm"] input[name^="answer_"]S     b      trimT  &-      pwdRecoveryResendForm_sendByQuestionsCallbackU     d"      pwdRecoveryResendResultForm_fillInV    OWV)      form[name="pwdRecoveryResendForm"] buttonW     GawU      #pwdRecoverySetLinkX   @      #manageAccountForm_links_blockY    "      pwdRecoverySetForm_fillInQuestionsZ    mi      manageAccountForm_links_display[   G      pwdRecoverySetForm_empty\        itt]         maxQuestions^  +'      #pwdRecoverySetForm_question_base_block_   k^/      pwdRecoverySetForm_question_base_default_option`         answersa   r      form[name="pwdRecoverySetForm"] div[id^="pwdRecoverySetForm_question_"][id$="_block"][id!="pwdRecoverySetForm_question_base_block"]b   Rg-      form[name="pwdRecoverySetForm"] select optionc     X l      selectedQuestionsd     u2      pushe  Gm$A      selectValuef   m      pwdRecoverySetFormWaitingg     l&      form[name="pwdRecoverySetForm"] buttonh    T9      form[name="pwdRecoverySetForm"] select[name^="question_"]i     S6      form[name="pwdRecoverySetForm"] input[name^="answer_"]j    !      pwdRecoverySetForm_updateCallbackk     c!      pwdRecoveryResendResultForm_emptyl     aWT      form[name="pwdRecoveryResendResultForm"] #pwdRecoveryResendResultForm_password_valuem  +      manageAccountForm_personal_settings_changedn   4< 3      form[name="manageAccountForm"] input[name="prefix"]o    /      manageAccountForm_personal_settings_modifyEventp   L:      manageAccountForm_personal_settings_phoneHelpBlock_displayq    ,=,2      form[name="manageAccountForm"] input[name="phone"]r    R$      #manageAccountForm_links_back_buttons  }0      #manageAccountForm_personal_settings_back_buttont  hb 2      #manageAccountForm_personal_settings_update_buttonu    ZY*      manageAccountForm_personal_settings_updatev    J&      #manageAccountForm_devices_back_buttonw    X(      #manageAccountForm_devices_update_buttonx  O|       manageAccountForm_devices_updatey  >      form[name="manageAccountForm"]z    9      #manageAccountLink_link{   $6/      #manageAccountForm_links_personal_settings_link|   K/+      manageAccountForm_personal_settings_display}   cO!      manageAccountForm_devices_display~     0%      #manageAccountForm_links_devices_link     I,,      #manageAccountForm_links_account_refill_link  hH      accountRefillForm_display     1Y4      #manageAccountForm_personal_settings_phone_help_link  mSW/      #manageAccountForm_links_modify_my_package_link   O8       modifyPackageForm_package_update  ?#0      #manageAccountForm_devices_block div.trashButton  t1!       manageAccountForm_devices_delete  ;J      #manageAccountLink          manageAccount           managePersonalSettings    i5      #manageAccountForm_links_personal_settings_link_block     q      manageDevices     5oL+      #manageAccountForm_links_devices_link_block   ^      allowmodifypackage    .0      #manageAccountForm_links_modify_my_package_block  	      accountRefill     2      #manageAccountForm_links_account_refill_link_block    v*      manageAccountForm_personal_settings_fillIn    R*      #manageAccountForm_personal_settings_block    >%)      manageAccountForm_personal_settings_empty     p       manageAccountForm_devices_fillIn  M       #manageAccountForm_devices_block  ~      manageAccountForm_devices_empty         ^portal-([a-zA-Z_-]+)$    t{      defaultBehavior   ]c      creationModeSettings  ;<      tr[id^="manageAccountForm_personal_settings_"][id$="_block"]  8>      span[id^="manageAccountForm_personal_settings_"][id$="_state"]    J`y@      #manageAccountForm_personal_settings_postal_postoffice_box_state  6~H      #manageAccountForm_personal_settings_postal_state_or_province_name_state  A4      #manageAccountForm_personal_settings_last_name_state  1qb6      form[name="manageAccountForm"] input[name="last_name"]    k4      #manageAccountForm_personal_settings_last_name_block  5      #manageAccountForm_personal_settings_first_name_state     n!7      form[name="manageAccountForm"] input[name="first_name"]    5      #manageAccountForm_personal_settings_first_name_block     _{20      #manageAccountForm_personal_settings_email_state  2      form[name="manageAccountForm"] input[name="email"]    0      #manageAccountForm_personal_settings_email_block        phoneNumber   X0      #manageAccountForm_personal_settings_phone_state  0      #manageAccountForm_personal_settings_phone_block  lC      #manageAccountForm_personal_settings_organizational_unit_name_state   vEE      form[name="manageAccountForm"] input[name="organizational_unit_name"]     |C      #manageAccountForm_personal_settings_organizational_unit_name_block   Wp>      #manageAccountForm_personal_settings_postal_country_name_state    w      countryName   @      form[name="manageAccountForm"] input[name="postal_country_name"]  `?      #manageAccountForm_personal_settings_postal_locality_name_state   #      localityName  `A      form[name="manageAccountForm"] input[name="postal_locality_name"]     6      #manageAccountForm_personal_settings_postal_code_state    ;8      form[name="manageAccountForm"] input[name="postal_code"]  :9      #manageAccountForm_personal_settings_postal_address_state     4P;      form[name="manageAccountForm"] input[name="postal_address"]   Yn      stateOrProvinceName   jJ      form[name="manageAccountForm"] input[name="postal_state_or_province_name"]    ^      postOfficeBox     6nqB      form[name="manageAccountForm"] input[name="postal_postoffice_box"]    :!9      #manageAccountForm_personal_settings_postal_address_block           userCustomFields  ?      customFields  v
      fieldid   &8>[      personalField_    'Z4      #manageAccountForm_personal_settings_personal_field_  o}:      form[name="manageAccountForm"] input[name="personal_field_          "]    3&      #manageAccountForm_privatePolicy_block    IKS      form[name="manageAccountForm"] input[name="manageAccountForm_privatePolicy_accept"]   ea=      #manageAccountForm_personal_settings_block input[type="text"]     !w      #manageAccountForm_personal_settings_block span[id^="manageAccountForm_personal_settings_personal_field_"][id$="_text"]   Tb5      #manageAccountForm_personal_settings_phone_help_block     |D7      #manageAccountForm_personal_settings_phone_prefix_value   .i6      manageAccountForm_personal_settings_phone_prefix_value    6      #manageAccountForm_personal_settings_phone_phone_value    ]5      manageAccountForm_personal_settings_phone_phone_value     zc
D      #manageAccountForm_personal_settings_phone_help_prefix_example_value  Z>C      manageAccountForm_personal_settings_phone_help_prefix_example_value   ,5C      #manageAccountForm_personal_settings_phone_help_phone_example_value   nfB      manageAccountForm_personal_settings_phone_help_phone_example_value    m(      field_names   
91
      field_name    !*      #manageAccountForm_devices_no_device_block    Z      devices   Kk      userDevices   vD      deviceIndex   T      deviceValues  sE      address   'H%      #manageAccountForm_devices_base_block     8      comment   \_6      locked          current   ]!6      currentDevice     *      div.trashButton         #manageAccountForm_devices_block tr[id^="manageAccountForm_devices_"][id$="_block"][id!="manageAccountForm_devices_base_block"][id!="manageAccountForm_devices_no_device_block"]  v=      parents   ur8k2      tr[id^="manageAccountForm_devices_"][id$="_block"]          manageAccountFormWaiting  R%      form[name="manageAccountForm"] button     !r=      form[name="manageAccountForm"] input[name="personal_field_1"]     FE2=      form[name="manageAccountForm"] input[name="personal_field_2"]     =      form[name="manageAccountForm"] input[name="personal_field_3"]     =,2      manageAccountForm_personal_settings_updateCallback    +R5      form[name="manageAccountForm"] input[name^="device_"]     vl)      modifyPackageForm_cancel_button_show_hide     oO%      form[name="modifyPackageForm"] button     P}      modifyPackageFormCallback     r<      modifyPackageForm_display           accountRefillForm_changed     k <      form[name="accountRefillForm"] select[name="select_package"]  h,a      accountRefillFormPay  hs}      form[name="accountRefillForm"]    JB!      #logonForm_accountRefillLink_link     J9L      #paypalRefillLink     @#y      accountRefillPaymentSubscribe     .      #ogoneRefillLink  j|q      #accountRefillForm_back_button    K(      resetPaymentProcess   JU      #accountRefillForm_pay_button     C!      #accountRefillForm_confirm_button     (      accountRefillForm_confirm     &      accountRefillForm_get_free_refill_code    g      accountRefillFormWaiting  "Q-      accountRefillFormResetPayment_confirmCallback     Thw!      accountRefillForm_paymentValidate      2      form[name="accountRefillForm"] input[name="login"]    /7      form[name="accountRefillForm"] input[name="refillcode"]   Z*      #accountRefillForm_table  _5      #accountRefillForm_explain     Ns      #logonForm_accountRefillLink  D)      refill_process     :y      options   y\      optionsInfos        defaultOptionText     ry8      refill    Nb.      paypalOptionPaymentForm_default_package_option    _]\%      #accountRefillForm_select_option_text     $      accountRefillForm_select_option_text	  \      #accountRefillForm_title_text
     N      accountRefillForm_title_text  ,      #accountRefillForm_explain_text   T      accountRefillForm_explain_text    -      #accountRefillForm_option_description_explain     /,      accountRefillForm_option_description_explain  7tB*      #accountRefillForm_option_description_text    7)      accountRefillForm_option_description_text           empty     %@      <option id="accountRefillForm_default_option" selected value="">  k&      #accountRefillForm_option_user_explain    o	6      form[name = "accountRefillForm"] input[name = "login"]    d9      form[name = "accountRefillForm"] input[name = "password"]     d@      form[name = "accountRefillForm"] select[name = "select_package"]  jTn1      accountRefillFormPaymentSubscribe_confirmCallback     ;      form[name = "accountRefillForm"] input[name = "refillcode"]   q %!      accountRefillForm_confirmCallback     57      form[name = "accountRefillForm"] input[name  = "login"]   :      form[name = "accountRefillForm"] input[name  = "password"]    E      PAYPAL    ?xm"      paypalPaymentForm_options_describe    Gj      OGONE     !      ogonePaymentForm_options_describe      
m%      form[name="accountRefillForm"] button!     l[V      optionInfos"   >#      #refillForm_subscriptionChoice_grid#   |E#      #accountRefillForm_behavior_explain$   =<      form[name = "accountRefillForm"] input[name  = "refillcode"]%  J^      form[name="accountRefillForm"] select[name="select_package"] #accountRefillForm_default_option&    1	      :selected'     +      #accountRefillForm_option_description_value(         description)   _$      #autoLogonForm_connect_button*     R      autoLogonFormConnect+  z      form[name="autoLogonForm"],    zS      auto-  z"      autoLogonWithSecurePasswordConnect.    ],      #autoLogonForm_policy_block/   V7      #autoLogonForm_policy_text0    . 	      SUBSCRIBE1           AUTO2  Ph.      autoLogonFormWaiting3  L]6      form[name="autoLogonForm"] input[name="policy_accept"]4    Fb      autoLogonFormConnectCallback5  M      autoUrl6   D*      autoLogonWithSecurePasswordConnectCallback7    !*      other_choices8     .k)      #oneSubscriptionForm_other_choices_button9     J#'      #oneSubscriptionForm_other_choices_link:   ;&      oneSubscriptionFormOtherChoices;   3#      #oneSubscriptionForm_connect_button<   y      oneSubscriptionFormConnect=    dl       form[name="oneSubscriptionForm"]>  Mf9      #oneSubscriptionLink?  _F      oneSubscriptionLinkEnable@     z      #one_facebookLinkA     -      socialNetworkConnectOneB   ~CG      #one_googleLinkC         #one_linkedinLinkD     |L=      #one_twitterLinkE  ,      .custom_checkboxF  >1a      toggle_checkboxG   e      .custom_checkbox_1H          toggle_textI   {g0"      #logonForm_subscriptionChoice_gridJ    "      #subscriptionChoiceInsertK     j      #logonFormSubscriptionLink_linkL   B{$      #directSubscriptionForm_explain_textM  Y)      #oneSubscriptionForm_connect_policy_blockN     |P      subscriptionForm_configureO    SdR      clonefbLikeP   O      onefacebookLikeQ   #g      #facebookInputR          onefacebookInputS  oQ      #logonForm_facebook_like_textT     [&      oneSubscriptionForm_facebook_like_textU    P      #logonForm_facebook_like_urlV  }%      oneSubscriptionForm_facebook_like_urlW     549-      #oneSubscriptionForm_socialNetworkChoice_gridX     %Ys      div#onefacebookLikeY   +)      cloneTwiterFollowZ     ~      onetwitterFollow[  hh      #twitterInput\     Yr      onetwitterInput]   Fj      #logonForm_twitter_follow_text^    u'      oneSubscriptionForm_twitter_follow_text_   MA*      #logonForm_twitter_follow_auto_screen_name`    c$3      oneSubscriptionForm_twitter_follow_auto_screen_namea   K      div#onetwitterFollowb  p 9      label#oneSubscriptionForm_twitter_follow_auto_screen_namec     <(      #oneSubscriptionForm_other_choices_blockd  !s(      #oneSubscriptionForm_connect_policy_texte  lGp"      #oneSubscriptionForm_policy_resumef          ONEg   >	U%      subscriptionForm_commonFields_displayh     $      #subscriptionForm_fields_state_blocki        blockj     E-      #subscriptionForm_div_statek   J%'      #oneSubscriptionForm_fields_state_blockl   -      subscriptionForm_emptym    z9j'      subscriptionForm_phoneHelpBlock_displayn   [*      subscriptionForm_passwordHelpBlock_displayo    }"'      oneSubscriptionFormWaitingp          subscriptionFormSubscribeq     ieRX      form[name="oneSubscriptionForm"] input[name="oneSubscriptionForm_connect_policy_accept"]r  +U"      oneSubscriptionFormConnectCallbacks    T      form[name="oneSubscriptionForm"] input[name="subscriptionForm_privatePolicy_accept"]t  0=      form[name="oneSubscriptionForm"] input[name="twitter_follow"]u     8n<      form[name="oneSubscriptionForm"] input[name="facebook_like"]v  >U#      #directSubscriptionForm_back_buttonw   $@      directSubscriptionFormBackx    u(      #directSubscriptionForm_subscribe_buttony  3      directSubscriptionFormSubscribez   )      #directSubscriptionResultForm_back_button{     U#      form[name="directSubscriptionForm"]|   C)      form[name="directSubscriptionResultForm"]}     N4      #directSubscriptionLink~   M/|      directSubscriptionLinkEnable  jU&      directSubscriptionResultForm_configure          directSubscriptionFormWaiting     X_'      directSubscriptionFormSubscribeCallback   ;`$      directSubscriptionResultForm_display  6      dpsk  ,	      available     u      wlan  ]-      #directSubscriptionResultForm_dpsk_wlan_block     s
      passphrase    3      #directSubscriptionResultForm_dpsk_passphrase_block   +\/      #directSubscriptionResultForm_dpsk_explain_text   ;[!&6      #directSubscriptionResultForm_dpsk_download_link_block    58      #directSubscriptionResultForm_dpsk_download_explain_text  o[.      #directSubscriptionResultForm_dpsk_title_block    lK60      #directSubscriptionResultForm_dpsk_explain_block  )      #directSubscriptionResultForm_login_value     Wo      tmp_input_params  _A      userPassword  Q,      #directSubscriptionResultForm_password_value  	      ********  t\      hidePortalCredentials     :l
-      #directSubscriptionResultForm_dpsk_wlan_value     _3      #directSubscriptionResultForm_dpsk_passphrase_value   R      downloadURL   k&      #directSubscription_dpsk_download_link    ""      directSubscriptionResultForm_empty    7"      #printSubscriptionForm_back_button    t/_      printSubscriptionFormBack     '      #printSubscriptionForm_subscribe_button   ^      printSubscriptionFormSubscribe    kn(      #printSubscriptionResultForm_back_button  }*%"      form[name="printSubscriptionForm"]    w:(      form[name="printSubscriptionResultForm"]  t]      #printSubscriptionLink    `      printSubscriptionLinkEnable   v      printSubscriptionFormWaiting  O(&      printSubscriptionFormSubscribeCallback    S]=#      printSubscriptionResultForm_display          #smsSubscriptionForm_back_button  ,      smsSubscriptionFormBack   Te%      #smsSubscriptionForm_subscribe_button     0T      smsSubscriptionFormSubscribe  d       form[name="smsSubscriptionForm"]  @O      #smsSubscriptionLink  @9      smsSubscriptionLinkEnable     K      smsSubscriptionFormWaiting    $      smsSubscriptionFormSubscribeCallback  !      #mailSubscriptionForm_back_button     P      mailSubscriptionFormBack  #c&      #mailSubscriptionForm_subscribe_button    d8|I      mailSubscriptionFormSubscribe     7!      form[name="mailSubscriptionForm"]     ^dM      #mailSubscriptionLink     	U      mailSubscriptionLinkEnable    ">      autofill  I      mailSubscriptionFormWaiting   R%      mailSubscriptionFormSubscribeCallback     XE$      paypalSubscriptionResultForm_changed  SgC@      form[name="paypalSubscriptionResultForm"] input[name="send_sms"]  sN(      paypalSubscriptionResultFormSend_display  /hA      form[name="paypalSubscriptionResultForm"] input[name="send_mail"]     ^ B=      form[name="paypalSubscriptionResultForm"] input[name="email"]     [)(      paypalSubscriptionResultForm_modifyEvent  L3      paypalSubscriptionResultForm_phoneHelpBlock_display   >      form[name="paypalSubscriptionResultForm"] input[name="prefix"]    0=      form[name="paypalSubscriptionResultForm"] input[name="phone"]     O#      #paypalSubscriptionForm_back_button   q      paypalSubscriptionFormBack    d(      #paypalSubscriptionForm_subscribe_button        paypalSubscriptionFormSubscribe   P@)      #paypalSubscriptionResultForm_back_button     5)      #paypalSubscriptionResultForm_send_button     ^r*      paypalSubscriptionResultFormSendCredential    _f#      form[name="paypalSubscriptionForm"]   3)      form[name="paypalSubscriptionResultForm"]     y      #paypalSubscriptionLink   
ZK      paypalSubscriptionLinkEnable  $6      #paypalSubscriptionResultForm_send_sms_phone_help_link    'r      showSendSms   t4      showSendMail  V
$      #paypalSubscriptionForm_explain_text  u>)      paypalOptionSubscriptionForm_explain_text     6      sendSms   Lm,      #paypalSubscriptionResultForm_send_sms_block  U 2      #paypalSubscriptionResultForm_send_sms_phone_block    Bi      sendMail  @-      #paypalSubscriptionResultForm_send_mail_block     '*6      #paypalSubscriptionResultForm_send_email_address_block    _      form[name="paypalRedirectForm"]   n+      paypalSubscriptionFormWaiting     yf'      paypalSubscriptionFormSubscribeCallback   83$      paypalSubscriptionResultForm_display  )      #paypalSubscriptionResultForm_login_value     #,      #paypalSubscriptionResultForm_password_value  	,`?      form[name="paypalSubscriptionResultForm"] input[name="end_sms"]   q      subscriptionForm_changed  @,7      form[name="paypalSubscriptionForm"] input[name="email"]   >tY8      form[name="paypalSubscriptionForm"] input[name="prefix"]  ^e7      form[name="paypalSubscriptionForm"] input[name="phone"]   1""      paypalSubscriptionResultForm_empty    M*gW.      paypalOptionSubscriptionResultForm_back_button    <}^<      form[name="paypalSubscriptionResultForm"] input[type="text"]  oN@      form[name="paypalSubscriptionResultForm"] input[type="checkbox"]  +:0      #paypalSubscriptionResultForm_result_login_value  }3      #paypalSubscriptionResultForm_result_password_value   7      #paypalSubscriptionResultForm_send_sms_phone_help_block   9      #paypalSubscriptionResultForm_send_sms_phone_prefix_value      E+8      paypalSubscriptionResultForm_send_sms_phone_prefix_value  8      #paypalSubscriptionResultForm_send_sms_phone_phone_value  57      paypalSubscriptionResultForm_send_sms_phone_phone_value   %VF      #paypalSubscriptionResultForm_send_sms_phone_help_prefix_example_value    :AE      paypalSubscriptionResultForm_send_sms_phone_help_prefix_example_value     ME      #paypalSubscriptionResultForm_send_sms_phone_help_phone_example_value     D      paypalSubscriptionResultForm_send_sms_phone_help_phone_example_value  SZK#      :visible  &s#      paypalSubscriptionResultFormWaiting   kv      sendMailOption    O       sendSmsOption     f2      paypalSubscriptionResultFormSendCredentialCallback    z      paypal_send_mail  eqz<      form[name="paypalPaymentForm"] select[name="select_package"]  iv      paypalPaymentFormPay  7      #paypalPaymentForm_back_button    .      paypalPaymentFormRefillBack   OU$      #paypalPaymentForm_disconnect_button  xO      paypalPaymentFormBack     J      #paypalPaymentForm_pay_button     4B*      #paypalPaymentResultForm_disconnect_button    "      paypalPaymentResultForm_disconnect     T'      #paypalPaymentResultForm_connect_button   L_      paypalPaymentResultForm_connect   P-!      form[name="paypalPaymentForm"]    $      form[name="paypalPaymentResultForm"]  Z@w      #payPalSendButton_Fake          paypalRedirectFormPay      n      paypalPaymentFormWaiting  Zl      paypalRedirectFormPayCallback           paypalSendPaymentForm	     97      form[name="paypalRedirectForm"] input[name="encrypted"]
   m      paypalUrlPost     :9/      ?cmd=_express-checkout&useraction=commit&token=   >      token     S      paypalInfos   :	#      create     )      #paypalPaymentForm_default_package_option     }@t&      #paypalPaymentForm_select_package_text    R/+      paypalOptionPaymentForm_select_package_text   e      #paypalPaymentForm_title_text     u"      paypalOptionPaymentForm_title_text    V;      #paypalPaymentForm_explain_text   9y$      paypalOptionPaymentForm_explain_text  .      #paypalPaymentForm_package_description_explain    <3      paypalOptionPaymentForm_package_description_explain   <+      #paypalPaymentForm_package_description_text   R0      paypalOptionPaymentForm_package_description_text        connectionProfile     \o      timeout   riI      form[name="paypalPaymentForm"] small#paypalPaymentForm_payment_timer_text     x3J      form[name="paypalPaymentForm"] small#paypalPaymentForm_payment_timer_value    oQQ      <option id="paypalPaymentForm_default_package_option" disabled selected value="">           waiting_paypal     	      verifying!     T      paypalPaymentResultForm_verify"          user_exists#   U3,      #paypalPaymentForm_package_description_value$  j*      paypalPaymentFormBackCallback%     ?^t#      paypalPaymentFormRefillBackCallback&   fB      paypalPaymentFormPayCallback'  m#      accountRefillForm_option_buyed_text(   ~X#      paypalOptionPaymentForm_refill_text)   P      #paypal_select_list*   H_'      #paypalPaymentForm_payment_detail_value+   7      paypalPaymentResultForm_display,   ?`      verifyTimer-   	;&      paypalPaymentVerify_payment_timer_stop.    N!+      #paypalPaymentResultForm_payment_timer_text/   7~-      error_logon_waiting-paypal-payment-validation0     P'      paypalPaymentVerify_payment_timer_start1         paymentTimer2  y;+      paypalPaymentResultForm_payment_timer_start3   ~%      #paypalPaymentResultForm_explain_text4     rW%      form[name="paypalPaymentWaitingForm"]5     >~Y,      #paypalPaymentWaitingForm_payment_timer_text6  #+      paypalPaymentWaitingForm_payment_timer_text7    *      paypalPaymentResultForm_payment_timer_stop8    bx      a_connect_link9    b}E-      paypalPaymentResultForm_payment_timer_display:     0Z&      #paypalPaymentResultForm_payment_timer;    TJ)      feedbackForm_automatic_disconnection_text<     -F,      #paypalPaymentResultForm_payment_timer_value=  ;&      feedbackForm_time-credit-without-hours>    ~&DE#      ogoneSubscriptionResultForm_changed?   pT?      form[name="ogoneSubscriptionResultForm"] input[name="send_sms"]@    I'      ogoneSubscriptionResultFormSend_displayA   Ke!@      form[name="ogoneSubscriptionResultForm"] input[name="send_mail"]B  <      form[name="ogoneSubscriptionResultForm"] input[name="email"]C  '      ogoneSubscriptionResultForm_modifyEventD   q2      ogoneSubscriptionResultForm_phoneHelpBlock_displayE    ]=      form[name="ogoneSubscriptionResultForm"] input[name="prefix"]F     3<      form[name="ogoneSubscriptionResultForm"] input[name="phone"]G  g3V"      #ogoneSubscriptionForm_back_buttonH    \8      ogoneSubscriptionFormBackI     '      #ogoneSubscriptionForm_subscribe_buttonJ   h      ogoneSubscriptionFormSubscribeK    m(      #ogoneSubscriptionResultForm_back_buttonL  6q(      #ogoneSubscriptionResultForm_send_buttonM  Q)      ogoneSubscriptionResultFormSendCredentialN     {"      form[name="ogoneSubscriptionForm"]O    +(      form[name="ogoneSubscriptionResultForm"]P  zb      #ogoneSubscriptionLinkQ    y      ogoneSubscriptionLinkEnableR   4.5      #ogoneSubscriptionResultForm_send_sms_phone_help_linkS     H'I#      #ogoneSubscriptionForm_explain_textT   	(      ogoneOptionSubscriptionForm_explain_textU  ?+      #ogoneSubscriptionResultForm_send_sms_blockV   1      #ogoneSubscriptionResultForm_send_sms_phone_blockW     n,      #ogoneSubscriptionResultForm_send_mail_blockX  d5      #ogoneSubscriptionResultForm_send_email_address_blockY     #6      form[name="ogoneRedirectForm"]Z    40      ogoneSubscriptionFormWaiting[  ?A&      ogoneSubscriptionFormSubscribeCallback\    RY#      ogoneSubscriptionResultForm_display]   @(      #ogoneSubscriptionResultForm_login_value^  q+      #ogoneSubscriptionResultForm_password_value_   ->      form[name="ogoneSubscriptionResultForm"] input[name="end_sms"]`    c7      form[name="ogoneSubscriptionForm"] input[name="prefix"]a   ^6      form[name="ogoneSubscriptionForm"] input[name="phone"]b    6      form[name="ogoneSubscriptionForm"] input[name="email"]c    :L@!      ogoneSubscriptionResultForm_emptyd     c-      ogoneOptionSubscriptionResultForm_back_buttone     nz;      form[name="ogoneSubscriptionResultForm"] input[type="text"]f   0g?      form[name="ogoneSubscriptionResultForm"] input[type="checkbox"]g   mj,/      #ogoneSubscriptionResultForm_result_login_valueh   /2      #ogoneSubscriptionResultForm_result_password_valuei    8r6      #ogoneSubscriptionResultForm_send_sms_phone_help_blockj    *>8      #ogoneSubscriptionResultForm_send_sms_phone_prefix_valuek  9f7      ogoneSubscriptionResultForm_send_sms_phone_prefix_valuel   V07      #ogoneSubscriptionResultForm_send_sms_phone_phone_valuem   #(6      ogoneSubscriptionResultForm_send_sms_phone_phone_valuen    /E      #ogoneSubscriptionResultForm_send_sms_phone_help_prefix_example_valueo     QzD      ogoneSubscriptionResultForm_send_sms_phone_help_prefix_example_valuep  uED      #ogoneSubscriptionResultForm_send_sms_phone_help_phone_example_valueq  uWFC      ogoneSubscriptionResultForm_send_sms_phone_help_phone_example_valuer   o7m"      ogoneSubscriptionResultFormWaitings    T1      ogoneSubscriptionResultFormSendCredentialCallbackt     j      ogone_send_mailu   8{7;      form[name="ogonePaymentForm"] select[name="select_package"]v   /8      ogonePaymentFormPayw   24      #ogonePaymentForm_back_buttonx     &      ogonePaymentFormRefillBacky    7#      #ogonePaymentForm_disconnect_buttonz   ]#      ogonePaymentFormBack{  XM      #ogonePaymentForm_pay_button|  ^U)      #ogonePaymentResultForm_disconnect_button}     v!      ogonePaymentResultForm_disconnect~     &      #ogonePaymentResultForm_connect_button    Jc      ogonePaymentResultForm_connect    3      form[name="ogonePaymentForm"]     eIg#      form[name="ogonePaymentResultForm"]   o      #ogoneSendButton_Fake     )      ogoneRedirectFormPay  2^
      ogoneInfos    (      #ogonePaymentForm_default_package_option  ]Ej-      ogoneOptionPaymentForm_default_package_option     H%      #ogonePaymentForm_select_package_text     FU*      ogoneOptionPaymentForm_select_package_text    Yi      #ogonePaymentForm_title_text  ^!      ogoneOptionPaymentForm_title_text     h;      #ogonePaymentForm_explain_text     #      ogoneOptionPaymentForm_explain_text   v-      #ogonePaymentForm_package_description_explain     2      ogoneOptionPaymentForm_package_description_explain    rRj*      #ogonePaymentForm_package_description_text    j/      ogoneOptionPaymentForm_package_description_text   `G      form[name="ogonePaymentForm"] small#ogonePaymentForm_payment_timer_text   &v$H      form[name="ogonePaymentForm"] small#ogonePaymentForm_payment_timer_value  HEP      <option id="ogonePaymentForm_default_package_option" disabled selected value="">  @      waiting_ogone     
      ogonePaymentResultForm_verify     WG      ogoneSendPaymentForm  G+      #ogonePaymentForm_package_description_value   4;!      ogonePaymentFormBackCallback  V"      ogonePaymentFormRefillBackCallback    `      ogonePaymentFormPayCallback   2      form[name="ogoneRedirectForm"] input[name="PSPID"]    >3      form[name="ogoneRedirectForm"] input[name="USERID"]   LzI1      form[name="ogoneRedirectForm"] input[name="PSWD"]     PS4      form[name="ogoneRedirectForm"] input[name="ORDERID"]  _x[3      form[name="ogoneRedirectForm"] input[name="AMOUNT"]   r5      form[name="ogoneRedirectForm"] input[name="CURRENCY"]     ;#Q5      form[name="ogoneRedirectForm"] input[name="LANGUAGE"]     },4      form[name="ogoneRedirectForm"] input[name="SHASIGN"]  1w6      form[name="ogoneRedirectForm"] input[name="ACCEPTURL"]    v
      portal_url    sNO7      form[name="ogoneRedirectForm"] input[name="DECLINEURL"]    /S9      form[name="ogoneRedirectForm"] input[name="EXCEPTIONURL"]     :6      form[name="ogoneRedirectForm"] input[name="CANCELURL"]          ogoneRedirectFormPayCallback  L "      ogoneOptionPaymentForm_refill_text    H      #ogone_select_list    d0&      #ogonePaymentForm_payment_detail_value    5w      ogonePaymentResultForm_display    a*      #ogonePaymentResultForm_payment_timer_text    D*      ogonePaymentResultForm_payment_timer_start    iB)      ogonePaymentResultForm_payment_timer_stop     Dk%      ogonePaymentResultFormConnectCallback     m,      ogonePaymentResultForm_payment_timer_display  &R%      #ogonePaymentResultForm_payment_timer     :) +      #ogonePaymentResultForm_payment_timer_value   T, A9      form[name="pmsPaymentForm"] select[name="select_package"]     X      #pmsPaymentForm_cancel_button     B.!      #pmsPaymentForm_disconnect_button           pmsPaymentFormBack    ,4      #pmsPaymentForm_pay_button    )%      pmsPaymentFormPay     Y 2      form[name="pmsPaymentForm"]   S_N      pmsInfos  !Q&      #pmsPaymentForm_default_package_option    +      pmsOptionPaymentForm_default_package_option   U#      #pmsPaymentForm_select_package_text   (      pmsOptionPaymentForm_select_package_text  4      #pmsPaymentForm_title_text    /Zn      pmsOptionPaymentForm_title_text   ^jz      #pmsPaymentForm_explain_text  !      pmsOptionPaymentForm_explain_text     +      #pmsPaymentForm_package_description_explain   xe/a0      pmsOptionPaymentForm_package_description_explain  ^J(      #pmsPaymentForm_package_description_text  /x|-      pmsOptionPaymentForm_package_description_text     }N      <option id="pmsPaymentForm_default_package_option" disabled selected value="">    &      pmsPaymentForm_cancel_button_show_hide    r      session_has_expired   P!      #pmsPaymentForm_missingInfo_block     7v      pmsPaymentFormBackCallback    2"      #pmsPaymentForm_caution_block           pmsPaymentFormWaiting     #6      form[name = "pmsPaymentForm"] input[name = "password"]    g      pmsPaymentFormPayCallback     n8      pmsPaymentFormConnectCallback     T[D)      #pmsPaymentForm_package_description_value     K      pmsPaymentForm_options_describe   z       pmsOptionPaymentForm_refill_text  ijf      #pms_select_list  $      #pmsPaymentForm_payment_detail_value  -      form[name="pmsRedirectForm"]  )#      #ppsSubscriptionForm_connect_button   -:      ppsSubscriptionFormSubscribe         form[name="ppsSubscriptionForm"]  63}%      #ppsSubscriptionForm_captcha_code_img           src   Djo      /_INC/gen_random_img.php?#    _1$      ppsSubscriptionForm_policy_configure  !      #ppsSubscriptionForm_policy_block            #ppsSubscriptionForm_policy_text  qs      PPS   M      ppsSubscriptionForm_empty     8>M3      form[name="ppsSubscriptionForm"] input[type="text"]   _7      form[name="ppsSubscriptionForm"] input[type="checkbox"]   \@x      ppsSubscriptionFormWaiting    ,;      form[name="ppsSubscriptionForm"] input[name="scratch_code"]   r;      form[name="ppsSubscriptionForm"] input[name="captcha_code"]   LP"      #ppsSubscriptionForm_policy_accept    sI$      ppsSubscriptionFormSubscribeCallback  C"      ppsSubscriptionFormConnectCallback    ]&O      #common_subscription_fields   8GR	      prependTo     >=$      #subscriptionForm_phone_prefix_value  x      subscriptionForm_modifyEvent  S#      #subscriptionForm_phone_phone_value   1!      #subscriptionForm_phone_help_link     Y/      mandatory_bool    5>      $.settings.subscribe.     &$	      userLogin      V"      #subscriptionForm_user_login_state    "      #subscriptionForm_user_login_block    n%      #subscriptionForm_user_password_state     d%      #subscriptionForm_user_password_block     x-      #subscriptionForm_user_password_confirm_block     !      #subscriptionForm_last_name_state     !      #subscriptionForm_last_name_block     9:l"      #subscriptionForm_first_name_state    J"      #subscriptionForm_first_name_block    jf      #subscriptionForm_gender_state    W8M      #subscriptionForm_gender_block    SK"      #subscriptionForm_birth_date_state     NE"      #subscriptionForm_birth_date_block    
}X%      #subscriptionForm_user_language_state     _~%      #subscriptionForm_user_language_block     t9!      #subscriptionForm_interests_state     jv!      #subscriptionForm_interests_block           #subscriptionForm_email_state     [      #subscriptionForm_email_block     |I      #subscriptionForm_phone_state     {      #subscriptionForm_phone_block	     D"      #subscriptionForm_phone_help_block
    C0      #subscriptionForm_organizational_unit_name_state  
P0      #subscriptionForm_organizational_unit_name_block  ys&      #subscriptionForm_postal_address_state    q#      #subscriptionForm_postal_code_state   ;K,      #subscriptionForm_postal_locality_name_state  4(-      #subscriptionForm_postal_postoffice_box_state     5      #subscriptionForm_postal_state_or_province_name_state     =pN+      #subscriptionForm_postal_country_name_state   &      #subscriptionForm_postal_address_block    s(      #subscriptionForm_personal_field_1_state  ;](      #subscriptionForm_personal_field_1_block  <p(      #subscriptionForm_personal_field_2_state  U(      #subscriptionForm_personal_field_2_block  (      #subscriptionForm_personal_field_3_state  I>S(      #subscriptionForm_personal_field_3_block  /      sponsoringEnabled     E%      #subscriptionForm_sponsor_email_block     ,n(      SubscriptionForm_explain_sponsoring_text  %      #subscriptionForm_sponsor_email_state     !      #subscriptionForm_personal_field_     S      form[name="   +[H%      SubscriptionForm"] input[type="text"]      %h)      SubscriptionForm"] input[type="password"]!     g!9)      SubscriptionForm"] input[type="checkbox"]"     /&      SubscriptionForm"] input[type="radio"]#    "      SubscriptionForm"] select > option$    .      selected%  !%      #subscriptionForm_password_help_block&     v      .pwdConstraint'    0H$      #subscriptionForm_password_help_list(  @K`j'      #subscriptionForm_password_help_list li)   Cw-      #subscriptionForm_password_help_list li:first*     <V      subscriptionForm_password_help_+   F91      subscriptionForm_password_help_character_set_text,     k$      _common_subscription_fields-   J|
      .userLogin.    (      pwd/   f      .userPassword0     V-      #subscriptionForm_user_password_confirm_state1      m$      #subscriptionForm_password_help_link2  :      .email3    ^$      .phone4    "%s      #subscriptionForm_policy_block5          .sponsoringEnabled6          $.settings.private_Policy7     K      #subscriptionForm_policy_text8     X      #subscriptionForm_policy_resume9   "<#      subscriptionForm_phone_prefix_value:   g("      subscriptionForm_phone_phone_value;    9H1      #subscriptionForm_phone_help_prefix_example_value<     0      subscriptionForm_phone_help_prefix_example_value=  A'm0      #subscriptionForm_phone_help_phone_example_value>  ]/      subscriptionForm_phone_help_phone_example_value?   vl      #subscriptionForm_user_login@  ;      #subscriptionForm_user_passwordA   '      #subscriptionForm_user_password_confirmB   H      #subscriptionForm_last_nameC   6      #subscriptionForm_first_nameD  $      #subscriptionForm_emailE   *      #subscriptionForm_organizational_unit_nameF    "V       #subscriptionForm_postal_addressG  Jk      #subscriptionForm_postal_codeH     r&      #subscriptionForm_postal_locality_nameI    q'      #subscriptionForm_postal_postoffice_boxJ   c/      #subscriptionForm_postal_state_or_province_nameK   D%      #subscriptionForm_postal_country_nameL     .      #subscriptionForm_gender_mM          #subscriptionForm_gender_fN    G      #subscriptionForm_birth_dateO        #subscriptionForm_user_languageP   :e\      #subscriptionForm_interestsQ   u^"      #subscriptionForm_personal_field_1R    "      #subscriptionForm_personal_field_2S    Wi$"      #subscriptionForm_personal_field_3T    S}G      #subscriptionForm_sponsor_emailU   t.&      #subscriptionForm_privatePolicy_acceptV    D      $.settings.user.langW  e      $.settings.lang.defaultLangX          #pre_portal_close_cna_linkY    &YR      pre_portal_close_cnaZ        #pre_portal_step1_pass_link[   Lz\      pre_portal_switch_step\    _"	      pre_portal_wait]   7z      hasClass^  u      pre_portal_fake_click_     [f*      #fake_anchor_change1`  0hO      #fake_anchor_change2a  S#      error_pre_portal_try_again_android8b   ,      pre_portal_add_success_triggerc    1>      struct_ajaxd   
      pre_portale    w      domainf    y
x       span#pre_portal_domaing    g      copy_textareah           textareai  
      readonlyj        positionk  H<*      absolutel  ]      leftm  u      -9999pxn   <b      execCommando         copyp  A      span#pre_portal_domain_copiedq     C#
      PRE_PORTALr    J'      pre_portal_divs    0H      div#pre_portal_blockt  h      old_stepu  ^[      new_stepv  hR"      step_block_prefixw     s3d      pre_portal_stepx   	\      step_indicator_prefixy     	      pre_portal_indicator_stepz     ;      pre_portal_go_next_step{   '      current_step|        pre_portal_go_back_step}   9C      pre_portal_oob_ajax~   35      pre_portal_start  >xu      error_pre_portal_internal     Y!      #informativeWidget_connect_button     Ml      informativeWidgetConnect  ^i      informativeWidget_replace           keyword   4W      content   ?      return_content    Dg      _B%   k-      _E%   e*;      _B%.*%    )IB      html_content  #Mh      informativeWidgetSettings     f      lang_value_itt    &      #widget_informative_  !]l      lastname  Q	      firstname     Z]_	      startDate     Eh"      validity_startdate    7      endDate   )      validity_enddate        timecredit_available  ~4      timecredit_remaining  H9m      #welcomeHeadline  Z       informativeWidgetConnectCallback  \I      &nbsp;(   K3O      initPortal/<  '      buildRedirectionURL/<     #      displayErrorInfo/<    E      displayErrorInfo/</<  f	      displayErrorInfo/</</<    T:      displayErrorInfo/</</</<  [      replaceAllFreeURLs/<  M&      shibAuthenticated/callbacks.beforeSend    "[h#      shibAuthenticated/callbacks.success   1qt$      shibAuthenticated/callbacks.complete  1      translate/<   "      translate/</<     5      translate/</</<   q      getGenericTranslation/<   @)IY      getErrorTranslation/<     <
~      getErrorTranslation/</<   m      getInputTranslation/<     	      getTextTranslation/<  SW4"      startRefresh/refreshObj.ressource<    wm      doRefresh/callbacks.success   $      condition_general_policy_configure/<  (      spread_general_policy_value/<     l&      lang_block_translate/callbacks.success    _      securePwdForm_empty/<     $J(      securePwdFormAccess/callbacks.beforeSend  s%      securePwdFormAccess/callbacks.success     ~D&      securePwdFormAccess/callbacks.complete    LF-      forceModifyPwdForm_empty/<    (      forceModifyPwdFormBack/callbacks.success  v.      forceModifyPwdFormConfirm/callbacks.beforeSend    *+      forceModifyPwdFormConfirm/callbacks.success   j,      forceModifyPwdFormConfirm/callbacks.complete        logonForm_configure/<     %      logonFormConnect/callbacks.beforeSend     {"      logonFormConnect/callbacks.success    o#      logonFormConnect/callbacks.complete   1      do_socialNetworkConnect/success/callbacks.success     T,      do_socialNetworkConnect/callbacks.beforeSend  mIo)      do_socialNetworkConnect/callbacks.success     6*      do_socialNetworkConnect/callbacks.complete    z      socialNetworkConnect/<    <      feedbackForm_fillIn/<     ="+      feedbackFormDisconnect/callbacks.beforeSend   (      feedbackFormDisconnect/callbacks.success  A)      feedbackFormDisconnect/callbacks.complete     %}T      feedbackForm_remainingTimeCredit_timer_start/timerObj.remainingTimeCredit.ressource<  L$"C      feedbackForm_forceDiscTimer_start/timerObj.forceDiscTimer.resource<   TV^      feedbackForm_postConnectRedirectDelay_timer_start/timerObj.postConnectRedirectDelay.ressource<    4      modifyPwdForm_empty/<     <)      modifyPwdFormConfirm/callbacks.beforeSend     }{&      modifyPwdFormConfirm/callbacks.success    3!'      modifyPwdFormConfirm/callbacks.complete   J3      getPurchaseSummaryFormGenerate/callbacks.beforeSend   )m0      getPurchaseSummaryFormGenerate/callbacks.success  B/1      getPurchaseSummaryFormGenerate/callbacks.complete     "      upgradeAccountForm_fillIn/<   a2,      upgradeAccountForm_empty/<    4)x1      upgradeAccountForm_getAmount/callbacks.beforeSend     dMB.      upgradeAccountForm_getAmount/callbacks.success    ,X/      upgradeAccountForm_getAmount/callbacks.complete   |R'      upgradeAccountOgoneRedirectForm_empty/<   8      upgradeAccountOgoneRedirectForm_pay/callbacks.beforeSend  5      upgradeAccountOgoneRedirectForm_pay/callbacks.success     |Nz6      upgradeAccountOgoneRedirectForm_pay/callbacks.complete    	2      upgradeAccountCheckForm_check/callbacks.beforeSend    "/      upgradeAccountCheckForm_check/callbacks.success   @4N0      upgradeAccountCheckForm_check/callbacks.complete  '	b/      upgradeAccountFormGenerate/callbacks.beforeSend   ;,      upgradeAccountFormGenerate/callbacks.success  q-      upgradeAccountFormGenerate/callbacks.complete     XZU      pwdRecoveryForm_empty/<   ),      pwdRecoveryForm_confirm/callbacks.beforeSend  &)      pwdRecoveryForm_confirm/callbacks.success     :6*      pwdRecoveryForm_confirm/callbacks.complete    '      pwdRecoveryResendForm_fillInQuestions/<   0Em)      pwdRecoveryResendForm_fillInQuestions/</<     ?4      pwdRecoveryResendForm_sendBySms/callbacks.beforeSend  {1      pwdRecoveryResendForm_sendBySms/callbacks.success     [02      pwdRecoveryResendForm_sendBySms/callbacks.complete    O}S6      pwdRecoveryResendForm_sendByEmail/callbacks.beforeSend    5OZ3      pwdRecoveryResendForm_sendByEmail/callbacks.success   @@4      pwdRecoveryResendForm_sendByEmail/callbacks.complete  fi'      pwdRecoveryResendForm_sendByQuestions/<   .:      pwdRecoveryResendForm_sendByQuestions/callbacks.beforeSend    v7      pwdRecoveryResendForm_sendByQuestions/callbacks.success    X8      pwdRecoveryResendForm_sendByQuestions/callbacks.complete  o$      pwdRecoverySetForm_fillInQuestions/<  b!&      pwdRecoverySetForm_fillInQuestions/</<    %@'      pwdRecoverySetForm_questionsTranslate/<   *      pwdRecoverySetForm_updateQuestionChoices/<    em,      pwdRecoverySetForm_updateQuestionChoices/</<  9x      pwdRecoverySetForm_update/<   b.      pwdRecoverySetForm_update/callbacks.beforeSend    JD;+      pwdRecoverySetForm_update/callbacks.success   Et,      pwdRecoverySetForm_update/callbacks.complete  {Y+,      manageAccountForm_personal_settings_fillIn/<  nv <      manageAccountForm_personal_settings_customFields_configure/<  K"      manageAccountForm_devices_fillIn/<    &y$      manageAccountForm_devices_fillIn/</<  Dt	?      manageAccountForm_personal_settings_update/callbacks.beforeSend    g/l<      manageAccountForm_personal_settings_update/callbacks.success  E=      manageAccountForm_personal_settings_update/callbacks.complete     @2&"      manageAccountForm_devices_update/<    5X5      manageAccountForm_devices_update/callbacks.beforeSend     2      manageAccountForm_devices_update/callbacks.success    -_|3      manageAccountForm_devices_update/callbacks.complete   p25      modifyPackageForm_package_update/callbacks.beforeSend     ;~2      modifyPackageForm_package_update/callbacks.success    q3      modifyPackageForm_package_update/callbacks.complete	   L(      resetPaymentProcess/callbacks.beforeSend
  
%      resetPaymentProcess/callbacks.success     &      resetPaymentProcess/callbacks.complete    4%      accountRefillForm_options_configure/<     F2      accountRefillPaymentSubscribe/callbacks.beforeSend    iv6/      accountRefillPaymentSubscribe/callbacks.success   0      accountRefillPaymentSubscribe/callbacks.complete  aF.      accountRefillForm_confirm/callbacks.beforeSend    8lL+      accountRefillForm_confirm/callbacks.success   a,      accountRefillForm_confirm/callbacks.complete  G2?N;      accountRefillForm_get_free_refill_code/callbacks.beforeSend   Sc88      accountRefillForm_get_free_refill_code/callbacks.success  )9      accountRefillForm_get_free_refill_code/callbacks.complete     &r0$      accountRefillForm_options_describe/<  I!      autoLogonForm_configure/<     ()      autoLogonFormConnect/callbacks.beforeSend     ('&      autoLogonFormConnect/callbacks.success    @'      autoLogonFormConnect/callbacks.complete   pZ7      autoLogonWithSecurePasswordConnect/callbacks.beforeSend   4      autoLogonWithSecurePasswordConnect/callbacks.success  5      autoLogonWithSecurePasswordConnect/callbacks.complete     H      oneSubscriptionForm_configure/<   !	1      oneSubscriptionFormOtherChoices/callbacks.success      }/      oneSubscriptionFormConnect/callbacks.beforeSend!   ,      oneSubscriptionFormConnect/callbacks.success"  >-      oneSubscriptionFormConnect/callbacks.complete#     C      socialNetworkConnectOne/<$     I+      oneSubscriptionLinkEnable/callbacks.success%   f$u`"      directSubscriptionForm_configure/<&    T4      directSubscriptionFormSubscribe/callbacks.beforeSend'  1      directSubscriptionFormSubscribe/callbacks.success(     Hx!X2      directSubscriptionFormSubscribe/callbacks.complete)    G!      printSubscriptionForm_configure/<*     .`3      printSubscriptionFormSubscribe/callbacks.beforeSend+   P%0      printSubscriptionFormSubscribe/callbacks.success,  l1      printSubscriptionFormSubscribe/callbacks.complete-     cJ      smsSubscriptionForm_configure/<.   1      smsSubscriptionFormSubscribe/callbacks.beforeSend/     4.      smsSubscriptionFormSubscribe/callbacks.success0    d/      smsSubscriptionFormSubscribe/callbacks.complete1          mailSubscriptionForm_configure/<2  A
2      mailSubscriptionFormSubscribe/callbacks.beforeSend3    /i/      mailSubscriptionFormSubscribe/callbacks.success4   !0      mailSubscriptionFormSubscribe/callbacks.complete5  \"      paypalSubscriptionForm_configure/<6     4      paypalSubscriptionFormSubscribe/callbacks.beforeSend7  \X#1      paypalSubscriptionFormSubscribe/callbacks.success8     =`2      paypalSubscriptionFormSubscribe/callbacks.complete9    sC$      paypalSubscriptionResultForm_empty/<:  [?      paypalSubscriptionResultFormSendCredential/callbacks.beforeSend;   d<      paypalSubscriptionResultFormSendCredential/callbacks.success<  c=      paypalSubscriptionResultFormSendCredential/callbacks.complete=     [8*      paypalRedirectFormPay/callbacks.beforeSend>    =r'      paypalRedirectFormPay/callbacks.success?   l5B(      paypalRedirectFormPay/callbacks.complete@  9&      paypalPaymentForm_packages_configure/<A    fs'      paypalPaymentFormBack/callbacks.successB   -      paypalPaymentFormRefillBack/callbacks.successC     )      paypalPaymentFormPay/callbacks.beforeSendD     P`&      paypalPaymentFormPay/callbacks.successE    UD$'      paypalPaymentFormPay/callbacks.completeF   _7%      paypalPaymentForm_packages_describe/<G     q$      paypalPaymentForm_options_describe/<H  3      paypalPaymentResultForm_verify/callbacks.beforeSendI   0      paypalPaymentResultForm_verify/callbacks.successJ  l1      paypalPaymentResultForm_verify/callbacks.completeK     $GG      paypalPaymentVerify_payment_timer_start/timerObj.paymentTimer.resource<L   72K      paypalPaymentResultForm_payment_timer_start/timerObj.paymentTimer.resource<M   j!      ogoneSubscriptionForm_configure/<N     ;3      ogoneSubscriptionFormSubscribe/callbacks.beforeSendO   K0      ogoneSubscriptionFormSubscribe/callbacks.successP  |-{1      ogoneSubscriptionFormSubscribe/callbacks.completeQ     #      ogoneSubscriptionResultForm_empty/<R   Z>      ogoneSubscriptionResultFormSendCredential/callbacks.beforeSendS    x;      ogoneSubscriptionResultFormSendCredential/callbacks.successT   uCT<      ogoneSubscriptionResultFormSendCredential/callbacks.completeU  /%      ogonePaymentForm_packages_configure/<V     6Me&      ogonePaymentFormBack/callbacks.successW    ^,      ogonePaymentFormRefillBack/callbacks.successX  SB(      ogonePaymentFormPay/callbacks.beforeSendY  %      ogonePaymentFormPay/callbacks.successZ     C&      ogonePaymentFormPay/callbacks.complete[    )      ogoneRedirectFormPay/callbacks.beforeSend\     	@&      ogoneRedirectFormPay/callbacks.success]    X'      ogoneRedirectFormPay/callbacks.complete^   PU-)      ogoneRedirectFormPay/callbacks.complete/<_     R&$      ogonePaymentForm_packages_describe/<`  4]+#      ogonePaymentForm_options_describe/<a   2      ogonePaymentResultForm_verify/callbacks.beforeSendb    @&/      ogonePaymentResultForm_verify/callbacks.successc   [0      ogonePaymentResultForm_verify/callbacks.completed  )OLDJ      ogonePaymentResultForm_payment_timer_start/timerObj.paymentTimer.resource<e    {g#      pmsPaymentForm_packages_configure/<f   N5$      pmsPaymentFormBack/callbacks.successg  /k&      pmsPaymentFormPay/callbacks.beforeSendh    in#      pmsPaymentFormPay/callbacks.successi   +c$      pmsPaymentFormPay/callbacks.completej  [.      pmsPaymentFormPayCallback/callbacks.beforeSendk    +      pmsPaymentFormPayCallback/callbacks.successl   A,      pmsPaymentFormPayCallback/callbacks.completem   !"      pmsPaymentForm_packages_describe/<n    a!      pmsPaymentForm_options_describe/<o     BV      ppsSubscriptionForm_empty/<p   8.1      ppsSubscriptionFormSubscribe/callbacks.beforeSendq     7J.      ppsSubscriptionFormSubscribe/callbacks.successr    \|/      ppsSubscriptionFormSubscribe/callbacks.completes   V9      ppsSubscriptionFormSubscribeCallback/callbacks.beforeSendt     6      ppsSubscriptionFormSubscribeCallback/callbacks.successu    l7      ppsSubscriptionFormSubscribeCallback/callbacks.completev         subscriptionForm_empty/<w  '      subscriptionForm_commonFields_display/<x   L      pre_portal_fake_click/<y   V=      pre_portal_fake_click/</<z     >      pre_portal_configure/<|    P$-      informativeWidgetConnect/callbacks.beforeSend}     G*      informativeWidgetConnect/callbacks.success~    	5	+      informativeWidgetConnect/callbacks.complete       #             
   %,                                                                                                                                                              	                 
                                                                                                                                                                                                                                                                                                                                                                                                                   !                  "                  #                  $                  %                  &                  '                  (                  )                  *                  +                  ,                  -                  .                  /                  0                  1                  2                  3                  4                  5      4           6                  7      6           8      6           9      6           :                  ;                  <                  =                 >      =           ?      =          @      ?           A      =          B      A          C      B           D      =          E      D          F      E           G      =           H      =           I                 J      I           K                 L      K          M      L           N                 O      N           P                 Q      P           R                  S                  T                  U      T           V                  W                  X      W           Y                  Z                  [                  \                  ]                  ^                  _                  `                 a      `           b                  c                 d      c           e                  f                  x                  y      g           z                  ~                                          k                                                     n                 n                 n                                                                                         u                                   w                                                                       {                 {                 {                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         	                 
                                                                                                                                                         !                "                 #                $                 %                 &                '                (                )                 *                 +                 ,                 -                .                 /                0                1                2                 3                 4                5                6                7                 8                 9                :                ;                <                 =                 >                 V                 W                 X                Y                 Z                 [                 \                 ]               ^               _               `                 a                 b                 c                 d                 e                f              g               h               i                 j                 k               l               m               n                 o               p               q               r                 s                t               u               v               w               x                 y                 z                 {                 |                }     %          ~     %              '               %               %               %                                                -                               /               /              1                                                4               4               4               4               4                                                                                                                                                                                        C                                                                                                   I                                K              L               L                                                                                   R               R               R                                                W               W               W               W                                                                  ^               ^               ^                                                 c               c               c                                                                                  j                                                 m               m               m                                q               q               q                                u               u               u                                                                                                   }                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           '               (                 )                 *                 +                 ,               -               .               /                 0                 1                 2                 3                 4                 <               =                 >                 ?                 @                 A               B               C               D                 E                 F                 G                 M               N                 O                 P                 Q                 R               S               T               U                 V                 W                 ]               ^                 _                 `                 a                 b               c               d               e                 f                 g                 |               }                 ~                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             	                                                                                                                                                                                                                                                                                                                                                                                                                                                           $               $               $                                                                                                    ,                                                 /                                                 2                           	                 
                      6               6               6                                                                                   =               =               =               @                               B                               D                                                 G               G               G                                             !                 "                 #     N          $                 %                 &                 .                /     S          0                 1                 2     V          3                 4                 5                 6                 7     [          8     [          9     [          :                 ;     _          <     _          =     _          >                 ?                @     d          A                B     f          C                 G                 H                 I                 J     k          K     k          L                 M                 N     o          O     o          P     o          Q                 R     s          S     s          T     s          U                 V                ]     x                       
   ^     z                           _     |          `     |          a     |          b     |          c     |          d                 e                 f                 g                h                               i                                                            j                                                             k                                l                 m                 n                o                 s                 t               u               v                 w                 x               y                 z                 {                 |                 }                 ~                                                                                                                                                                                    g                h                i                j                k                l                m                n                o                p                q                r                s                t                u                v                w                  {                |                }                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               ?               @               A               B               C               D               E               F               G               H               I               J               K               L               M               N               O               P               Q               R               S               T               U                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                #               #               #               #               #          	     #          
     #               #               #               #                                 .          !     .          "     .          #     .          $     .          %     .          &                 5     5          6     5          7     5          8     5          9     5          :     5          ;                 H     <          I     <          J     <          K     <          L                 X     A          Y     A          Z     A          [     A          \                 h     F          i     F          j     F          k     F          l     F          m     F          n     F          o     F          p     F          q     F          r     F          s     F          t     F          u     F          v     F          w     F          x     F          y     F          z     F          {                      Z               Z               Z               Z               Z               Z               Z               Z               Z               Z                                e               e               e               e               e               e               e               e               e               e               e               e               e               e               e               e               e               e               e                                y               y               y               y               y               y               y               y               y               y                           '               (               )               *               +               ,               -                 D               E               F                 W               X               Y               Z               [               \                 p               q               r                                     Oc      B   P  m    r   6  x > Po  }   P  ]  /     q Z  H   |    g  E S    Y   9 U    r [   w  ` $     .  c    b  /      F   M    o   X V   ^   c Z   j     e 7     p g   P  "   r [  R   o    ! /  z   h  _  Y     J   g  l     P r  [   w  W  T  & B  }     Pd   *   X     O     l q   Z      Pe \     y  p Y ~   + G   M  i  - y   f t  ]  T  z   Z Q v  :  ?      a   ~  l  0 w         n  2   k y    P      m ?    x   J  f  * 8 4    , Q    n       \  @   b p  L  ^       Pr [ X  i  - $ I  } F  =    t  x   1 | H \  < %  A   u   >       2  N     p  C   v m P{   P [       o A c      q h     PN  7 E  S     p     P u  ^   D   `         & K    Q v  m  V ?  s  \ j  k   a     s    l U  c  5 C      Pn e   	 P  p                               (                ,              3  7  8  i                                                                          I        P  P                                                  P@                  Pj                                  P      j                      P                                     Pj                    j                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  j                                                                                                                                         P@                  j                   Pj                  j                   Pj                   Pj                 j                  Pj                 `j                   j                 j                 j                 `  P P  P@                 j               `  P  P@                 Pj                  j               `  P  P@                 j               `  P  P@                 j                @  +                  @  +                                                                                                                 @                                 m                                                       +  @                     P                    Q  j                    %  i                4 P5 P              i                                                                                                  ,                                j                                                                                                                                  ,                                j                                                                                                                                                                    ,                 !     z                                                  j                1                              @  +                  P `+  P P  `j  `          `              ,                                                                                                                                                        ,                                 P  P                                                                                                                                              `+  P  PD  P  `j  `          `          `                                                             '              ,                                ,   @  a  e                # 9          = H I J K PL PM PN PV  [ \ ^ _ `                !                j                                                                                                                                  t u                 } ~                 P                                                                     P                                                                              P                                                                                             ,                                j                                                                                                                  ,                  ,                 !     z                                ,                                                                                                                                ,                                ,                               ,                ,                ,                ,                P               H     j                                 j                                                                                                                                                                  j                                                                                                                                                                                                                                                                       ,                                ,                                j                                 l                 ,                                                                                                                 ,                ,                                PA I             J PK P                j                 j                                                                                                                                                                                      P                j                                                                                                                ,                \ PA P                j                  Pj                J K               j                 j                 j                                  P              j                  c P              j                 e Pj                 j                                  P                j                 j                                                                                 ,                                                              ,                ,                ,                ,                #          P\                                                  l                 ,                    	            \  #        P                                                 P P                j                 j                                 j                                                                                                                    P                j                                                                                                                                                                                                                  j                                                                                 P                H     r j                 ,                                                  j                                                                                                                                                                                                                    ! i                P               H  t j                                               @  +                ,                                                                                                                                                                                                   O Y #                               +                ,                                                                                                                                                 `  PD  P+  P  `j  `          `          `                                                                                                              ,                                                                                                                                                 ,                                                                                 ,                                                                                                                                 ,                                                                ,                                                                                                                                                                                 ,                                                                                                                                                                                 ,                                                                                                                                 ,                                 j                 j                 ,                                 ,                                                                                                                                    l                                                                                                                                   P                H     j                 ,                                                                                                                                                                                                                 P               H  t j                   P H  t P  P P              H  j                 ,                                                                                                                                                                                                                                                                        ,                                                                                                                                 ,                                 j                 j                 ,                                 ,                                                                                                                                    l                                 P                H     j                 ,                                                                                                                                                                                                                                                                                                                                   P               H  t j                   P H  t P  P P              H  j                 ,                                                                                                                                                                                                                        P                H     j                 ,                                                                                                                                                                                                                                                  P               H  t j                   P H  t P  P P              H  j                                 +                ,                                j                 j                                                                                                                                                                                    `  P P P  `j  `          `               P `  P P\ P P  `j  `          `                             j                 j                 j                 j                 j                 ,                 l                     ,  	               P `k P P!  P  `z `  `j  `          `
              `"  P. Pk PY P( P+  P P  `j  `          `          `          `                          `          `          `               P `+  P P  `j  `          `               l                                                  P  P  `j  `                                                                             c                               g               ,  r             t u v x              {              {               }                                                                 = 9                 ,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                j                 j                 j                 j                                                                                                                                                                                                                                                                                                                                 j                 j                 j                 j                                                                                                                                                                                                                                                                                                                                                                                                                                 7                                                                                                                                               j                 j                                                                                                                                                                                                                                                                                                                                                                                                                                 j                 j                 j                 j                 j                 j                 j                 j                 j                 j                 j                                                                                                                                                                                                                                                                                                                                                 j                 j                 j                 j                 j                 j                 j                 j                 j                 j                 j                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 j                 j                 j                 j                                                                                                   0          	     
                   I$KE	   -          3            
                                                                     3                         &!!  4     4                                |  }        |  }                G  G  g  o         G  G  g  o m        G  G  g  o I        G  G  g  o %   !     G  G  g  o &              o G  h  s      o G  h  s      o G  h  s      o G  h  s      o G  h  s      o G  h  s      o G  h  s      o G  h  s      o G  h  s     |  }         o G  h  s      o G        s     |  }         o G  h  s      o G        s     |  }         o G  h  s      o G  h  s      o G  h  s      o G  h  s      o G  h  s      o G  h  s      o G  h  s     |  }         o G  h  s      o G  h  s     |  }         o G  h  s      o G  h  s      o G  h  s      o G  h  s     |  }         o G  h  s      o G  h  s      o G  h  s E%`P0%`P0%`P7%`PG
%`P P> P> P> P>  PO%`PG`P+P/PD 	`P+P/PD 	`P+P/PD 	`P+P/PD 
`P+P/PD 6`P+P/PD U`P+P/PD L`P+P/PD `P+P/PD %`P0000`P+P/PD 6`P+P PD a%2`P0000`P+P/PD `P+P PD 5% `P0000`P+P/PD `P+P/PD `P+P/PD `P+P/PD `P+P/PD `P+P/PD P`P+P/PD %+`P0000`P+P/PD !`P+P/PD ${%*`P0000`P+P/PD &[`P+P/PD (`P+P/PD *`P+P/PD +^%`P0000`P+P/PD -`P+P/PD .N`P+P/PD /P          O                                #             o G   s        G         s @ `P0 `P+P*PI `P P4P                                     G   G      D         G   G   G               G   G   G      !          s     s     00 `P0 `P'P4 `P: `PAF `P1Q |  |                  N           G   G      E         G   G   G                G   G                     o G	      G   G   G   G
   s        o G	      G   G   G   G   s        o G      s        o G      o       G   G      [   2      G   G   G      6   9      G   G   G   G      @      A      B   Q   B      G      s     s     G   G   G   G      N   N   00 `P0 `P+P /P4 `P+P 2PD `P+P GPD `P+P/GP8 `P t@ `PAK0 `P P4 `PJ `P0 `PAF `P1Q                                                                 A             o G   s         o G   s  #             o G   s     00 `P6 `P0 `PM `P00 `P+P*P4 `P+P*PN0 `P+P*PIP  t  d                  |         G                G   G      
   $            G   G   I            G   G   G   	   o            G
   ]          HG   o  G      o           H         .'  "         $         $      G         h   s     s      s         G   G   G      s        G   G   G      s     o     :    :       o     =    =      G          B      G   G      G     H       s      s      s      s       s  !    s  "    s  #    s  $    s  %    s  &    s  '    s  (    s  )    s  *    s  +    s  ,    s  -    s  .    s  /    s  0    s  1    s  2    s  3    s  4    s  5    s  |   @ 	`P0 `P@ `P6 `P P8 
 `P&fP0 `P P/P? `P@
 -`P@ 	`P0 `PO `P PD `P: `P: `P P4 `P PD! 	`P0 `PAPF% 	`P0 `PAPF+ 	`P@- `P: `P: `P: `P: `P: `P: `P: `P: `PJ7 `P: `P: `P: `P: `P: `P: `P: `PJ@ `P: `P: `PJD `P: `PJG `PJI `PJK `PJN `POPP    t            q         P                                          s            G   G   G   s       @ `P0 `PO `P 	P4 `P< P    ,  ,  Y                 =            o                s      s      s      s      s      s      s  	    s  
    s      s      s      s      s      s      s      s      s      s      s      s      s      s      s     s           7       s  (   9          o G      s =   @ 	`P&P= `PA-F `P: `P: `P: `P: `P: `P: `P: `P: `PJ `P: `P: `P: `P: `P: `P: `P: `PJ `P: `P: `PJ `P: `PJ! `P' PD# `PJ& 	`P0 `P@)@+ `P+P/PI-P                                      G   G   G      F         G   G   G      !         G   G   G      3          s        G   G   G   o    @ 	`P0 `P'P4 `P PC
F `PA
Q    X  X                  m                                       G              G              G              G          G              G          G              G          G	              G	          
   %  %   %  %   %  %   "     G        G      o      G      o        +     ,   C   -           0      |  }    2       I   3          o G      o    8        I   9     G         =     G      ?      @      G      o           o G         s        o G          s      #   N      G!     h"   s Q      G#   G$      s        o G%   s     G&      s    \           _      G'   (   o    c   (      c   )   c         G!     h*   s    G+      G,   &o          %   k   -      I.   m   @
 	`P@0 `P: `P: `P: `PJ `P0 `P@@ `P0 `P@ `P0 `P@ `P0 `P@  `P0 `P@$ `P@( `P= `P P8 `P P8 `P0 `P0 `P*PM/ `P@1 `P+P/4P= `P@5 `P0 `P 	P9 `P+P P4 `P+P P4 `P0 `P PI> `P P4 `P+P*P4 `P 	P4 `PAUKD0 `P0 "`P P0 `P PDK `P PIM `PKQ `P? `PAUV  h   h   3                                o G        %   % %   %s 0 `P+P P4 P    P   P                                     % %   %%   0 `P7 P                        l             c         G                G   G         $         G   G   G            G              G         G   G               G   G   G   	       %      G   G
      *   $   +         G   G
   I   0          o G      G   G   G   o G      o G      s        o G      o G   h   s        's    E      G   G         K          o G      G   G   G   o G      o G      s        o G      o G   h   s        0us 7   `          o G      o G      s f   7   f          o G      o G      s l   0 	`P0 `P0 `P@ 	`P0 `PO
 `P@ `P0 `P@ `P+P P/P/PD `P*P/P/PD   `P.
P>0 `P0 `P+P P/P/P40 `P*P/P/PD   `P.
P>00 `P+P/P/P0000 `P+P/P/P90P         F                                  o           o G      o G   h   s 6 `P*P9 `P*P/P/PD   P   ,    d                             o G   o           G   G   G   #  
     G     o G   o         <        G      G   G   G	   o G   o                 
   |                       }             G   G   G   G      o l   %      |     }     G      G   G   G   G   o           1     H  2     [3   \],  4              H     G   G   G        %   %   @        E   C      G   G   G   G      o    K       L   J   M      G   G   G      %   S      G   G      H   Y     Z        G   G      H   G   G   G   HG!     H   o   h       "   o G      G#        G   G      H   G   G   G   HG!     Ho s E  z      G   G      H   G   G   G   HG!      G   G   G	   H   ~          "   o G      G#        G   G      H   G   G   G   HG!      G   G   G	   Ho s y          "   o G      G#        G   G      H   G   G   G   HG!      G   G   G$   Ho s    ,        G   G   G        %%   %           E         G   G   G   G   &   o              J         G   G   G   '   %         G   G      H      O          G   G      H   G   G   G   HHG!     H             "   o G      G#        G   G      H   G   G   G   HHG!     H   G   G   G   Ho s w       G   G      H   G   G   G   HHG!      G   G   G	   H            "   o G      G#        G   G      H   G   G   G   HHG!      G   G   G	   H   G   G   G   Ho s    0      "   o G      G#        G   G      H   G   G   G   HHG!      G   G   G$   H   G   G   G   Ho s L     L  L  ^  [M  \]   N             H     G   G   G        %(   %^   Z      )   o G*   o         +      o G      G#        o s e  Ke  ^      b   h     G   G   G   G   ,   o 1   p     G   G   G   G   -   o w  }  x     G   G   G   G   -   o c         .   o G*   o         /      o G      G#        o s         G   G   G   G   ,   o ^         0   o G*   o         1      o G      G#        o s      G2      G   G   G   h3   s    G4   s      "   o G5      s        G   G   G   6   T       G   G   G   G7      *        G   G   G   G8            9    :   |;       G   G   G   G7   o ;       G   G   G   G8   o %)  } o      G#   <    =     o   G>     G?   <      G@     o   GA   <      GB     o   GC   H  GD     GC   H  GC   GE   o
 	     G   G   G   GF   *        G   G   G   GG        9     	  H      G   G   G   GG   %I   %%	       G#     	  o 
      "   o G   
  s $        G   G   J   I     Z       J         "   o G      G#        G   G   G   o s   6 `P*P*P8 `P0 $`P P*P8 `P0 `P P*"PM `P@	 5`P0 5`PF /`P: !`P P0 9`P0 :`P P8 %`P0 $`P@ )`P0 8`P? &`P0 [P0@ $`P6 )`P0 (`P+P P#PN .`P0 (`P+P P#PN"0 (`P+P P#P@& +`P0 [P0@* $`P6 )`P0 (`P+P P#PN. .`P0 (`P+P P#PN10 (`P+P P#PI4 	`PJ L80 )`P0 8`P? %`P0 $`P+P*P9 $`P P 5P#PI9 L@ !`P 2P0 9P0 %`P P0 $`P+P*P9 $`P P 7P#PNF *`P P0 6`P+P*P9 $`P P 2P#PIJ  `P PDh  `P,P4  `P+P/PNk %`P@m $`P0 5`P P 2P,P#P8 5`P< ,P399 ,P39 ,P3<9<No 7PH{ (`P0 (`PK~ 5`P P8 $`P+P.P>000 $`P0000 %`P0 $`P+P P#PI   P ,          4                                 @              G   G   G      % G   %  o          P             G   G   G      % G   %   G   G	   G
   o        G      1                       <              o G   o        G   s     G      G       G   o s          o G      s    ,            o G   o        G   s     G      G       G   o s          o G      s ,   <      G    G   h   s    @   0 6`P P9 )`P0 (`P PN -`P00 =`P P*P8 ,`P+P4 ,`P P#P4 ,`P P.P4 ,`P:0 =`P P*P8 ,`P+P4 ,`P P#P4 ,`P P.P4 ,`P:0 ,`P PD ,`PJ  P               
               G                  o G   o        G   s     G      G       G    G   G	   
   o o s          o G      s    0 5`P0 E`P P*P8 4`P+P4 4`P HP#P#P4 4`P P.PI ,P          F                                  o           o G      o G   h   s 6 `P*P9 `P*P/P/PD P  |  |          	       %                o G   o           G   G   G      
      G     o G   o         <         G      G   G   G	   o G   o            J          
   o G      G        G   G   G   o s %   6 `P*P*P8 `P0 $`P P*P8 `P0 `P P*"PM `P0 `P+P P#PI P `   `   .                                 o G      o G      s 0 `P+P/P/P4P                     c          |  }           I                 G         
    G      U          G   I      G   G	   G
               G   G	   M
         G   G      `         G   G      @   $      G   G          *      G   G      .   J   /    G         3      3       G   I   5   p   5    G         9    G      <      =   .   =       G   I       G   I   A       G   I       G   I       G   I      I    G         L       G   I   N    G         R       G   I   T    G         X       G   I   Z    G         ^       G   I   `      G           s @ `P0 `PO 	`P0 `PA>F
 
`P0 `P0 `P0 `P@ 
`PE `P0 `PA>K0 `P@@ `P0 `PA>K0 `P0 `P@$ `P0 `P0 `P@) `PK, 	`P0 `P@0 `P0 `P@4 `P0 `P@9 `P0 `P@= `P P4P       b                 
          |  }           I       G   I       G   I      G	           s @ `P0 `PO `P0 `P@	 `P P4P    x   x   >                           |  }           I      G           s @ `P0 `PO `P P4P                               |  }           I                    G   I       G   I    G	                G	   I
          G   I      G                G   I         G                G   I         G           s @ `P0 `PO 	`P0 `PAF
 `P0 `P0 `P0 `P@ `P0 `P0 `P@ `P0 `P@ `P P4P                                  |  }           I                 G         
      
       G   I          G   I      G	           s @ `P0 `PO 	`P0 `PAF
 	`P0 `PAK0 `P@ `P@ `P P4P       h                .          |  }           I                 G         
   F   
       G   I      |  }         G   o  I          G	   I
      G   G                G   G         K         G   G   G      &   $      G   G   G   G   *   &   +      G           s .   0 `P0 `PO 	`P0 `PAF	 	`P0 `PAK0 `P0 `P0 `P/PN `P@ `P0 `P PIP                                    |  }           I                 G         
      
       G   I         G           s @ `P0 `PO 	`P0 `PAF
 	`P0 `PAK0 `P@ `P P4P        +                #          |  }           I                 G      K   
    G      2       G             G               R          G   I       G   I       G   I	       G   I
          G   I      G           s @ `P0 `PO 	`P0 `PAF
 
`P0 `PAK0 `P0 `P0 `P0 `P@ `P@ `P P4P       +                #          |  }           I                 G      K   
    G      2       G             G               R          G   I       G   I       G   I	       G   I
          G   I      G           s @ `P0 `PO 	`P0 `PAF
 
`P0 `PAK0 `P0 `P0 `P0 `P@ `P@ `P P4P   x   x   >                           |  }           I      G           s @ `P0 `PO `P P4P                     |          |  }           I                 G         
      
       G   I       G               u              	        
                           d              G   I       G   I       G   I       G   I       G   I       G   I       G   I       G   I       G   I       G   I       G    I!       G"   I#       G$   I%       G&   I'       G(   I)       G*   I+       G,   I-       G.   I.       G/   I0       G1   I2       G3   I3   "  ?       G4   I5   A       G6   I7       G8   I9       G:   I;       G   I       G   I       G   I       G   I       G   I       G   I       G   I       G   I       G   I       G   I       G    I!       G"   I#       G$   I%       G&   I'       G(   I)       G*   I+       G,   I-       G.   I.       G/   I0       G1   I2       G3   I3   Q   q       G<   I=       G>   I?       G@   IA      w      w       GB   IC   D   GE           s @ `P0 `PO 	`P0 `PAdF
 	`P0 `PAdK0 `P@ `P00@ `P0 `P0 `P0 `P0 `P0 `P0 `P@ `P0 `P0 `P0 `P0 `P0 `P@$ `P0 `P0 `P@( `P0 `P0 `P0 `P0 `P0 `PJ/0 `P0000@6 `P0 `P0 `P0 `P0 `P0 `P0 `P0 `P0 `P0 `P@A `P0 `P0 `P0 `P0 `P0 `P@H `P0 `P0 `P@L `P0 `P0 `P0 `P0 `P0 `PJS@U `P0 `P0 `P@Y `PJ[0 `PAdA] `PJa `P@c `P P4P        I                -          |  }           I                   G   G                     G   G   G   I    G	                G	   I	            G   G   G
   I         G   G   G   I         G   G   G   I       G   I       G
   I      G           s @ `P0 `PO 	`P0 `PAF	 	`P0 `PAF `P@ `P0 `P@ `P0 `P0 `P@ `P@ `P@ `P P4P                     '          |  }           I                   G   G                     G   G   G   I         G   G   G	   I	         G   G   G
   I         G   G   G   I       G   I       G
   I      G           s @ `P0 `PO 	`P0 `PAF	 `P0 `PAF `P0 `P0 `P0 `P0 `P@ `P@ `P P4P                       '          |  }           I                   G   G                     G   G   G   I         G   G   G	   I	         G   G   G
   I         G   G   G   I       G   I       G
   I      G           s @ `P0 `PO 	`P0 `PAF	 `P0 `PAF `P0 `P0 `P0 `P0 `P@ `P@ `P P4P   8  8                             |  }                      G   I       G   I       G   I       G   I       G   I       G   I       G	   I
      G           s @ `P@ `P0 `PAF `P0 `P0 `P0 `P0 `P0 `P@ `P0 `P P4P                                   |  }           I                    G   I       G   I       G   I       G   I       G	   I
      G           s @ `P0 `PO 	`P0 `PAF	 `P0 `P0 `P0 `P@ `P@ `P P4P                                  |  }           I                    G   I       G   I       G   I       G   I       G	   I
      G           s @ `P0 `PO 	`P0 `PAF	 `P0 `P0 `P0 `P@ `P@ `P P4P                                    |  }                        I       G   I         G   G   G	   I	         G   G   G
   I
      G           s @ `P@ 	`P0 `PAF `P? `P0 `P0 `P0 `P P4P 0  0                             |  }           I                    G   I       G   I       G   I         G	   G
   G   I         G	   G
   G   I      G           s @ `P0 `PO `P0 `PAF `P0 `P0 `P0 `P0 `P0 `P P4P                                |  }           I                    G   I       G   I         G   G	   G
   I
         G   G	   G   I      G           s @ `P0 `PO `P0 `PAF `P0 `P0 `P0 `P0 `P P4P       |                           |  }           I                    G   I       G   I      G	           s @ `P0 `PO 	`P0 `PAF `P@ `P@ `P P4P         |                           |  }           I                    G   I       G   I      G	           s @ `P0 `PO 	`P0 `PAF `P@ `P@ `P P4P                                    |  }           I                    G   I       G   I       G   I   	   G
           s @ `P0 `PO 	`P0 `PAF `P0 `P@ `P@ `P P4P                                    |  }           I                    G   I       G   I       G   I	   
   G           s @ `P0 `PO 	`P0 `PAF `P0 `P@ `P@ `P P4P         |                           |  }           I                    G   I       G   I      G	           s @ `P0 `PO 	`P0 `PAF `P@ `P@ `P P4P                                    |  }           I                           I                          G   I   	   G
           s @ `P0 `P? `P@ `P< 	`P0 `PAF `P@ `P P4P                       <          |  }           I                    G   I       G   I       G	   I
       G   I       G   I       G   I       G   I       G   I       G   I       G   I       G   I       G   I       G   I       G   I       G   I        G!   I"       G#   I$   %   G&   G'   G(      -   /    G)   %   G&   G'   G(   G*   6      7       G)   I+   9   %   G,           s @ `P0 `PO 	`P0 `PA$F	 `P0 `P0 `P0 `P0 `P0 `P@ `P0 `P0 `P0 `P0 `P0 `P@ `P0 `P0 `P@ `P@ `P0 	`P@  `P@# `P P4P  p   p   4                                  I      G           s @ `P8 `PO `P P4P          F                                G   I         I      G           s @ `P8 `P0 `PO `P P4P                                   |  }           I                    G   I       G   I       G   I       G	   I	       G
   I      G           s @ `P0 `PO 	`P0 `PAF	 `P0 `P0 `P0 `P@ `P@ `P P4P         j                           |  }           I                    G   I      G           s @ `P0 `PO 	`P0 `PAF
 `P@ `P P4P          j                           |  }           I                    G   I      G           s @ `P0 `PO 	`P0 `PAF
 `P@ `P P4P          `                 	                 I                    G   I      G           s @ `P8 `PO 	`P0 `PAF
 `P@ `P P4P         c                             G                G   G      
   (             o G   h   s    @ 	`P0 `P+P/PIP                                      G   G   [   \]~                      o G      o <             o G         G   G      Hs       ^6  `P0 `P/P/P> `P*P PI L P                     9                (           G   G   G                G   G   I      |  }           I         I	      I
      G   G      %         G   G   G         -            G   G   G   G   I   !      |  }      h   I     h   I     h   I            s 0 	`P0 `PAF `P0 `P0 `P? `P? `P; 
`P0 `P@ `P0 `P? `P? `PO `P.P4P    8   8                                 s  `P'P$P 4   4                                 s   `P*P 8   8                                 s  `P'P$P                                |  }           I                    G   I       G   I       G   I       G   I   	   G
           s @ `P0 `PO `P0 `PAF	 `P0 `P0 `P0 `P@ `P P4P    d  d                             |  }           I                    G   I       G   I       G   I    G                G   I       G	                G	   I	      
   G           s @ `P0 `PO `P0 `PAF	 `P0 `P0 `P@ `P0 `P@ `P0 `P@ `P P4P    (  (                             |  }           I                    G   I       G   I       G   I    G                G   I      	   G
           s @ `P0 `PO `P0 `PAF	 `P0 `P0 `P@ `P0 `P@ `P P4P    ,  ,                                        G      A         G   G      !         G   G   G      )         G   G   G      $         G   G   G            G             o G   	   o G
   h   s        o G      o G
   h   s        o G      o G
   h   s        o G      o G
   h   s        s        s        s        s        s           s           s        s        s           s        s           s            s        !   s        "   s        #   s        $   s        %   s &       '   s &       (   s &       )   s &       *   s +          s +          s +           s +       #   s +       $   s +       !   s +       "   s ,       s -       s .       s /       s 0       s 1       s 2       s 3       s 4       s 5       s 6       s 7       s 8       s 9       s :       s ;           s ;          s ;          s ;       $   s ;       #   s <       s     =   o G
   h>   s     ?      %@   %o G
   hA   s B       s    C   2          D   o GE   F   G   s -          D   o GE   F   H   s    0 `P0 `P0 `P@0 `P@
 `PO `P*P/P/PD `P*P/P/PD' `P*P/P/PD= `P*P/P/PDP `P+)P4 `P+5P4 `P+4P4 `P+(P4 `P+<PDW `P P4 `P P4 `P+P4 `P+P4 `P !P4 `P+,P4 `P !P4 `P !P4 `P !P4 `P !P4 `P !P4 `P !P4 `P !PDf `P !P4 `P !P4 `P !P4 `P !PDl `P 'P4 `P 'P4 `P 'P4 `P 'P4 `P 'P4 `P 'P4 `P 'P4 `P+:PDv `P+!P4 `P+$P4 `P+#P4 `P+#P4 `P+"P4 `P+#P4 `P+"P4 `P+ P4 `P+P400 `P+P4 `P+%P4 `P+(P400 `P+&P4 `P+!P4 `P ,P4 `P ,P4 `P ,P4 `P ,P4 `P ,P400 `P+PD   `P+P/P400 `P P/.PD   `P+P400 `P0 `P+P 	P>00 `P+P 	P90P   8  8                                  o G      o G   o                       o G      G   G   G   o G   o           5            o G      o G   o        	      I
   6 `P*P/P*P8 `P0 `P*P P*"P8 `P0 `P*P/P*PM `P? P   d  d                                     o G     o G   o                        o G      G   G   G   o G   o           6             o G      o G   o               o G   	   o G
   h   s 6 `P*P/P*P9 `P0 `P*P P*"P9 `P0 `P*P/P*PN `P*P/P/PD P         F                	                o G   o               %o G      s 6 `P*P*P8 `P P/P4 P  d  d                                     o G     o G   o                        o G      G   G   G   o G   o           6             o G      o G   o               o G   	   o G
   h   s 6 `P*P/P*P9 `P0 `P*P P*"P9 `P0 `P*P/P*PN `P*P/P/PD P                                         o G   o                  %o G   o  G   h   s    -                %o G     s    6 `P*P*P8  `P7 `P P*P/PD `P? `P P/PI P   \   \   )                              G               6 `P0 `PL P        G                                  o           o G      o G   h   s 6 `P*P9 `P+P/P/PD P       Q                
                  o G   o           o G      o G   h   s 6 `P*P*P9 `P+P/P/PD P    X  X                                  o G     o G   o                       o G      G   G   G   o G   o           5            o G      o G   o            	      %o G
         s 6 `P*P/P*P8 `P0 `P*P P*"P8 `P0 `P*P/P*PM `P P P4 P  P   P                                     o G   s  6 `P*P*P4 P P   P                                     o G   s  6 `P*P*P4 P |  |                  &                                        G      A   
      G   G      !         G   G   G      )         G   G   G      $         G   G   G            G             o G	   
   o G   h   s    @ `PK 	`P0 `P0 `P@0 `P@ `P? `P*P/P/PD `P5Q      u               1                o G      o G   o           4           
         o G         %o G   o           K            o G         G   G   G	   %o G   o                    o G   
      %o G   o           E   '         o G      G   G   G	   o G   o     1   6 `P*P/P*P8 `P0 `P0 `P*P P* P9 `P0 `P*P P*0P@	0 `P*P P*P9 `P0 `P*P P*"PN P    |  |                  &                                        G      A   
      G   G      !         G   G   G      )         G   G   G      $         G   G   G            G             o G	   
   o G   h   s    @ `PK `P0 `P0 `P@0 `P@ `P? `P*P/P/PD `P5Q  0  0                                       o G      o G   h   s                 o G     o G   o         E             o G      G   G	   G
   o G   o       6 `P7 `P*P/P/PD	 `P? `P*P/P*P9 `P0 `P*P P*"PN P          E                                o G   o                      6 `P*P*P8 `P0 `P7 `PA V  |  |                  &                                        G      A   
      G   G      !         G   G   G      )         G   G   G      $         G   G   G            G             o G	   
   o G   h   s    @ `PK 	`P0 `P0 `P@0 `P@ `P? `P*P/P/PD `P5Q  (  (                                  o G      o G   o                       o G      o G   o           E            o G      G   G   G   o G   o        6 `P*P/P*P8 `P0 `P*P/P*P9 `P0 `P*P P*"PN P    |  |                  &                                        G      A   
      G   G      !         G   G   G      )         G   G   G      $         G   G   G            G             o G	   
   o G   h   s    @ `PK 	`P0 `P0 `P@0 `P@ `P? `P*P/P/PD `P5Q  (  (                                  o G      o G   o                       o G      o G   o           E            o G      G   G   G   o G   o        6 `P*P/P*P8 `P0 `P*P/P*P9 `P0 `P*P P*"PN P        O                T                  3        G              G   G   
                    G    H      ;        G    HG       G    HG     B       G   G      '        G     G   G   H   $   O   %     G     G   G   HG       G     G   G   HG        /      G	   G
   G      .   6     G      G	   G
   G   H   >   X   ?     G      G	   G
   G   HG       G      G	   G
   G   HG     M        /   P        %   %  %   %      T        T      0 `P:0@ 	`P0 `P0 `P0 `P@
 `P0 `P0 `P@ `P0 `P0 `P@ `P0 `P@0 `PN `P4Q                      >                  3        G              G   G   
   ^                 G    H      %        G    HG             G   G      '        G     G   G   H   !   /   "     G     G   G   HG        '      G   G	   G      .   .     G      G   G	   G   H   6   1   7     G      G   G	   G   HG     >        >      0 `P:@ `P0 `P0 `P0 `P0 `P0 `P0 `P@ `PN `P4Q          I                             G      3            G   h      G   o I      0 	`P0 `P@J &PNP    8   8                                 s  0 `P: P         R                             G      $         G      G   s 
         |  }     0 	`P0 `P PI `P/P9P   p   p   5                            |  }        h   I             s 0 `P@ `PO `P/P4P   8   8                                 s  0 `P: P         C                              s     G   G                s      s     @ `P: 	`P0 `PJ `PO	P      s                <           G                G   G      
   8        G   G   G         G   G   G      (         G   G   G   G           G   M      G      |  }  I      G   G      I        J   )      G   G      |  }  I      G   G   G     I   4      G   G	         :      G   M	   <   0 `P0 `P0 `P0 `P@ `P0 `P P9 `P0 `P0 `P P9 `P@ `P0 `P@P                                    G      E         G   G      %         G   G   G         [         G   G   G      7         G   M      G      |  }  I      0 `P0 `P0 `P0 `P PNP  |  |                  H          |  }          G   o  I        G   o  %I      |      	   
                             }          G   o  HI        G   o  I      |                       }          G   o  HI         |  }  I      G     G    o  K  G    o  5   #      G   !   K   G   "   I#      '     G    o  =   +      G     G    o  K   G   $   I#      1     G    o  @   5      G     G    o  &K   G   $   I#   8   <      G     G    o  K   G   "   I#   B        G%   o  I&        G'   o  I(      0 `P@ `P.P9 `P.P; `P0 `P P: `P.P9 `P0 `P P: `P.P9 `P P5 	`P*P? `P0 `P@ `P*P0 `P P5 `P@ `P*P0 `P P8 `P@0 `P P5 `P@ `P.P9 `P.PI `P4Q                                  |  }          	  *I         G                        I      G               G    *I         0 `P0 `P0 `P0 `P0 `PL `P4Q   P  P                             G     *o       G        )&<*o        )&  <)&             o             o             o      G       	    o              o 0 `P P8 `P P8 `P@ `P P8 `P P8 `P PH	 `P P P3Q   D  D                  9             o          o            %   %o G      s                  %   %o G   	   
   s          %   %o G      s          %   %o G   s           %   %o G   o  G         s    %            %   %o G     s          %   %o G   s           %   %o G   o  G         s 9   0 `P,P8 `P,P8 `P P.P4 	`P> `P P P4 `P P/P4 `P P*P4 `P P*P 	PN
0 `P P.P4 `P P*P4 `P P*P 	PIP   D  D                   8        G             G   G                   %o G   o  G         %   %o G	   
         %o G   o  G      o G   h   s           s  G   G              G   G   #   a   $             %   %o G         s        o G         s \   .             %   %o G         s        o G         s 8   0 `P0 `P/P*P: P: P: P/P/
PD `P PD `P0 `P P !P4 `P+P PN0 `P P !P4 `P+P PI"P                     (          g        G                   G                       o G      o    	      	       G      o       c           G	   X           
   %  H%I        '           
   %  H%I        G      o       c           G	   :   !         o G         
   %  H%s (   6 `P: `P0 `P0 `P*P/P0 `P/P0 `P0 `P0 `P0 `P@ `P/P0 `P0 `P*P PI P                       m            c                         ^        |  }        _   	   c      d       d      d      d       	   G
   G   G   I        	   G
   G   H         c      d       d      d      d       	   G
   G             	   G
   G   H   !      "   I     G     G         (     G   G      ,      -     G   G      /   /   I   0     0       H      4       H  	         %   %o G      o :   <                s         s 8   @     G         D             s F     .'  ,H   	   G
      4   M   	   G
   G         S       T      U   	   G
   G   G      t   \      	   G
   G   G   G      	       o G         s 	        o G         s m   0 `P: `P:0 `PF `P0 `P@	 `P@ `P5 : : : O `P@ `P@ `P5 : : : O `P0 `P@ `P&fP0 `P> `P P/%P= `P "P4 `P.PN$ `P0 `P PI 1`P@( `P@* `P0 `P0 `P+P *P4 `P+P ,PI1P               \   \   +                                   %   %o G   h   s 0 `P P/ PDP                                            H   t                   H%   %o G                %   %o G      o s    .'   {   0  `P&fP0 `P P 4P/!P#PD 6`P@ P                                                      G   G      k         G   G   G      F         G   G   G   %         G   G   G         0 `P00Q                       @               o G   h   s        o G   h   s        o G   h   s     	   o G   h
   s        o G   h   s        o G   h   s        o G   h   s        o G   h   s        o G   h   s        o G   h   s        o G   h   s        o G   h   s        o G   h   s        o G   h   s        o G   h    s     !   o G   h"   s @ `P+P/PD `P+P/PD
 `P+P/PD `P+P/PD `P+P/PD `P+P/PD `P+P/PD `P+P/PD `P+P/PD `P+P/PD" `P+P/PD% `P+P/PD( `P+P/PD+ `P+P/PD. `P+P/PD1 `P+P/PD4P   @   @                                    s 0 `P+P4 P   @   @                                    s 0 `P+P4 P   @   @                                    s 0 `P+P4 P   @   @                                    s 0 `P+P4 P   @   @                                    s 0 `P+P4 P   @   @                                    s 0 `P+P4 P   @   @                                    s 0 `P+P4 P   @   @                                    s 0 `P+P4 P   @   @                                    s 0 `P+P4 P   @   @                                    s 0 `P+P4 P   @   @                                    s 0 `P+P4 P   @   @                                    s 0 `P+P4 P   @   @                                    s 0 `P+P4 P   @   @                                    s 0 `P+P4 P   @   @                                    s 0 `P+P4 P   @   @                                    s 0 `P+P4 P   <  ,                   H          G      E         G   G      %         G   G   G         N        G   G   G   G   (             o G   s              o G	   s  
   
   #   
      G   G   G   G      +      G   G   G   
   H   (   3          o G	   s  D   7             G   G   G   
   H%   %o G	   s  C   
   
   .'
   .H   @ 	`P0 `P0 `P+P*PN0 `P+P*P4 `P,fP0 `P0 `P+P*PN0 `P P*BPI O`P@P <                                                G   G      '         G      |  }  I         G   G     I      |  }          I         s    |  }      h	   I
            s 0 	`P0 `P PN `P@ `P0 `PM	 `P)	PD `P0 `PO `P.P4P                                       n         G   Y         G   G      9   
      G   G            G   G   G                G	   G
   s    @ `P00 `P PI P  |   |   =                                 o G   h   s        o G   h   s @
 `P+P/!PD `P+P/PDP   (   (                               @   @   @                                 s  0 `P: `P1 Q          D                  	           G   G         #             o G   s  	   @ 	`P@0 `P+P*PI	P    ,  ,                                                     /         G   G         	      	      (             o G   s  -             o G   s      s     @ `P6 
`P0 `P@ `P0 `PK
 	`P0 `P+P*PN0 `P+P*P4 `POP    P   P                                    o G   h   s @ `P+P/%PDP X   X   $                                  o G      s 6 `P*P/P4 P          x                  
               7      U             o G      s -             o G      s    
   0 `P00 `P+P/	P4 `P:0 `P+P/	P4 `PJ	P                                      |  }               o G   o  I      |  }      h   I     h   I	     h
   I            s @ `P@ `P/P*9PI `P0 `PO
 `PO `PO `P.	P4P   <   <                                 s 0 `P'P4 P   8   8                                 s  0 `P: P   <   <                                 s 0 `P'P4 P   \  \                    +            s     G   G               G   G      '         G      |  }  I         G   G   G      ,         G   G      |  }  I          G   G   G       	   o G
   o  I       s  +   @ `P: 	`P0 `P0 `P PN `P0 `P PN
 `P "P*9P9 `POP                                           o G   h   s        o G   h   s        o G   h	   s     
   o G   h   s        o G   h   s @ `P+P/$PD `P+P/'PD `P+P/$PD `P+P/"PD$ `P+P/PD)P 8   8                                 s  0 `P: P   8   8                                 s  0 `P: P   0   0                              0 `P1 Q   8   8                                 s  0 `P: P   <   <                                 s 0 `P'$P4 P         D                  	           G   G         #             o G   s  	   @ 	`P@0 `P+P*$PI	P                        $                                  /         G   G         	      	      j             o G   s     G   G   G   	   #          
   o G   s     F             o G   s         o G   s      s  $   @ `P6 
`P0 `P@ `P0 `PK
 	`P0 `P+P*$P4 `P0 `P+P* P@0 `P+P*#P4 `P+P*$P4 `POP    P   P                                    o G   h   s @ `P+P/*PDP X   X   $                                  o G      s 6 `P*P/P4 P    l   l   0                            |  }        h   I          s @ `P@ `PO	 `P*
P4P   8   8                                 s  0 `P: P   D   D                                 s      s  @ `P: `P:P t  t                                   u                   o G      s        o G      s        o G      s k             o G      s        o G      s        o G      s       0 `P00 `P+P $P4 `P+P 'P4 `P+P/	P4 `P:0 `P+P $P4 `P+P 'P4 `P+P/	P4 `PJP        ^                1           |  }           G   G   G   G   I             o G   o  I	          
   o G   o  I             o G   o  I      G   G      %         G   G   G      #   -   $         G   G   G   G   I   *      |  }      h   I     h   I     h   I            s @ `P@ `P0 `P/P*;P9 `P/P*;P9 `P/P*?PI	 
`P0 `P@ `P0 `PO `PO `PO `P.P4P  <   <                                 s 0 `P'P4 P   8   8                                 s  0 `P: P   <   <                                 s 0 `P'P4 P   p   p   9                  
            s     G   G                s  
   @ `P: 	`P0 `POP  \  \                                                     9             o G      o    
      
      K                    s           o G   s  #             o G   s     0 `P6 
`P0 `P@ `P+P/#P? `PK	 	`P0 `P0 `P)&PI `P+P*#PN0 `P+P*#PIP                       o         G      E         G   G      %         G   G   G                     o G   o  G   2          	   o G
      o G   s            o G            o s    |        }       [(   \]   )               H         o G   o      G   s    G      G            %  o    G   G   G   G     Ho s        o G     s 8E   ^   G   G   G   G   G   [L   \]   M            G   G   G   G   G      H    G      Z          o G   o      G   s    G      G            o   G     G   G    !   o o s        o G     s o   o   ^o   0 	`P0 `P+P*"P0 `P+P/%P*PI `P+P 'P#P4 `P0 `P0 `P? `P+P*+P8 `P+P4 `P P P#P4 `P+P."PD
 L `P0 `P0 `P0 `P+P*+P8 `P+P4 `P P cP#P#P4 `P+P."PI @P                               K                 ,               o G   h   s        o G   h   s        o G   h   s     	   o G   h
   s        o G   h   s        o G   h   s        o G   h   s        o G   h   s        o G   h   s        o G   h   s        o G   h   s @ `P+P/.PD `P+P//PD `P+P/0PD" `P+P/)PD& `P+P/(PD+ `P+P/PD. `P+P/PD1 `P+P/PD4 `P+P/PD7 `P+P/PD= `P+P/PDAP <   <                                 s 0 `P'*P4 P   <   <                                 s 0 `P'*P4 P   @   @                                    s 0 `P+P4 P   @   @                                    s 0 `P+$P4 P   @   @                                    s 0 `P+$P4 P   @   @                                    s 0 `P+P4 P   @   @                                    s 0 `P+P4 P   @   @                                    s 0 `P+P4 P   @   @                                    s 0 `P+P4 P   @   @                                    s 0 `P+P4 P   @   @                                 s  0 `P: `P1 Q        C	                u         G   G      K         G   G   G      &         G   G   G   G                s  #             o G	   s        G   G
            G   G
   G   "      #       s    G   G
   G   n   *          o G   s         o G   s         o G   s         o G   s  :      G   G
        @      G   G
   G   t  E          o G   s         o G   s     G   G      I   S      G   G   G      $   Z      G   G   G   G   _      `          o G   s     G   G   G   G      *   l      G   G   G   G      r   <   s          o G      G   G   G   G   s |   #   |          o G   s        G   G
   G   <             o G   s         o G   s        G   G
   G   <             o G   s          o G   s        G   G
   G!   z            o G   s      "   o G   s     G   G      I         G   G   G!      $         G   G   G!   G#                $   o G   s     G   G   G!   G%      *         G   G   G!   G%         B          &   o G   '      G   G   G!   G%   %s    #          $   o G   s           G   G
   [   \]      (   (   (   G)   g*   o           +   o G,   -   (   %.   %(   %/   %   G   G
   (   H%0   %s     +   o G   s      1   (   %2   %o G   s       )  ^   G   G
   G3            4   o G   s     G   G3           G   G3   G5     Q        G6      G   G3   G5   h7   s     8   o G9   h:   s      G   G
   G;      $      <   o G   s     G   G;      ,     G   G;   G=   0  7   1      >   o G      G   G;   G=   s 9     G   G
   G      ?     G   G
   G      D     G   G
   G   l   I     G   G
   G   M   N     G   G
   G!   .   S        T     G   G
   G;   X  #   Y      ?   o G   s  ]     G   G@      !   c     G   G@   GA   h  A   i         o G   s         o G   s  #   q         o G   s  u  @ `P0 `P00 `P+P*PI
 `P0 `P'*P4 `P0 `P+P*2P4 `P+P*(P4 `P+P*.P4 `P+P* PI `P@ `P0 `P+P*(P4 `P+P*P4 `P0 `P+P*P4 `P0 `P+P &P@0 `P+P*PI" `P0 `P+P*(P4 `P+P*PI& `P0 `P+P*(P4 `P+P*PI* `P0 `P+P*(P4 `P+P*P4 `P0 `P+P*P4 `P0 `P+P 4P@20 `P+P*PI8 %`P6 `P0 `P P= `P+P /P4 `P+P*/P4 `P P*PD? `PK9 LD `P0 `P+P*P4 `P0 `P PDK `P+P/PIh `P0 `P+P*P4 `P0 `P+P +PIr `P00000?0 `P+P*'PI~ `P0 `P+P*2P4 `P+P*(P>00 `P+P*(P90P            o     h   h   3                                o G        %   %  %   %s 0 `P+P P4 P                                       o G   o        G   G   G      H                 G      z        G   	   o               G   &         
     %             %       '             o G     s    6 `P*P*P8 `P0 `P6 	`P%@ `P PH 
`P0 `P@0 `P@ 	`PN `P+P./PI P         W                                o G     s        o G     s        o G     s 0 `P+P- P4 `P+P*.$P4 `P+P*6$P4P                                     G   G      K         G   G   G      &         G   G   G   G                o G   	   o                 0 `P0 `P+P/GP8 `P 0Q     :                1          G   G                G   G   G      2             o G   o  G   	   s       G   G
      %         G   G
   G                      G   G
     o           G   G
     o          o G      s        o G     s 1   0 `P &0 `P+P*P/	PI `P0 `P P8 `P P8 `P+P.!P4 `P+P.PIP        O                      $                   %   %v                                              	    	      |  }           I                               o        	    
   o G             o s 	       o G             o s N `P71 `P 	P0 ; `PM `P0 `PAF `P0 `P0 `P0 `P&PN `P+P 5P#P4 `P+P 7P#P4P          M                 *   D  D                  _                                  k         G   G      7   	                   G   G                        G   G	   O         G   G
   G      *         G   G
   G   G      %   1   &          o G          o s ,      G   G
   G      *   3      G   G
   G   G      :      ;      G   G
   G   G         s         o G     G   s   G   G   <   K          o G   s         o G   s  S      (   U          o G   s  -   Y          o G   s      s  _   @ `P6 `P0 `P0 `P !0 `PK
 `P0 `P+P 5P#PI `P0 `P0 `PJ `P+P P4 `P@ `P+P*PD `P+P*$PI `P0 `P+P*P>0 `P+P*P4 `PO!P                                       o       G   G   G      (   	      G   G   G   G                      Q         G	        G
     G   o          o G     s    0 `P.P8 `P0 `P0 `P P8 `P+P.PIP   P   P                                    o G      s @ `P+P/2P4P        x                  
               7      U             o G      s -             o G      s    
   0 	`P00 `P+P/	P4 `P:0 `P+P/	P4 `PJ	P                        A           |  }               o G   o  I             o G   o  I             o G	   
   o I             o G	   
   o I             o G	   
   o                      I      G   G      %   "      G   G   G      (   -   )         G   G   G   G   I   /      G      o      G      o        7     8      9        I   :      |  }      h   I     h   I     h   I    !         s @ `P0 `P/P*0P9 `P/P*3P9 `P/P/HP9 `P/P/OP9 `P/P/5P@	 `P0 `P@ `P P8 `P P8 `P0 `P@ `P0 `PO `PO `PO `P.P4P <   <                                 s 0 `P'P4 P   8   8                                 s  0 `P: P   <   <                                 s 0 `P'P4 P       a                 <            s     G   G      <        G   G      '         G      |  }  I         G   G   G      ^         G   G      |  }  I      G   G   G       	   o G
   o  I   )       s     @   -      G   G          3      G   G      7       8      G   G   s <   @ `P: `P0 `P0 `P PN `P0 `P P9 `P P*0PN `P: `P@ `P PIP                                                                 (             o G   s  #   
          o G   s     @ `P6 `P0 `PM `P0 `P+P*P>0 `P+P*PIP    8   8                                 s  @ `P:P        N                 (          |  }         o  6         G      G   c      d    o             G   6   	   9      G
   G   G   9   6      9      G   9   9   h   9   h   9   h   9   h   9   6   9   9   9   s N   #      h   I      h   I      h    I   !          s (   0 `P@ `P 4*P0 `P0 : 0 5 : @ J J J J  5 K# F PN%0 `P@) `P@, `P@/ `P PI1P <   <                                 s 0 `P'P4 P   <   <                                 s 0 `P'P4 P   \   \   %                             h   I             s 0 `P@ `P P4 P  8   8                                 s  0 `P: P   h   h   ,                             G   6      9   I       s   0 `P? @ `P: `P1 Q   <   <                                 s 0 `P'P4 P   8   8                                 s  0 `P: P   <   <                                 s 0 `P'P4 P       q                ^      $            |  }              I         2                o G      o I   
      	   2             
   o G      o I         G   G      %         G   G   G         .            G   G   G   G   I   $          v          &            &          v          (            (         *      G   ,   )   -         /      G   1     2      G   o   5          o G      o #   ;          o G   s  ?          o G   h   s C          o G   h   s        o G           !   o G      o s     "   o G#   $   s     %   o G&   s  M   W      '   $   Y   (   G)   *   I+      \   ,       s ^   > `P7 `P0 `PG `P@ `P0 `P P/9PN
 `P0 `P P/8PN `P0 `P@1 `P+P0 ; `PM1 `P+	P0 ; `PM `P@ `P0 `P+P/2P? `P+P*,PI# `P+P/2PI( `P+P/,PDC `P+P BP/+P#P4 `P+P/P4 `P+P*$P>@H `P@J `P@L0 `P+PIPP         a                     6             u     t   t   7                                 o G          o G      o s 0 `P+P 3P/3P#P4 P                        "               s           o G      o I         	      G      p             	   o G      o I
       o  5         G   6      9   I       s            $         G      I                 s "   @ `P+$PD `P P/3PI `P0 `P P/,P9 `P&P= `P? @ `P: `PA F `P@ `P@@ `P+PI P                          &            s     G   G               G   G      O         G   G   G      *         G   G   G   G         .      	      G   G   G   G   I
   $       s  &   @ `P: `P0 `P0 `P@ `PO	P                                         %   %o G      s          %   %o G      s          %   %o G	   s      
   o G      s 0 `P P/1P4 `P P/)P4 `P P*)PD `P+P/P4P   X  X                                             `             o G   s         o G   s         o G   	   s [             o G   s         o G   s         o G   	   s    0 `P0 `PJ `P= `P+P* P4 `P+P*P4 `P+P 4P>0 `P+P* P4 `P+P*P4 `P+P 4PIP  |   |   =                                 o G   h   s        o G   h   s @ `P+P/$PD
 `P+P/PDP   8   8                                 s  0 `P: P   0   0                              0 `P1 Q   L  L  
                           G   G      	        G   G   G      U         G   G   G   G      +         G   G   G   G   G      (             o G	   s  #   !          o G
   s  %      G   G   G      U   ,      G   G   G   G      +   4      G   G   G   G   G   ;   (   <          o G	   s  #   @          o G
   s  D      G   G   G      &   K      G   G   G   G   Q   (   R          o G	   s  #   V          o G
   s  Z      G   G   G      &   a      G   G   G   G   g   (   h          o G	   s  #   l          o G
   s  p      G   G   G      &   w      G   G   G   G   }   (   ~          o G	   s  #             o G
   s        G   G   G      &         G   G   G   G      (             o G	   s  #             o G
   s        G   G   G      &         G   G   G   G      (             o G	   s  #             o G
   s        G   G   G      &         G   G   G   G      (             o G	   s  #             o G
   s        G   G   G      &         G   G   G   G      (             o G	   s  #             o G
   s        G   G   G      &         G   G   G   G      (             o G	   s  #             o G
   s        G   G   G      &         G   G   G   G     (            o G   s  #            o G
   s  
     G   G   G       &        G   G   G    G     (         !   o G	   s  #         !   o G
   s        G   G   G"      &   '     G   G   G"   G   -  (   .      #   o G	   s  #   2      #   o G
   s  6     G   G   G$      &   =     G   G   G$   G   C  (   D      %   o G	   s  #   H      %   o G
   s  L     G   G   G&      &   S     G   G   G&   G   Y  (   Z      '   o G	   s  #   ^      '   o G
   s  b     G   G   G(      &   i     G   G   G(   G   o  (   p      )   o G	   s  #   t      )   o G
   s  x     G   G   G*      &        G   G   G*   G     (         +   o G	   s  #         +   o G
   s    @ 	`P@ `P0 `P+P*%PN0 `P+P*%PI `P0 `P+P*$PN0 `P+P*$PI `P0 `P+P* PN0 `P+P* PI `P0 `P+P*&PN0 `P+P*&PI  `P0 `P+P*PN#0 `P+P*PI' `P0 `P+P* PN*0 `P+P* PI. `P0 `P+P*!PN10 `P+P*!PI5 `P0 `P+P*#PN80 `P+P*#PI< `P0 `P+P*)PN?0 `P+P*)PIC `P0 `P+P*&PNF0 `P+P*&PIJ `P0 `P+P*#PNM0 `P+P*#PIQ `P0 `P+P*!PNT0 `P+P*!PIX `P0 `P+P**PN[0 `P+P**PI_ `P0 `P+P*0PNb0 `P+P*0PIf `P0 `P+P*3PNi0 `P+P*3PIm `P0 `P+P*$PNp0 `P+P*$PIs `P0 `P+P*2PNv0 `P+P*2PIzP    <  <  b         
       I                                  /         G   G         	      	              G            G           G      E         G   G	      %         G   G	   G
      !   (   "      G   G	   G
     H   &        %   (     G   o      *        *         ,            %   %o G   o      G      o           G      s   G     s    ;         s =       s      s         o G   s  #   E          o G   s  I   0 `P6 
`P0 `P@ `P0 `PK	 	`P@ `P@@ `P0 `P@ `P0 `P.P@0 `PO `PO `P P+!P8 `P 	PH! `P< `P P4 `P/PN%@' 	`P*PI) `P: `P: `P+P*PN-0 `P+P*PI0P    8  8  ;                         G   G               G   G         G               G   G         ;             o G      G   G   G	   s (             o G   
   s       G         !      G   G      %   ;   &          o G      G   G   G	   s (   -          o G   
   s 1      G         5      G   G	   8   ,  9          o G   s     G      }   A          o G   s         o G   s         o G      s        o G      s x   Q          o G   s         o G   s         o G      s        o G      s a   #   a          o G   s  e      G   G      %   k      G   G   G      q      r          o G         G   G   G   s        o G   s     G      @         G   G	   %         G   G   G         #             o G   s                  o G   s     G       T             o G         G    G	   s        o G   s  F             o G      !   s        o G   s        G"               G"   G	         6          #   o G      G"   G	   s (          #   o G   
   s       G$               G$   G	         6          %   o G      G$   G	   s (          %   o G   
   s    &      s    G'      (          (   o G   s  #          (   o G   s        G)               G)   G	         6          *   o G      G)   G	   s (          *   o G   
   s       G+               G+   G	         6          ,   o G      G+   G	   s (         ,   o G   
   s      G-         	     G-   G	        6         .   o G      G-   G	   s (         .   o G   
   s      G/              G/   G	         6   !      0   o G      G/   G	   s (   '      0   o G   
   s +  1    s     G2         1     G2   G	      5     6  3      s (   8      4   o G   
   s <     G5         @     G5   G	   C  6  D  6   |  }    6   |7       G5   G	   o )  }   8      o      G9   :    ;     o   G<     G=   :      G>     o   G?   :      G@     o   GA   H  GB     GA   H  GA   GC   o
       D   o G      G9   :    E     o   o s 4   m      D   o G   :    F     o s s     GG      z  w  H   GI      GG   G	   *o      GG   G	     )&<*  :    J       o   :    K       o        GG   GL      R        GG   GL   G	     :    M        GG   GL   G	   o         :    N     o        G9               o       O   o G     s     P   o G   s  A         O   o G   
   s     P   o G   s       GG              GG   GQ        5     R      s     S   o G   s  A         T   o G   
   s     S   o G   s       GU              GU   G	        5     V      s     W   o G   s  A         X   o G   
   s     W   o G   s       GY      $        GY   GZ   G	        f             GY   G[      $        GY   G[   G	        2        G\      GY   G[   G	   h]   s   6   |  }       GY   G^               GY   G^   G	           :    _     o 	  6   |7       GY   G^   G	   o 7       G`   G	   o %7      Ga   o  <)o %)  }        :    b     o 	  6   |7       GY   Gc   G	   o 7       G`   G	   o %7      Ga   o  <)o %)  }   *  8      o      G9   :    ;     o   G<     G=   :      G>     o   G?   :      G@     o   GA   H  GB     GA   H  GA   GC   o
      G9   	    o 	     GY   Gd      I   I     GY   Gd   G	      %   O     GY   Gd   G	   Ge   T  8   U  	  f      GY   Gd   G	   Gg   %h   %%	  \     >  ]  i       o         `    Gj      c  i       GY   Gk   G	      GY   GZ   G	   %o      G9   :    l     o   Gj     Gm     Gj     Gm   o 
  u  o  u  i       o   i       GY   Gk   G	   o   i       GY   GZ   G	   o   
   
    Gj        
     G9   :    n     o   Gj     Gm     Gj     Gm   o %
  
    Gj        o        
     %
      Gj   X     
     G9   :    p     o   Gj     Gm     Gj     Gm   o %
         
   
    
       
  
            {     i       GY   Gk   G	      GY   GZ   G	   %o      G9   :    q     o   Gj     Gm   o 
       i       GY   Gk   G	   o   i       GY   GZ   G	   o      G9   :    r     o   Gj     Gm     Gj     Gm   o 
    
  	       o   	  %     
     %      s   o G     o Gt   u   v   s     w   o G   s  A         s   o G   
   s     w   o G   s       Gx   Gy   (         z   o G\   h{   s      G              G   G	   j        G   G      J        G   G   G      %        G   G   G        K         G   G   G        |      s      }    s  
     G~              G~   G	     (            o G   s  #            o G   s    0 	`P0 `P@ `P0 `P+P %PN0 `P+P/%PI `P0 `P+P $PN0 `P+P/$PI `P0 `P+P* PD `P0 `P+P*P4 `P+P*#P4 `P+P/ P4 `P+P/ PN0 `P+P*P4 `P+P*#P4 `P+P/ P4 `P+P/ P@#0 `P+P* PI' `P0 `P+P %P4 `P+P*&PD+ `P0 `P+P*1P@/0 `P+P*1PD2 `P0 `P+P %P4 `P+P*&PN60 `P+P %P4 `P+P*&PI< `P0 `P+P PN?0 `P+P/PIC `P0 `P+P  PNF0 `P+P/ PIJ `P)P4 `P0 `P+P* PNN0 `P+P* PIR `P0 `P+P !PNU0 `P+P/!PIY `P0 `P+P #PN\0 `P+P/#PI` `P0 `P+P )PNc0 `P+P/)PIg `P0 `P+P &PNj0 `P+P/&PIn `PJp `P0 `P)PNs0 `P+P/!PIw `P0 &`P0 `P 	P+8 `P*P8 `P 
P ^P HP RP8 `P+P 0P'P#PN~0 `P+P &P#P900 `P0 `P P8 `P0 `P P8 `P P8 `P6 `P0 `P0 `P P000 `P.P=0 `P 	P8 `P+P.$P4 `P+P*$P>00 `P+P/$P4 `P+P*$P900 `P0 `P),P4 `P+P*.P>00 `P+P/.P4 `P+P*.P900 `P0 `P)!P4 `P+P*0P>00 `P+P/0P4 `P+P*0P900 `P000 `P'`P7 `P0 `P PI   `P00 `P00 `P.P8 `P 
P ;P KP&P,000 `P.P8 `P 
P 6P KP&P,M   `P*P8 `P 
P ^P HP RP800 `P P80 `P00 `P;00 `P? `P+P8 `P? 	`P0 `P P8 `P P P0000 `P+P8 `P P8 `P P80 `P: 	`P00 `P P P6 `P;0 	`P00 `P P P00000 `P?00 `P00 `P? `P P8 `P P P000 `P P8 `P P8 `P P PM   `P00 `P+P.2P P4 `P+P*2P>00 `P+P/2P4 `P+P*2PI  `P0 `P+P/KPI  `P0 `P0 `P)1P>00 `P?000 `P0 `P+P*$P>00 `P+P*$P900P          W                          G   G          G       G   G       G   G         0 	`P0 `P7 `P> `P0 `P0 `PA V  \   \   )                                  o G         s 6 `P*P P4 P  l  l                   0           G   G                  G   G   G   G   I         G   G            P         G   G      I      G   G   G	      .            G   G   G	   G   I	   &   
    s     G   G   G      .       s  0   @ 	`P0 `P0 `P@ `P0 `P@	 `P: `P0 `POP                                       V                   o G      s        o G      s L   
          o G      s        o G      s       0 `P00 `P+P $P4 `P+P/	P4 `P:0 `P+P $P4 `P+P/	P4 `PJP      9                /           |  }        G   G               G   G   G      -            G   G   G   G   I         G   G   G      -            G   G   G   G   I   "   	    s  
    s      s     |  }      h   I     h   I     h   I            s @ `P0 	`P0 `P0 `P@ `P0 `P@ `P: `P: `PJ `P0 `PO `PO `PO `P.
P4P <   <                                 s 0 `P'P4 P   8   8                                 s  0 `P: P   <   <                                 s 0 `P'P4 P                                       G   G   G      F         G   G   G      !         G   G   G      (             G   G   G   o        s  	    s  
    s  0 	`P@ `P PC
F `P: `P: `P:P                                G   G      O         G   G   G      *         G   G   G   G         o         G   G      O         G   G   G      *   "      G   G   G   G      )     *           -      G      E   2      G   G      %   8      G   G   G	      >   "   ?      G   G   G	     C      G   G      %   I      G   G   G      O     P      G   G   G   H  H   ;   Y      G   G   G   H  HG
          1  `      G         e      G   G	      a   k      G   G	   G      <   r      G   G   G   H   G   G	   G   H   ~   ]         G   G   G   H   G   G	   G   HG
         G   G	   G     9         G   G   G   HG   G
                                             o          G   G   G   HG      7                     o %   %%   ]               G   G   G   HG   %   %   G   G   G   HG   %   %%             o G      s (             o G
      s    (             o G
      s    0 `P00 `P0 `P0 `P@00 `P0 `P0 `P0 `P@ `P0 `P0 `P@0 `P0 `PO `P0 `P+PM `P0 `P P@0 `PK# `P+P. PN%0 `P+P/ P@)0 `P+P/ PI,P      ^                         G   G      %         G   G   G                                   G   G   G   G   G	   v        G   G   G   G      H  
   |  }      G     G   G   s   G     G   G   s       o   
   |  }      G     G   G   s   G     G   G   s       o     G   G   H   ;     G   K  G   K  ;I     G      I   B      G   G   G   G   G	      J         %   K     G   G     G   G     Q     G   HG   U     G   H-   Y     G      \     G   ;^   S   _         G            o       G   G     o o %      i         G            o       G   G     o    G            o   G   H  G     G   H  G   G   o    G            o   G   H  G     G   H  G   G   o o %             G   G              G   G                 G   HG        G   H-        G           G   ;   *                  o %   e           G             o       G   G     o    G            o   G   H  G     G   H  G   G   o       G   G     o    G            o   G   H  G     G   H  G   G   o o %         G   G   G   G   G	            !   %            .'   e      "   %       #   o G$      s (          #   o G$   %   s    0 	`P0 `P: `P,fP0 "`P0 `P0 `P P4 `P P4 `P*PH
 `P0 `P 	P4 `P 	P4 `P*P8 `P0 `P? `P? `P< `P@ `P0 `PK `P0 `P0 `P P EP#P@0 `P P CP OP P   P P#P@ 0 `P0 `P0 `P P6 `PJ' `P P DP OP P   P MP P#|PK) `P0 `PK P`P@- `P6 `P+P.!PN00 `P+P/!PI3P           _           ~                            G      h            |  }  I      G   I      G      G   h      G   G   o I	      0 	`P0 `P/P9 `P0 `P@O 8PNP @   @                                    s 0 `P+.P4 P         J                             G      4         G      G   G   s    M      0 	`P0 `P P4 `P@P                     h          G               G      o   
      G   G      O         G   G   G      *         G   G   G   G                 G   G   G   G   G	   .(I	      G   G   G   G   G	   Y  0   
   G      G   G   G   G   G	   *o    
   G      G   G   G   G   G	      )&<*o      G   G   G   G   G	      )&  <)&              o              o              o          o G      G          o              o s 2   b       s         o G      s h   @ 	`P0 `P0 `P0 `P P8 `P P8 `P@	 `P P8 `P P8  `P PH `P+P =P P#PN0 `P: `P+P/.PIP        !                 1              o G      o          G   G   G      *         G   G   G   G	               
   G            
      |  }  I   
   G   I   
   G      G   G   G   G	   I	   
   G      G   h   
   G   G   o I   1   0 `P+P/0P= `P0 `P0 `P/P9 `P0 `P0 `P@	O .PNP   @   @                                    s 0 `P+#P4 P                                          o G      s    G          	      G   G         4      	   G
      G   G   s    M      0 `P+P/0P4 	`P0 `P P4 `P@P   $  $                    #          G                G   G      
            G   G   .(I      G   G   C             o G          G   G     o s       	    s  
    s  #   0 `P0 `P0 `P0 `P+P 5P#PN0 `P: `POP  @  @                    $           G   G   G      *         G   G   G   G         Z             o G      G   G   G   G   s     	   o G
   s  A          	   o G   s         o G      s $   @ 	`P0 `P+P $P4 `P+P*$PN0 `P+P*$P4 `P+P/$PI
P                                   G                  |  }  I      G   I      G      G   G   G	   I
      G      G   h      G   G   o I      0 	`P0 `P/$P9 `P0 `P0 `P:@O PN
P  @   @                                    s 0 `P+3P4 P         J                             G      4         G      G   G   s    M      0 	`P0 `P P4 `P@P p  p                   )          G   G            G   G   .(I      G   G                     G   G   o           o G      G	   
       o    G   G      o s 7   !       s         o G   s      s  )   @ 	`P0 `P0 `P0  `P P8 `P+P ?P P#PN0 `P: `P+P*1P4 `POP   L   L                                    G   G   G   I   0 `P0P   $  $                                   o G   h   s        o G   h   s        o G   h	   s     
   o G   h   s        o G   h   s        o G   h   s @ `P+P/PD `P+P/"PD `P+P/PD" `P+P/PD& `P+P/PD+ `P+P/PD/P   8   8                                 s  0 `P: P   8   8                                 s  0 `P: P   0   0                              0 `P1 Q   8   8                                 s  0 `P: P   8   8                                 s  0 `P: P   <   <                                 s 0 `P'P4 P   `   `   )                                 o G      o G   s  @ `P+P/P*(PDP          i                1                                        j             o G   s     G   G   G      #             o G   s               	   o G
   s         o G
   s      s     G   G   !   #      G   G   G   (   (   )          o G   s  #   -          o G
   s  1   0 `P6 
`P0 `PM 	`P0 `P+P*P4 `P0 `P+P*P@0 `P+P*P4 `P+P*P4 `PJ `P0 `P+P*PN0 `P+P*PIP   P   P                                    o G   h   s @ `P+P/%PDP X   X   $                                  o G      s 6 `P*P/P4 P    t  t                                   u                   o G      s        o G      s        o G      s k             o G      s        o G      s        o G      s       0 `P00 `P+P P4 `P+P "P4 `P+P/	P4 `P:0 `P+P P4 `P+P "P4 `P+P/	P4 `PJP        ^                1           |  }           G   G   G   G   I             o G   o  I	          
   o G   o  I             o G   o  I      G   G      %         G   G   G      #   -   $         G   G   G   G   I   *      |  }      h   I     h   I     h   I            s @ `P@ `P0 `P/P*6P9 `P/P*6P9 `P/P*:PI	 
`P0 `P@ `P0 `PO `PO `PO `P.	P4P  <   <                                 s 0 `P'P4 P   8   8                                 s  0 `P: P   <   <                                 s 0 `P'P4 P         E                              s     G   G                 s     s    @ `P: 	`P0 `P'P4 `P'PIP                       :                                           G   G      K   
      G   G   G      &         G   G   G   G                              G   G      '         G      |  }  I   #      G   G   G      ,   *      G   G      |  }  I   0      G   G   G      I          s 	       s @ `P6 
`P0 `P@ `P0 `P@	0 `PK 	`P0 `P PN 	`P0 `P  PN `P0 `P*PD `P&%P4P    \  \                                                     9             o G      o    
      
      K                    s           o G   s  #             o G   s     0 `P6 
`P0 `P@ `P+P/P? `PK	 	`P0 `P0 `P)!PI `P+P*PN0 `P+P*PIP                       o         G      E         G   G      %         G   G   G                     o G   o  G   2          	   o G
      o G   s            o G            o s    |        }       [(   \]   )               H         o G   o      G   s    G      G            %  o    G   G   G   G     Ho s        o G     s 8E   ^   G   G   G   G   G   [L   \]   M            G   G   G   G   G      H    G      Z          o G   o      G   s    G      G            o   G     G   G    !   o o s        o G     s o   o   ^o   0 	`P0 `P+P*P0 `P+P/ P*PI `P+P "P#P4 `P0 `P0 `P? `P+P*&P8 `P+P4 `P P P#P4 `P+P.PD
 L `P0 `P0 `P0 `P+P*&P8 `P+P4 `P P ^P#P#P4 `P+P.PI @P                                 y                                 o G   h   s        o G   h   s        o G   h	   s     
   o G   h   s @ `P+P/(PD `P+P/,PD `P+P/(PD `P+P/!PDP   <   <                                 s 0 `P'P4 P   8   8                                 s  0 `P: P   0   0                              0 `P1 Q   8   8                                 s  0 `P: P                                      G   G   7             o G      o G   s  <             o G	   s         o G	   s     @ 	`P@ `P+P/P*(PN
0 `P+P*(P4 `P+P*PIP     8                *                                        2          s         o G   s               o G   s     G   G   K         G   G   G   	   &         G   G   G   G   !   (   "       
   o G   s  #   &       
   o G   s  *   0 `P6 
`P0 `PM 	`P0 `P: `P+P*(PN	0 `P+P*(PD `P0 `P+P*!PN0 `P+P*!PIP     G                -          G   G      %         G   G   G                 G   G   G         G      6             o G      G   G	   s (             o G   
   s       G      ;   #          o G         G   G	   s -   )          o G         s -   0 	`P0 )`P@ `P0 `P+P )PN0 `P+P/)PI `P0 `P+P *PN0 `P+P *PIP          x                  
               7      U             o G      s -             o G      s    
   0 `P00 `P+P/	P4 `P:0 `P+P/	P4 `PJ	P    X  X                   "           |  }           G   G   G   G   I      G   G      %         G   G   G         -            G   G   G   G   I         |  }      h	   I
     h   I     h   I            s @ `P@ `P@ 
`P0 `P@
 `P0 `PO `PO `PO `P.P4P <   <                                 s 0 `P'P4 P   8   8                                 s  0 `P: P   <   <                                 s 0 `P'P4 P   p   p   9                  
            s     G   G                s  
   @ `P: 	`P0 `POP                      :                                           G   G      K   
      G   G   G      &         G   G   G   G                              G   G      '         G      |  }  I   #      G   G   G      ,   *      G   G      |  }  I   0      G   G   G      I          s 	       s @ `P6 
`P0 `P@ `P0 `P@	0 `PK 	`P0 `P PN 	`P0 `P )PN `P0 `P*PD `P&%P4P    H  H                   4               o G   h   s        o G   h   s        o G   h	   s     
   o G   h   s        o G   h   s        o G   h   s        o G   h   s        o G   h   s        o G   h   s        o G   h   s        o G   h   s        o G   h   s        o G   h   s @ `P+P/>PD `P+P/)PD `P+P//PD `P+P/1PD `P+P/)PD `P+P/*PD  `P+P/0PD# `P+P/1PD, `P+P/$PD/ `P+P/*PD5 `P+P/PD9 `P+P/>PD= `P+P/0PDAP 8   8                                 s  0 `P: P   <   <                                 s 0 `P'P4 P   t   t   -                              s     s     s     s 0 `P'P4 `P''P4 `P'P4 `P'P4 P  8   8                                 s  0 `P: P   `   `   "                              s     s     s 0 `P'P4 `P'P4 `P'P4 P 8   8                                 s  0 `P: P   8   8                                 s  0 `P: P   t   t   -                              s     s     s     s 0 `P'P4 `P''P4 `P'P4 `P'P4 P  0   0                              0 `P1 Q   0   0                              0 `P1 Q   P   P                                 s     s 0 `P' P4 `P'P4 P    L   L                                 s     s  0 `P'P4 `P: P    P   P                                 s     s 0 `P'P4 `P'P4 P    l  l                    $           G   G                o G   s         o G   s         o G   s         o G   s      	   o G   s      
   o G   s         o G   s         o G   s  $   @ 	`P0 `P+P*$P4 `P+P**P4 `P+P*1P4 `P+P*+P4 `P+P*>P4 `P+P*0P4 `P+P*%P4 `P+P*"PIP                      &                                        2          s         o G   s               o G   s     G   G   K         G   G   G   	   &         G   G   G   G   !      "   
    s    $   
    s &   0 `P6 
`P0 `PM 	`P0 `P: `P+P*$PN	0 `P+P*$PD `P0 `P'*PN0 `P'*PIP                        *                      o G   s         o G   s         o G   s         o G   s         o G   s               o G   s         o G   s         o G   s         o G   s         o G   s  *   0 	`P? `P+P*+P4 `P+P*>P4 `P+P*0P4 `P+P*%P4 `P+P*"PN0 `P+P*+P4 `P+P*>P4 `P+P*0P4 `P+P*%P4 `P+P*"PIP        x                                                         5          s      s     s     s    0 `P6 
`P0 `PM 	`P0 `P: `P'P4 `P'4P4 `P'PIP    H  H                                                           h          s      s      s     s     s        o G   s  	    s #             o G
   s     0 `P6 
`P0 `PM 	`P@ `P: `P: `P''P4 `P' P4 `P'P4 `P+P*#P4 `P'PN0 `P+P*#PIP                                                              >          s     s        o G   s  #             o G   s     0 `P6 
`P0 `PM 	`P0 `P'P4 `P''P4 `P+P*)PN
0 `P+P*)PIP  (  (                                                           A             o G   s         o G   s  <             o G   s         o G   s     0 `P6 
`P0 `PM 	`P0 `P+P*1P4 `P+P*0PN	0 `P+P*1P4 `P+P*0PIP    (  (                   "          G   G      O         G   G   G      *         G   G   G   G         J         G   G   G   G             o G   h   s (          	   o G
      s "   0 	`P0 $`P0 `P*P/PN0 `P+P/2PIP    X  X          
       ?                o H         H   -            HG            	      G      o         G   G      O         G   G   G      *            G   G   G   H   "   K   #         G   G   G   HG        G   G   G     0   -         G   HG        G     1          o G     s        o G      G	   
   !   ;            o    =      G	   >   s 6 `P*P:00 `P0 `P0 `P@ `P? `P0 `P@0 `P0 `P@ `P+P.2PD `P+P OP P4 P |   |   =                                 o G   h   s        o G      s @ `P+P/7PD `P+P/%P4P    X   X   $                                  o G      s 6 `P*P/P4 P    t   t   4                                 o G      s     s      s @ `P+P/%P4 `P: `P''P4P                        '           |  }           G   G   G   G   I             o G   o  I	      G   G   
   %         G   G   G   
      -            G   G   G   G   I          |  }      h   I     h   I     h   I            s @ `P@ `P0 `P/P*?PI 
`P0 `P@ `P0 `PO `PO `PO `P.P4P    <   <                                 s 0 `P'P4 P   8   8                                 s  0 `P: P   <   <                                 s 0 `P'P4 P         x                  
               7      U             o G      s -             o G      s    
   0 `P00 `P+P/	P4 `P:0 `P+P/	P4 `PJ	P    @  @                    +            s     G   G               G   G      O         G   G   G      *         G   G   G   G         V          	   o G
      G   G   G   G   G   s     s      s +   0 `P: 	`P0 `P0 `P+P %P4 `P: `P''PI	P    H  H                   y           G   G      O         G   G   G      *         G   G   G   G         5            o G      G   G   G   G   G	   s     
   o G         G   G   G   G   G   s        o G      G   G   G   G   G   s        o G      G   G   G   G   G   s        o G      G   G   G   G   G   s        o G      G   G   G   G   G   s        o G      G   G   G   G   G   s        o G      G   G   G   G   G   s        o G      G   G   G   G   G   s        o G      G   G   G   G   G   s y   0 	`P0 `P+P IP4 `P+P 1P4 `P+P EP4 `P+P FP4 `P+P DP4 `P+P GP4 `P+P FP4 `P+P HP4 `P+P HP4 `P+P GPIP  x   x   =                                 o G   h   s        o G      s 0 `P+P/FPD `P+P/1P4P X   X   $                                  o G      s 6 `P*P/P4 P                         )           |  }           G   G   G   G   I         G   G   G   G   G	   I
      G   G      %         G   G   G         -            G   G   G   G   I   "      |  }      h   I     h   I     h   I            s 0 `P0 `P0 `P@ 
`P0 `P@	 `P0 `PO `PO `PO `P.P4P <   <                                 s 0 `P'P4 P   8   8                                 s  0 `P: P   <   <                                 s 0 `P'P4 P   t   t   :                  
            s     G   G                s 
   @ `P: 	`P0 `P'PIP  X  X                   "           |  }           G   G   G   G   I      G   G      %         G   G   G         -            G   G   G   G   I         |  }      h	   I
     h   I     h   I            s 0 `P0 `P@ 
`P0 `P@ `P0 `PO `PO `PO `P.P4P   <   <                                 s 0 `P'P4 P   8   8                                 s  0 `P: P   <   <                                 s 0 `P'P4 P         E                              s     G   G                 s     s    @ `P: 	`P0 `P'P4 `P'PIP   X  X                   "           |  }           G   G   G   G   I      G   G      %         G   G   G         -            G   G   G   G   I         |  }      h	   I
     h   I     h   I            s @ `P@ `P@ 
`P0 `P@
 `P0 `PO `PO `PO `P.P4P <   <                                 s 0 `P'P4 P   8   8                                 s  0 `P: P   <   <                                 s 0 `P'P4 P         D                              s     G   G                s      s    @ `P: 	`P0 `P: `P'4PIP                       :                                           G   G      K   
      G   G   G      &         G   G   G   G                              G   G      '         G      |  }  I   #      G   G   G      ,   *      G   G      |  }  I   0      G   G   G      I          s 	       s @ `P6 
`P0 `P@ `P0 `P@	0 `PK 	`P0 `P PN 	`P0 `P %PN `P0 `P*PD `P&%P4P                         X               o G   h   s        o G   h   s        o G   h   s        o G   h	   s     
   o G   h   s        o G   h   s        o G   h   s        o G   h   s        o G   h   s        o G   h   s        o G   h   s        o G   h   s        o G   h   s        o G   h   s         o G   h!   s     "   o G   h#   s     $   o G   h%   s     &   o G   h'   s     (   o G   h)   s     *   o G   h+   s     ,   o G   h-   s     .   o G   h/   s @ `P+P/6PD	 `P+P/6PD `P+P/5PD `P+P/5PD `P+P/$PD `P+P/!PD  `P+P/'PD$ `P+P/-PD* `P+P/'PD/ `P+P/%PD3 `P+P/$PD7 `P+P/&PD; `P+P/*PD@ `P+P/PDG `P+P/!PDL `P+P/$PDP `P+P/1PD] `P+P/3PDa `P+P/'PDf `P+P/$PDk `P+P/&PDo `P+P/-PDtP   l   l   .                                         o s     s 6 `P %P#P4 `P'&P4 P  X   X   #                                         o s 6 `P $P#P4 P l   l   .                                         o s     s 6 `P %P#P4 `P'&P4 P  X   X   #                                         o s 6 `P $P#P4 P 0   0                              0 `P1 Q   0   0                              0 `P1 Q   0   0                              0 `P1 Q   0   0                              0 `P1 Q   P   P                                 s     s 0 `P'P4 `P'P4 P    8   8                                 s  0 `P: P   8   8                                 s  0 `P: P   8   8                                 s  0 `P: P   `   `   %                              s        o G   s  0 `P'-P4 `P+P*'P4 P   P   P                                 s     s 0 `P'P4 `P'P4 P    P   P                                 s     s 0 `P'P4 `P'P4 P    8   8                                 s  0 `P: P                                     s    G   G   G   G   G   +   
      G   G   G   G   G      %      	    s     s +      	    s 
    s     s    0 `P'-P4 `P0 `P'P4 `P'-PN0 `P'P4 `P'P4 `P'-PI P  8   8                                 s  0 `P: P   P   P                                 s     s 0 `P'P4 `P'P4 P    P   P                                 s     s 0 `P'P4 `P'P4 P    8   8                                 s  0 `P: P   P   P                                 s     s 0 `P'P4 `P'#P4 P          g                             G   G   2             o G   s      s  #             o G   s     @ `P0 `P+P*"PD `P@0 `P+P*!PIP                                                                (             o G   s  -   
          o G   s      s         s @ `P6 `P0 `PM `P0 `P+P*!PN
0 `P+P*!PD `PO `P'&P4P          A                  
               o G   h   s     s     I      I   @ `P+P/'PD `PJ	 `P< `P<P   X   X   $                                  o G      s 6 `P*P/P4 P    \  \                               G   4             o G            o s 
      G   4          	   o G       
     o s           o G            o s        o G            o s 0 `P0 `P+P ,P#PI `P0 `P+P +P#PI `P+P 9P#P4 `P+P 8P#P4P        	                                       U                G      o H       G      s 
      
    G   o     R       G        G   	   o o s     G      o K$          G      o K         0 
`P00 `P  P0 `P/PI `PJ0 `P*P0 `P (P#P#P4 `P  P@0 `P  PK `PJP ,  ,                                                     9             o G      o    
      
      (             o G   s  #             o G   s     @ `P6 `P0 `P@ `P+P/&P? `PK
 `P0 `P+P*&PN0 `P+P*&PIP    \  \                  =           |  }               o G   o  I             o G   o  I         G	   '          
   o G   o              I	         G   '             o G   o              I      G   G      %   $      G   G   G      *   -   +         G   G   G   G   I   1      G   G      I      |  }      h   I     h   I     h   I            s 0 `P@ `P/P*6P9 `P/P*6P9 `P >P*7P0 `P <P*6P@ `P0 `P@ `P@ `P0 `P? `P? `PO `P.P4P    8   8                                 s  `P'P$P 4   4                                 s   `P*#P 8   8                                 s  `P'P$	P       P                              s     G   G      +          s     s     s    @ `P: `P0 `P'P4 `P'P4 `P'-PIP                                         V                   o G      s        o G      s L   
          o G      s        o G      s       0 
`P00 `P+P (P4 `P+P/	P4 `P:0 `P+P (P4 `P+P/	P4 `PJP        !                {                                                    o G   s     G   G      O         G   G   G      *         G   G   G   G                 G   G   G   G   G	   (   '       
   o G   s  #   +       
   o G   s  /      G   G   G   G   G   (   7          o G   s  #   ;          o G   s  ?      G   G   G   G   G   (   G          o G   s  #   K          o G   s  O      G   G   G   G   G   V   W      G   G   G   G   G   +   _      G   G   G   G   G	   f   #   g          o G   s  k          G   G   G   G   G	   s s   7   s          o G   s      s      s  {   0 `P6 
`P0 `PM 	`P0 `P+P*'PD	 `P@ `P0 `P+P*0PN0 `P+P*0PI `P0 `P+P**PN0 `P+P**PI `P0 `P+P*,PN0 `P+P*,PI `P6 `P+P*'PI  `P -P@#0 `P+P*'P4 `P: `PO(P                                                                2          s         o G   s  -             o G   s      s     0 `P6 
`P0 `PM 	`P0 `P: `P+P*+PN
0 `P+P*+P4 `POP  P   P                                    o G   s  0 `P+P*  PDP    ,  ,                   '          G      o         G   G      O         G   G   G      *         G   G   G   G         _         G   G   G   G         G   G   G   G        G      h	   s '   0 	`P? `P0 !`P@ `P PIP   x  x            	       #              o G   o  G   o            o G             o G      o G      	      %o s        o G
      o G   h   s        o G
      o G   h   s        o G          o s 0 `P+P*/P*P8 `P*P P/	P P#P4 `P*P/P/PD	 `P*P/P/PD `P*P P#P4 P                	                         o G             o G      o G            %o s           %  o 	   ;             o G
             %  o s    6 `P*P P/P P#P4 `P P0 `P*P P#PI P          Z         	                         o G             o G      o G            %o s 6 `P*P P/P P#P4 P                                                G      A         G   G      !         G   G   G      '         G   G   G     "         G   G   G            s        s 0 	`P0 `P0 `P@0 `P@	 `P: `P)%P4P   0  0                              |  }        G   G      %         G   G   G         -            G   G   G   G   I         |  }      h   I	     h
   I     h   I            s 0 `P@ 
`P0 `P@ `P0 `PO `PO `PO `P.P4P    <   <                                 s 0 `P'P4 P   8   8                                 s  0 `P: P   <   <                                 s 0 `P'P4 P   0  0                              |  }        G   G      %         G   G   G         -            G   G   G   G   I         |  }      h   I	     h
   I     h   I            s 0 `P@ 
`P0 `P@ `P0 `PO `PO `PO `P.P4P    <   <                                 s 0 `P'P4 P   8   8                                 s  0 `P: P   <   <                                 s 0 `P'P4 P         E                              s     G   G                 s     s    @ `P: 	`P0 `P'P4 `P'PIP   \  \                               |  }            o G   h   s    G   G      %         G   G   G	         .            G   G   G	   G
   I	         |  }        h   I      h   I      h   I             s 0 `P@ `P+P/>PD 
`P0 `P@ `P0 `PO `PO `PO `P/P4P         P                                     o G      o    G          o G   o  o K6 `P/P/P P*P#P5 P   <   <                                 s 0 `P'P4 P   8   8                                 s  0 `P: P   <   <                                 s 0 `P'P4 P         h                              s     G   G      C             G   G   G   G	   s 
    s     s    @ `P: 	`P0 `P "P4 `P'#P4 `P'PIP                                        V                   o G      s        o G      s L   
          o G      s        o G      s       0 `P00 `P+P .P4 `P+P/	P4 `P:0 `P+P .P4 `P+P/	P4 `PJP  P   P                                    o G      s @ `P+P/PDP     M                .                                        G      E   	      G   G      %         G   G   G         (             o G   s  #             o G   s        =       	    s      
   o G   s      s -   (       
   o G   s      s  .   0 `P6 
`P0 `PM 	`P0 `P+P*PN	0 `P+P*PI 	`P0 `P: `P+P*$P4 `P'PN0 `P+P*$P4 `POP                	       q          G      E         G   G      %         G   G   G         |                 G   G   G   G   F        G   G   G   G             o G	   o  G
   o            o G             o G      o G            %o s        o G      o G   h   s        o G      o G   h   s        o G      o G   h   s    G   G   G   G      Z   I      G   G   G   G      H   *   R      G   G   G   G      HX   b   Y          o G      o G   h   s        o G      o G   h   s e          o G          o s    .'   m       s      s  @ 	`P0  
`P'fP0 `P@ `P+P*,P*P8 `P*P P/	P P#P4 `P*P/P/8PD `P*P/P/PD `P*P/P/PD `P9 `P*P/P/PD `P*P/P/PI" `P*P P#PD K`P@% `P: `P:P            k   k        Z         	                         o G             o G      o G            %o s 6 `P*P P/P P#P4 P          y         	                         o G             o G      o G           %o o       G     h   s 6 `P*P P/P P#PI `P PD P  h   h   3                                o G       %   % %   %s 0 `P+P 	P4 P          Z         	                         o G             o G      o G            %o s 6 `P*P P/P P#P4 P    p   p   >                
                  o G      G   G   G   G      Hs 6 `P*P P4 P p   p   >                
                  o G      G   G   G   G      Hs 6 `P*P P4 P L   L                                    o G   s  0 `P+P*  P4P P   P                                   o G   h   s 0 `P+P/2PDP                 	                                o G   o  %   o    M   	          o G                 o G   o  %   o s    6 `P 5P*P)P0 `P*P AP*P)P#PI P        P                  
           |  }            o G   h   s        o G   h   s 0 `P@ `P+P/+PD
 `P+P/+PDP        Z                                  o G   o     1         G          o G   o  s    6 `P*P*P0 `P P*P#PI P        P                
                  o G   o            o G      o G   h   s 6 `P*P*PI `P*P/P/PD	 P                                            o G      o G   s     G          o G   o    o (                o G   o     2             o G      o G   s     6 `P*P P*P4 `P 
P*P(P DP*P0 `P*P P*PI P                                      V                   o G      s        o G      s L   
          o G      s        o G      s       0 `P00 `P+P +P4 `P+P/	P4 `P:0 `P+P +P4 `P+P/	P4 `PJP                      $           |  }            o G   h   s        o G   h   s    G   G	   
   %         G   G	   G   
      .            G   G	   G   G   I         |  }        h   I      h   I      h   I             s @ `P@ `P+P/>PD `P+P/;PD 
`P0 `P@ `P0 `PO `PO `PO `P/ P4P    x   x   A                	                     o G      o        o G   o  K6 `P/P/P-P*P5 P       P                                     o G      o    G          o G   o  o K6 `P/P/P P*P#P5 P   <   <                                 s 0 `P'P4 P   8   8                                 s  0 `P: P   <   <                                 s 0 `P'P4 P         E                              s     G   G                 s     s    @ `P: 	`P0 `P'P4 `P'PIP                                                                  (             o G   s  -   
          o G   s      s     0 `P6 
`P0 `PM 	`P0 `P+P*-PN	0 `P+P*-P4 `POP L   L                                   o G     s 0 `P+P-YP4P P   P                                    o G      s 0 `P+P/YP4P                        @               o G   h   s        o G   h   s        o G   h   s        o G   h	   s     
   o G   h   s        o G   h   s        o G   h   s        o G   h   s        o G   h   s        o G   h   s        o G   h   s        o G   h   s        o G   h   s        o G   h   s         o G   h!   s     "   o G   h#   s @ `P+P/8PD	 `P+P/8PD `P+P/7PD `P+P/7PD `P+P/)PD `P+P/5PD `P+P/7PD! `P+P/+PD$ `P+P/-PD* `P+P/#PD0 `P+P/PD3 `P+P/4PD9 `P+P/*PD> `P+P/1PDC `P+P/9PDF `P+P/4PDIP   l   l   .                                         o s     s 6 `P 9P#P4 `P':P4 P  X   X   #                                         o s 6 `P 8P#P4 P l   l   .                                         o s     s 6 `P 9P#P4 `P':P4 P  X   X   #                                         o s 6 `P 8P#P4 P 8   8                                 s  0 `P: P   <   <                                 s 0 `P'P4 P   8   8                                 s  0 `P: P   <   <                                 s 0 `P'P4 P   8   8                                 s  0 `P: P   0   0                              0 `P1 Q   <   <                                 s 0 `P'P4 P   `   `   "                              s     s     s 0 `P'+P4 `P'!P4 `P':P4 P P   P                                 s     s 0 `P'!P4 `P'+P4 P    P   P                                 s     s 0 `P'P4 `P'P4 P    8   8                                 s  0 `P: P   8   8                                 s  0 `P: P   P   P                                    o G      s @ `P+P/PDP                     $                                        G   G   G   (   
          o G   s  #             o G   s         s 	    s 
    s    3             o G   s      s #              o G   s  $   0 `P6 
`P0 `PM 	`P0 `P+P*PN	0 `P+P*PI `P'P4 `P'!P4 `P'+PD 	`P0 `P+P*#P4 `P'PN0 `P+P*#PIP                       E                                        G   G   G   (   
          o G   s  #             o G   s        G   G   G   (          	   o G   s  #          	   o G   s         G   G   G
   (   &          o G   s  #   *          o G   s  .      G   G   (   3          o G   s  #   7          o G   s  ;      (   =          o G   s  #   A          o G   s  E   0 `P6 
`P0 `PM 	`P0 `P+P*:PN	0 `P+P*:PI 	`P0 `P+P*0PN0 `P+P*0PI 	`P0 `P+P*5PN0 `P+P*5PI 	`P0 `P+P*7PN!0 `P+P*7PI% 	`P0 `P+P*#PN(0 `P+P*#PI+P                                                              =          s         o G   s      s -             o G   s      s     0 `P6 
`P0 `PM 	`P0 `P: `P+P*/P4 `P'PN0 `P+P*/P4 `POP                                                                =          s         o G   s      s -             o G   s      s     0 `P6 
`P0 `PM 	`P0 `P: `P+P*%P4 `P'PN
0 `P+P*%P4 `POP                       b         G                G   G      
   )            G   G   G            G   G              G   G         |     }     G	      G   G   G
   G   o          3   &     H     G   G     H     +     +          o G   s         o G         s        o G         s        o G         s   s   =     G         A     G   G   D   9   E      G         I      G   G      L      M     5   O     G         S     G   G   V   -   W          o G         s [      G         _      G   G      c   1   d          o G      G   G   s j   #   j          o G   s  n     s   p     G         t     G   G   w   9   x      G         |      G   G                 5        G              G   G      -             o G         s       G               G   G         1              o G      G   G   s    #          !   o G   s       s        G"              G"   G      9         G"               G"   G                 5        G"              G"   G      -          #   o G         s       G"               G"   G         1          $   o G      G"   G   s    #          %   o G   s       s        G&              G&   G      9         G'               G'   G                5        G&              G&   G      -          (   o G         s       G'               G'   G                  G'   G      A         )   o G   s      *   o G   s  o   	      +   o G      G'   G   s     )   o G   s      *   o G   s  ,   I&     <         )   o G   s      *   o G   s  !  #   !      -   o G   s  %    s   '    G.         +    G.   G   .  9   /     G.         3     G.   G      6     7    5   9    G.         =    G.   G   @  -   A      /   o G         s E     G.         I     G.   G      M  1   N      0   o G      G.   G   s T  #   T      1   o G   s  X    s   Z    G2         ^    G2   G   a  9   b     G2         f     G2   G      i  M  j    5   l    G2         p    G2   G   s  -   t      3   o G         s x     G4         |     G4   G        1         5   o G      G4   G   s     5       G2             G2   G     -         6   o G         s      G7              G7   G        1         8   o G      G7   G   s     5       G2             G2   G     -         9   o G         s      G:              G:   G        1         ;   o G      G:   G   s     5       G2             G2   G     -         <   o G         s      G2              G2   G        1         =   o G      G2   G   s      G>              G>   G        1         ?   o G      G>   G   s      G@              G@   G        1         A   o G      G@   G   s   #         B   o G   s     C   |  }        GD      (        GE      GD   hF   s 
    
                 G     %H   !       G     %HG     M        GH   6          H             H   !     "    G     %H   !   '    G     %HG   +  8   ,      I     %J   %o G         s 2  K       s      H   8   9      L     %M   %o G        Hs @  .   @      I     %N   %o G   s  F    .'  -H     GO         L     GO   G      P  c   Q      P   o G   s      Q   o GR   S   T       GO   G   o U   s #   ^      P   o G   s  b  0 	`P0 `P@ 	`P0 `P0 !`P0 "`P P8 `P6 `P0 `P; '`P@@ `PK `P+P*AP4 `P+P CP4 `P+P EP4 `P+P MPD `P9 `P0 `P+P 9PI `P0 `P+P ;P@"0 `P+P*9PI' `P9 `P0 `P+P :PI+ `P0 `P+P <P@/0 `P+P*:PI4 `P9 `P0 `P+P 5PI8 `P0 `P+P 7P@<0 `P+P*5PIA `P9 `P0 `P+P 5PIE `P0 `P0 `P+P*8P4 `P+P*9PNJ0 `P+P 7P4 `P+P*8P4 `P+P*9P4 `P@Q@S `P+P*8P4 `P+P*9P@W0 `P+P*5PI\ `P9 `P0 `P+P HPI` `P0 `P+P JP@d0 `P+P*HPIi `PIk `P0 `P+P CPIn `P0 `P+P EPIs `P0 `P+P DPIv `P0 `P+P FPI{ `P0 `P+P ;PI~ `P0 `P+P =P9000 `P0 `P+P >P90 `P0 `P+P @P9000 `P0 `P+P OP9000 `P0 `P+P GP0000 `P+P*>P9000 `P0 `P0 `P P9000  
`P&fP0 `P00 `P0 `P P JP90 `P+:P40 `P0 `P P LP0000 `P P*JPI   %`P@   `P0 `P+P*+P4 `P+P iP)P>00 `P+P*+P9000P                 D   D                                G    G   K0 `P0 P       _                                 o G      s        o G      s     s     I	      I
   0 `P+P/BP4 `P+P/|PD `P: `P< `P<P        	                                       U                G      o H       G      s 
      
    G   o     R       G        G   	   o o s     G      o K$          G      o K         0 `P00 `P 4P0 `P/PI `PJ0 `P*P0 `P (P#P#P4 `P 4P@0 `P 4PK `PJP p  p                                                     9             o G      o    
      
          o G      o                (             o G   s  #             o G   s     @ `P6 
`P0 `P@ `P+P/:P? `PK
 	`P+P/9P? `PK 	`P0 `P+P*:PN0 `P+P*:PIP   \  \                               G   4             o G            o s 
      G   4          	   o G       
     o s           o G            o s        o G            o s 0 	`P0 `P+P @P#PI 	`P0 `P+P ?P#PI `P+P MP#P4 `P+P LP#P4P    (    #      	          l         |           }              G   G        G   G   G	            
   |     }     G      G   G   G	   G   o        .        H     G   G     H        |  }       G      (   $      G     G   h   s (          +      [,   \]  -               H           H   "   6       HG     8   8        H      <        HG     >          A       H   ;   E            %   %o G       Hs    L        G   G   G   H   L   T            %   %o G        G   G   G   Hs G   _            %   %o G        G   G   G   Hs j     .'  ?l   ^l   @ `P0 `P6 `P: `P@ 	`P0 !`P0 "`P P8 `P0 `P; `P@ `P0 	`P0 `P PI 	`P0 `P0 `P? `P: `P0 `P@ `P0 `P@! `P0 `P0 `P P IPN% `P0 `P P IPN(0 `P P IPI, `PM @/P (        Q    @   @                                G    K0 `P0 P  @  @                   %               o G   s     G   G      F   
      G   G   G      !         G   G   G      j         G   G   G         G	   <             o G
   s     G      h   s %   0 `P+P*/P4 	`P0 `P0 `P0 `P+P*/P4 `P PI P  @  @           	       7          G      |            o G   o  G   o            o G             o G      o G	   
         %o s        o G      o G   h   s        o G      o G   h   s    G   '   $          o G      s (      G   1   +          o G      o G   s  1          o G          o s 7   0 `P0  `P+P**P*P8 `P*P P/	P P#P4 `P*P/P/PD `P*P/P/PD `P0 `P*P/PI `P0 `P*P/P*PI `P*P P#PI P          |         	                         o G             o G      o G            %o s        o G      G   s 6 `P*P P/P P#P4 `P*P P4 P               	                         o G             o G      o G            %o s        o G      G   s    G	   ,             o G   
   
   s    6 `P*P P/P P#P4 `P*P P4 `P0 `P*P PI P  p   p   3                                 o G   s         o G   s  0 `P+P*/P4 `P+P*  P4P `   `   .                                  o G      o G   s  6 `P*P/P*>P4P                                      V                   o G      s        o G      s L   
          o G      s        o G      s       0 `P00 `P+P *P4 `P+P/	P4 `P:0 `P+P *P4 `P+P/	P4 `PJP  `  `  N                t           |  }               o G   o  I             o G   o  I             o G   o  I	          
   o G   o  I             o G   o  I             o G   o  I             o G   o  I             o G   o  I             o G   o  I             o G   o  I         G   '   8          o G   o     <      <   I         G   '   A          o G   o     E      E   I             o G   o  I              o G   o  I!          "   o G   o  I#      G$   G%   &   %   [      G$   G%   G'   &   a   -   b         G$   G%   G'   G(   I'   h          )   o G*   +   o I,      |  }      h-   I.     h/   I0     h1   I2   3         s @ `P0 `P/P*<P9 `P/P*=P9 `P/P*8PI `P/ P*KPI	 `P/P*AP9 `P/P*>P9 `P/P*GP9 `P/P*HP9 `P/#P*PP9 `P/P*FPI `P RP*9P0 `P PP*8P@ `P/P*CP9 `P/P*CP9 `P/P*CPI 
`P0 `P@ `P/P/-PI `P0 `PO" `PO% `PO) `P.P4P <   <                                 s 0 `P'P4 P   8   8                                 s  0 `P: P   <   <                                 s 0 `P'P4 P   t   t   :                  
            s     G   G                s 
   @ `P: 	`P0 `P'PIP  \  \                               |  }            o G   h   s    G   G      %         G   G   G	         .            G   G   G	   G
   I	         |  }        h   I      h   I      h   I             s 0 `P@ `P+P/:PD 
`P0 `P@ `P0 `PO `PO `PO `P/P4P   x   x   A                	                     o G      o        o G   o  K6 `P/P/P-P*P5 P <   <                                 s 0 `P'P4 P   8   8                                 s  0 `P: P   <   <                                 s 0 `P'P4 P   t   t   :                  
            s     G   G                s 
   @ `P: 	`P0 `P'PIP                                       P                   o G   s         o G      s F   
          o G   s         o G      s       0 `P00 `P+P**P4 `P+P/	P4 `P:0 `P+P**P4 `P+P/	P4 `PJP                        &           |  }        G   G      %         G   G   G         -            G   G   G   G   I         |  }      h   I	     h
   I     h   I      G      I      G      I             s     s 0 `P@ 
`P0 `P@ `P0 `PO `PO `PO `P0 `P0 `P< `P'P4 `P'PDP    <   <                                 s 0 `P')P4 P   8   8                                 s  0 `P: P   <   <                                 s 0 `P')P4 P         F                                    s     G   G         
       s    0 `P< `P: 	`P0 `P'PIP                       $               o G   h   s        o G   h   s        o G   h	   s     
   o G   h   s        o G   h   s        o G   h   s        o G   h   s        o G   h   s        o G   h   s @ `P+P/APD `P+P/APD `P+P/#PD `P+P/&PD `P+P/PD `P+P/PD% `P+P/#PD0 `P+P/"PD4 `P+P/&PDEP H   H                                 s      s  0 `P: `P: P    H   H                                 s      s  0 `P: `P: P    0   0                              0 `P1 Q   \   \   !                              s      s     s 0 `P: `P'P4 `P'P4 P @   @                                    s 0 `P+P4 P   @   @                                    s 0 `P+P4 P                                      G   G      %         G   G   G                   s           s        s 	    s  0 `P0 `P'PN0 `P'PI `P'P4 `P: P 8   8                                 s  0 `P: P                                      G   G      J         G   G   G      %         G   G   G                   s  P             o G	   o  
             s            s     0 `P@ `P@@ `P+P*AP@	 `P@@ `PO P       N                            |  }        h   I      h   I      h   I          s @ `P0 `P? `P? `PO `P*
P4P    8   8                                 s  `P'P$P D   D                                     s &`P*-P$P    8   8                                 s  `P'P$	P 4   4                                 s  0 `P:P     M                 9           G   G      J         G   G   G      %         G   G   G                      o G      G   G   G   s     	   o G      G   G   G   s    G   G
   n   )          o G   s         o G   s         o G   s         o G   s  9   @ `P@ `P+P 7P4 `P+P <P4 `P0 `P+P*#P4 `P+P*&P4 `P+P*P4 `P+P*PIP       g                             G   G   2             o G   s      s  #             o G   s     @ `P0 `P+P*!P4 `P@0 `P+P*#PI
P    \  \  z                a          G   G      %         G   G   G         5           G   G   G   G              G   G   G   G             o       	   o G
          o s        o G
          o s        o G
          o s        o G
          o s        o G
          o s    :    :            =      G      E   B      G   G      %   H      G   G   G      N   $   O      G   G   G      S          o G   s         o G        %   %s        o G   h   s a   @ `P0 `P6@ `P0 `P0 `P+P8 `P+P /P#P4 `P+P 'P#P4 `P+P )P#P4 `P+P 7P#P4 `P+P 4P#PN0 `PA?F `P0 `P0 `P@ `P+P*AP4 `P+P APD `P*P/PI?P      i               Q                o H         H   -            HG          D  	      G      o         G   G      O         G   G   G      *            G   G   G   H   "   K   #         G   G   G   HG        G   G   G     p   -         G   H   5   2         G   HG        G     "   6           G     7      G   	   7   :     
            o %   %%  9   ?     
      G   %   %   G   %   %%  F               o G         G   %   %  %   %  %   %s 6 `P*P:00 `P0 `P0 `P@ `P? `P0 `P@ `P0 `P0 `P@0 `P: `P@ `P0 `P P@0 `PK `PJ `P+P AP4 P     :                U                                                G   G      %         G   G   G         <             o G      G   G   G   G   s        	   o G
   s         o G
   s     G   G      O   *      G   G   G      *   1      G   G   G   G      8   A   9          o G
   s         o G
   s  <   A          o G   s         o G   s  I   U   I       	   o G   s         o G   s         o G   s  U   @ `P6 `P0 `PM `P@	 `P0 `P+P 7PI `P+P*#P4 `P+P*P4 `P0 `P+P*+P4 `P+P*PN0 `P+P*+P4 `P+P*P@0 `P+P*#P4 `P+P*P4 `P+P*PIP    H  H                             |  }               o G   o  I        I             o G   o  I          	   o G   o  I
      |  }      h   I     h   I     h   I            s 0 `P@ `P/P*<P9 `P= `P/P*?P9 `P/P*FPI `P0 `P? `P? `PO `P.P4P  8   8                                 s  `P'P$P D   D                                     s &`P*1P$P    8   8                                 s  `P'P$	P h  h                  @           |  }               o G   o  I             o G   o  I             o G   o  I	      G
   G            G
   G   G                  G
   G   G   I      G
   G   G      %   %      G
   G   G      *   (   +         G
   G   G   I   0         G
   G   G   I   5       s      s     |  }      h   I     h   I     h   I            s 0 `P@ `P/P*<P9 `P/P*AP9 `P/P*?PI `P0 `P@ `P0 `P@ `P@ `PJ `PJ `P0 `P? `P? `PO `P.P4P    8   8                                 s  `P'P$P 4   4                                 s   `P*%P 8   8                                 s  `P'P$	P 8  8                              |  }               o G   o  I             o G   o  I             o G   o  I	      |  }      h
   I     h   I     h   I            s 0 `P@ `P/P*=P9 `P/P*FP9 `P/P*@PI `P0 `P? `P? `PO `P.P4P    8   8                                 s  `P'P$P 4   4                                 s   `P*P 8   8                                 s  `P'P$	P     3                 /           G   G      	        G   G      %         G   G   G                   s    G   G   	   $      
    s      s >         G   G         #       s      s '      '       s )       s      s    -       s  /   @ `P0 `P0 `P'PD `P0 `P: `P'PN
 `P0 `P: `P'P@0 `P'PI `PJ `P'PN0 `POP                                     s     G   G               G   G      %         G   G   G         0          s 	    s 
    s           s     @ `P: `P0 `P0 `P'P4 `P'P4 `P'PN	0 `POP                                       V                   o G      s        o G      s L   
          o G      s        o G      s       0 	`P00 `P+P *P4 `P+P/	P4 `P:0 `P+P *P4 `P+P/	P4 `PJP      w                             G   G      %         G   G   G                 G   G   G   G      N               G   G   G   G   G            G   G   G   G     HG       	   o G
   o  2   *      G   G   G   G     H      0     .'  M2         4      G   6     7      G   G   G   $   <      G   G   G   G   A   2   B          o G      o G   s  H      G   G   G   $   M      G   G   G   G   R   2   S          o G      o G   s  Y          o G   s  U   ]          o G   s         o G   s         o G   s  i          o G   s         o G             o G      o s [   v          o G   s         o G      s        o G   s     @ `PF `P@ `P0  `P&fP0 `P 4P*BP> `P0 `PJ H`P@ `P0 `P0 `P+P/P*0PI `P0 `P+P/P*0PI `P+P*&PN0 `P+P*P4 `P+P*PD `P+P*&PI# `P+P*(P4 `P+P/R+P/dP$PN&@( `P+P*(P4 `P+P AP4 `P+P*&PI,P             ~      T  T                  E          G   G      %         G   G   G                    G   G   G   G      -         G   G   G   G                               G      E   "      G   G      %   (      G   G   G      .   $   /      G   G   G      3       	   o G
   o     F   9          o G   s         o G      s '   A          o G   h   s E   0 `P@ `P6 `P0 `P@0 `PA.F `P0 `P0 `P@ `P+P*AP0 `P+P*2P4 `P+P/0PN0 `P*P/PI.P d  d                 E                o H      G          o G   o    
         H   #            HG              G      o         G   G      O         G   G   G	      *   "         G   G   G	   H   )   2   *         G   G   G	   HG     @   0         G	   H   "   5         G	   HG     8           ;   
       o   =          o G   s         o G     s E   6 `P*P: `P P*BP>0 	`P0 `P@ `P? `P@
 `P0 `P@ 	`P0 `P+PM `P+P*2P4 `P+P.0PI P |   |   =                                 o G   h   s        o G   h   s @ `P+P/"PD
 `P+P/PDP   8   8                                 s  0 `P: P   0   0                              0 `P1 Q       J                 3           G   G      %         G   G   G                  G   G      K         G   G   G      &         G   G   G   G          !   	    s  Z   #       
   o G   s      
   o G   h   s        o G   s  /   #   /          o G   s  3   @ `P@ `P0 `P@	@ `P+P*P4 `P+P/PD `P+P* P@0 `P+P*PIP   <   <                                 s  0 `P*&`P1 Q                                  G   G      %         G   G   G         G             G   G     o           o G      s    @ `P0 `P P8 `P+P.PIP                     $                                           G   G      `   
      G   G      @         G   G                G   G                        (             o G	   s  #              o G
   s  $   @ `P6 `P0 `P@ `P5 `PK
 `P0 `P+P*PN0 `P+P*PIP                                       V                   o G      s        o G      s L   
          o G      s        o G      s       0 	`P00 `P+P "P4 `P+P/	P4 `P:0 `P+P "P4 `P+P/	P4 `PJP  `  `                   !           |  }               o G      o I      G   G   	   %         G   G   G
   	      -            G   G   G
   G   I
         |  }      h   I     h   I     h   I            s @ `P0 `P/P/<PI `P0 `P@	 `P0 `P? `P? `PO `P.P4P   8   8                                 s  `P'P$P 4   4                                 s   `P* P 8   8                                 s  `P'P$	P       g                             G   G      3            G   G   G   G   I	         
    s      s     @ `P@ `P@0 `P: `PO
P                                     |  }               o G   o  I      |  }      h   I     h   I	     h
   I            s @ `P@ `P/P*9PI `P0 `P? `P? `PO `P.	P4P 8   8                                 s  `P'P$P 4   4                                 s   `P*.P 8   8                                 s  `P'P$	P X  X                    +            s     G   G               G   G      '         G      |  }  I         G   G   G      ,         G   G      |  }  I          G   G   G       	   o G
   o  I       s  +   0 `P: `P0 `P0 `P PN `P0 `P PN	 `P "P*9P9 `POP X  X                  1                  o G   "             o                 o    	               G   h   s           o G   h   s     	   o G
   h   s        o G   h   s        o G   h   s        o G   h   s        o G   h   s        o G   h   s        o G   h   s        o G   h   s @ `P6 	`P+P@ `P+P@0 `P+PM 	`P0 `P PI `P+P/(PD `P+P/%PD `P+P/PD$ `P+P/PD' `P+P/PD* `P+P/PD- `P+P/PD2 `P+P/PD5 `P+P/PD:P   8   8                                 s  0 `P: P   8   8                                 s  0 `P: P   0   0                              0 `P1 Q   8   8                                 s  0 `P: P   @   @                                    s 0 `P+P4 P   @   @                                    s 0 `P+P4 P   @   @                                    s 0 `P+P4 P   @   @                                    s 0 `P+P4 P   h   h   -                                      o G      o s 6 `P P/P#P4 P    h   h   -                                      o G      o s 6 `P P/P#P4 P    $  $  	                j          G   G      %         G   G   G                     o G   7             o G	      o G
   s           G   G   G   7             o G	      o G
   s  H   $      G   G   G   (   *          o G   h   s .      G      G   G   G   o G   (   8          o G
   s  #   <          o G   s  @      G   G      K   F      G   G   G      &   M      G   G   G   G   S      T       s  #   V          o G   s  Z          s <   \          o G   s         o G   s  d      G   G         j      G   G   G   n   b  o          o G   o  G       !   o       G"   #   o G       $   s    G"   %   o G   &   $   s    G"   %   o G       '   s    G"   (   o G       )   s     *   o G+      s     *   o G
   s      ,   o G
   s     G   G      I         G   G   G      $         G   G   G   G-                .   o G
   s     G   G   G   G/      *         G   G   G   G/   0      <          1   o G2      G   G   G   G/   s    #          .   o G3   s        G   G               G   G   G4      <          *   o G
   s      5   o G
   s        G   G               G   G   G6      <          *   o G
   s      7   o G
   s        G   G               G   G   G8      h         9   o G   o  G       :   o     G"   ;   o G       <   s   G"   =   o G   &   <   s   G"   =   o G       >   s   G"   ?   o G       @   s     *   o G+     s     *   o G
   s      A   o G
   s     G   G      I        G   G   G8      $   $     G   G   G8   GB   )     *      C   o G
   s     G   G   G8   GD      *   6     G   G   G8   GD   0   <  B   =      E   o G2   F      G   G   G8   GD   %s G  #   G      C   o G3   s  K     G   G         Q     G      G   G   o     GG   H   o !   [    GG   I   o ^     _    G   a  (   b      J   o G
   s  #   f      J   o G   s  j  @ 	`P@ `P+P0 `P+P/P*/PN0 `P0 `P+P/P*&PN `P0 `P+P/$PI `P P0 `P+P*)P>0 `P+P*)PI `P0 `P@0 `P+P*.PI' `P+PN)0 `P+P*%P4 `P+P*PI0 `P0 `P+P*P P8 `P P P4 `P P &P4 `P P &P4 `P P %P4 `P+P.2P4 `P+P*2P4 `P+P*P4 `P0 `P+P*P4 `P0 `P+P &P@?0 `P+P*PIC 	`P0 `P+P*2P4 `P+P*PIG 	`P0 `P+P*2P4 `P+P*PIK `P0 `P+P*P P8 `P P P4 `P P 'P4 `P P 'P4 `P P 3P4 `P+P.2P4 `P+P*2P4 `P+P*P4 `P0 `P+P*P4 `P0 `P+P >P@Y0 `P+P*PI^ `P0 `P P8 `P P "P0 `P+P*-P>0 `P+P*-PIgP 8   8                                 s  0 `P: P                                  G   G      %         G   G   G         {             G   G     o           o G      s     	   o G   
       G   G     o s    @ 	`P0 `P P8 `P+P.-P4 `P+P ,P#PIP   D  D  p                R                                           G   G      w   
      G   G      W         G   G      7         	             G   G
                                      s        o G   s         o HG   G      s   -          o G         s        o G         s        o G         s 9      9          o G   s         s        o HG   G      P   F          o G         s        o G         s N       s     s @ `P6 
`P0 `P@ `P b0 `PK	 	`P0 `P+%P4 `P+P*%P4 `P+P0 `P+P )P4 `P+P  P4 `P+P ,P@0 `P+P*%P4 `P+P4 `P+P0 `P+P )P4 `P+P  PI `P''P4 `P'*P4P l   l   0                            |  }        h   I          s 0 `P@ `PO `P*
P4P    8   8                                 s  0 `P: P   t  t                                   u                   o G      s        o G      s        o G      s k             o G      s        o G      s        o G      s       0 `P00 `P+P .P4 `P+P (P4 `P+P/	P4 `P:0 `P+P .P4 `P+P (P4 `P+P/	P4 `PJP                                          o              o G      o I      |  }      h	   I
     h   I     h   I            s 0 `P+PH `P/P/^P9 `P0 `PO `PO `PO `P.	P4P <   <                                 s 0 `P'P4 P   8   8                                 s  0 `P: P   <   <                                 s 0 `P'P4 P                        ,           G   G                   o G      G   G   G   G	   s     
   o G      G   G   G   G   s        o G             o G      o s        o G             o G      o s     s     *       s  ,   @ 	`P@ `P+P /P4 `P+P 2P4 `P+P WP/^P#P4 `P+P ^P/ZP#P4 `P@
0 `POP    |  <  ;                X      $         |  }           I         2                o G      o I   
      	   2             
   o G      o I         G   G      %         G   G   G         .            G   G   G   G   I   $                   %   %v          (            (          v          *            *         ,      G   .   )   /         1      G   3     4      -   6            9      G   ;   o   <          o G      o #   B          o G   s  F          o G   h   s J          o G   h   s         o G!   "   s     #   o G$   s     V   %       s X   > `P@ `P@ `P0 `P P/CPN	 `P0 `P P/BPN `P0 `P@ `P7 `PG1 `P P@ ; `PM1 `P+	P0 ; `PM" `P@% `P0 `P+P/2P? `P+P*,PI) `P+P/2PI. `P+P/,PDC `P+P/P4 `P+P*$PNF@I `P+PIKP    |  \     m                     6  *                t   t   7                                 o G          o G      o s 0 `P+P 3P/3P#P4 P   D  D                                   s           o G      o I      G   p   
          	   o G      o I
       o  5         G   6      9   I       s             s @ `P+$PD `P P/3PI `P0 `P P/,PI	 `P&P= `P? @ `P: `PA F `P+P4 P    l   l   0                            |  }        h   I          s @ `P@ `PO	 `P*
P4P   8   8                                 s  0 `P: P   $  $                                   o G   h   s        o G   h   s        o G   h   s     	   o G
   h   s        o G
   h   s        o G   h   s @ `P+P/(PD `P+P/-PD `P+P/.PD `P+P/(PD `P+P/.PD `P+P/PDP   8   8                                 s  0 `P: P   8   8                                 s  0 `P: P   8   8                                 s  0 `P: P   0   0                              0 `P1 Q   0   0                              0 `P1 Q   8   8                                 s  0 `P: P                        L           G   G      %         G   G   G         y            o G   7             o G	      o G
   s           G   G   G   7             o G	      o G
   s  H   $      G   G   G   (   *          o G   h   s .      G      G   G   G   o G   (   8          o G
   s  #   <          o G   s  @          s <   B          o G   s         o G   s  J       s  @ 	`P@ `P+P0 `P+P/P*/PN0 `P0 `P+P/P*&PN `P0 `P+P/$PI `P P0 `P+P*)P>0 `P+P*)PI `P+PN0 `P+P*(P4 `P+P*PI! `P:P  8   8                                 s  0 `P: P   |  |                                                           P             s        o G   s         o G   s  K             o G   s         o G   s         s    	    s 
    s @ `P6 
`P0 `PM 	`P0 `P+%P4 `P+P*(P4 `P+P*.PN0 `P+P*(P4 `P+P*.P4 `P+PI `P''P4 `P'*P4P   4   4                                 s  0 `P:P t  t                                   u                   o G      s        o G      s        o G      s k             o G      s        o G      s        o G      s       0 `P00 `P+P (P4 `P+P -P4 `P+P/	P4 `P:0 `P+P (P4 `P+P -P4 `P+P/	P4 `PJP          e                 	               o       |  }      h   I     h   I     h   I	   
         s 0 `P+P8 `P0 `PO `PO	 `PO `P.	P4P    <   <                                 s 0 `P'P4 P   8   8                                 s  0 `P: P   <   <                                 s 0 `P'P4 P   t   t   :                  
            s     G   G                s 
   0 `P: 	`P0 `P'$PIP                                   G   G      %         G   G   G                 G   G   G   G      +         G   G   G   G   G              G   G   G   G   G      0   &      G   G   G   G   G   G	   .   #   /       
   o G   s  3      G   G   G   G   G      0   <      G   G   G   G   G   G	   D   <   E          o G   s         o G   s  M      G   G   G   G   G      0   V      G   G   G   G   G   G	   ^   <   _          o G   s         o G   s  g      g          o G   s         o G   s      
   o G   s         o G   s         o G   s  {   #   {          o G   s     @ 	`P0 `P0 `P0 `P+P*2PI `P0 `P+P*8P4 `P+P*4PI `P0 `P+P*;P4 `P+P*=P@0 `P+P*3P4 `P+P*5P4 `P+P*2P4 `P+P*8P4 `P+P*;P@0 `P+P*.PIP    H  H  $                                                        G   G      %   
      G   G   G                 G   G   G   G      <             o G      G   G   G   G   s "      G   G   G   G	      /  *   
       o      G   G         2      G   G   G      o   9      G   G   G   G      E   A      G   G   G   G   G      I     G	      K   -   L          o G      s <   P          o G      G   G   G   G	   s Y      G   G   G   G      &   a      G   G   G   G   g   n   h          o G      G   G   G   G   s        o G      G   G   G   G	   s z      G   G   G   G                  o G      G   G   G   G   G   s    G   G   G   G   G      A             o G      G   G   G   G   G   s       G   G   G   G   G      F             o G         G   G   G   G   G   s       G   G   G   G      &         G   G   G   G               A             o G   s          o G!   s  F              o G   s         o G!   s  "    s           #    s     @ `P6 
`P0 `PM 	`P0 `P0 `P+P .PI `P0 `P+P8 `P00@ `P+P/1PN0 `P+P 1PI `P0 `P+P /P4 `P+P 2PI `P0 `P+P 2P4 `P0 `P+P 8PI" `P0 `P+P +PI( 	`P0 `P0 `P+P*.P4 `P+P*(PN-0 `P+P*(P4 `P+P*.P4 `P@20 `PO5P                                           o G      s        o G      s        o G      s        o G      s        o G	   
      s 0 `P+P/.P4 `P+P/1P4 `P+P/2P4 `P+P/8P4 `P+P +P4P `   `   "                              s     s     s @ `P'P4 `P' P4 `P'P4P  $  $                                   o G   h   s        o G   h   s        o G   h   s     	   o G
   h   s        o G
   h   s        o G   h   s @ `P+P/'PD `P+P/,PD `P+P/-PD `P+P/'PD `P+P/-PD `P+P/PDP   8   8                                 s  0 `P: P   8   8                                 s  0 `P: P   8   8                                 s  0 `P: P   0   0                              0 `P1 Q   0   0                              0 `P1 Q   8   8                                 s  0 `P: P   4  4                   <           G   G      %         G   G   G                     o G   7             o G	      o G
   s           G   G   G   7             o G	      o G
   s  H   $      G   G   G   (   *          o G   h   s .          s U   0          o G   s         o G   s         o G   s  <   @ 	`P@ `P+P0 `P+P/P*/PN0 `P0 `P+P/P*&PN `P0 `P+P/$PI `P+PN0 `P+P*'P4 `P+P*-P4 `P+P*PIP    8   8                                 s  0 `P: P   |  |                                                           P             s        o G   s         o G   s  K             o G   s         o G   s         s    	    s 
    s @ `P6 
`P0 `PM 	`P0 `P+%P4 `P+P*'P4 `P+P*-PN0 `P+P*'P4 `P+P*-P4 `P+PI `P''P4 `P'*P4P   4   4                                 s  0 `P:P t  t                                   u                   o G      s        o G      s        o G      s k             o G      s        o G      s        o G      s       0 `P00 `P+P 'P4 `P+P ,P4 `P+P/	P4 `P:0 `P+P 'P4 `P+P ,P4 `P+P/	P4 `PJP          e                 	               o       |  }      h   I     h   I     h   I	   
         s 0 `P+P8 `P0 `PO `PO	 `PO `P.	P4P    <   <                                 s 0 `P'P4 P   8   8                                 s  0 `P: P   <   <                                 s 0 `P'P4 P   t   t   :                  
            s     G   G                s 
   0 `P: 	`P0 `P'#PIP   (  (                                                           A             o G   s         o G   s  <             o G   s         o G   s     @ `P6 
`P0 `PM 	`P0 `P+P*-P4 `P+P*'PN0 `P+P*'P4 `P+P*-PIP   `   `   "                              s     s     s @ `P'P4 `P' P4 `P'PDP       y                                 o G   h   s        o G   h   s        o G   h	   s     
   o G   h   s @ `P+P/%PD `P+P/*PD `P+P/%PD `P+P/PDP   8   8                                 s  0 `P: P   8   8                                 s  0 `P: P   0   0                              0 `P1 Q   8   8                                 s  0 `P: P                        8           G   G      %         G   G   G                     o G   7             o G	      o G
   s           G   G   G   7             o G	      o G
   s  H   $      G   G   G   (   *          o G   h   s .          s <   0          o G   s         o G   s  8   @ 	`P@ `P+P0 `P+P/P*/PN0 `P0 `P+P/P*&PN `P0 `P+P/$PI `P+PN0 `P+P*%P4 `P+P*PIP    8   8                                 s  0 `P: P                                                                  7             s        o G   s  2             o G   s         s        s @ `P6 
`P0 `PM 	`P0 `P+%P4 `P+P*%PN
0 `P+P*%P4 `P+PI `P''P4P  4   4                                 s  0 `P:P t  t                                   u                   o G      s        o G      s        o G      s k             o G      s        o G      s        o G      s       0 `P00 `P+P %P4 `P+P *P4 `P+P/	P4 `P:0 `P+P %P4 `P+P *P4 `P+P/	P4 `PJP          e                 	               o       |  }      h   I     h   I     h   I	   
         s 0 `P+P8 `P0 `PO `PO	 `PO `P.	P4P    <   <                                 s 0 `P'P4 P   8   8                                 s  0 `P: P   <   <                                 s 0 `P'P4 P   p   p   9                  
            s     G   G                s  
   0 `P: 	`P0 `POP   `   `   "                              s     s     s @ `P'P4 `P' P4 `P'P4P        y                                 o G   h   s        o G   h   s        o G   h	   s     
   o G   h   s @ `P+P/&PD `P+P/+PD `P+P/&PD `P+P/PDP   8   8                                 s  0 `P: P   8   8                                 s  0 `P: P   0   0                              0 `P1 Q   8   8                                 s  0 `P: P                        T           G   G      %         G   G   G                     o G   7             o G	      o G
   s           G   G   G   7             o G	      o G
   s  H   $      G   G   G   (   *          o G   h   s .      G   G   G   G      x   6          o G      G   G   G   G   G   s        o G      G   G   G   G   G   s J          s <   L          o G   s         o G   s  T   @ 	`P@ `P+P0 `P+P/P*/PN0 `P0 `P+P/P*&PN `P0 `P+P/$PI `P0 `P+P /P4 `P+P 2PI `P+PN0 `P+P*&P4 `P+P*PIP 8   8                                 s  0 `P: P                                                                  7             s        o G   s  2             o G   s         s        s @ `P6 
`P0 `PM 	`P0 `P+%P4 `P+P*&PN
0 `P+P*&P4 `P+PI `P''P4P  4   4                                 s  0 `P:P t  t                                   u                   o G      s        o G      s        o G      s k             o G      s        o G      s        o G      s       0 `P00 `P+P &P4 `P+P +P4 `P+P/	P4 `P:0 `P+P &P4 `P+P +P4 `P+P/	P4 `PJP          e                 	               o       |  }      h   I     h   I     h   I	   
         s 0 `P+P8 `P0 `PO `PO	 `PO `P.	P4P    <   <                                 s 0 `P'P4 P   8   8                                 s  0 `P: P   <   <                                 s 0 `P'P4 P   p   p   9                  
            s     G   G                s  
   0 `P: 	`P0 `POP   `   `   "                              s     s     s @ `P'P4 `P' P4 `P'P4P  D  D  ;                 L               o G   h   s        o G   h   s        o G   h	   s        o G
   h   s        o G   h   s        o G   h   s        o G
   h   s        o G   h   s        o G   h   s        o G
   h   s        o G   h   s        o G   h   s        o G   h   s        o G   h   s        o G   h   s        o G   h    s     !   o G   h"   s     #   o G   h$   s     %   o G   h&   s @ `P+P/EPD	 `P+P/FPD `P+P/BPD `P+P/BPD `P+P/BPD `P+P/CPD `P+P/CPD# `P+P/CPD' `P+P/BPD, `P+P/BPD0 `P+P/BPD6 `P+P/(PD: `P+P/-PD> `P+P/.PDB `P+P/.PDH `P+P/(PDL `P+P/.PDR `P+P/PDV `P+P/;PDYP l   l   2                                      o G      o    s 6 `P )P/P(P4 P   l   l   2                                      o G      o    s 6 `P )P/P(P4 P   l   l   .                                         o s     s 6 `P 2P#P4 `P'3P4 P  X   X   #                                         o s 6 `P 1P#P4 P X   X   #                                         o s 6 `P 1P#P4 P l   l   .                                         o s     s 6 `P 2P#P4 `P'3P4 P  X   X   #                                         o s 6 `P 1P#P4 P X   X   #                                         o s 6 `P 1P#P4 P l   l   .                                         o s     s 6 `P 2P#P4 `P'3P4 P  X   X   #                                         o s 6 `P 1P#P4 P X   X   #                                         o s 6 `P 1P#P4 P 8   8                                 s  0 `P: P   8   8                                 s  0 `P: P   8   8                                 s  0 `P: P   8   8                                 s  0 `P: P   0   0                              0 `P1 Q   0   0                              0 `P1 Q   8   8                                 s  0 `P: P   8   8                                 s  0 `P: P   t  t                                  G   G      %         G   G   G         ?        G   G   G   G      1             o G   	    
   o s       G   G   G   G      *   #      G   G   G   G      *      +          o G   7   0          o G      o G   s     6      G   G   G   7   <          o G      o G   s  H   B      G   G   G   (   H          o G   h   s L      G   G   G   G      +   T      G   G   G   G   G   [   K   \          o G   s         o G   s      s  B   f          o G   s         o G   s     n      G   G   G   G      +   v      G   G   G   G   G   }   A   ~          o G   s         o G   s  B             o G   s         o G   s                     #              o G   s        G   G   G   G!      x          "   o G#      G   G   G   G!   G$   s     %   o G#      G   G   G   G!   G&   s    '       s n          (   o G   s      )   o G   s      *   o G   s         o G   s     0 `P&`PF `P@ `P0 `P+P .P#PI	 `P@ `P+P0 `P+P/P*/PN0 `P0 `P+P/P*&PN `P0 `P+P/$PI `P0 `P+P*1P4 `P+P*7PD `P@!0 `P+P*1P4 `P+P*7P4 `PK' `P0 `P+P*2P4 `P+P*;PN+0 `P+P*2P4 `P+P*;P4 `PK1 `P@3 `P+P*.PI6 `P0 `P+P /P4 `P+P 2PI; `P+PN=0 `P+P*(P4 `P+P*.P4 `P+P*$P4 `P+P*PICP   8   8                                 s  0 `P: P       +                (                                                     s        o G   s     G   G   G   G   	   1          
   o G          o s    2             o G   s         s            o G   s      s     s @ `P6 `P0 `PM `P0 `P+%P4 `P+P*(PD
 `P0 `P+P .P#P@0 `P+P*(P4 `P+PI `P+P*.PD `P''P4 `P'*P4P   4   4                                 s  0 `P:P t  t                                   u                   o G      s        o G      s        o G      s k             o G      s        o G      s        o G      s       0 	`P00 `P+P (P4 `P+P -P4 `P+P/	P4 `P:0 `P+P (P4 `P+P -P4 `P+P/	P4 `PJP          e                 	               o       |  }      h   I     h   I     h   I	   
         s 0 `P+P8 `P0 `P? `P? `P? `P.	P4P   8   8                                 s  `P'P$P 4   4                                 s   `P*+P 8   8                                 s  `P'P$	P       D                              s     G   G                s      s    0 `P: `P0 `P: `P'$PIP                                                                G   G      %   
      G   G   G         H        G   G   G   G      <             o G      G   G   G   G   s "      G   G   G   G	      /  *   
       o      G   G         2      G   G   G      o   9      G   G   G   G      E   A      G   G   G   G   G      I     G	      K   -   L          o G      s <   P          o G      G   G   G   G	   s Y          o G      s    G   G   a      I          o G          o G   o  s k      G   G   o      I          o G          o G   o  s y      G   G   }      I          o G          o G   o  s            o G      G   G   G   G   s     !   o G      G   G   G   G	   s       A          "   o G#   s      $   o G%   s            $   o G#   s     G   G   G   G&      1          '   o G(   )    *   o s        "   o G%   s  +    s     ,    s    G   G   G   G&      1          -   o G(   )    .   o s    @ `P6 `P0 `PM `P0 `P0 `P+P .PI `P0 `P+P8 `P00@ `P+P/1PN0 `P+P 1PI `P+P DPD `P0 `P< `P+P FP*=P#PI `P0 `P< `P+P GP*>P#PI! `P0 `P< `P+P FP*=P#PI' `P+P /P4 `P+P 2PI+ `P0 `P+P*.P4 `P+P*(PN/0 `P+P*(PD2 `P0 `P+P .P#PI6 `P+P*.P4 `PO9 `P'3PD; `P0 `P+P 3P#PI>P                                       o G   h   s        o G   h   s        o G   	   s     
   o G   	   s     s     I      I      I   @ `P+P/APD `P+P/EPD `P+P/5P4 `P+P/8PD `PJ `P< `P< `P<P X   X   $                                  o G      s 6 `P*P/P4 P    X   X   %                                  o G      s 6 `P*P P4 P  ,  ,                                                     9             o G      o    
      
      (             o G   s  #             o G   s     @ `P6 `P0 `P@ 
`P+P/<P? `PK
 `P0 `P+P*<PN0 `P+P*<PIP    \  \                               G   4             o G            o s 
      G   4          	   o G       
     o s           o G            o s        o G            o s @ `P0 `P+P BP#PI `P0 `P+P AP#PI `P+P OP#P4 `P+P NP#P4P   l  l  u                N                                                  #             o G   s         #             o G   s            o G      o (             o G      o    #          	   o G   s      I          [   "          o G
   s         o G   #   +       	   o G
   s  /       [   1          o G
   s         o G   #   :       	   o G
   s  >          o G      o (   C          o G      o G   #   H       	   o G
   s  L       s @ `P6 `P0 `PM `P0 `P0 `P+P*7PI `P0 `P+P*;PI `P+P/;P P/8P0 `P+P*.P@0 `P0 `P+P*7P4 `P+P@ `P+P*.PI `P0 `P+P*;P4 `P+P@ `P+P*.PI! `P+P/;P P/8P0 `P+P*.PI% `P'3P4P  t  t                                   u                   o G      s        o G      s        o G      s k             o G      s        o G      s        o G      s       0 	`P00 `P+P .P4 `P+P .P4 `P+P/	P4 `P:0 `P+P .P4 `P+P .P4 `P+P/	P4 `PJP        K                o           |  }            o G      o          o G      o             o G   o  I	          
   o G   o  I         G   '             o G   o              I         G   '   !          o G   o     %      %   I         G   '   *          o G   o     .      .   I      G   G      %   5      G   G   G      ;   -   <         G   G   G   G   I   B      |  }      h   I     h   I     h   I      G   G   G    G!      :   O      G   G   G    G!   G"      W     W   +   X      #   I$   %         s [      G   G   G    G&      :   c      G   G   G    G&   G"      k     k   +   l      '   I$   %         s o   @ `P0 `P+P/FP8 `P+P/EPH `P/P*0P9 `P/P*3PI	 `P IP*CP0 `P KP*DP0 `P IP*CP@ `P0 `P@ `P0 `P? `P? `PO `P0 `P? `P.PI `P0 `P? `P.PIP  8   8                                 s  `P'#P$P 4   4                                 s   `P*6P 8   8                                 s  `P'#P$	P p   p   9                  
            s     G   G                s  
   @ `P: `P0 `POP  `   `   "                              s     s     s @ `P'P4 `P' P4 `P'P4P      	                                       U                G      o H       G      s 
      
    G   o     R       G        G   	   o o s     G      o K$          G      o K         0 	`P00 `P -P0 `P/PI `PJ0 `P*P0 `P (P#P#P4 `P -P@0 `P -PK `PJP     -                 (               o G   h   s        o G   h   s        o G   h	   s     
   o G   h   s        o G   h   s        o G   h   s        o G   h   s        o G   h   s        o G   h   s        o G   h   s @ `P+P/APD `P+P/APD `P+P/#PD `P+P/)PD `P+P/"PD `P+P//PD `P+P/,PD  `P+P/#PD# `P+P/)PD/ `P+P/PD3P   H   H                                 s      s  0 `P: `P: P    H   H                                 s      s  0 `P: `P: P    8   8                                 s  0 `P: P   8   8                                 s  0 `P: P   8   8                                 s  0 `P: P   8   8                                 s  0 `P: P   8   8                                 s  0 `P: P   0   0                              0 `P1 Q   0   0                              0 `P1 Q   8   8                                 s  @ `P: P  P  P                   !           |  }           G   G   G   I      G   G      %         G   G   G         -            G   G   G   G	   I         |  }      h
   I     h   I     h   I            s 00 `P0 `P0 `P0 `P@ `P0 `P? `P? `P? `P.P4P   8   8                                 s  `P'P$P 4   4                                 s   `P*!P 8   8                                 s  `P'P$	P       D                             G   G                s     s  
       s  0 `P0 `P'P4 `PO `P:P                           "               o G      G   G   G   s        o G   	      G   G   G
   s    G   G   G
      %   G   G   G   %      G   G      I       s       I   00 `P+P <P4 `P+P $P4 `P0 `P0 `P'P4 `P?P                                      G   G      %         G   G   G                   s  <             o G   s      	   o G   s     @ `P@ `P@0 `P+P*#P4 `P+P*)PIP     h                          G   G      %         G   G   G         #           G   G   G   G      ?         G   G   %         G   G   G   	      J         G   G   G   G          
   o G   o    w  (      G   G   G   G      ?   0      G   G   %   4      G   G   G   	   9     :      G   G   G   G             o          o G          o s        o G          o s        o G          o s        o G          o s        o G          o s    _    _            b      G      E   g      G   G      %   m      G   G   G      s   $   t      G   G   G      x      G   G   G   G      +         G   G   G   G   G      h             o G   s         o G           G   G   G   G   G   o s A             o G!   s         o G   "   s        #   o G$   s      #   o G%   &     %'   %s        o G(   h)   s    @ `P0 `P6@ `P0 `P@	 `P+P*/P@ `P0 `P0 `P+P8 `P+P 0P#P4 `P+P 'P#P4 `P+P )P#P4 `P+P 8P#P4 `P+P 5P#PN0 `PALF `P0 `P0 `P@ `P0 `P+P*NP4 `P+P TP#PN#0 `P+P*NP4 `P+P/OPI) `P+P*AP4 `P+P APD, `P*P/PILP      T        
       O                o H         H   -            HG          D  	      G      o         G   G      O         G   G   G      *            G   G   G   H   "   K   #         G   G   G   HG        G   G   G     p   -         G   H   5   2         G   HG        G     "   6           G     7      G   	   7   :     
            o %   %%  9   ?     
      G   %   %   G   %   %%  F          o G         G   %   %  %   %s 6 `P*P:00 `P0 `P0 `P@ `P? `P0 `P@ `P0 `P0 `P@0 `P: `P@ `P0 `P P@0 `PK `P+P AP4 P                                                                   G   G      `   
      G   G      @         G   G                G   G                        n        G   G   G	   
   %   "      G   G   G	      '      (       s    G   G   G	         0       s  2      G   G   G	   
      8       s  :     :      G   G      >      G   G   G      k   D      G   G   G	      F   J      G   G   G      !   Q      G   G   G   V      W       s      s  [          o G   s     G   G   %   c      G   G   G      h   A   i          o G   s         o G   s  <   q          o G   s         o G   s  y      y          o G   s         o G   s         o G      s     s      s         o G   s     @ `P6 `P0 `P@ `P5 `PK	 `P@ `P00 `P'P4 `P '`P? `P ,`P@@ `P0 `P: `PO `P+P*#PD `P0 `P+P*#P4 `P+P*)PN 0 `P+P*)P4 `P+P*#P@&0 `P+P*#P4 `P+P*3P4 `P+P/1P4 `P: `PJ0 `P+P*PI2P    l   l   0                            |  }        h   I          s 0 `P@ `PO `P*
P4P    4   4                                 s   `P*!P                                    G                G   G      
   7         G   M      G      |  }  I          s      s  @ `P0 `P0 `P PN `P: `P:P  l   l   0                            |  }        h   I          s 0 `P@ `PO `P*
P4P    4   4                                 s   `P*'P                                    G                G   G      
   7         G   M      G      |  }  I          s     s     s  	    s  @ `P0 `P0 `P PN `P'P4 `P'P4 `P: `P:P    t  t                   2                                 o G      s        o G      s        o G      s        o G      s        o G      s     	   o G
      s              o G      s        o G      s        o G      s        o G      s        o G      s     	   o G
      s    2   0 	`P00 `P+P #P4 `P+P )P4 `P+P "P4 `P+P /P4 `P+P ,P4 `P+P/	P4 `P:0 `P+P #P4 `P+P )P4 `P+P "P4 `P+P /P4 `P+P ,P4 `P+P/	P4 `PJP                      &           |  }               o G   o  I      G   G      %         G   G   G	         -            G   G   G	   G
   I	            G   G   G   I      |  }      h   I     h   I     h   I            s @ `P@ `P/P*BPI `P0 `P@	 `P0 `P0 `P? `P? `P? `P.P4P    8   8                                 s  `P'P$P 4   4                                 s   `P* P 8   8                                 s  `P'P$	P       k                              s     G   G      (             o G   s  #             o G   s     @ `P: `P0@	 `P+P*PN@ `P+P*PIP  <  <                  f          G   G      %         G   G   G         _           G   G   G   G      ?         G   G   %         G   G   G   	      -         G   G   G   G         $      G   G   G   G
      ?   ,      G   G   %   0      G   G   G   	   5   -   6      G   G   G   G
         ;    ;            >      G      E   C      G   G      %   I      G   G   G      O   $   P      G   G   G      T          o G   o     F   Z          o G   s         o G      s '   b          o G   h   s f   0 `P@ `P6 `P0 `P@ `P0 `P@
0 `PA1F `P0 `P0 `P@ `P+P*AP0 `P+P*3P4 `P+P/1PN0 `P*P/PI1P   d  d                 E                o H      G          o G   o    
         H   #            HG              G      o         G   G      O         G   G   G	      *   "         G   G   G	   H   )   2   *         G   G   G	   HG     @   0         G	   H   "   5         G	   HG     8           ;   
       o   =          o G   s         o G     s E   6 `P*P: `P P*BP>0 	`P0 `P@ `P? `P@
 `P0 `P@ 	`P0 `P+PM `P+P*3P4 `P+P.1PI P 4  4  u                9           G   G   G         G   G   G   G               o G	   
       o s        o G	   
       o s        o G	   
       o s        o G	   
       o s        o G	   
       o s        o G   h   s    G   G      <   1          o G   s         o G   s  9   @ `P0 `P0 `P6000 `P+P 0P#P4 `P+P 'P#P4 `P+P )P#P4 `P+P 8P#P4 `P+P 5P#PD `P*P/PD9 `P00 `P+P*$P4 `P+P*PI>P  (  (  C               m                o H      G      G   G   G     
         H   D            HG                  HG              G      o         G   G	      O         G   G	   G
      *   $         G   G	   G
   H   +   q   ,         G   G	   G
   HG         G   G	   G
            G   G	   G
   HG         <         G
   H   P   A         G
   HG         G
            G
   HG      $   H            G
      I            L          o    N      G      :   Q                   o %   %%   ;   V            G   %   %   G   %   %%   ]          o G   s         o G   s         o G      s        o G      s m   6 `P*PJ `P@ `P0 `P0 `P; `P@
 `P? `P0 `P0 `P@ `P0 `P0 `P? `P@0 `P; `P@ `P0 `P+PN `P0 `P P@!0 `PL$ `P+P*3P4 `P+P*P4 `P+P/1P4 `P+P/,PI) P                                                                          s        o G   s     G   G   G      &        G   G	   G
      )          s     G   G	   M
          s         o G   s     G   G   G      (   *          o G   s  j   .      G   G   G      F   4          o G   s         o G   s      s  >     >      G      E   C      G   G      %   I      G   G   G      N   B   O      G   G	   G
         V       s  X      X       s         o G   s     G   G	   G      *   e      G   G	   G   G      l   N   m          o G   s     G   G	   G   
I       s  #   x          o G   s  |   #   |          o G   s        G   G   G   G       *         G   G   G   G         1          !   o G"   #    $   o s    @ `P6 `P0 `PM `P0 `P'P4 `P+P*)P4 `P00 `P0 `P: `P@ `P: `P+P*0P4 `P0 `P+P*,PN `P0 `P+P*#P4 `P+P*)P4 `P@ `P0 `P0 `P@ 0 `P: `P+P*,P4 `P0 `P+P*0P4 `P0 `P@(0 `P+P*0P@-0 `P+P*)PI1 `P0 `P+P 3P#PI4P   L  L                              G   G               |  }        |  }          G   G   G   I         G   G   G   I     h   I	     h
   I     h   I       s          s           s     0 `P0 `P0 `P0 `P0 `P0 `P? `P? `P? `P'P4 `P.PN0 `POP 8   8                                 s  `P'P$P 8   8                                 s  `P'P$P 8   8                                 s  `P'P$	P                        A           G   G   G      a            o G   s         o G   s      	   o G   s      
   o G   s         o G          o s        o G   s     G   G   
I      G         *         |  }  I      G   'I      G      G   G   G   I      G      G   h      G   G   o I   A   0 `P0 `P+P**P4 `P+P*0P4 `P+P*,P4 `P+P**P4 `P+P 6P#P4 `P+P*1PD	 `P0 `P0 `P/P9 `P0 `P0 `P (PNP  4   4                                 s   `P*"P <  <                    "               o G   s         o G   s         o G   s         o G   s     G	   
             G	   G   
      4         G      G	   G   s    M	   "   0 `P+P**P4 `P+P*0P4 `P+P*,P4 `P+P**P4 `P0 `P P4 `P@	P    ,  ,                               G   G                s     G   G   M      G   G   G	   
   9          s       G   G   G   I             s               s      s     0 `P0@ `P: `P0 `P00 `P'P4 `P@0 `P@0 `P: `POP         l                              s      s    G   G   M      G   G   G             s        	    s     0 `P: `P'P4 `P0 `P0 `P@ `P?P    H  H                    ,           G   G   G      *         G   G   G   G                  G                  |  }  I      G   I	      G      G   G   G   G   I      G   
   G   h      G   G	   o I   ,   0 `P0 `P0 `P/P9 `P0 `P0 `P (PN
P 4   4                                 s   `P*0P                                        o G      s    G          	      G   G         4      	   G
      G   G   s    M      0 `P+P/+P4 `P0 `P P4 `P@P       3                R           G                G   G      
           G   G   .(I      G   G           G      G   G   *o       G      G   G      )&<*o      G   G      )&  <)&            o       	     o       
     o          o G          o s    ]   >          o G      G          o              o s P   G          o G      G          o         o s P      P       s  R   0 `P0 `P0 `P0 `P P8 `P P8 `P@ `P P8 `P P8 `P PH `P+P 5P#PD `P00 `P+P @P0H =P#PN0 `P+P @P P#P@0 `POP    D  D  ;                 L               o G   h   s        o G   h   s        o G   h	   s        o G
   h   s        o G   h   s        o G   h   s        o G
   h   s        o G   h   s        o G   h   s        o G
   h   s        o G   h   s        o G   h   s        o G   h   s        o G   h   s        o G   h   s        o G   h    s     !   o G   h"   s     #   o G   h$   s     %   o G   h&   s @ `P+P/DPD `P+P/EPD `P+P/APD `P+P/APD `P+P/APD `P+P/BPD `P+P/BPD `P+P/BPD" `P+P/APD& `P+P/APD) `P+P/APD. `P+P/'PD1 `P+P/,PD4 `P+P/-PD7 `P+P/-PD< `P+P/'PD? `P+P/-PDD `P+P/PDG `P+P/:PDJP l   l   2                                      o G      o    s 6 `P (P/P(P4 P   l   l   2                                      o G      o    s 6 `P (P/P(P4 P   l   l   .                                         o s     s 6 `P 1P#P4 `P'2P4 P  X   X   #                                         o s 6 `P 0P#P4 P X   X   #                                         o s 6 `P 0P#P4 P l   l   .                                         o s     s 6 `P 1P#P4 `P'2P4 P  X   X   #                                         o s 6 `P 0P#P4 P X   X   #                                         o s 6 `P 0P#P4 P l   l   .                                         o s     s 6 `P 1P#P4 `P'2P4 P  X   X   #                                         o s 6 `P 0P#P4 P X   X   #                                         o s 6 `P 0P#P4 P 8   8                                 s  0 `P: P   8   8                                 s  0 `P: P   8   8                                 s  0 `P: P   8   8                                 s  0 `P: P   0   0                              0 `P1 Q   0   0                              0 `P1 Q   8   8                                 s  0 `P: P   8   8                                 s  0 `P: P   t  t                                  G   G      %         G   G   G         ?        G   G   G   G      1             o G   	    
   o s       G   G   G   G      *   #      G   G   G   G      *      +          o G   7   0          o G      o G   s     6      G   G   G   7   <          o G      o G   s  H   B      G   G   G   (   H          o G   h   s L      G   G   G   G      +   T      G   G   G   G   G   [   K   \          o G   s         o G   s      s  B   f          o G   s         o G   s     n      G   G   G   G      +   v      G   G   G   G   G   }   A   ~          o G   s         o G   s  B             o G   s         o G   s                     #              o G   s        G   G   G   G!      x          "   o G#      G   G   G   G!   G$   s     %   o G#      G   G   G   G!   G&   s    '       s n          (   o G   s      )   o G   s      *   o G   s         o G   s     0 `P&`PF `P@ `P0 `P+P -P#PI	 `P@ `P+P0 `P+P/P*/PN0 `P0 `P+P/P*&PN `P0 `P+P/$PI `P0 `P+P*0P4 `P+P*6PD `P@ 0 `P+P*0P4 `P+P*6P4 `PK& `P0 `P+P*1P4 `P+P*:PN*0 `P+P*1P4 `P+P*:P4 `PK0 `P@2 `P+P*-PI6 `P0 `P+P /P4 `P+P 2PI; `P+PN=0 `P+P*'P4 `P+P*-P4 `P+P*#P4 `P+P*PICP   8   8                                 s  0 `P: P       +                (                                                     s        o G   s     G   G   G   G   	   1          
   o G          o s    2             o G   s         s            o G   s      s     s @ `P6 `P0 `PM `P0 `P+%P4 `P+P*'PD
 `P0 `P+P -P#P@0 `P+P*'P4 `P+PI `P+P*-PD `P''P4 `P'*P4P   4   4                                 s  0 `P:P t  t                                   u                   o G      s        o G      s        o G      s k             o G      s        o G      s        o G      s       0 	`P00 `P+P 'P4 `P+P ,P4 `P+P/	P4 `P:0 `P+P 'P4 `P+P ,P4 `P+P/	P4 `PJP          e                 	               o       |  }      h   I     h   I     h   I	   
         s 0 `P+P8 `P0 `P? `P? `P? `P.	P4P   8   8                                 s  `P'P$P 4   4                                 s   `P**P 8   8                                 s  `P'P$	P       D                              s     G   G                s      s    0 `P: `P0 `P: `P'#PIP                                                                G   G      %   
      G   G   G         H        G   G   G   G      <             o G      G   G   G   G   s "      G   G   G   G	      /  *   
       o      G   G         2      G   G   G      o   9      G   G   G   G      E   A      G   G   G   G   G      I     G	      K   -   L          o G      s <   P          o G      G   G   G   G	   s Y          o G      s    G   G   a      I          o G          o G   o  s k      G   G   o      I          o G          o G   o  s y      G   G   }      I          o G          o G   o  s            o G      G   G   G   G   s     !   o G      G   G   G   G	   s       A          "   o G#   s      $   o G%   s            $   o G#   s     G   G   G   G&      1          '   o G(   )    *   o s        "   o G%   s  +    s     ,    s    G   G   G   G&      1          -   o G(   )    .   o s    @ `P6 `P0 `PM `P0 `P0 `P+P -PI
 `P0 `P+P8 `P00@ `P+P/0PN0 `P+P 0PI `P+P CP4 `P0 `P< `P+P FP*=P#PI `P0 `P< `P+P EP*<P#PI `P0 `P< `P+P EP*<P#PI$ `P+P /P4 `P+P 2PI( `P0 `P+P*-P4 `P+P*'PN,0 `P+P*'PD/ `P0 `P+P -P#PI3 `P+P*-P4 `PO6 `P'2PD8 `P0 `P+P 2P#PI;P                                        o G   h   s        o G   h   s        o G   	   s     
   o G   	   s     s     I      I      I   0 `P+P/@PD `P+P/DPD `P+P/4P4 `P+P/7PD
 `P: `P< `P< `P<P   X   X   $                                  o G      s 6 `P*P/P4 P    X   X   %                                  o G      s 6 `P*P P4 P  ,  ,                                                     9             o G      o    
      
      (             o G   s  #             o G   s     @ `P6 `P0 `P@ 
`P+P/;P? `PK	 `P0 `P+P*;PN0 `P+P*;PIP    \  \                               G   4             o G            o s 
      G   4          	   o G       
     o s           o G            o s        o G            o s 0 `P0 `P+P AP#PI `P0 `P+P @P#PI `P+P NP#P4 `P+P MP#P4P    l  l  u                N                                                  #             o G   s         #             o G   s            o G      o (             o G      o    #          	   o G   s      I          [   "          o G
   s         o G   #   +       	   o G
   s  /       [   1          o G
   s         o G   #   :       	   o G
   s  >          o G      o (   C          o G      o G   #   H       	   o G
   s  L       s 0 `P6 `P0 `PM `P0 `P0 `P+P*6PI	 `P0 `P+P*:PI `P+P/:P P/7P0 `P+P*-P@0 `P0 `P+P*6P4 `P+P@ `P+P*-PI `P0 `P+P*:P4 `P+P@ `P+P*-PI `P+P/:P P/7P0 `P+P*-PI# `P'2P4P   t  t                                   u                   o G      s        o G      s        o G      s k             o G      s        o G      s        o G      s       0 	`P00 `P+P -P4 `P+P -P4 `P+P/	P4 `P:0 `P+P -P4 `P+P -P4 `P+P/	P4 `PJP        K                o           |  }            o G      o          o G      o             o G   o  I	          
   o G   o  I         G   '             o G   o              I         G   '   !          o G   o     %      %   I         G   '   *          o G   o     .      .   I      G   G      %   5      G   G   G      ;   -   <         G   G   G   G   I   B      |  }      h   I     h   I     h   I      G   G   G    G!      :   O      G   G   G    G!   G"      W     W   +   X      #   I$   %         s [      G   G   G    G&      :   c      G   G   G    G&   G"      k     k   +   l      '   I$   %         s o   @ `P0 `P+P/EP8 `P+P/DPH `P/P*0P9 `P/P*3PI	 `P JP*CP0 `P HP*BP0 `P HP*BP@ `P0 `P@ `P0 `P? `P? `PO `P0 `P? `P.PI `P0 `P? `P.PIP  8   8                                 s  `P'"P$P 4   4                                 s   `P*5P 8   8                                 s  `P'"P$	P p   p   9                  
            s     G   G                s  
   @ `P: `P0 `POP  `   `   "                              s     s     s @ `P'P4 `P' P4 `P'P4P      	                                       U                G      o H       G      s 
      
    G   o     R       G        G   	   o o s     G      o K$          G      o K         0 	`P00 `P ,P0 `P/PI `PJ0 `P*P0 `P (P#P#P4 `P ,P@0 `P ,PK `PJP     -                 (               o G   h   s        o G   h   s        o G   h	   s     
   o G   h   s        o G   h   s        o G   h   s        o G   h   s        o G   h   s        o G   h   s        o G   h   s @ `P+P/@PD `P+P/@PD `P+P/"PD `P+P/(PD `P+P/!PD `P+P/.PD `P+P/+PD  `P+P/"PD# `P+P/(PD0 `P+P/PD4P   H   H                                 s      s  0 `P: `P: P    H   H                                 s      s  0 `P: `P: P    8   8                                 s  0 `P: P   8   8                                 s  0 `P: P   8   8                                 s  0 `P: P   8   8                                 s  0 `P: P   8   8                                 s  0 `P: P   0   0                              0 `P1 Q   0   0                              0 `P1 Q   8   8                                 s  @ `P: P                                     G   G      %         G   G   G                   s  <             o G   s      	   o G   s     @ `P@ `P@0 `P+P*"P4 `P+P*(PIP     h                          G   G      %         G   G   G         #           G   G   G   G      ?         G   G   %         G   G   G   	      J         G   G   G   G          
   o G   o    w  (      G   G   G   G      ?   0      G   G   %   4      G   G   G   	   9     :      G   G   G   G             o          o G          o s        o G          o s        o G          o s        o G          o s        o G          o s    _    _            b      G      E   g      G   G      %   m      G   G   G      s   $   t      G   G   G      x      G   G   G   G      +         G   G   G   G   G      h             o G   s         o G           G   G   G   G   G   o s A             o G!   s         o G   "   s        #   o G$   s      #   o G%   &     %'   %s        o G(   h)   s    @ `P0 `P60 `P0 `P@ `P+P*.P@
 `P0 `P0 `P+P8 `P+P /P#P4 `P+P &P#P4 `P+P (P#P4 `P+P 7P#P4 `P+P 4P#PN0 `PAJF `P0 `P0 `P@ `P0 `P+P*LP4 `P+P RP#PN"0 `P+P*LP4 `P+P/MPI( `P+P*@P4 `P+P @PD+ `P*P/PIJP       T        
       O                o H         H   -            HG          D  	      G      o         G   G      O         G   G   G      *            G   G   G   H   "   K   #         G   G   G   HG        G   G   G     p   -         G   H   5   2         G   HG        G     "   6           G     7      G   	   7   :     
            o %   %%  9   ?     
      G   %   %   G   %   %%  F          o G         G   %   %  %   %s 6 `P*P:00 `P0 `P0 `P@ `P? `P0 `P@ `P0 `P0 `P@0 `P: `P@ `P0 `P P@0 `PK `P+P @P4 P                                                                   G   G      `   
      G   G      @         G   G                G   G                        n        G   G   G	   
   %   "      G   G   G	      '      (       s    G   G   G	         0       s  2      G   G   G	   
      8       s  :     :      G   G      >      G   G   G      k   D      G   G   G	      F   J      G   G   G      !   Q      G   G   G   V      W       s      s  [          o G   s     G   G   %   c      G   G   G      h   A   i          o G   s         o G   s  <   q          o G   s         o G   s  y      y          o G   s         o G   s         o G      s     s      s         o G   s     @ `P6 `P0 `P@ `P5 `PK	 `P0 `P00 `P'P4 `P '`P? `P +`P@@ `P0 `P: `PO `P+P*"PD `P0 `P+P*"P4 `P+P*(PN0 `P+P*(P4 `P+P*"P@%0 `P+P*"P4 `P+P*2P4 `P+P/0P4 `P: `PJ. `P+P*PI0P l   l   0                            |  }        h   I          s 0 `P@ `PO `P*
P4P    4   4                                 s   `P* P                                    G                G   G      
   7         G   M      G      |  }  I          s      s  @ `P0 `P0 `P PN `P: `P:P  l   l   0                            |  }        h   I          s 0 `P@ `PO `P*
P4P    4   4                                 s   `P*&P                                    G                G   G      
   7         G   M      G      |  }  I          s     s     s  	    s  @ `P0 `P0 `P PN `P'P4 `P'P4 `P: `P:P    t  t                   2                                 o G      s        o G      s        o G      s        o G      s        o G      s     	   o G
      s              o G      s        o G      s        o G      s        o G      s        o G      s     	   o G
      s    2   0 	`P00 `P+P "P4 `P+P (P4 `P+P !P4 `P+P .P4 `P+P +P4 `P+P/	P4 `P:0 `P+P "P4 `P+P (P4 `P+P !P4 `P+P .P4 `P+P +P4 `P+P/	P4 `PJP                      &           |  }               o G   o  I         G   G   G   I      G   G	   
   %         G   G	   G   
      -            G   G	   G   G   I         |  }      h   I     h   I     h   I            s @ `P@ `P/P*API `P0 `P0 `P@
 `P0 `P? `P? `P? `P.P4P    8   8                                 s  `P'P$P 4   4                                 s   `P*P 8   8                                 s  `P'P$	P       k                              s     G   G      (             o G   s  #             o G   s     0 `P: `P0@ `P+P*PN
@ `P+P*PIP   H  H  s                 n            s        o G         G   G   G   s     	   o G
      G   G   G   s        o G
      G   G   G   s        o G
      G   G   G   s        o G
      G   G   G   s        o G
      G   G   G   s        o G
      G   G   G   s        o G
      G   G   G   s        o G
      G   G   G   s        o G
      G   G   G   s        o G
      G   G   G   s        o G
      G   G   G   s        o G
      G   G   G   s        o G   s  00 `P'P4 `P+P #P4 `P+P 7P4 `P+P 8P4 `P+P 6P4 `P+P 9P4 `P+P 8P4 `P+P :P4 `P+P :P4 `P+P 9P4 `P+P ;P4 `P+P <P4 `P+P >P4 `P+P ;P4 `P+P*#P4P        D                             G   G                s     s  
       s  @ `P0 `P'P4 `PO `PJP  |  |                  &           |  }               o G   o  I         G   G   G   I      G   G	   
   %         G   G	   G   
      -            G   G	   G   G   I         |  }      h   I     h   I     h   I            s 00 `P0 `P/P*:P9 `P0 `P0 `P@ `P0 `P? `P? `PO `P.P4P 8   8                                 s  `P'P$P 4   4                                 s   `P* P H   H                                 h   s @ `PKC PD P  <   <                                 s 0 `P'P4 P   <  <                  f          G   G      %         G   G   G         _           G   G   G   G      ?         G   G   %         G   G   G   	      -         G   G   G   G         $      G   G   G   G
      ?   ,      G   G   %   0      G   G   G   	   5   -   6      G   G   G   G
         ;    ;            >      G      E   C      G   G      %   I      G   G   G      O   $   P      G   G   G      T          o G   o     F   Z          o G   s         o G      s '   b          o G   h   s f   @ `P0 `P6 `P0 `P@ `P0 `P@
0 `PA1F `P0 `P0 `P@ `P+P*@P0 `P+P*2P4 `P+P/0PN0 `P*P/PI1P   d  d                 E                o H      G          o G   o    
         H   #            HG              G      o         G   G      O         G   G   G	      *   "         G   G   G	   H   )   2   *         G   G   G	   HG     @   0         G	   H   "   5         G	   HG     8           ;   
       o   =          o G   s         o G     s E   6 `P*P: `P P*AP>0 	`P0 `P@ `P? `P@
 `P0 `P@ 	`P0 `P+PM `P+P*2P4 `P+P.0PI P 4  4  u                9           G   G   G         G   G   G   G               o G	   
       o s        o G	   
       o s        o G	   
       o s        o G	   
       o s        o G	   
       o s        o G   h   s    G   G      <   1          o G   s         o G   s  9   @ `P0 `P0 `P6000 `P+P /P#P4 `P+P &P#P4 `P+P (P#P4 `P+P 7P#P4 `P+P 4P#PD `P*P/PD: `P00 `P+P*#P4 `P+P*PI?P  (  (  C               m                o H      G      G   G   G     
         H   D            HG                  HG              G      o         G   G	      O         G   G	   G
      *   $         G   G	   G
   H   +   q   ,         G   G	   G
   HG         G   G	   G
            G   G	   G
   HG         <         G
   H   P   A         G
   HG         G
            G
   HG      $   H            G
      I            L          o    N      G      :   Q                   o %   %%   ;   V            G   %   %   G   %   %%   ]          o G   s         o G   s         o G      s        o G      s m   6 `P*PJ `P@ `P0 `P0 `P; `P@ `P? `P0 `P0 `P@ `P0 `P0 `P? `P@0 `P; `P@ `P0 `P+PN `P0 `P P@"0 `PL% `P+P*2P4 `P+P*P4 `P+P/0P4 `P+P/+PI* P                       l                                                    o G   s      s    G   G   G           	    s      
   o G   s     G   G   G      (             o G   s  )  "      G   G   G      K   (          o G   s         o G   s      s     2   	    s         o G   s     G   G   G      *   ?      G   G   G   G      F   I   G       
   o G   s     G   G   G   
I       s  R   #   R          o G   s  V      G   G   G   G      *   ^      G   G   G   G      e   1   f          o G          o s l   @ `P6 `P0 `PM `P0 `P+P*(P4 `P'P4 `P00 `P: `P+P*/P4 `P0 `P+P*+PN `P0 `P+P*"P4 `P+P*(P4 `P@0 `P: `P+P*+P4 `P0 `P+P*/P4 `P0 `P@ 0 `P+P*(PI$ `P0 `P+P 2P#PI'P   P  P                              G   G               |  }        |  }          G   G   G   I         G   G   G   I     h   I	     h
   I     h   I       s          s           s     0 `P0 `P0 `P0 `P0 `P@ `P? `P? `P? `P'P4 `P.PN@ `POP   8   8                                 s  `P'P$P 8   8                                 s  `P'P$P 8   8                                 s  `P'P$	P ,  ,                               G   G                s     G   G   M      G   G   G	   
   9          s       G   G   G   I             s               s      s     0 `P0@ `P: `P0 `P00 `P'P4 `P@0 `P@0 `P: `POP         w                             G   G      M          s     G   G   M         G   G	   G
   I             s     0 `P0@ `P: `P0 `P@	0 `POP       l                              s      s    G   G   M      G   G   G             s        	    s     0 `P: `P'P4 `P0 `P0 `P@ `PO	P   H  H                    ,           G   G   G      *         G   G   G   G                  G                  |  }  I      G   I	      G      G   G   G   G   I      G   
   G   h      G   G	   o I   ,   0 `P0 `P0 `P/P9 `P0 `P0 `P (PN
P 4   4                                 s   `P*/P                                        o G      s    G          	      G   G         4      	   G
      G   G   s    M      0 `P+P/*P4 `P0 `P P4 `P@P                       L           G                G   G      
           G   G   .(I      G   G           G      G   G   *o       G      G   G      )&<*o      G   G      )&  <)&            o       	     o       
     o      ]   8          o G      G          o              o s P   A          o G      G          o         o s J      J       s  L   0 `P0 `P0 `P0 `P P8 `P P8 `P@ `P P8 `P P8 `P PH `P00 `P+P ?P0H <P#PN0 `P+P ?P P#P@0 `POP  $  $                                   o G   h   s        o G   h   s        o G   h	   s     
   o G   h   s        o G   h   s        o G   h   s @ `P+P/>PD `P+P/>PD `P+P/"PD `P+P/&PD `P+P/PD `P+P/ PD P   8   8                                 s  0 `P: P   8   8                                 s  0 `P: P   h   h   ,                              s    G      I       s 0 `P'P4 `P0 `P'P4 P 8   8                                 s  0 `P: P   8   8                                 s  0 `P: P   0   0                              0 `P1 Q         |                             G   G      %         G   G   G                   s  #             o G   s     @ 	`P@ `P@0 `P+P* PI
P                     z          G   G      %         G   G   G                    G   G   G   G      x         G   G   G   G      E         G   G   G   G             o G   o    &   3  &      G   G   G   G	        .      G   G   G   G	      
       o          o G   
       o s        o G   
       o s        o G   
       o s        o G   
       o s        o G   
       o s    S    S            V      G      E   [      G   G      %   a      G   G   G      g   $   h      G   G   G      l          o G   s         o G        %   %s        o G   h   s z   0 `P@ `P6@ `P0 `P0 `P@ `P+P*,P@ `P0 `P0 `P+P8 `P+P -P#P4 `P+P $P#P4 `P+P &P#P4 `P+P 5P#P4 `P+P 2P#PN0 `PADF `P0 `P0 `P@" `P+P*>P4 `P+P >PD% `P*P/PIDP      T        
       O                o H         H   -            HG          D  	      G      o         G   G      O         G   G   G      *            G   G   G   H   "   K   #         G   G   G   HG        G   G   G     p   -         G   H   5   2         G   HG        G     "   6           G     7      G   	   7   :     
            o %   %%  9   ?     
      G   %   %   G   %   %%  F          o G         G   %   %  %   %s 6 `P*P:00 `P0 `P0 `P@ `P? `P0 `P@ `P0 `P0 `P@0 `P: `P@ `P0 `P P@0 `PK `P+P >P4 P        G                S                                           G   G      `   
      G   G      @         G   G                G   G                        >            o G	   s     G   G
   G      &      (      )       s    +       s -      G   G
   G      P   4      G   G
   G   G      &   <      G   G
   G   G   B   (   C          o G	   s  #   G          o G   s  K   7   K          o G   s      s      s  S   @ `P6 
`P0 `P@ `P5 `PK
 	`P0 `P+P* P4 `P0 `P'&PN0 `P'&PI `P0 `P+P*&PN0 `P+P*&P@0 `P+P* P4 `P: `POP  l   l   0                            |  }        h   I          s @ `P@ `PO	 `P*
P4P   8   8                                 s  0 `P: P   D   D                                 s      s  @ `P: `P:P L  L                                   d                   o G   s         o G   s         o G   s  Z             o G   s         o G   s         o G   s        0 `P00 `P+P*"P4 `P+P*&P4 `P+P*"P4 `P:0 `P+P*"P4 `P+P*&P4 `P+P*"P4 `PJP  t  t                                   u                   o G      s        o G      s        o G      s k             o G      s        o G      s        o G      s       0 `P00 `P+P &P4 `P+P P4 `P+P/	P4 `P:0 `P+P &P4 `P+P P4 `P+P/	P4 `PJP        g                3           |  }               o G   o  I      G   G      %         G   G   G	         -            G   G   G	   G
   I	         G   G      %          G   G   G      &   ,   '             o G   o  I   ,      |  }      h   I     h   I     h   I            s @ `P0 `P/P*?PI 
`P0 `P@	 `P0 `P/P*<PN `P0 `PO `PO `PO `P.P4P    <   <                                 s 0 `P'P4 P   8   8                                 s  0 `P: P   <   <                                 s 0 `P'P4 P       e                ^            s     G   G      @        G   G              |  }           G   G   G   I         G   G   G	   I	         G   G   G
   I
      G   G   G      (   &         G   G   G   I   +      G   G   G      3   2      G   G   G      8      :   7   ;         G   G   G   I         I   B      G   G      %   H      G   G   G      N   -   O         G   G   G   G   I   U      |  }      h   I     h   I     h   I            s    \       s  ^   @ `P: 	`P0 `P0 `P0 `P0 `P0 `P@
 `P0 `P@ `P0 `P0 `P@ `P0 `P@ `P0 `PO `PO `PO! `P.PN#0 `PO'P    <   <                                 s 0 `P'P4 P   8   8                                 s  0 `P: P   <   <                                 s 0 `P'P4 P         n                                   G   G                s  3   
      G      I   	    s  
    s     0 `P< 	`P0 `P@0 `P0 `P: `PO
P       5                V          G   G      %         G   G   G                    G   G   G   G      -         G   G   G   G      ]         G   G   G   G      -   "      G   G   G   G         '    '            *      G      E   /      G   G      %   5      G   G   G	      ;   $   <      G   G   G	      @       
   o G   o     _   F          o G   s         o G   s         o G      s '   R          o G   h   s V   0 `P@ `PF `P0 `P@	 `P0 `P@0 `PA8F `P0 `P0 `P@ `P+P*>P0 `P+P*!P4 `P+P*0P4 `P+P/.PN0 `P*P/PI8P      (               M                o H      G          o G   o    
         H   #            HG             G      o         G   G      O         G   G   G	      *   "         G   G   G	   H   )   2   *         G   G   G	   HG     ]   0         G	   H   '   5         G	   HG        8   
       o   :           =     >      ?   
       o   A          o G   s         o G   s         o G     s M   6 `P*P: `P P*?P>0 	`P0 `P@ `P? `P@
 `P0 `P@0 `P+PM 	`P0 `P+PM `P+P*!P4 `P+P*0P4 `P+P..PI P        \                5           G   G   G         G   G   G   G               o G	   
       o s        o G	   
       o s        o G	   
       o s        o G	   
       o s        o G	   
       o s        o G   h   s    G   G      #   1          o G   s  5   @ `P0 `P0 `P6000 `P+P -P#P4 `P+P $P#P4 `P+P &P#P4 `P+P 5P#P4 `P+P 2P#PD `P*P/PD; `P00 `P+P*!PI?P  d  d  s               s                o H      G      G   G   G   5  
         H   D            HG                  HG              G      o         G   G	      O         G   G	   G
      *   $         G   G	   G
   H   +   q   ,         G   G	   G
   HG         G   G	   G
            G   G	   G
   HG         <         G
   H   P   A         G
   HG         G
            G
   HG      $   H            G
      I            L      M      N          o    P      G      :   S                   o %   %%   ;   X            G   %   %   G   %   %%   _          o G   s         o G   s         o G   s         o G      s        o G      s s   6 `P*PJ `P@ `P0 `P0 `P; `P@ `P? `P0 `P0 `P@ `P0 `P0 `P? `P@0 `P; `P@ `P0 `P+PN `P0 `P P@"0 `PL% `P+P*!P4 `P+P*0P4 `P+P*P4 `P+P/.P4 `P+P/)PI+ P    |   |   =                                 o G   h   s        o G   h   s @ `P+P/(PD `P+P/%PDP   8   8                                 s  0 `P: P   0   0                              0 `P1 Q       9                 /           G   G      %         G   G   G                      o G      	   s        o G
   s     G   G   G   G      +         G   G   G   G   G   $      %       s  #   '          o G   s  +   #   +          o G   s  /   @ 	`P@ `P+P *P4 `P+P**PD `P0 `P@0 `P+P*&P@0 `P+P*%PIP                                     G   G      O         G   G   G      *         G   G   G   G         L             G   G   G     o           o G	      s    @ 	`P0 `P P8 `P+P.%PIP      '                &                                           G   G      `   
      G   G      @         G   G                G   G                        (             o G	   s  -              o G
   s      s  &   @ `P6 
`P0 `P@ `P5 `PK
 	`P0 `P+P*%PN0 `P+P*%P4 `POP   |   |   =                                 o G   h   s        o G   h   s 0 `P+P/8PD `P+P/<PDP    X   X   $                                  o G      s 6 `P*P/P4 P    X   X   %                                  o G      s 6 `P*P P4 P                                       V                   o G      s        o G      s L   
          o G      s        o G      s       0 `P00 `P+P (P4 `P+P/	P4 `P:0 `P+P (P4 `P+P/	P4 `PJP      O                ,           |  }           I             o G   o  I             o G   o  I	          
   o G      o I      G   G      %         G   G   G         -            G   G   G   G   I   %      |  }      h   I     h   I     h   I            s @ `P@ `P? `P/P*AP9 `P/P*AP9 `P/P/(PI	 
`P0 `P@ `P0 `PO `PO `PO `P.	P4P  <   <                                 s 0 `P'P4 P   8   8                                 s  0 `P: P   <   <                                 s 0 `P'P4 P       f                3            s     G   G      A        |  }           G   G   G   I         G   G   G	   I	          
   o G      o I      G   G      %         G   G   G      %   -   &         G   G   G   G   I   ,      |  }      h   I     h   I     h   I            s 3   @ `P: 	`P0 `P0 `P0 `P0 `P/P/(PI	 `P0 `P@ `P0 `PO `PO `PO `P.PIP   <   <                                 s 0 `P'P4 P   8   8                                 s  0 `P: P   <   <                                 s 0 `P'P4 P       C                 7            s     G   G               s     G   G            	      G   G
   G   G   I   	      G   G            P         G   G       I      G   G
      %   '      G   G
   G      -   .   .   	      G   G
   G   G   I   5       s  7   @ `P: 	`P0 `PJ `P@ `P0 `P@ `P0 `P@ `POP H  H                                   o G      s        o G   s         o G   h   s        o G	   h
   s        o G   h   s        o G	   h   s        o G   h   s 0 `P+P/ P4 `P+P* PD `P+P/)PD	 `P+P/)PD `P+P/(PD `P+P/(PD `P+P/&PDP    l   l   .                                         o s     s 6 `P &P#P4 `P''P4 P  X   X   #                                         o s 6 `P %P#P4 P l   l   .                                         o s     s 6 `P &P#P4 `P''P4 P  X   X   #                                         o s 6 `P %P#P4 P 8   8                                 s  0 `P: P                       r     $               G   G                G   G   H   
                      %v +                                                       G               G   G	      W         G   G
   4                o G         s "   #   "          o G   s  &      G         *      G   G	   -   W   .      G   G
   4   1             o G         s 5   <   5          o G   s         o G   s  =      G         A      G   G	   D   W   E      G   G
   4   H             o G         s L   #   L          o G   s  P      G         T      G   G	   W   W   X      G   G
   4   [             o G         s _   #   _          o G   s  c      G         g      G   G	   j   W   k      G   G
   4   n             o G         s r   #   r          o G   s  v      G         z      G   G	   }   W   ~      G   G
   4                 o G         s    #          !   o G   s        G"               G"   G	      W         G"   G
   4             #   o G         s    #          $   o G   s        G%               G%   G	      W         G%   G
   4             &   o G         s    #          '   o G   s        G(               G(   G	      W         G(   G
   4             )   o G         s    #          *   o G   s        G+               G+   G	      a         G+   G
   4             ,   o G         s    -    s  <          .   o G   s      /   o G   s        G0               G0   G	      W         G0   G
   4             1   o G         s    #          2   o G   s        G3               G3   G	              G3   G
                4   o G         s     5   o G         s     6   o G         s     7   o G         s     8   o G         s     9   o G         s   #         :   o G   s       G;              G;   G	     W        G;   G
   4             <   o G         s $  #   $      =   o G   s  (     G>         ,     G>   G	   /  W   0     G>   G
   4   3         ?   o G         s 7  #   7      @   o G   s  ;     GA         ?     GA   G	   B  W   C     GA   G
   4   F         B   o G         s J  #   J      C   o G   s  N     GD         R     GD   T  M   U      E   o G   s      F      %G   %o G   s  -   _      H   o G         s c     G   G   G	      i     G
   k     l     l     -   n      I   o G   	   J   s r  > `P7 `P7 `P01 `P P0 ; `PM
 `P0 `PA  F `P0 `P0 `P7 `P+P 'P@0 `P+P*'PI `P0 `P0 `P7 `P+P *P@0 `P+P**P4 `P+P*2PI# `P0 `P0 `P7 `P+P &P@(0 `P+P*&PI- `P0 `P0 `P7 `P+P 'P@20 `P+P*'PI7 `P0 `P0 `P7 `P+P #P@<0 `P+P*#PIA `P0 `P0 `P7 `P+P 'P@F0 `P+P*'PIK `P0 `P0 `P7 `P+P *P@P0 `P+P**PIU `P0 `P0 `P7 `P+P &P@Z0 `P+P*&PI_ `P0 `P0 `P7 `P+P "P@d0 `P+P*"PIi `P0 `P0 `P7 `P+P "PIo `P00 `P+P*"P4 `P+P*'PIv `P0 `P0 `P7 `P+P 5P@{0 `P+P*5P9000 `P0 `P0 `P7 `P+P +P4 `P+P (P4 `P+P 1P4 `P+P 2P4 `P+P :P4 `P+P 0P000 `P+P*+P9000 `P0 `P0 `P7 `P+P -P000 `P+P*-P90 `P0 `P0 `P7 `P+P -P000 `P+P*-P90 `P0 `P0 `P7 `P+P -P000 `P+P*-P9000 `P0 `P+P**P4 `P P*:P>000 `P+P *P900 `P0 `P<000 `P0 `P+P )P90P                       g   $                       T      $    	               %v ?,                                                       |           }                               	    o           [   \]     
   
      
   H         H               HG      H           HG      H   J   %             %   %o G         HG      Hs    .         HG      G   G   G   H   Y   8             %   %o G         HG      G   G   G   Hs T   E             %   %o G         HG      G   G   G   Hs R      .'   BT   ^> `P71 `P P@ ; `PM `P0 `PAF `P0 `P7 `P0 `P&PN `P0 `P0 `P0 `P0 `P P 6PN `P0 `P P 6PN0 `P P 6PI `PO LP         G                 $                  &                 +                                          %   %o G   h   s          %   %o G   h   s          %	   %o G   h
   s          %   %o G   h   s          %   %o G   h   s     s     I      I      I   0 `P0 `PAF `P P/APD `P P/EPD `P P/EPD `P P/BPD `P P/>PD `PJ `P< `P< `P<P   X   X   $                                  o G      s 6 `P*P/P4 P    X   X   $                                  o G      s 6 `P*P/P4 P    X   X   %                                  o G      s 6 `P*P P4 P  X   X   %                                  o G      s 6 `P*P P4 P  X   X   %                                  o G      s 6 `P*P P4 P  (  (                                                     9             o G      o    
      
      (             o G   s  #             o G   s     @ `P6 `P0 `P0 `P+P/'P? `PK	 `P0 `P+P*'P>0 `P+P*'PIP      	                                       U                G      o H       G      s 
      
    G   o     R       G        G   	   o o s     G      o K$          G      o K         0 	`P00 `P !P0 `P/PI `PJ0 `P*P0 `P (P#P#P4 `P !P00 `P !PK `PJP  \  \                                                     9             o G      o    
      
      N                     s           o G   s  #             o G   s     0 `P6 `P0 `P0 `P+P/*P? `PK `P0 `P0 `P,,PI `P+P**P>0 `P+P**PIP  x  8  )                [      $ 	   
               %   %v ,                                            	          o G   o  G	   2          
   o G      o G   s                                 o           |        }       [    \]   !               H          o G   o        G   s     G      G             %   o    G      Ho s        o G      s =9   ^   G   G   [<   \]   =            G   G      H      G      F          o G   o        G   s     G      G             o    G      G   G    !   o o s        o G      s [   [   ^[   > `P71 `P P0 ; `PM `P0 `P+P*)P0 `P+P/,P*PI `P0 `P&PN `P0 `P0 `P0 `P+P*2P9 `P,P4 `P P P#P4 `P+P/)PD L `P0 `P0 `P0 `P+P*2P9 `P,P4 `P P jP#P#P4 `P+P/)PI @!P x  H     M                 *         E           #         c	                      $ 
           (                                         o G         %   %s        o G   s     	    
      %   %v ,                              >            (                  G      (             o G   s  n   "          o G   s         o G         G      +         +      +   s ,      	    
      %   %v ,         0            0         U   2         ?   4         )   6         8      G   :      ;          o G   s         o G   s         o G         G      H         H      H   s        o G         G      N         N      N   s <   O          o G   s         o G   s  W      	    
      %   %v -         [             [            ^      _   (   `       !   o G   s  P   d       !   o G   s      !   o G"   #   o G#   h$   s n      	    
      %%   %v -         r    &        r         K   t       '   o G   s      (   o G         s    |         ~      G      s          '   o G   s      (   o G         G                        s #          '   o G   s        	    
      %)   %v --             *                 d          +   o G   s      ,   o G   s      -   o G         s                   G                +   o G   s      ,   o G   s      -   o G         G                        s <          +   o G   s      ,   o G   s     .          s 	    /   v B-           (                  G      (          0   o G1   s        2          s     	  	    
      %3   %v L-   	          4      	      	     #       	         	     M          5   o G   s            %6   %o G   s  H          5   o G   s            %6   %o G   s     > `P0 `PAuF `P+P  P4 `P+P* PD	 `P71 `P P0 ; `PM `P 40 `P+P*'P>0 `P+P*'P4 `P+P 'PI `P71 `P P0 ; `PM `P0 `P+P**P4 `P+P*2P4 `P+P *P4 `P+P 2P>0 `P+P**P4 `P+P*2PI( `P71 `P P0 ; `PM. `P0 `P+P*)P>0 `P+P*)P4 `P+P/)P/PI8 `P71 `P P0 ; `PM> `P0 `P+P*"P4 `P+P "P> `P0 `P+P*"P4 `P+P "P>0 `P+P*"PII `P71 `P P0 ; `PMO `P0 `P+P*"P4 `P+P*'P4 `P+P "P> `P0 `P+P*"P4 `P+P*'P4 `P+P "P>0 `P+P*"P4 `P+P*'PI] `P 'PD` `P0 `P )0 `P+P*#P>0 `P !PIh `P71 `P P0 ; `PMn `P ?0 `P+P**P4 `P P*:P>0 `P+P**P4 `P P*:PIuP    h                            &        *   +     4                   *             *             *             *             *           P  *   L   L                                          s 0 `P *P4 P        C                      $                v ]-                                                       |  }           I                               o            	   o G
             o s        o G
             o s N `P71 `P+	P@ ; `PM	 `P0 `PAF `P0 `P0 `P0 `P&PN `P+P 'P#P4 `P+P )P#P4P          A                        	                                       U                G      o H       G      s 
      
    G   o     R       G        G   	   o o s     G      o K$          G      o K         0 	`P00 `P !P0 `P/PI `PJ0 `P*P0 `P (P#P#P4 `P !P00 `P !PK `PJP  \  \                               G   4             o G            o s 
      G   4          	   o G       
     o s           o G            o s        o G            o s 0 `P0 `P+P -P#PI `P0 `P+P ,P#PI `P+P :P#P4 `P+P 9P#P4P                                  |  }                                      I             o G   o  I             o G   o  I	          
   o G   o  I             o G   o  I             o G   o  I             o G   o  I         G   '   *          o G   o     .      .   I         G   '   3          o G   o     7      7   I             o G   o  I             o G   o  I             o G   o  I             o G   o  I              o G   o  I!          "   o G   o  I#          $   o G   o  I%          &   o G'   (   o '   `       &   o G   o  X   d       )   o G'   (   o '   i       )   o G   o     m      m   I*          +   o G   o  I,          -   o G   o  I.          /   o G   o  '   ~       /   o G   o              I0          1   o G   o     '          1   o G   o              I2          3   o G   o     '          3   o G   o              I4          5   o G   o     '          5   o G   o              I6          7   o G   o     '          7   o G   o              I8          9   o G'   (   o I:      G;   G<      %         G;   G<   G=         -            G;   G<   G=   G>   I=         0 `P0 `P0 `PD(F `P= `P/P*"P9 `P/P*%P9 `P/P*-P9 `P/P*!P9 `P/P*"P9 `P/P*P9 `P ?P**P0 `P =P*)P0 `P/ P*0P9 `P/P*&P9 `P/P*#P9 `P/P*,P9 `P/P*-P9 `P/#P*5P9 `P/P*+P9 `P/P/ P P* P P/ P P* P0 `P/P*"P9 `P/P*%P9 `P/P*!P P*!P@ `P/P*(P P*(P0 `P/P*(P P*(P0 `P/P*(P P*(P@! `P/P*%P P*%P@# `P/P/,P9 `P0 `P@' `P4Q                                                v -                                          v -                                   > `P0 `P0 `PE	F `P0 `P0 `PE	V    |   |   =                                 o G   h   s        o G   h   s 0 `P+P/PD `P+P/ PDP    8   8                                 s  0 `P: P   <   <                                 s 0 `P)P4 P       K                  	               o G      o (             o G      s 	   0 `P+P/
P= `P+P/	PIP   h   h   /                             G   G      %I       h   s @ `P7 `PKC PDP l   l   /                             G   G      %I       h   s 0 `PG `PKC PD P         t                                 o G      o (             o G      s 	      G   6      9	   I
       s  0 `P+P/	P= `P+P/	PI `P? @ `P: P t   t   ;                                o G      o            I      @ `P+P/
P= `P@P                                      G   G            G   G   G      7   	          o G      G   G   G   s           o G   h   s @ `P0 `P+P PI `P+P/PDP   t  t                   "           G      o           o G          o G   o  o G         o G	   
      o G	         s    G   G      s    G   s     G      s    G   G      s        o G   s  0 `P 	P8 `P*P P*P#P:*P:*P:*P4 `P P4 `P+P4 `P 	P4 `P P4 `P+P*"P4 P                                                         /         G   G         	      	          o              G   s          G   s     0 `P6 `P0 `P@ 
`P0 `PK	 `P+P8 `P> `P+P>0 `P+PIP   ,  ,                                          %  %o G   s            % %o G   s                %  %o G      s          % %o G	      s     
   o G   s  0 `P: `P P*%P4 `P P*%P4 `P: `P P/)P4 `P P/)P4 `P+P*"P4P    @   @                                    %s 0 `P.P4P  @   @                                    &s 0 `P.P4P                      !            o        6      9      G   G   G   9	   6
      9   9      9   h   9             s    G      s w         |  }         I      |  }         I         s    G          s !   0 `P0 `P5 : 0 5 O : O `P*P4 `P PN0 `P0 `P? `P0 `P? `P*P4 `P PIP   h   h   ,                             G   6      9   I       s   0 `P? @ `P: `P1 Q   P   P                                    o G   h   s 0 `P+P/&PDP  8   8                                 s  0 `P: P       @                                        |     %   %     }      G      o       |     %   %     }      G        o       |     %   %     }      G        o    V         |     %   %  %   %     }      G        o          00 `P80 `P00 `P 	P8 `P  P8 `P 	P8 `P  P8 `P 	P8 `P  P@0 `P 	P8 `P  PM `P4Q  
  
                           G                G   G      
   K                   |  }  
     G   G        G      E         G   G      %         G   G   G      !     "   	   	   $   	      G   G   G   G
   r  ,      G   G   G   	   H           %o G   o              :      ;      <         <          G         @     G   G     B               o           G         H     G   G     J               o           G         P     G   G      T     U      |      G   G   G   o       G   G   o %    
  G   o  <)o %)  }         o      G            o   G     G         G     o   G         G      o   G!   H  G"     G!   H  G!   G#   o
          $        o           G              G   G%                 |      G   G%   G   o       G   G   o %    
  G   o  <)o %)  }         o      G            o   G     G         G     o   G         G      o   G!   H  G"     G!   H  G!   G#   o
          &        o           G'      4     (   G)     G'   G   *o     G'   G     )&<*      *       o       +       o   	    G'   G,      D        G'   G,   G   	      -     	  o   !          .     o         G             	  o          /        o           G'      ?        G'   G0               G'   G0   G      &     (   G)     G'   G0   G   *o   (   G)     G'   G0   G     )&<*o     G'   G0   G     )&  <)&      *       o       +       o       1       o      G       2     o             o         3        o             %o G      s 	   	   .'	   n  0@ `P00 `P: `P:0000 `P0 "`P@ `P00 `P,fP00 `P0 `P P*+P8 `P0 `PO `P: `P00 `P@ `P PH  `P: `P00 `P@% `P PH( `P: `P00 `P P ?P XP&P,|P8 `P*P8 `P P aP KP LPM/ `P PH2 `P: `P00 `P P =P XP&P,~P8 `P*P8 `P P aP KP LPM9 `P PH; `P: `P00 `P P8 `P0 `P P8 `P P8 `P6 	`P00 `P0 `P P@I0 `P/PML `P 	PMN `P PHP `P: `P00 `P P8 `P P8 `P@W `P P8 `P P8 `P PH[ `P P PM] `P PH_ `P P.*PD E`P@cP 
              l  l                  >                                           G   G         
      G   G      `         G   G      @         G   G                G   G   	                        !   
      $       s  &          o G   s         o G   s         o G      s _   2          o G   s         o G      s        o G      s >   @ `P6 `P0 `P@ 
`P0 `PK
 `P0 `P00 `PO `P+P*P4 `P+P*P4 `P+P/PN0 `P+P*P4 `P+P/P4 `P+P/PIP       N                            |  }        h   I      h   I      h   I          s 00 `P0 `P? `P? `PO `P*P4P    (   (                                    4   4                                 s   `P*$P (   (                                          M                             G   G      (             o G      s 
       s  00 `P00 `P+P/PI `P:P   3  `$                `$                 !  "  #  $  %  &  '   )  *  +  ,    -  .  /    `$  0  1  2      `    ?  $      @      `$      4  5  6  9  V  /     :  ;  <  =    >    pA  B  C    @  +  D      E  F  G  H  I  J  K  L  M  N  O  P  Q  R  S  T  U  V  W  X  Y  Z  [  \  ]  ^  _    ``  a  b  c  d  e  f  g  h  i  j  k  l  m  n  o  p  q  r  s  t  u  v  w  x  y    $  2  z  {    `$      |    }    ~  	  `$          
  `=  &    `      o               :  /  I  $               )                &      k   
  p        ;  ?  &    p     5  6    `  $      1      z     o         `  $        -  7   o   @              1              k       p  `$             o   @                C      ;        ~                                                       k     p1              K              Q               )      `$       k     p  `$             o   @            `$       k     p  `  $      @          4  5  6               k     p      p        `$              `            $                "  $                            `             $      `     $      `                     	  
    $      `       "      $      `       "          $                 `          $      `       "  $          $      `       "  $          $      `      $      `              C          K " ! $ # & % ' (     * ) , + . - 0 / 2 1 4 3 6 5 8 7 : 9 < ; > = ? A @ C B D F E "  G $  H J I M L O N         $      `  Q     $    R "  $              H      `  T     $    R "  U         H       `  W     $    R "  U         H    !  `      "  $  ' ( Y     $    "  `  [     "  $  ' (     $    #  `  ]     "  $  ' (     $    $  `    _   "  $    R U     %  `  a     "  b $  $    R H  U   &  `  d     "  $  $    R H  U   '  `  f     "      $    (  `  h     "      $    )  `  j     "  k     $    *  `  m     "  o n     $    +  `  q     "      $    ,  `  s            @  $    -  `  u     " ! $ # & % ' ( * ) , + . - 0 / 2 1 4 3 6 5 8 7 : 9 < ; > =     $      v         .  `x   $    /  `    z   $    0  `  |     "  & % ' (     $    1  `  ~         $    2  `           $    3  `         $    5  `$      &   4  `$       a  k   6  p7  ` 8  ` 9  ` 6  `$          "   $          8  p 9  p :  p   :  `       "    $  H  $    ;  `       "   $  U   $    <  `       "  $  H  U $    >  `$       o     @        @  `$    #  ?  `$       o     @       k   A  pC  ` B  `$    #    D  pA  `$       o     @       k   C  pF  `$       o     @     #  &   E  `$        k   G  pD  `$       k   F  pG  `$    H  `$  1  =  `  $      @          k   ?  p  @  p B  p E  p     C  +  D     C               K   	                      H  p  I  p     &     J  `$           o     @     I  `o     $      @          k   K  pM  `$    L  `$       k   N  p  o     @    K  `o     $      @           k   M  pO  `$         o     @    N  `o     $      @            k   P  pQ  `$         o     @    P  `o     $      @           k   R  pR  `o     +  ,       $    @      S  `o     +  ,     $    @  U  ` T  `      5   V  p V  `      5     X  ` W  `  Y  p     Y  `  $           Z  `$        @         [  `$      R      \  `                                   Q      B     V      ]  `  !  
 %   ^  `          w  $     _  `  $  #  	   
  ,             1  o   a  `  P o     $  &     Q     _  `  `+    ,  $  #      &    1     *  k   b  p       !  " # b  `$ +  D    & ' ( ) $    *    * + , - ,  #    .  /  0 v 1   2 &  '  3 d  `  $  #  6 &  '   )  c  `$  #  6 7 e  pe  `$        9 : ; f  `$      @       O   1  P  I Q R h  `  $      S   T 5  6  U g  `$          @     ?  z  p r i  `$      W Y j  `$      Z W 1    [ l  `$  !  o   k  `$  \ k     pm  `$    ^ _ o  `] p  `a q  `] n  `  $  ` !      p   p   p r  `  $              ` !    _  s  `$     f Y t  `$      j f 1    k   l m   n v  `$  !  o   u  `$  o k     px  `p w  `    p  y  `  _  z  `$  b &  r d   ^ _ |  `q }  `v ~  `q {  `  $      "    s !  $  t  u        p   p   p    `  $        _    `$  m  w    1      `$        k x y    z { | Y }    ~                      z     o     `$           `$  !           ;  .  @  /       `$    *    +  ,    Y E           1        o          	      @    Q    P       #      k     p    p        K     `$        `$    *    +  ,  %   )    `$    E         *  +          `}       `    +   $          `$            0               !  "         1      `  $              ' (      `$  #  !  o     `$    ^ _   `   `   `   `  $     !  "  #  $  %   )                                    p   p   p     `  $            "     !    _      S 5  6  U   `$   1      `_    `   `   `   `  p    `$      @         `   `   `   `  8 $          @      9     @   3    p   p   p   p    @     p  p  p   `$      )    `  $    )    ,          @         6       `    	 $    )                }      `   `,          p7   p&  '  2     1    6       `  $            5  6  _    `$  #    7           `  $      1    &  '    `$         ,   1  Y 	        "      	 
      k                   `$      S      C     @  o       Q R            7 ! =  "  1      `P Q R S G   `$  &    k   `$           $     o   	  %   1  9 & '     (    )   * &    + ,  #  "  -  . / H  0  1 
 2  3  4 5 6 7 8    K                  Q         : ; <           = > ? @  A B C D  E  F  G O k     pT U W X Y   Z       )   !  S ]   a 
  b c d e  f g  h i j   pl m n    `$           "        }     `$   &  r   ^ _   `o   `r   `o   `  $        "       p q   p   p   p    `$      s   }  ~    _     `$         H     @        v M   w    x )  y   z   o     `$        6 { |                      V    Q                8   o     `   `        5     p   `     5      `     $        A             w  D      q -    `   `$    w               5     p   `$  F   -        5     `       $  F    p     `$      k         1    o     `   `        $    ) + A 5     p   `     5      `   A   w  $          ,   m   `5  $    )   6    `$     1    `$   1      k            `$  !  o     `$   k     p  `$   &  r    ^ _   `   `   `   `  $      "     !  $            p   p   p    `  $         e    `$         ,    f  e    `$    w    1      `$        k  y     { | Y                           z     o     `$    e    1   Y   ` $   1        e      `$        e       o     &   #    `$    ^ _   `   `   `   `  $      "         p  p 	 p e   `  $           `$         ,    g  e    `$      Y          ` $   1              `$   1          `      `     $   1  h      `h   $   1      `$   1       `$        @      M   w   x   `$         H  k   " p   o     `$  !  o     `$   k   $ p   -    `$     -      `   `   `   `  $      "     !  k     ' p ( p ) p i   `$    ^ _   `  $                     `$         R  !    &            b    M            `$  !  o     `$   k   . p      `   `   `   `  $      "     R b o     0 p 1 p 2 p l   `  $           `   `   `   `  $      "        5 p 6 p 7 p p   `  $            `   `   `   `  $      "        : p ; p < p g   `  $            `$         ,    h  e    `$    " 0 1    Y   `$   1    1   `$  !  o     `$  2 k   Y p 	 ' (  `	 ' $  3 !   4 ( 5 6 7 8 9 :  `  	 &    !  o      `$  ;  w 1     `>  `?  `>  `  $  < !  "  = & 	 ' 
 o   (            " ^ p _ p ` p { 	 `  $        $ u   
 `$  @ &  r   ^ _  `$   1        " # A B     C Y D   E _   `F $  G 1    E  `$  H Y  `$  &   R  M _    O o      `$  &    R  M _   `$  L   1  &   R  M _     N k   h p   i p  `$        " A I k   g p `  $      @    E F  `P  `Q  `P  `  $            l p m p n p }  `P  `Q  `P  `  $            p p q p r p   `  $        c  $  `$  &    S !   `P  `T   `P  `  $  R k   u p          v p w p x p  ! `  $        U   " $  , $ " `$  V &  r   ^ _ # `$  W  X $ `$        " W 1    Y  Z [ & `$   &  R  M _  ( `$        ' `$  &    R  M _  k    p) `$  &    R  M _  * `$  !      " A + `$  !      " ` % `$        " ] I ^   1  &   R  M _     _ k   ~ p  p    pA `  p p  / , `$  a Y . `  O $  !  o     - `$  b k    p0 `$  !  o   d 2 `$  &  r 1   !    1 `$  !      k    p/ `  $  . k    p p3 `$  g &  r   ^ _ 5 `$  &    !  6 `$  &    S !  7 `f 8 `j 9 `f 4 `  $  h k    pi  p           p  p  p y : `  $        i  v  ; `$   1    k < `$  l   = `$  l   o   > `$     ? `$        1    Z } | y e  @ `$        1          X A ` $   1  Z    B ` $   1  Z    D `   C `$          @     ~          1     o       " ,     !     $    Y    (   n  q m  *    ,        .            k    p          v   &  '      E `$   !  o       m ' ( F `  m &    !  o     G `$    w  1    H `m ' $   !    (       J ` I `  8 : <   $           ~        k    p        	   @      M `$  &   R  M _     N `$  &    R  M _  !    r L `   $     1  &   R  M _     N k    p    p      Y  K `$   1               k    pO `$   1   Y P `$    Y Q `$   &  r   ^ _ S ` T ` U ` R `  $   !  "  $  &  *  ,  .  0  2  4  6 m ' n o   ( q  8  :  <           3  )     p  p  p t V `  $        i  X `$  &    !  Y ` Z ` [ ` W `  $   k    p           p  p  p w \ `  $        i  ] `$       ^ _ 1  _ ` ` ` a ` ^ `  $             p  p  p           t  i  b `    $         d ` e ` f ` c `   p  p  p  g `  h `$    R   "     !     1       i `$       1    Y k `$        @    o   M   w    x )  y            "  >   j `$               	 
         @        k    pl `$        "   !     1           n ` o ` p ` m `  $   !  "     $   H   p  p  p  r ` s ` t ` q `  $   !  "     $    R U    w      p  p  p  v ` w ` x ` u `  $   !  "   H   $   p  p  p  y `$          "  i      r    s  c       z `  $          "  i   e    { `$    &  r   ^ _ | `$               !  y       " 1        # $ &  r %  & ~ `$     !    (   @     v    '   } `$           @   !  o    1  '   k    p `-  `$        , *  +  ,   W     p. Y +  `$    *    +   /    `$        0   1 + 1     `$  ) &  r   ^ _  `2  `4  `2  `  $  3  )               p  p  p   `$        5      5 6    _   `2  `6  `2  `  $  ` !      p  p  p  `  $              ` !    *  `?  `$        C  I    >  1  K   J K 7  p     L Y *  +  ,   M N = E      &   P    Q R S    T U V W   @  X  o         B  C 	  Z [ \ ] ^ _ ` D  a  b @  ;    c  `$    *    +   d   e   `$        0   f     0 g C  = 1  h   ,  i   j k   l m n  `_   `   p   `$  8 &  r ;   ^ _  `o  `r  `o  `p C  $  q  )  F    p  p  p    `$           !      "  #  $  %  &  '  q  )   s .     `$      )   `  $    )    ,          @         `    	 $  t  )    u            }      `  `,         p7  p    1    `_   `   p   `~  `$          I    }  1  K   J K 7 ( p     L Y N {   `g   $  { 1  |   l m n  `_   `$  v &  r x   ^ _  `  `  `  `p     - p . p / p    `  $          `$             ,   Y         |  `$          "     $  p    ,  o         !  #         &   | 1  {    _   `$     o       &   #   `c  w  m   `  `$          I      1  K   J K 7 = pN  Y   `g   $   1     l m n  `_   `$   &  r    ^ _  `  `  `  `p     B p C p D p    `  $          `$   1      `c  w  n   `  `$          I      1  K   J K 7 N pN  Y  `g   $   1    l m  `_   `$   &  r    ^ _  `  `  `  `p     S p T p U p    `  $        _   `c  w  j   `  `$          I      1  K   J K 7 ^ p    !  "  #  $  N  Y  `g   $   1    l m  `_   `$   &  r    ^ _  `  `  `  `p     c p d p e p    `  $        _   `c  w  k   `  `$                H  I      1  K   J K 7 } p ,       Y         !  "  #  $  N     `g   $   1                l  m n  `_   `$   &  r    ^ _  `  `  `  `p      p  p  p    `  $           `$          "     $  p    ,  o      &  '   Y   !   '   (      #   1                `$  !  o    `$  &  '   `$   k    p  p   o      ' ( Y  `$    w 1     ` ' $   !    (        `  $   1             w   `$   &  r    ^ _  `  `  `  `  $    )      !  "  #  $   Y  o   '  (             p  p  p      ,     X  [  `  $        _   `c  w  o   `   &    !  o      `  `  `  `  $    R "           p  p  p c  `$        r  _     `$  	 !    R   &    
   o     5  6   `$            Y   `$        @    o   M   w    x )  y             `$          H  R U                    @     1               k    p `$             R      r  !  U    "    1        #   o     `$  `   p   `$      R     _   `%  `   p   `$      R   r      `$   &  r        ^ _  `  `&  `  `  $   !  H            R "   p  p  p S  `  $         1     `$     !    (   @     v    #     `$          H  R U     @   !  o    1  #   k    p `$      R H      ( @    o    v M   w    x )  y      ) #   *  `$      @           '    (     k    p     1    `  $   1    R      ,   -   .   U      Y      / 0 1   2            `  `+  `  `$    R     "     p  p  p   ^ _  
 `! 	 `$      ,   3   .   4 1  5    6   1      5    p  `$  3 1  .     4   1    5    `$        7   1 R    + 5  8 6      `7 + $      1 }      `9  `$      1          5    p  `$  :   -    1    5    `  1               w  $  .    ; <    =   `Q  `$           S    T H  I    P  1  K   J K 7  p ,  U V    Y  W X L     !  "  #  $  N N O Y  `g   $  N 1         S    T   l O m n  `_   `$  G &  r I   ^ _  `Z  `[  `Z  `p      p  p  p    `  $         \  `$          "  ]   $  p    ,  o   ^  _ &  '   ' > E !  ` ( F a Y B b    #  O 1  N    S    T c D K d  `$  !  o    `$  &  '   `$  e k    pf  pg   o   h  > ' ( Y   `$  i  w 1    ! `> ' $  j !   k ( l m n o p q " `  $  V 1    X   L      w D # `$  K &  r L   ^ _ % `r & `s ' `r $ `  $  A  )  ?    !  "  #  $  > ' E o   ( F Y B            p  p  p      ,  t   X  ] ( `  $        _  ) `c  w  p  * `  > &    !  o     + `$            Y  - `$        @    o   M   w    x )  y   u         , `$          H  R U                    @     1         u      k    p. `$             R      s    U    "    1   w y       o    0 ` / `   p  1 `$      R     _  3 ` 2 `   p  4 `$      R   s     5 `$  w &  r y { | ~   ^ _ 7 ` 8 ` 9 ` 6 `  $  u !  H    R "           p  p  p V : `  $         1    ; `  $  Y &      R   !        b    M                < `$        s  _    > ` ? ` A ` @ `   p= `  $   !  b   R "           p  p  p ` C `$    u !    (   @     v       B `$          H  R U     @  u !  o    1     k    pE `$      R H      ( @    o    v M   w    x )  y           D `$      @           '         k    p    Y 1   F `$   1      R         U  ~   Y    1           K    d H ` I ` J ` G `$    R     "     p  p  p   ^ _  K `$           1 R     5  8 6  }   L `$           1 5  R 8 6    M `  $      1 }    z O ` N `$      1          5   $ p P `$     -    1    5   Q `  1               w  $        = } R `$           Y T `$        @    o   M   w    x )  y            S `$         H                    @        k   0 pU `$               1              W ` V `  3 p  X `  _  Y `$   1      Z `$   &  r    ^ _ \ ` ] ` ^ ` [ `  $   !  H            $   8 p 9 p : p P ` ` a ` b ` _ `  $        R   "                    < p = p > p   _  c `  $               _  e `$     !    (   @     v        d `$         H     @   !  o    1      k   A pg `$      R H      ( @    o    v M   w    x )  y            f `$      @          '         k   C p     1  h `$        K  &    z  +  ,    Y  i `$        K +      j `$        0     1     l `$  !  o   m `$  &  '  k `$   k   K p L pn `$   &  r   ^ _ p ` q ` r ` o `  K   $   !  M  O   )              O p P p Q p   t ` u ` v ` s `  $            "  $    )        S p T p U p   w `  $        _    S      "        x `$    D    }    y ` ,      "        "   Y $   ?   A    C   D   Y   (    	 * 
  ,        8   :   <     #    h i z `}    { `    8 : <    ,    $   	     @      } `$  !  o   ~ `$  !  o    `$  &  '   `$  &  '   `$  &  $ | `  $    k   ` p  a p! b p" c p# d p  ' ( Y  `$  	  w 1     `   &    !  o      `$  %  w    1     `}    &  `  $  ' y    ( { | Y        )         *        + z     o    `n    `  o   $    #  , 1  }    -  `    ,         "   /  `     0 &  `1  7 j p2  `  3  ` 	    4 Y  5  `   `}   6  `    +   $  7    8   `   &    !  o      ` ' $   !   9 (  : ; < = >  `      $  ? !  "  @ $  A J B " C $ D &  '  o   (  E * F , G . H 0 I 2 J 4 K 6 L  )  M ? N A O C P D Q 8 R : S < T > U            `}   V   W  `$    ] _ ^  `$    ] _ ^     @a        `5  6   `   v p `5  6   _   u p `$    ] _ ^   `    h $    f &  i  j k l m      n o   p z   `$    d e f   7 y p `$      q s 1     `w $  #    1  y      p  `[  `[  `$    	  @        `8   @    $      9     @~   3  \   p  b       `o     %  g  R      `$      0 o     @    P       "     $    K  W X                 Q                      = > ?  A w     `$    0       0   f        2    z  {   ` `  ` `   p  p  p   `$        2  z  {    `    $             `=   `= N  `=   `=   `=   `=   `= ]  `= U  `= F  `= H  `=   `=   `=   `= Q  `=   `=   `$  < 7 h  p> i  p? j  p@ k  pA l  pB m  pC n  pD o  pE p  pG q  pI r  pJ s  pK t  pL u  pM v  pN w  p ` `X  `$  V 7 |  pW   }  p `c  `e  ` `h  `h  `$  b 7   pd   pf     pg   pi   p `  `  `   `   `   `   `   `   ` 	  `   `.   `$   7   p   p   p   p   p   p   p   p   p   p     p `   ` `$   7   p     p `  `  ` `  `  `  `$   7   p   p     p   p   p   p `  `  ` `  `$   7   p   p     p  p `  `  `   i   `  `  i   `  `  `   i   ` ` ` i   `i    ` i   `$     p 7  p  p  p  p  p  p  p    p  p  p  p  p `  $    `  $   `  $    `  $   ` ` ` ` `u  c   `  `  `  ` $      `v  i   `c  u   `   ` $      " #   Y $ u    `&  `$ u   `v  i   `*  `c  ,  `$  
  @ p A p B pC p   D p E p F p G p 7 H p I p J p K p L p M p N p O p! P p% Q p' R p( S p) T p+ U p `o  $  p  `o  $   `o  $  p 	 `o  $  
 `_   `i   `u  `i   `x  ` `i   `| } p  `} |  ` i   `p  `  `$  n   p  pq  p pr 7  ps  pt  pv  pw  py    pz  p{  p~  p  p  p  p `   `   ` `  c   `    `    `$        "  i  c     `  `$    R     w   !  o     `$     p  p    p 7  p  p  p  p  p  p! `* " `  `$  ) 7  p+    p$ `: % `< & `' `? ( `A  ) `A  * `A  + `A 	 , `F $  &   - `H $  &   # `$  8    9 7  p;  p=    p>  p@ 	 pB 
 pC  pD  pE  pG  p/ `w 0 `y 1 `_  2 `3 `4 `~ . `$  v 7 ! px " pz # p{   $ p| % p} & p6 ` 7 ` 8 `_  9 `: `; ` 5 `$   7 6 p 7 p 8 p   9 p : p ; p= ` > ` ? `@ ` < `$   7 I p J p   K p L pB ` C ` D `E ` A `$   7 Y p Z p   [ p \ pG ` $   )    H ` $   )    I `  $   J `  $  K `  $  L `  $   M `  $  N `  $  O `  $   P `  $  Q `  $  R ` S ` T `_  U ` V `W `X ` Y ` F `$    i p j p  k p l pm p n po pp p q pr ps p 7 t p u p v p w p   x p y p z p { p[ `  \ `  ] ` ^ ` _ ` ` ` a ` b `c `d ` Z `$     p  p 7  p  p  p  p   p    p  p  pf `@ $   )    g `@ $   )    h `C  $  D i `C  $  j `C  $  k `C  $  D l `C  $  m `C  $  n `C  $  D o `C  $  p `C  $  q `H r `J s `_  t `M u `v `w `Q x `D e `$  ?   pA  pB   p  p pE  p p pF  p p pG 7  pI  pK  pL  pN    pO  pP  pR  pz ` v { ` v | `x } `z ~ `v  `}  `  ` ` ` y `$  u   p  pw 7  py  p{  p|  p~  p    p  p  p `  `  `t  $    S   i   `  `  ` `$    ( p ) p 7 * p + p , p   - p `  ` `$   7 E p   F p `  $  m  `  $   `  $  m  `  $   `m  `$    2      X p Y p Z p[ p 7 \ p `Y  `[  `$  X 7 q pZ r p `  `$   7  p   `  p  p  p  p  p  p	  p  p  p  p  p  p  p  p  p  p  p  p  p  p  p   p!  p"  p#  p$  p%  p&  p'  p(  p)  p*  p+  p,  p-  p.  p/  p0  p1  p2  p3  p4  p5  p7  p;  p<  p=  p>  pJ  pL  pO  pQ  pS  pT  pU  pW  pX  pZ  p[  p\  p]  p^  p_  p`  pa  pc  pd  pf  px  py  p~  p  p  p  p  p  p  p  p  p  p  p  p  p  p  p  p  p  p  p  p  p  p  p  p  p  p  p  p  p  p  p  p  p  p  p  p  p  p  p  p  p  p  p  p  p  p  p  p  p  p  p  p  p  p  p  p  p  p  p  p  p  p  p p p p p p
 p p p p p p p p  p! p# p% p& p* p+ p, p- p/ p3 p4 p8 p9 p= p> pV pW pX pZ p[ p\ p] pa pb pc pd pe pf pj pk po ps pt py pz p{ p| p} p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p' p) p* p+ p, p0 p1 p2 p3 p4 p< p> p? p@ pA pE pF pG pM pO pP pQ pR pV pW p] p_ p` pa pb pf pg p| p~ p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p p  p p p p p p	 p
 p p p p p p p p p p  p! p" p# p% p& p. p/ p1 p2 p4 p5 p6 p7 p; p? p@ pB pG pH pI pJ pM pN pR pV p] p^ p_ pe pf pg ph pi pk pl pm pn po ps pt pw px pz p{ p| p} p~ p p p p p p                 Q     P  P  P  P  P  $        pg  p{  p  p  p  p  p  p p	 ? p- .  / m  p 7    p p p  p5 pH pX p h p p>  p p' pD p W pp p pX!                 	                                         !              0   6           '   	         f       _           	   `           /   ~                                R             9              K                                 L           ?           m             t               
                                    
                                                                          F           F     P       X     S       h     V       x     X            Z            \            ^            `            c         
   e         
   g            i            l         
   p            r         -   t       3     w       8     y       ?     {       M  	   }       V  	          _            n     B        g           |     ]        v           x           z                                                 I   ?                                                                                                                                 V             K           q             f           c                       ~  	                       	                       
                                                                                  
                        )                       $  
          .            N            C           i  !   C             /         	              8         #                                                                                                                                                                                                                                                 A             =                                                                 F          	   a             [                       ]            X                                             a                                                                                                 I        	     d             n                  "     c                   '     p       *  	   q       9     e       3           5           7           P     v       W  	   h       `  "          ,                                                                                                                !              $              '              *                B   H                                            
                                       c        #            1            6            A  "   .        ;           =           ?           c            v     w        {              "          }          
           
           
                       
                                    -                                                          
          I              F              H              &  ,   J        R     e        |            q           w                "       		     o       	             	           	           	           *	     r       5	     /       O	  &   7       w	  
   B       u	           	     q       	            	     E       	           	     p       	            	     5       	     l       	           	            	            	     m       \              Q              S              U              V              X              Z              
     K        	
     f        
            
            
  	          /
            )
           +
           -
           F
            N
  
          X
  	          a
  "          s              l              n              p              q              
  
   L        
     g        
            
            
            
           
           
           
            
  
                                                                                                                                                                                                              
     M        
     h        
  	          
            
                                                           /            +           7            D            >           @           B           W            \            j                                                                                                                                                                                                                
            0                                                                                                                                                                                                                                                                                                                                   	   Z             u          	   1                              '  
          1            >             8           :           <           Y  	   ?       b     >       j     $       ~                 E         
   F                                          	                                                                                                         Q            &                                                        T            P       #     [        (     v        `     Y       5           B  	         <           K           R           Y                [                                   /                                             f            *                                                                   j            ,            U            k       b  $            5              :              >              C              G              I              K              M              O              Q              R              T              X              [              ^              `                   N             i              Z            |            }       "  V                     x              
   o            p                                                                   	                                                          4   u                                         H            Z     x       O           T           V           X           l            s                        {           }                                                                                                                                      
                                          	               	           
                                           	   \                                                                                        /            )           +           -           O            I           K           M           `            s                                                                                                          G                     	               b             2            *                                             4             -                                        ,     6                                                                                                                                                                 ;  K   Q        9                            l             :                    	   o            <                        !           "           r         &   A            #           #      *     ?       (     $                                    
                                                                           1     R        /     %      H     m        S     w       U  	          d     y       ^     &      `     '      b     (      o            v              $                           ~       ,               "               $               &               (               )               *                    S             )           n                      	                           *           +           ,                              	            C               <               >               @               A                    O             -      "  	   j        +            -  	          <            6     .      8     /      :     0      G            N            V               O               Q               S               T               T     P        R     1      m  	   k        v            x  	                           2           3           4                                 '            b               h               n               s               w               {                                                                                                                                                                                                                    +   T             5           o                      	                           6           7           8                    /          8            0     9      4     9      H            O            ^            l  	          {  (          u     :      w     ;      y     <                                
                                                                                                                                                                                                =           >           ?                                
   W          *               @      2      r        T            R     A      Y     $       c            a     B      h  
   %       r                        ~     C           D           E        	   &                        F                       G        %   +       )     !       #     H      %     I      '     J      <     0       :     K      U     -       c            t  
               2       ~     L           7            9       8!  '                                          !              !              !              !              !              !              !              "!              &!              *!              ,!              .!              0!              2!              3!              4!              6!                +   U             M           p             H         	   Z            J            N           O           P      
     [         /   \       I     c       A     Q      E     Q      Y     D       `            o     @       }  	   r         (   M            R           S           T           s            Q         
   C       s!              _!              b!              e!              g!              i!              k!              m!              o!              p!              q!                
   X          *               U            s        5     z       3     V      :            D     x       B     W      I  
          S            e     v       _     X      a     Y      c     Z      y  	                                                    [           \           ]           ^                       _      	                 `      $            I            C     a      E     b      G     c      Z            k            x  
   }                        d                              !              !              !              !              !              !              !                	   Y                         e           t                          f                  
              	                            g           h           i      :            4     j      6     k      8     l      U            q            `     m                       n      !              !              !                   V          
               q                         o           o                                    p           q           r                        s           t           u      7            !              !              !              !              !              !              G  K   N                        l            v           v           v           v           v           m         
            	   n         "            7   g            w      E            S  
          ]            l  ?   p                   !              !              !                   \            ^            x           y           b         	   ^             z           x             [       	     z            |            Y                  
 !              !              +  	          4  4           h     y        ~  	          z     |      {     }      }     ~        	          H      '     '                    n    n                    ~  s  ~                           *                  	    	  E              W
  _  D
  _  Y                       k   <               "    "                      ~       '             $    $                 !  !  x!  !  $  ,            g#  #  ^#  #  1  ,          %  Y  %  Y  B            6(  rT  -(  rT  T  0           (  bT  (  bT  V  4           A  I  
A  I    H            F  WI  F  WI    K          U  TX  U  TX    /            .V  DX  %V  DX    4             Y  Y  Y  Y                 w]  [d  b]  [d                tf  g  [f  g  \              h  8i  qh  8i  l  &            vk  	n  Tk  	n  {  "            o  vq  o  vq                =s  u  -s  u                Ow  x  =w  x                {  Y~  {  Y~                -                          {    3              R    @                  ;    "                    M    M                3        <                o    o  a  #            H    2                    o    o                =    '                                          y    y                Q    6                    >    >                        *              I    .    D              A    '    ]                )    )  r                ( x  (               *                        )             	  	   &             B 
 B                                  d  @  "  $            R  R 3              \ H S H 6              n 0 T 0 @               d  \  N  #                 O  #                 P  #             X  2  U  &            u g _ g l              g 	 M 	             )  39   39              ! # ! #   -           E# $ =# $   &            v$ $ n$ $   +           % ' % '   (           K& ' C& '   +            & R' & R'   2           ( W* 
( W*   +           h( O* `( O*   0            ( C* ( C*   4            7 7 7 7 8  *            "8 D8 8 D8 ;  @           : > : > P             ]< > T< > ^  *           ? B ? B v            ^A B VA B   $            A B A B   %           C F C F              E F E F   (           G J G J              xI J oI J   '             K O K O               P ES P ES              S OT S OT                T )T S )T   ;             T U }T U               hU eV VU eV                U V U V "  !             V pW V pW ,               W VZ W VZ 9               Z [ Z [ O               b\ {a N\ {a [              a b a b               b d b d   /            ze h de h             h n h n   +           i l i l   ,             n x n x             x y x y 	  $            7y y .y y 	  4             z z y z 		              |  |  	               ^| | U| | 	  +             | | | | 	  +             } A} } A} 	  +             o} } f} } !	  +             } } } } $	  +             %~ R~ ~ R~ '	  +             ~ ~ w~ ~ *	  +             ~  ~  -	  +             9 i 0 i 0	  .                 3	  .              (  ( 6	  .             V  M  9	  +                 <	  +              9  9 ?	  +             g  ^  B	  +                 E	  +             G  *  L	              q 	 T 	 c	                  p	              R  I  	               , V # V 	  5                 	  4             H  (  	                 (  ( 	             b  F  	                  	  8                 	             1    	                <  < 	  $             _  V  	  !                 	  "             h  D  	  $            ] [ T [ 	               
 5  5 
  8             t  k  
  ;                 
  9             U  L  
  6              U  U "
  .              t  t +
  %             9 w  w :
  #            #  # S
  !                U
  =            q u R u \
                !  ! `
  !                 j
  '             c i A i r
  "            5  5 
  "             ( Z  Z 
  $             }  t  
  !              
  
 
  "               x  
  *                 
  -            {  L  
  /            L  L 
                P  P 
  ?                 
  @              A  A   A               v    :              4  4   9             r  i    #                   !              ;  ;   #             `  W    "                                 H  H "  -                *                   q  5            R  R u  4             	      3            m  N                 !      #           $  $   *             ,  ,               S  .    %             >  > !                # i # )             f  M  5                )  ) J  !             I n @ n M                   P               .    X  !                 q  )                  &           /                                      # I  I               `  W                   }    !              s  s                      "             0 [ ' [                }  t                                   -  -   F             s  j    >             Q y , y   %               {    -             X  X "                 7                *  * ;  8               v  A  3                 H               ;                 O  O               6 7 6 7   :           K K K K   f             ,O 0Q O 0Q                zQ R ^Q R 1             0S V S V @               U U U U R  $             U #V U #V U  !             GV tV >V tV X  "             W *X V *X a  '             QX a ,X a m  %            4a n a n   &          5o p  o p   5            ;p p 2p p   M             p q p q   4             q Lw q Lw   7          xw y Nw y   *            jy y ay y   C             z ${ y ${   )             R{ | &{ |   ,            "} ~ | ~   (           ~  ~  *  :            t  k  0  (             N    5  9             P O  O <  <              Q  L  7             P  P V                   h  3              5  5 l  6                 r  4              "  " x  ,             W  N  |  1              K 
 K   (                                  4 | 4              n  R                      8                               V  9                       $              3  3   !             W  N    "                   %                               = ,  ,   (                *  *           , H # H M                   Q  <             
 <  < U  @                 [  =              D  D a  5                 h  )                 {  '            5 (  (   &             ` ` `   &            !  !   '              9  9   $             \  S    !                   "               h    /             4 2  2   '           y  p                       R               x    =                 	  C              A  A   E               x    =             S  J    >                   D             L  C    E             p  g  &  9                 )  ?             C  :  /  1              T  T 3  R                 7  D             e  @  ?  %             N  +  P  #                e  3                v  )            M      =             ?  ?   (            q   A     0          D  "    "           ` \ W \   /                  !            S u J u   J              o  o   "                  %             {  r    $              	  	   !             - a $ a   "                   #                  ,                   /                (  .            6 X - X )  Y             g  g /  ,             P  G  9  $                 <  !              8  8 ?  "              f  f H  4              h  P  &                 Y  $              P  P \  !             t  k  _  "             H    h  .            A    s  #                 ~  $                     !             D x ; x   "                   +                   '           i  a                 7  7   F              x    E              h  h   E                  D             9 O 0 O   6               }    2                   8             1 H ) H   >                   7              K  K   5               {    4                   6             U  M    :              E   E     -                       1              5 	 5   4             z  r    A             b  Z    C                 !  7             W  O  &  4                 +  6             G  ?  /  =              } d } ;  "             < 	  	 L              	 
 	 
 `              (
 B
  
 B
 b  6              $ g $ p  1                  $            ~  O    /                                6 
 6                 X  P                                      g / ? /   (               c                 E   E    &            }  ! G  !   6            " $# ! $#   $           T# <( &# <(   .          $ 2( $ 2(    #           % +' % +' #  0            _' ' V' ' )  1             o( ) >( ) 1  1           %* E, ) E, >  (             *+ _+ !+ _+ F  $             + + y+ + I  !             + , + , L  "            q, . G, . S  *             v- - m- - [  $             - . - . ^  !             ). _.  . _. a  "             . ^/ . ^/ h  +           / [2 `/ [2 q  .            0 J0 / J0 t  Q             /1 d1 &1 d1 }  $             1 1 ~1 1   !             1 #2 1 #2   "             2 3 ]2 3   6             3 =5 3 =5   %            d5 7 ?5 7   %             =7 9 7 9   #          9 FA 9 FA   +            ; Y< ; Y<   [           < = < =   2             #= = = =   +           > q> = q>   1            z? ? q? ?   6            @ u@ @ u@   5             iA B HA B   !           3B tC B tC   .           B pC B pC   E           C jF vC jF   1            3D D *D D   >           E fF 	E fF   >            mE ^F dE ^F   -             F ;H F ;H   "          _H K =H K   "            H I H I    Q            fI I ]I I $  N             J J J J -  $             J K J K 0  !             AK tK 8K tK 3  "             L L K L <  *             L BN L BN E  ,            oN N DN N T  +            O O N O X  *            8Q z[ /Q z[ f              Q FR Q FR j  L            R R R R o  K            7S S .S S s  K            #T vT T vT x  J             T T T T ~  =             DU vU ;U vU   I             U V U V   K             EV wV <V wV   ?             V V V V   A             JW iW AW iW   8             W W W W   0             8X X /X X   H             ;Y Y 2Y Y   >             Y VZ Y VZ   E             Z Z Z Z   M             A[ v[ 8[ v[   H             i\ ] E\ ]   $             [^ ` 9^ `   "            ` e ` e   (            f g e g   4            g i g i   *          i  i  )  3             &      7                  2               \    8             G  G 	  C             z  z "  E            |  -  C                ?  3               _  )           L | C | e  )            T  T i  8                m  9                   (             C  C   )               v    !             l    3                   $              +  +   !             O  F    "             C      ;                 )            W  N    M             {  r    $                   !             : l 1 l   "             #      ;              6  6   2           b  9  
  )             h  _    $                   !              b  b   "             e  C  '  "                :                N  N >  R                 B  Q             ; R 3 R I  4                 O  6             = o 5 o U  &                 Y  %                 _  3             4 U , U j  2                 n  6                                )  )                K  C                                      # >  >   6             j  @    *                   $                 ,           L  C                    f    "           8      &                                M  M                 o  g                     #  "                 ;                 #  # <                E l = l =                   B  /             7 ] / ] J                  w  K                    L                R t  t Q  :                 o  *             U  4    !                                   +           I  @    !                               g  _    2                   0            M 
 - 
                 
 N
 
 N
   2             Y   2   !  '             a  a -                  A              K  K P               p  h  Z                    [                    \                    c  %            H    r  +              :  : y                \  T  z                    {                   }     3            f 	 ] 	                      %             a  X    <                   :             Z  Q    -                   *             @ t 7 t   (                   *              8  8   )            f  ]    )                  +            o L2 I L2   &             ! '" ! '"   D             3 g4 2 g4 A  5            .5 2: 
5 2: N  $           : ; h: ; n  (             ; ,; ; ,; q  !             ; = ; = z  #           H> t@ %> t@   #             j? ? a? ?   $             ? ? ? ?   !             @ O@ @ O@   "             @ -D @ -D   +           hD N HD N                I J I J   F             ^J hM UJ hM   >            O P N P   "             O O O O   !            Q T Q T                	R 8R  R 8R   <             }R R tR R   A             R S R S   B             vS S mS S #  =             S S S S '  C             MT ~T DT ~T -  0            T Y T Y 4  )             cW W ZW W A  D             ~Z \ WZ \ \  '            8] P] ] P] r  #             ] _ ] _ x  &           ` a _ a   (             ` ` ` `   $             ` 3a ` 3a   !             Wa a Na a   "             &b b a b   0             c Ui b Ui   /             )j Gt i Gt   -            t u tt u   +             v w dv w   %            x n{ x n{                x +y x +y   ;             oy y fy y   @             y z y z !  A             ez z \z z '  <             z z z z +  B             :{ j{ 1{ j{ 1  /            {  {  8  (             P~ ~ G~ ~ E  D             k  E  W  &             6  6 m  "               m  s  %                 '               y    $                   !             9 o 0 o   "                   /             ^  2    ,              n    $                                1  1   9             s  j    >                    :             n  e    -                  &             x  o    D             G  #    $            = U  U                       #               &  %                 )  $                   ,  !             D x ; x /  "              u  u 7  -                 B  "            " #  # Q                 y  U  :              $  $ Y  ?               x  _  ;                 e  .             ` e ` m  '              H  H z  D             )      %            $ <  <   !               r    $                 &               w    $                   !             5 j , j   "              i  i   .              ~  ~   #            % L  L                     V            I  A    W             u  u   R                  Q            e  ]     S                    S                
   R            t  l     T                   R             )  )    Q              x     S              B  B !   8               {  %   =              	  	 )   >             K  C  -   >                 3   9             1 H ) H 7   ?                 =   ,              H   H A   K             .  . H   )             * [ " [ [   8                    '                     #             ^  8     &           w  O     (              "  "    #             G x ? x    #                    #             g  7     0                    -            S  S !  +            0 J ( J !  P                 !  T             ;    1!  <              _  F!  >            #    R!  1                |!  ,               !  3             A r 9 r !                    !                 $  $ !                 s  s !  ;                 !  %                 !  1            F  F !               S  K  !  R              ;  ; !  Q                 !  3                 !  9             H i @ i !  2                 !  ?              E  E !  <                 !  4                 "  9              B  B "  ,            i e K e "                   y    "                        "                 9 
 9 "                  g  #"  &             [  =  /"               K n ' n ="  $            H p H J"  -            A  A v"                   "  "               "               T { L { "                -    "  &                "  $             ~  v  "                &  J!  J! "  ,             ! $ }! $ "  !           9% ' % ' #               & & & &  #                & ' & ' !#                =' d' 5' d' "#                ' ) ' ) (#  %           ) 1 ) 1 =#  ,           . 1 . 1 V#              1 l; 1 l; p#  +            4 : 4 : ~#               4< 7C < 7C #  (           C E C E #  '             D D D D #  !             D E D E #  !             .E UE &E UE #  !            E :I E :I #  0             H I H I $  @             kI J <I J $  /             eK -M =K -M $  (             M pN cM pN 8$  +            N P rN P B$  4             P SP P SP H$  @             P Q P Q O$  3             Q V Q V W$  6            VX Hc NX Hc $              X Y X Y $  U            uY Y mY Y $  V            Z Z Z Z $  Q            Z 4[ Z 4[ $  P            [ [ [ [ $  R            #\ \ \ \ $  R            \ :] \ :] $  Q            ] ] ] ] $  S            '^ ^ ^ ^ $  Q            ^ =_ ^ =_ $  P            _ _ _ _ $  R             *` P` "` P` $  7             ` ` ` ` $  <             ` a ` a $  =             Ra a Ja a $  =             a a a a $  8             3b Jb +b Jb $  >             b b b b $  +             c Dc b Dc $  J            c n c n $  (             g Mg g Mg $  8             n kq n kq %  &            q q q q 3%  "             1r s r s 9%  %           Et u t u J%  '             t t t t M%  #             u Cu u Cu N%  #             hu u `u u O%  #             /v v  v v U%  /             w & xw & `%  ,           |  R  %  *                %  O            @ i 8 i %  S              \  \ %  ;            , t  t %  =              v  %  0             K Y K %  +            : M : &  2                 &                 1  1 &                S  K  &                v  <  (&  :             i  E  4&  $             1    A&  0           3 ~ + ~ \&                   `&  Q             ?  7  d&  P                 k&  2             : [ 2 [ n&  8                 q&  1                 t&  >             \  T  w&  ;                 |&  3             ' >  > &  8             5 z , z &  +                 &  #           +    &  ,           \  S  &               q @ P @ &  !            u o u %'                (  ( ('                    /'  %                :'  #             ( T   T ='                    B'  +             C  #  Q'               %  % h'               F k > k s'                    t'                    u'                  b  {'  $             V b 9 b '                ?  ? '  %              |  '                )  ) '                K q C q '                   '               x  o  '                 '  +           e  \  '                 '  *                (                   A(  '           T c . c l(  &             D i < i s(  !                 t(  !                 u(  !                 (  '                 (  .             X 8 . 8 (  *            n N ; N (  3                 (  @              u Q u (  2               w  (  5            @   7   (                   (  S             B w 9 w (  R              Q  Q (  6                  )  :                   )  3             j    a    
)  5                   )  !            	  	 )  *           	  	  C)                   h)             4 4  4 )                   )  !               p  )  #                 )  /                )             N _ 4 _ )               `  W  )  $                 )  !              2  2 )  "             *"  *" )  "                     )  ,             
! L! ! L! )  )             x! ! o! ! )  *             " z# w" z# 
*  &           # , |# , *  )           ' + ' + 2*             2, 6 
, 6 P*  (            / 5 / 5 ^*              e7 9 \7 9 *               %9 V9 9 V9 *  <             9 9 9 9 *  :             <: < : < *  &             = C? g= C? *  -            
@ A ? A *  $           ;B 3C B 3C *  "            B B B B *  K            B /C B /C *  O             C  E hC  E *  #           OE H *E H 
+  %             G G G G +  $             G -H G -H +  !             QH H HH H +  "            I L H L '+  -             [K K RK K 6+  (             K K K K 9+  %             $L `L L `L <+  &             M ]O L ]O F+  +            P T P T c+              Q R Q R g+  :            AR yR 8R yR l+  9            R  S R  S p+  9            \S S SS S u+  8             S T S T y+  7           uT o RT o +  #          9o s 	o s <,  0           <t w t w _,             t t t t d,  Q            @u Zu 7u Zu g,  U            u u u u j,  U            0v Yv 'v Yv m,  R            v v v v p,  N             nx y >x y ~,  0            { | z | ,  %            o} F <} F ,  3              ,  5           E  E ,  .                  -  K           q  G  Y-  *             ! f ! r-  %             _  _ -  2              a  -  "              -                   -                -  - -  0             a  X  -  1                 -              $ D  D -               :  : -               e / ] / -               m 
 F 
 -  '           )    -                   -  +                 .              
    .                    ".               " m  m &.               = o = *.               m  d  3.                ~  O.                   P.  6              m  m \.  "              o  r.  $              g  g .  "             i  .  !                 .                      .                B H : H .                 &  & .  )           53UI1C46      b b Cb   n    O^partitionKey=%28https%2Cngeconnect.fr%29,:https://ucopia-lvbca.ngeconnect.fr/100/portal/portal.js?1637144850 strongly-framed 1 security-info FnhllAKWRHGAlo+ESXykKAAAAAAAAAAAwAAAAAAAAEaphjojH6pBabDSgSnsfLHeAAAAAgAAAAAAAAAAAAAAAAAAAAEANgFmCjImkVxP+7sgiYWmMt8FvcOXmlQiTNWFiWlrbpbqgwAAAAAAAAZjMIIGXzCCBUegAwIBAgIQLMhE8ypLcEecqPgLs1TzOTANBgkqhkiG9w0BAQsFADBfMQswCQYDVQQGEwJGUjEOMAwGA1UECBMFUGFyaXMxDjAMBgNVBAcTBVBhcmlzMQ4wDAYDVQQKEwVHYW5kaTEgMB4GA1UEAxMXR2FuZGkgU3RhbmRhcmQgU1NMIENBIDIwHhcNMjEwODAyMDAwMDAwWhcNMjIwODAyMjM1OTU5WjAlMSMwIQYDVQQDExp1Y29waWEtbHZiY2EubmdlY29ubmVjdC5mcjCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAL0r8CkPa4eUpvLfvIjJ57RSNqpMQy9sPiiujTQYNnrpQxS79bzF4/Nfq+yvSvcJi6azATiSIrlYhmtHDUSMfx8aoRxlGrGbE+7HvXXE3QdH5ghSM13vrL/IM0q/p8cC2cAGoUTkNim8r0ilf+wgaawfOH7dp0df+QmFGeHT+KrW7JLvyb9Y9UxBKpHoW2OcVMa2Zv8DW8jso6yuHY9WTToz9g9qgLgdx43AW4gQuvduHLbXrw4aA0HRKIaHXR+swW+2PBWD8unU3Hq9uEMhRpwY5MCR82yof4Ym7hQgLYvRotFqu3jBQmlHQInLh+zYUVZKUa1jkoRTaRuuDVM2Q2cCAwEAAaOCA08wggNLMB8GA1UdIwQYMBaAFLOQp9jJr07NYTyffK1df0H9aTDqMB0GA1UdDgQWBBQYgMxcTzFn4KfnsaiSqxoywcWKyjAOBgNVHQ8BAf8EBAMCBaAwDAYDVR0TAQH/BAIwADAdBgNVHSUEFjAUBggrBgEFBQcDAQYIKwYBBQUHAwIwSwYDVR0gBEQwQjA2BgsrBgEEAbIxAQICGjAnMCUGCCsGAQUFBwIBFhlodHRwczovL2Nwcy51c2VydHJ1c3QuY29tMAgGBmeBDAECATBBBgNVHR8EOjA4MDagNKAyhjBodHRwOi8vY3JsLnVzZXJ0cnVzdC5jb20vR2FuZGlTdGFuZGFyZFNTTENBMi5jcmwwcwYIKwYBBQUHAQEEZzBlMDwGCCsGAQUFBzAChjBodHRwOi8vY3J0LnVzZXJ0cnVzdC5jb20vR2FuZGlTdGFuZGFyZFNTTENBMi5jcnQwJQYIKwYBBQUHMAGGGWh0dHA6Ly9vY3NwLnVzZXJ0cnVzdC5jb20wRQYDVR0RBD4wPIIadWNvcGlhLWx2YmNhLm5nZWNvbm5lY3QuZnKCHnd3dy51Y29waWEtbHZiY2EubmdlY29ubmVjdC5mcjCCAX4GCisGAQQB1nkCBAIEggFuBIIBagFoAHYARqVV63X6kSAwtaKJafTzfREsQXS+/Um4havy/HD+bUcAAAF7BeJMjgAABAMARzBFAiA74dRanyqnKpkJ7fTgR58Xm7W1jhOLDCF5s1mzZCsaFgIhALQZjiKIT5U44wZ4K0+4IVr8ACuDq1RrvAd1VIaC6hAcAHYAQcjKsd8iRkoQxqE6CUKHXk4xixsD6+tLx2jwkGKWBvYAAAF7BeJMbgAABAMARzBFAiB+HZ2/sB0bEOiYgPf7mGNTd1qja9oWFDqunK/keVf6EAIhALIVCOD5jgI7duT+t6+ux1P4QU8molaXjnR2HrxGle7FAHYAKXm+8J45OSHwVnOfY6V35b5XfZxgCvj5TV0mXCVdx4QAAAF7BeJMPgAABAMARzBFAiEAkd+e35dXCcwxSJNnVgrJGui/F/3PXH2QKFT2aLjB/a4CIBNugsR//doubyCR4YzRv8GtQiaQMZMwl51g7uh6TXZuMA0GCSqGSIb3DQEBCwUAA4IBAQBPSX0EF+CVFUv+DlI2Tvf0E1QYLd/DdtdQMqjTg5dkSp95PbeUalRl6/nbFH8qIWr8iwWp3eUS9c8iss9+c7jAwuuzEFOkfFfRbD6h/oGU2Tj1OaR1xq7nxw6kP3wwq2b+5MS/1/oBS4pL96f2qHr5GshFv3Yzi47KFhaNKdSm4/qEhfvgM2r7JMG6OxH0kUkUqV3GVbzbsZLdzHPXBY0vH9Wuuo/rUgE+Cn10H+bf66nogkZwII+IAHZLtW2pU3ave5Vd+f7Oat0mpDrdOaTKCvWCrKveQkpHnXmrr0QiBFoxL1AlrlPLIiyDIFQ3VJ7ch9+9IGaMTbbFN4WQJtNywC8AAwAAAAABAQAAAAAAAARub25lAAAAEFJTQS1QS0NTMS1TSEEyNTYAA2YKMiaRXE/7uyCJhaYy3wW9w5eaVCJM1YWJaWtuluqDAAAAAAAABmMwggZfMIIFR6ADAgECAhAsyETzKktwR5yo+AuzVPM5MA0GCSqGSIb3DQEBCwUAMF8xCzAJBgNVBAYTAkZSMQ4wDAYDVQQIEwVQYXJpczEOMAwGA1UEBxMFUGFyaXMxDjAMBgNVBAoTBUdhbmRpMSAwHgYDVQQDExdHYW5kaSBTdGFuZGFyZCBTU0wgQ0EgMjAeFw0yMTA4MDIwMDAwMDBaFw0yMjA4MDIyMzU5NTlaMCUxIzAhBgNVBAMTGnVjb3BpYS1sdmJjYS5uZ2Vjb25uZWN0LmZyMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAvSvwKQ9rh5Sm8t+8iMnntFI2qkxDL2w+KK6NNBg2eulDFLv1vMXj81+r7K9K9wmLprMBOJIiuViGa0cNRIx/HxqhHGUasZsT7se9dcTdB0fmCFIzXe+sv8gzSr+nxwLZwAahROQ2KbyvSKV/7CBprB84ft2nR1/5CYUZ4dP4qtbsku/Jv1j1TEEqkehbY5xUxrZm/wNbyOyjrK4dj1ZNOjP2D2qAuB3HjcBbiBC6924cttevDhoDQdEohoddH6zBb7Y8FYPy6dTcer24QyFGnBjkwJHzbKh/hibuFCAti9Gi0Wq7eMFCaUdAicuH7NhRVkpRrWOShFNpG64NUzZDZwIDAQABo4IDTzCCA0swHwYDVR0jBBgwFoAUs5Cn2MmvTs1hPJ98rV1/Qf1pMOowHQYDVR0OBBYEFBiAzFxPMWfgp+exqJKrGjLBxYrKMA4GA1UdDwEB/wQEAwIFoDAMBgNVHRMBAf8EAjAAMB0GA1UdJQQWMBQGCCsGAQUFBwMBBggrBgEFBQcDAjBLBgNVHSAERDBCMDYGCysGAQQBsjEBAgIaMCcwJQYIKwYBBQUHAgEWGWh0dHBzOi8vY3BzLnVzZXJ0cnVzdC5jb20wCAYGZ4EMAQIBMEEGA1UdHwQ6MDgwNqA0oDKGMGh0dHA6Ly9jcmwudXNlcnRydXN0LmNvbS9HYW5kaVN0YW5kYXJkU1NMQ0EyLmNybDBzBggrBgEFBQcBAQRnMGUwPAYIKwYBBQUHMAKGMGh0dHA6Ly9jcnQudXNlcnRydXN0LmNvbS9HYW5kaVN0YW5kYXJkU1NMQ0EyLmNydDAlBggrBgEFBQcwAYYZaHR0cDovL29jc3AudXNlcnRydXN0LmNvbTBFBgNVHREEPjA8ghp1Y29waWEtbHZiY2EubmdlY29ubmVjdC5mcoIed3d3LnVjb3BpYS1sdmJjYS5uZ2Vjb25uZWN0LmZyMIIBfgYKKwYBBAHWeQIEAgSCAW4EggFqAWgAdgBGpVXrdfqRIDC1oolp9PN9ESxBdL79SbiFq/L8cP5tRwAAAXsF4kyOAAAEAwBHMEUCIDvh1FqfKqcqmQnt9OBHnxebtbWOE4sMIXmzWbNkKxoWAiEAtBmOIohPlTjjBngrT7ghWvwAK4OrVGu8B3VUhoLqEBwAdgBByMqx3yJGShDGoToJQodeTjGLGwPr60vHaPCQYpYG9gAAAXsF4kxuAAAEAwBHMEUCIH4dnb+wHRsQ6JiA9/uYY1N3WqNr2hYUOq6cr+R5V/oQAiEAshUI4PmOAjt25P63r67HU/hBTyaiVpeOdHYevEaV7sUAdgApeb7wnjk5IfBWc59jpXflvld9nGAK+PlNXSZcJV3HhAAAAXsF4kw+AAAEAwBHMEUCIQCR357fl1cJzDFIk2dWCska6L8X/c9cfZAoVPZouMH9rgIgE26CxH/92i5vIJHhjNG/wa1CJpAxkzCXnWDu6HpNdm4wDQYJKoZIhvcNAQELBQADggEBAE9JfQQX4JUVS/4OUjZO9/QTVBgt38N211AyqNODl2RKn3k9t5RqVGXr+dsUfyohavyLBand5RL1zyKyz35zuMDC67MQU6R8V9FsPqH+gZTZOPU5pHXGrufHDqQ/fDCrZv7kxL/X+gFLikv3p/aoevkayEW/djOLjsoWFo0p1Kbj+oSF++Azavskwbo7EfSRSRSpXcZVvNuxkt3Mc9cFjS8f1a66j+tSAT4KfXQf5t/rqeiCRnAgj4gAdku1balTdq97lV35/s5q3SakOt05pMoK9YKsq95CSkedeauvRCIEWjEvUCWuU8siLIMgVDdUntyH370gZoxNtsU3hZAm03JmCjImkVxP+7sgiYWmMt8FvcOXmlQiTNWFiWlrbpbqgwAAAAAAAAXtMIIF6TCCA9GgAwIBAgIQBeTcO5Q4qzuFl8umoZhQ4zANBgkqhkiG9w0BAQwFADCBiDELMAkGA1UEBhMCVVMxEzARBgNVBAgTCk5ldyBKZXJzZXkxFDASBgNVBAcTC0plcnNleSBDaXR5MR4wHAYDVQQKExVUaGUgVVNFUlRSVVNUIE5ldHdvcmsxLjAsBgNVBAMTJVVTRVJUcnVzdCBSU0EgQ2VydGlmaWNhdGlvbiBBdXRob3JpdHkwHhcNMTQwOTEyMDAwMDAwWhcNMjQwOTExMjM1OTU5WjBfMQswCQYDVQQGEwJGUjEOMAwGA1UECBMFUGFyaXMxDjAMBgNVBAcTBVBhcmlzMQ4wDAYDVQQKEwVHYW5kaTEgMB4GA1UEAxMXR2FuZGkgU3RhbmRhcmQgU1NMIENBIDIwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCUBC2meZV0/9UAPPWu2JSxKXzAjwsLibmCg5duNyj1ohrP0pILm6jTh5RzhBCf3DXLwi2SrCG5yzv8QMHBgyHwv/j2nPqcghDA0I5O5Q1MsJFckLSkQFEW2uSEEi0FXKEfFxkkUap66uEHG4aNAXLy59SDIzme4OFMH2sio7QQZrDtgpbXbmq08j+1QvzdirWrui0dOnWbMdw+naxb00ENbLAb9Tr1eeohovj0M1JLJC0epJmxbUi8uBL+cnB89/sCdfSN3tbawKAyGlLfOGsuRTg/PwSWAP2h9KK71RfWJ3wbWFmVXooS/ZyrgT5SKEhRhWvzkbKGPym1bgNi7tYFAgMBAAGjggF1MIIBcTAfBgNVHSMEGDAWgBRTeb9aqitKz1SA4dibwJ3ysgNmyzAdBgNVHQ4EFgQUs5Cn2MmvTs1hPJ98rV1/Qf1pMOowDgYDVR0PAQH/BAQDAgGGMBIGA1UdEwEB/wQIMAYBAf8CAQAwHQYDVR0lBBYwFAYIKwYBBQUHAwEGCCsGAQUFBwMCMCIGA1UdIAQbMBkwDQYLKwYBBAGyMQECAhowCAYGZ4EMAQIBMFAGA1UdHwRJMEcwRaBDoEGGP2h0dHA6Ly9jcmwudXNlcnRydXN0LmNvbS9VU0VSVHJ1c3RSU0FDZXJ0aWZpY2F0aW9uQXV0aG9yaXR5LmNybDB2BggrBgEFBQcBAQRqMGgwPwYIKwYBBQUHMAKGM2h0dHA6Ly9jcnQudXNlcnRydXN0LmNvbS9VU0VSVHJ1c3RSU0FBZGRUcnVzdENBLmNydDAlBggrBgEFBQcwAYYZaHR0cDovL29jc3AudXNlcnRydXN0LmNvbTANBgkqhkiG9w0BAQwFAAOCAgEAWGf9crJq13xhlhl+2UNG0SZ9yFP6ZrBrLafTqlb3OojQO3LJUP33WbKqaPWMcwO7lWUXzi8c3ZgTopHJ7qFAbjyY1lzzsiI8Le4bpOHeICQW8owRc5E69vrOJAKHypPstLbIFhfFcvwnQPYT/pOmnVHvPCvYd1ebjGU6NSU2t7WKY28HJ5OxYI2A25bUeo8tqxyIyW5+1mUfr13KFj8oRtygNeX56eXVlogMT8a3d2dIhCe2H7Bo26y/d7CQuKLJHDJdArolQ4FCR7vY4Y8MDEZf7kYzawMUgtN+zY+vkNaOJH1AQrRqahfGlZfh8jjNp+20J0CT33KpuMZmYzc4ZCIwojvxuch7yPspOqsactIGEk72gtQjbz7Dk+XYtsDe3CMW1hMwt6CaDixVBgBwAc/qOR2A24j3pSC4W/0xJmmPLQphgzpHphNULB7j7UTKvGofKA5R2d4On3XNDgOVyvnFqSot/kGkoUeuDcL5OWYzSlvhhChZbH2UF3bkRYKtcCD90m9jqNf6oDP6N8v3smWe2lBvP+Sn845dWDKXcCMu5/3EFZucJ48y7RetWIExKREam9T8bJUox04FB6b9HbwZ4ui3uRGKLXASUoWNjDNKD/yZkuBjcNqllEdjB+dYxzFfBT02Vf6Dsuimrdfp5gJ0iHRc2jTbkNJtUQoj1iNmCjImkVxP+7sgiYWmMt8FvcOXmlQiTNWFiWlrbpbqgwAAAAAAAAXiMIIF3jCCA8agAwIBAgIQAf1tMPyjylGoG7xkDjUDLTANBgkqhkiG9w0BAQwFADCBiDELMAkGA1UEBhMCVVMxEzARBgNVBAgTCk5ldyBKZXJzZXkxFDASBgNVBAcTC0plcnNleSBDaXR5MR4wHAYDVQQKExVUaGUgVVNFUlRSVVNUIE5ldHdvcmsxLjAsBgNVBAMTJVVTRVJUcnVzdCBSU0EgQ2VydGlmaWNhdGlvbiBBdXRob3JpdHkwHhcNMTAwMjAxMDAwMDAwWhcNMzgwMTE4MjM1OTU5WjCBiDELMAkGA1UEBhMCVVMxEzARBgNVBAgTCk5ldyBKZXJzZXkxFDASBgNVBAcTC0plcnNleSBDaXR5MR4wHAYDVQQKExVUaGUgVVNFUlRSVVNUIE5ldHdvcmsxLjAsBgNVBAMTJVVTRVJUcnVzdCBSU0EgQ2VydGlmaWNhdGlvbiBBdXRob3JpdHkwggIiMA0GCSqGSIb3DQEBAQUAA4ICDwAwggIKAoICAQCAEmUXNg7D2wiz0KxXDXbtzSfTTK1Qg2HiqiBNCS1kCdzOiZ/MPans9s/B3PHTsdZ7NygRK0faOca8Ohm0X6a9fZ2jY0K2dvKpOyuR+OJv0OwWIJAJPuLodMkYtJHUYmTbf6MG8YgYapAiPLz+E/CHFHv25B+O1ORRxhFnRghRy4YUVD+8M/5+bJz/Fp0YvVGONaanZshyZ9shZrHUm3gDwFA66Mzw3LyeTP6vBZY1H1dat//O+T23LLb2VN3I5xI6Ta5MirdcmrS3ID3KfyI0rn47aGYBROcBTkZTmzNg95S+UzeQc0PzMsNT79uq/nROacdrjGCT3sTHDN/hMq7MkztReJVni+49Vv4M0GkPGw/zJSZrM233bkf6c0Plfg6lZrEpfDKEY1WJxA3Bk1QwGROs0303p+tdOmw1XNtB1xLaqUkL39iAigmTYo61Zs8liM2EuLE/pDkP2QKe6xJMlXzzawWpXhaDzLhn4ugTncxbgtNMs+1b/97lc6wjOy0AvzVVdAlJ2ElYGn+SNuZRkg7zJn0cTRe8yexDJtC/QV9AqURE9JnnV4eeUB9XVKg+/XRjL7FQZQnmWEIuQxpMtPAlR1n6BB6T1CZGSlCBst6+eLf8ZxXhyVeEHg9j1uliutZfVS7qXMYoCAQlObgOK6nyTJccBz8NUvXt7y+CDwIDAQABo0IwQDAdBgNVHQ4EFgQUU3m/WqorSs9UgOHYm8Cd8rIDZsswDgYDVR0PAQH/BAQDAgEGMA8GA1UdEwEB/wQFMAMBAf8wDQYJKoZIhvcNAQEMBQADggIBAFzUfA3P9wF9QZllDHPFUp/L+M+ZBn8b2kMVn54CVVeWFPFSPCeHlCjtHzoBN6J2/FNQwISbxmtOuowhT6KOVWKR82kV2LyI48SqC/3vqOlLVSoGIG1VeCkZ7l8wXEskEVX/JJpuXior7gtNn3/3ATiUFJVDBwn7YKnuHKsSjKCaXqeYalltiz8I+8jRRa8YFWSQEg9zKC7F4iRO/Fjs8PRF/iKz6y+O0tlFYQXBl2+odnKPi4w2r78NBc5xjeambx9spnFixdjQg3IM8WcRiQycE0xyNN+81XHfqnHd4blsjDwSXWXavVcStkNr/+XeTWYRUc+ZruwXtuhxkYzeSf7dNXGiFSeUHM9h4ya7b6NnJSFd5t0dCy5oGzuCr+yDZ4XUmFF0sbmZgIn/f3gZXHlKYC6SQK5MNyosycdiyA5d9zZbyuAlJQG03RoHnHcAP9Dc1ew91Pq7P8yF1m9/qS3fuQL39ZeatTXaw2ewh0qpKJ4jjv9cJ2vhsE/zB+4ALtRZh8tSQZXq9EfX7mRBVXyNWQKV3WKdwrnuWih0hKWbt5DHDAff9Yk2dDLWKMGwsAvgnEzDHNb842m1R0aBL6KCq9NjRHDEjf8tM7qtj3u1cIiuPhnPQCjY/MiQu12ZIvVS5ljFH4gxQ+6IHdfGjjxDah2nGN59PRbxYvnKkKj9AAAAAQAAAAABAAA= request-method GET response-head HTTP/1.1 200 OK
Last-Modified: Wed, 08 Dec 2021 02:44:22 GMT
ETag: "6d627-5d29977a24568"
Accept-Ranges: bytes
Content-Length: 448039
Content-Type: application/javascript
Date: Mon, 07 Feb 2022 04:40:00 GMT
Server: Apache
 original-response-headers Date: Tue, 04 Jan 2022 04:33:35 GMT
Server: Apache
Last-Modified: Wed, 08 Dec 2021 02:44:22 GMT
ETag: "6d627-5d29977a24568"
Accept-Ranges: bytes
Content-Length: 448039
Keep-Alive: timeout=1, max=95
Connection: Keep-Alive
Content-Type: application/javascript
 ctid 2 uncompressed-len 0 net-response-time-onstart 5302 net-response-time-onstop 5974 necko:classified 1 alt-data 1;448039,javascript/moz-bytecode-20211215221728-8l alt-data-from-child 1  